<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Cataclysm BN: ranged Namespace Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Cataclysm BN
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('namespaceranged.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#enum-members">Enumerations</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">ranged Namespace Reference</div></div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structranged_1_1aim__type.html">aim_type</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="enum-members" name="enum-members"></a>
Enumerations</h2></td></tr>
<tr class="memitem:a5d9da06327706ab87ae19ee9dc08de53"><td class="memItemLeft" align="right" valign="top">enum class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceranged.html#a5d9da06327706ab87ae19ee9dc08de53">hit_tier</a> : int { <a class="el" href="namespaceranged.html#a5d9da06327706ab87ae19ee9dc08de53a52b0f37c2ac81918f900f3d3e6c98597">grazing</a> = 0
, <a class="el" href="namespaceranged.html#a5d9da06327706ab87ae19ee9dc08de53afea087517c26fadd409bd4b9dc642555">normal</a>
, <a class="el" href="namespaceranged.html#a5d9da06327706ab87ae19ee9dc08de53a7e85bcb66fb9a809d5ab4f62a8b8bea8">critical</a>
 }</td></tr>
<tr class="separator:a5d9da06327706ab87ae19ee9dc08de53"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a7a391700b761ffa6bc80dc0a998267cb"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceranged.html#a7a391700b761ffa6bc80dc0a998267cb">draw_cone_aoe</a> (const <a class="el" href="structtripoint.html">tripoint</a> &amp;origin, const std::map&lt; <a class="el" href="structtripoint.html">tripoint</a>, double &gt; &amp;aoe)</td></tr>
<tr class="separator:a7a391700b761ffa6bc80dc0a998267cb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad0ad7f6e4c593e68012655f0befed8cf"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceranged.html#ad0ad7f6e4c593e68012655f0befed8cf">hit_chance</a> (const <a class="el" href="classdispersion__sources.html">dispersion_sources</a> &amp;dispersion, double <a class="el" href="character_8h.html#addab86bfe6fd0bf8c22ec43df3ec051da1c21724609ac70f1573fd4b755c64ddb">range</a>, double target_size, double missed_by=1.0)</td></tr>
<tr class="memdesc:ad0ad7f6e4c593e68012655f0befed8cf"><td class="mdescLeft">&#160;</td><td class="mdescRight">The chance that a fired shot reaches required accuracy - by default grazing shot.  <a href="namespaceranged.html#ad0ad7f6e4c593e68012655f0befed8cf">More...</a><br /></td></tr>
<tr class="separator:ad0ad7f6e4c593e68012655f0befed8cf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af042bc3e3b1ea1c57a42ee323ad284a8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceranged.html#af042bc3e3b1ea1c57a42ee323ad284a8">print_dmg_msg</a> (<a class="el" href="classCreature.html">Creature</a> &amp;target, <a class="el" href="classCreature.html">Creature</a> *source, const <a class="el" href="structdealt__damage__instance.html">dealt_damage_instance</a> &amp;dealt_dam, <a class="el" href="namespaceranged.html#a5d9da06327706ab87ae19ee9dc08de53">hit_tier</a> ht)</td></tr>
<tr class="separator:af042bc3e3b1ea1c57a42ee323ad284a8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a51e6279a2008714e5596da4f5fa1b00e"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structdealt__damage__instance.html">dealt_damage_instance</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceranged.html#a51e6279a2008714e5596da4f5fa1b00e">hit_with_aoe</a> (<a class="el" href="classCreature.html">Creature</a> &amp;target, <a class="el" href="classCreature.html">Creature</a> *source, const <a class="el" href="structdamage__instance.html">damage_instance</a> &amp;di)</td></tr>
<tr class="separator:a51e6279a2008714e5596da4f5fa1b00e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeadf3905fda7ac9f7e6e13d78d6beadb"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceranged.html#aeadf3905fda7ac9f7e6e13d78d6beadb">throw_cost</a> (const <a class="el" href="classCharacter.html">Character</a> &amp;<a class="el" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>, const <a class="el" href="classitem.html">item</a> &amp;to_throw)</td></tr>
<tr class="separator:aeadf3905fda7ac9f7e6e13d78d6beadb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4c8c85e0249f67213d9994612315aa3e"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceranged.html#a4c8c85e0249f67213d9994612315aa3e">get_str_draw_penalty</a> (const <a class="el" href="classitem.html">item</a> &amp;it, const <a class="el" href="classCharacter.html">Character</a> &amp;p)</td></tr>
<tr class="memdesc:a4c8c85e0249f67213d9994612315aa3e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Penalties potentially incurred by STR_DRAW weapons.  <a href="namespaceranged.html#a4c8c85e0249f67213d9994612315aa3e">More...</a><br /></td></tr>
<tr class="separator:a4c8c85e0249f67213d9994612315aa3e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a32d7ead84f4eb01b4050fdbbca0767ea"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceranged.html#a32d7ead84f4eb01b4050fdbbca0767ea">str_draw_damage_modifier</a> (const <a class="el" href="classitem.html">item</a> &amp;it, const <a class="el" href="classCharacter.html">Character</a> &amp;p)</td></tr>
<tr class="separator:a32d7ead84f4eb01b4050fdbbca0767ea"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a613a2847b3c06998d6117f2630fc9ed5"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceranged.html#a613a2847b3c06998d6117f2630fc9ed5">str_draw_dispersion_modifier</a> (const <a class="el" href="classitem.html">item</a> &amp;it, const <a class="el" href="classCharacter.html">Character</a> &amp;p)</td></tr>
<tr class="separator:a613a2847b3c06998d6117f2630fc9ed5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa7a46e309ff8892e692a92511635a4eb"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceranged.html#aa7a46e309ff8892e692a92511635a4eb">str_draw_range_modifier</a> (const <a class="el" href="classitem.html">item</a> &amp;it, const <a class="el" href="classCharacter.html">Character</a> &amp;p)</td></tr>
<tr class="separator:aa7a46e309ff8892e692a92511635a4eb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afd6b1338d47e5ecd34de75b921c11113"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceranged.html#afd6b1338d47e5ecd34de75b921c11113">throw_dispersion_per_dodge</a> (const <a class="el" href="classCharacter.html">Character</a> &amp;<a class="el" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>, bool add_encumbrance)</td></tr>
<tr class="memdesc:afd6b1338d47e5ecd34de75b921c11113"><td class="mdescLeft">&#160;</td><td class="mdescRight">How much dispersion does one point of target's dodge add when throwing at said target?  <a href="namespaceranged.html#afd6b1338d47e5ecd34de75b921c11113">More...</a><br /></td></tr>
<tr class="separator:afd6b1338d47e5ecd34de75b921c11113"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a54895869f69a00b4a74df15057a9a780"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceranged.html#a54895869f69a00b4a74df15057a9a780">throwing_dispersion</a> (const <a class="el" href="classCharacter.html">Character</a> &amp;<a class="el" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>, const <a class="el" href="classitem.html">item</a> &amp;to_throw, <a class="el" href="classCreature.html">Creature</a> *critter, bool is_blind_throw)</td></tr>
<tr class="memdesc:a54895869f69a00b4a74df15057a9a780"><td class="mdescLeft">&#160;</td><td class="mdescRight">Dispersion of a thrown item, against a given target, taking into account whether or not the throw was blind.  <a href="namespaceranged.html#a54895869f69a00b4a74df15057a9a780">More...</a><br /></td></tr>
<tr class="separator:a54895869f69a00b4a74df15057a9a780"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaaa4e309fe9b7ad615954c9f7524ddce"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structdealt__projectile__attack.html">dealt_projectile_attack</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceranged.html#aaaa4e309fe9b7ad615954c9f7524ddce">throw_item</a> (<a class="el" href="classCharacter.html">Character</a> &amp;who, const <a class="el" href="structtripoint.html">tripoint</a> &amp;target, const <a class="el" href="classitem.html">item</a> &amp;to_throw, <a class="el" href="generic__factory_8h.html#a1159dbaba81931271dbfe5b9c7f041b3">std::optional</a>&lt; <a class="el" href="structtripoint.html">tripoint</a> &gt; blind_throw_from_pos)</td></tr>
<tr class="memdesc:aaaa4e309fe9b7ad615954c9f7524ddce"><td class="mdescLeft">&#160;</td><td class="mdescRight">Execute a throw.  <a href="namespaceranged.html#aaaa4e309fe9b7ad615954c9f7524ddce">More...</a><br /></td></tr>
<tr class="separator:aaaa4e309fe9b7ad615954c9f7524ddce"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3fc846128cfc30100d71fbb6e2d482c5"><td class="memItemLeft" align="right" valign="top">std::vector&lt; <a class="el" href="classCreature.html">Creature</a> * &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceranged.html#a3fc846128cfc30100d71fbb6e2d482c5">targetable_creatures</a> (const <a class="el" href="classCharacter.html">Character</a> &amp;<a class="el" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>, const int <a class="el" href="character_8h.html#addab86bfe6fd0bf8c22ec43df3ec051da1c21724609ac70f1573fd4b755c64ddb">range</a>)</td></tr>
<tr class="separator:a3fc846128cfc30100d71fbb6e2d482c5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a41e7f0a8b2c552d2f8ec4c8a4930c7af"><td class="memItemLeft" align="right" valign="top">std::vector&lt; <a class="el" href="classCreature.html">Creature</a> * &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceranged.html#a41e7f0a8b2c552d2f8ec4c8a4930c7af">targetable_creatures</a> (const <a class="el" href="classCharacter.html">Character</a> &amp;<a class="el" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>, const int <a class="el" href="character_8h.html#addab86bfe6fd0bf8c22ec43df3ec051da1c21724609ac70f1573fd4b755c64ddb">range</a>, const <a class="el" href="classturret__data.html">turret_data</a> &amp;turret)</td></tr>
<tr class="separator:a41e7f0a8b2c552d2f8ec4c8a4930c7af"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5332ed56c9f0b3702e72aecdcaa1e7be"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceranged.html#a5332ed56c9f0b3702e72aecdcaa1e7be">burst_penalty</a> (const <a class="el" href="classCharacter.html">Character</a> &amp;p, const <a class="el" href="classitem.html">item</a> &amp;gun, int gun_recoil)</td></tr>
<tr class="separator:a5332ed56c9f0b3702e72aecdcaa1e7be"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aed4420a1fd77e160a72de2a528e56da5"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceranged.html#aed4420a1fd77e160a72de2a528e56da5">gunmode_checks_common</a> (<a class="el" href="classavatar.html">avatar</a> &amp;you, const <a class="el" href="classmap.html">map</a> &amp;m, std::vector&lt; std::string &gt; &amp;messages, const <a class="el" href="classgun__mode.html">gun_mode</a> &amp;gmode)</td></tr>
<tr class="memdesc:aed4420a1fd77e160a72de2a528e56da5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Common checks for gunmode (when firing a weapon / manually firing turret)  <a href="namespaceranged.html#aed4420a1fd77e160a72de2a528e56da5">More...</a><br /></td></tr>
<tr class="separator:aed4420a1fd77e160a72de2a528e56da5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a743f9e35b20c136e56ca9e9480fb27bc"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceranged.html#a743f9e35b20c136e56ca9e9480fb27bc">gunmode_checks_weapon</a> (<a class="el" href="classavatar.html">avatar</a> &amp;you, const <a class="el" href="classmap.html">map</a> &amp;m, std::vector&lt; std::string &gt; &amp;messages, const <a class="el" href="classgun__mode.html">gun_mode</a> &amp;gmode)</td></tr>
<tr class="memdesc:a743f9e35b20c136e56ca9e9480fb27bc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Various checks for gunmode when firing a weapon.  <a href="namespaceranged.html#a743f9e35b20c136e56ca9e9480fb27bc">More...</a><br /></td></tr>
<tr class="separator:a743f9e35b20c136e56ca9e9480fb27bc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae6187116a03c20b18135711490b2e961"><td class="memItemLeft" align="right" valign="top"><a class="el" href="generic__factory_8h.html#a1159dbaba81931271dbfe5b9c7f041b3">std::optional</a>&lt; <a class="el" href="classshape__factory.html">shape_factory</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceranged.html#ae6187116a03c20b18135711490b2e961">get_shape_factory</a> (const <a class="el" href="classitem.html">item</a> &amp;gun)</td></tr>
<tr class="memdesc:ae6187116a03c20b18135711490b2e961"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns shaped attack used by the gun+ammo, if set.  <a href="namespaceranged.html#ae6187116a03c20b18135711490b2e961">More...</a><br /></td></tr>
<tr class="separator:ae6187116a03c20b18135711490b2e961"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ade9b38890f46ab6cbe94e1004f0ea5f1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceranged.html#ade9b38890f46ab6cbe94e1004f0ea5f1">execute_shaped_attack</a> (const <a class="el" href="classshape.html">shape</a> &amp;sh, const <a class="el" href="structprojectile.html">projectile</a> &amp;proj, <a class="el" href="classCreature.html">Creature</a> &amp;attacker)</td></tr>
<tr class="memdesc:ade9b38890f46ab6cbe94e1004f0ea5f1"><td class="mdescLeft">&#160;</td><td class="mdescRight">AoE attack, with area given by shape.  <a href="namespaceranged.html#ade9b38890f46ab6cbe94e1004f0ea5f1">More...</a><br /></td></tr>
<tr class="separator:ade9b38890f46ab6cbe94e1004f0ea5f1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7b4da33d1d9391123845f299f1f156dc"><td class="memItemLeft" align="right" valign="top">std::map&lt; <a class="el" href="structtripoint.html">tripoint</a>, double &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceranged.html#a7b4da33d1d9391123845f299f1f156dc">expected_coverage</a> (const <a class="el" href="classshape.html">shape</a> &amp;sh, const <a class="el" href="classmap.html">map</a> &amp;here, int bash_power)</td></tr>
<tr class="separator:a7b4da33d1d9391123845f299f1f156dc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae7778ea8feb8352ac65fe74e81164ebc"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceranged.html#ae7778ea8feb8352ac65fe74e81164ebc">prompt_select_default_ammo_for</a> (<a class="el" href="classavatar.html">avatar</a> &amp;u, const <a class="el" href="classitem.html">item</a> &amp;w)</td></tr>
<tr class="memdesc:ae7778ea8feb8352ac65fe74e81164ebc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Prompts to select default ammo compatible with provided gun.  <a href="namespaceranged.html#ae7778ea8feb8352ac65fe74e81164ebc">More...</a><br /></td></tr>
<tr class="separator:ae7778ea8feb8352ac65fe74e81164ebc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abf8b46e1f1dae2e7a3d4ff75b9495026"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceranged.html#abf8b46e1f1dae2e7a3d4ff75b9495026">handle_gun_damage</a> (<a class="el" href="classCharacter.html">Character</a> &amp;shooter, <a class="el" href="classitem.html">item</a> &amp;it)</td></tr>
<tr class="memdesc:abf8b46e1f1dae2e7a3d4ff75b9495026"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns true if a gun misfires, jams, or has other problems, else returns false.  <a href="namespaceranged.html#abf8b46e1f1dae2e7a3d4ff75b9495026">More...</a><br /></td></tr>
<tr class="separator:abf8b46e1f1dae2e7a3d4ff75b9495026"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a77dfe116a20cfa50c55a3c2073408e63"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceranged.html#a77dfe116a20cfa50c55a3c2073408e63">effective_dispersion</a> (const <a class="el" href="classCharacter.html">Character</a> &amp;who, int dispersion)</td></tr>
<tr class="separator:a77dfe116a20cfa50c55a3c2073408e63"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8b31304e61913a0072ad6df6e16bc932"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classdispersion__sources.html">dispersion_sources</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceranged.html#a8b31304e61913a0072ad6df6e16bc932">get_weapon_dispersion</a> (const <a class="el" href="classCharacter.html">Character</a> &amp;who, const <a class="el" href="classitem.html">item</a> &amp;obj)</td></tr>
<tr class="memdesc:a8b31304e61913a0072ad6df6e16bc932"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get weapon's dispersion value modified accoring to character stats.  <a href="namespaceranged.html#a8b31304e61913a0072ad6df6e16bc932">More...</a><br /></td></tr>
<tr class="separator:a8b31304e61913a0072ad6df6e16bc932"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a751a40c271349c3ea821c5badd49e42f"><td class="memItemLeft" align="right" valign="top">std::vector&lt; <a class="el" href="structranged_1_1aim__type.html">aim_type</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceranged.html#a751a40c271349c3ea821c5badd49e42f">get_aim_types</a> (const <a class="el" href="classCharacter.html">Character</a> &amp;who, const <a class="el" href="classitem.html">item</a> &amp;gun)</td></tr>
<tr class="separator:a751a40c271349c3ea821c5badd49e42f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3dbef919e3efee8967ddbcba998a55f3"><td class="memItemLeft" align="right" valign="top">std::pair&lt; int, int &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceranged.html#a3dbef919e3efee8967ddbcba998a55f3">get_fastest_sight</a> (const <a class="el" href="classCharacter.html">Character</a> &amp;who, const <a class="el" href="classitem.html">item</a> &amp;gun, double recoil)</td></tr>
<tr class="separator:a3dbef919e3efee8967ddbcba998a55f3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad70a4328dc4c6c69d45b40f23d90195d"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceranged.html#ad70a4328dc4c6c69d45b40f23d90195d">get_most_accurate_sight</a> (const <a class="el" href="classCharacter.html">Character</a> &amp;who, const <a class="el" href="classitem.html">item</a> &amp;gun)</td></tr>
<tr class="separator:ad70a4328dc4c6c69d45b40f23d90195d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a21b558e37c054d606a8a13cd8f2a9fdd"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceranged.html#a21b558e37c054d606a8a13cd8f2a9fdd">aim_speed_skill_modifier</a> (const <a class="el" href="classCharacter.html">Character</a> &amp;who, const <a class="el" href="type__id_8h.html#a13f6e54f55e89d7c6cd86da6d0a7e785">skill_id</a> &amp;gun_skill)</td></tr>
<tr class="separator:a21b558e37c054d606a8a13cd8f2a9fdd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad6e6221390082d1784933039cae98ce4"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceranged.html#ad6e6221390082d1784933039cae98ce4">aim_speed_dex_modifier</a> (const <a class="el" href="classCharacter.html">Character</a> &amp;who)</td></tr>
<tr class="separator:ad6e6221390082d1784933039cae98ce4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acf1831c2fdf09dc3f8df6df1a51a2dd0"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceranged.html#acf1831c2fdf09dc3f8df6df1a51a2dd0">aim_speed_encumbrance_modifier</a> (const <a class="el" href="classCharacter.html">Character</a> &amp;who)</td></tr>
<tr class="separator:acf1831c2fdf09dc3f8df6df1a51a2dd0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a25ff05a2a67dcbfc053c3bac0923f060"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceranged.html#a25ff05a2a67dcbfc053c3bac0923f060">aim_cap_from_volume</a> (const <a class="el" href="classitem.html">item</a> &amp;gun)</td></tr>
<tr class="separator:a25ff05a2a67dcbfc053c3bac0923f060"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aee24b0f617e2ee224a92d1c5422ae306"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceranged.html#aee24b0f617e2ee224a92d1c5422ae306">aim_per_move</a> (const <a class="el" href="classCharacter.html">Character</a> &amp;who, const <a class="el" href="classitem.html">item</a> &amp;gun, double recoil)</td></tr>
<tr class="memdesc:aee24b0f617e2ee224a92d1c5422ae306"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculates aim improvement per move spent aiming at a given.  <a href="namespaceranged.html#aee24b0f617e2ee224a92d1c5422ae306">More...</a><br /></td></tr>
<tr class="separator:aee24b0f617e2ee224a92d1c5422ae306"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6c1943d0fc446952875c5a5cb88cf3fc"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceranged.html#a6c1943d0fc446952875c5a5cb88cf3fc">recoil_vehicle</a> (const <a class="el" href="classCharacter.html">Character</a> &amp;who)</td></tr>
<tr class="memdesc:a6c1943d0fc446952875c5a5cb88cf3fc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get maximum recoil penalty due to vehicle motion.  <a href="namespaceranged.html#a6c1943d0fc446952875c5a5cb88cf3fc">More...</a><br /></td></tr>
<tr class="separator:a6c1943d0fc446952875c5a5cb88cf3fc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9fab96fd0829b448bad76e542e320156"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceranged.html#a9fab96fd0829b448bad76e542e320156">recoil_total</a> (const <a class="el" href="classCharacter.html">Character</a> &amp;who)</td></tr>
<tr class="memdesc:a9fab96fd0829b448bad76e542e320156"><td class="mdescLeft">&#160;</td><td class="mdescRight">Current total maximum recoil penalty from all sources.  <a href="namespaceranged.html#a9fab96fd0829b448bad76e542e320156">More...</a><br /></td></tr>
<tr class="separator:a9fab96fd0829b448bad76e542e320156"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1091f2ff573108fbf6d9f56f0c1d2187"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceranged.html#a1091f2ff573108fbf6d9f56f0c1d2187">gun_engagement_moves</a> (const <a class="el" href="classCharacter.html">Character</a> &amp;who, const <a class="el" href="classitem.html">item</a> &amp;gun, int target=0, int start=<a class="el" href="game__constants_8h.html#a8226e8a134603e5bc06df05efd13d8d1">MAX_RECOIL</a>)</td></tr>
<tr class="memdesc:a1091f2ff573108fbf6d9f56f0c1d2187"><td class="mdescLeft">&#160;</td><td class="mdescRight">How many moves does it take to aim gun to the target accuracy.  <a href="namespaceranged.html#a1091f2ff573108fbf6d9f56f0c1d2187">More...</a><br /></td></tr>
<tr class="separator:a1091f2ff573108fbf6d9f56f0c1d2187"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad3183129b44ab2775b50bb90da5c5333"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceranged.html#ad3183129b44ab2775b50bb90da5c5333">time_to_attack</a> (const <a class="el" href="classCharacter.html">Character</a> &amp;p, const <a class="el" href="classitem.html">item</a> &amp;firing, const <a class="el" href="classitem__location.html">item_location</a> loc)</td></tr>
<tr class="memdesc:ad3183129b44ab2775b50bb90da5c5333"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculates time taken to fire gun.  <a href="namespaceranged.html#ad3183129b44ab2775b50bb90da5c5333">More...</a><br /></td></tr>
<tr class="separator:ad3183129b44ab2775b50bb90da5c5333"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab65b29a98e9d9b297fe6d631afc0bf1c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceranged.html#ab65b29a98e9d9b297fe6d631afc0bf1c">make_gun_sound_effect</a> (const <a class="el" href="classCharacter.html">Character</a> &amp;who, bool burst, const <a class="el" href="classitem.html">item</a> &amp;gun)</td></tr>
<tr class="separator:ab65b29a98e9d9b297fe6d631afc0bf1c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0bb67d4debaf06355d3b7c8234fda44e"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceranged.html#a0bb67d4debaf06355d3b7c8234fda44e">fire_gun</a> (<a class="el" href="classCharacter.html">Character</a> &amp;who, const <a class="el" href="structtripoint.html">tripoint</a> &amp;target, int shots=1)</td></tr>
<tr class="memdesc:a0bb67d4debaf06355d3b7c8234fda44e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Fire wielded gun or auxiliary gunmod (ignoring any current mode)  <a href="namespaceranged.html#a0bb67d4debaf06355d3b7c8234fda44e">More...</a><br /></td></tr>
<tr class="separator:a0bb67d4debaf06355d3b7c8234fda44e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae09161f6a90d6bc3282a1e0f50c439b2"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceranged.html#ae09161f6a90d6bc3282a1e0f50c439b2">fire_gun</a> (<a class="el" href="classCharacter.html">Character</a> &amp;who, const <a class="el" href="structtripoint.html">tripoint</a> &amp;target, int shots, <a class="el" href="classitem.html">item</a> &amp;gun, <a class="el" href="classitem__location.html">item_location</a> ammo)</td></tr>
<tr class="memdesc:ae09161f6a90d6bc3282a1e0f50c439b2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Fire a gun or auxiliary gunmod (ignoring any current mode)  <a href="namespaceranged.html#ae09161f6a90d6bc3282a1e0f50c439b2">More...</a><br /></td></tr>
<tr class="separator:ae09161f6a90d6bc3282a1e0f50c439b2"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Enumeration Type Documentation</h2>
<a id="a5d9da06327706ab87ae19ee9dc08de53" name="a5d9da06327706ab87ae19ee9dc08de53"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5d9da06327706ab87ae19ee9dc08de53">&#9670;&nbsp;</a></span>hit_tier</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">enum class <a class="el" href="namespaceranged.html#a5d9da06327706ab87ae19ee9dc08de53">ranged::hit_tier</a> : int</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">strong</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="a5d9da06327706ab87ae19ee9dc08de53a52b0f37c2ac81918f900f3d3e6c98597" name="a5d9da06327706ab87ae19ee9dc08de53a52b0f37c2ac81918f900f3d3e6c98597"></a>grazing&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a5d9da06327706ab87ae19ee9dc08de53afea087517c26fadd409bd4b9dc642555" name="a5d9da06327706ab87ae19ee9dc08de53afea087517c26fadd409bd4b9dc642555"></a>normal&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a5d9da06327706ab87ae19ee9dc08de53a7e85bcb66fb9a809d5ab4f62a8b8bea8" name="a5d9da06327706ab87ae19ee9dc08de53a7e85bcb66fb9a809d5ab4f62a8b8bea8"></a>critical&#160;</td><td class="fielddoc"></td></tr>
</table>

<p class="definition">Definition at line <a class="el" href="ranged_8h_source.html#l00116">116</a> of file <a class="el" href="ranged_8h_source.html">ranged.h</a>.</p>
<div class="fragment"><div class="line"><a id="l00116" name="l00116"></a><span class="lineno">  116</span>                    : <span class="keywordtype">int</span> {</div>
<div class="line"><a id="l00117" name="l00117"></a><span class="lineno">  117</span>    <a class="code hl_enumvalue" href="namespaceranged.html#a5d9da06327706ab87ae19ee9dc08de53a52b0f37c2ac81918f900f3d3e6c98597">grazing</a> = 0,</div>
<div class="line"><a id="l00118" name="l00118"></a><span class="lineno">  118</span>    normal,</div>
<div class="line"><a id="l00119" name="l00119"></a><span class="lineno">  119</span>    <a class="code hl_enumvalue" href="namespaceranged.html#a5d9da06327706ab87ae19ee9dc08de53a7e85bcb66fb9a809d5ab4f62a8b8bea8">critical</a></div>
<div class="line"><a id="l00120" name="l00120"></a><span class="lineno">  120</span>};</div>
<div class="ttc" id="anamespaceranged_html_a5d9da06327706ab87ae19ee9dc08de53a52b0f37c2ac81918f900f3d3e6c98597"><div class="ttname"><a href="namespaceranged.html#a5d9da06327706ab87ae19ee9dc08de53a52b0f37c2ac81918f900f3d3e6c98597">ranged::hit_tier::grazing</a></div><div class="ttdeci">@ grazing</div></div>
<div class="ttc" id="anamespaceranged_html_a5d9da06327706ab87ae19ee9dc08de53a7e85bcb66fb9a809d5ab4f62a8b8bea8"><div class="ttname"><a href="namespaceranged.html#a5d9da06327706ab87ae19ee9dc08de53a7e85bcb66fb9a809d5ab4f62a8b8bea8">ranged::hit_tier::critical</a></div><div class="ttdeci">@ critical</div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a25ff05a2a67dcbfc053c3bac0923f060" name="a25ff05a2a67dcbfc053c3bac0923f060"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a25ff05a2a67dcbfc053c3bac0923f060">&#9670;&nbsp;</a></span>aim_cap_from_volume()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double ranged::aim_cap_from_volume </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classitem.html">item</a> &amp;&#160;</td>
          <td class="paramname"><em>gun</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="ranged_8cpp_source.html#l03898">3898</a> of file <a class="el" href="ranged_8cpp_source.html">ranged.cpp</a>.</p>
<div class="fragment"><div class="line"><a id="l03899" name="l03899"></a><span class="lineno"> 3899</span>{</div>
<div class="line"><a id="l03900" name="l03900"></a><span class="lineno"> 3900</span>    <a class="code hl_class" href="classstring__id.html">skill_id</a> gun_skill = gun.<a class="code hl_function" href="classitem.html#a3d8542661f2e2a82e8cb3792584912f3">gun_skill</a>();</div>
<div class="line"><a id="l03901" name="l03901"></a><span class="lineno"> 3901</span>    <span class="keywordtype">double</span> aim_cap = std::min( 49.0, 49.0 - <span class="keyword">static_cast&lt;</span><span class="keywordtype">float</span><span class="keyword">&gt;</span>( gun.<a class="code hl_function" href="classitem.html#a51eafbdf8b331d88b741c0c527f98eb9">volume</a>() / 75_ml ) );</div>
<div class="line"><a id="l03902" name="l03902"></a><span class="lineno"> 3902</span>    <span class="comment">// TODO: also scale with skill level.</span></div>
<div class="line"><a id="l03903" name="l03903"></a><span class="lineno"> 3903</span>    <span class="keywordflow">if</span>( gun_skill == <a class="code hl_variable" href="ranged_8cpp.html#a629add6779d8563b628372dc2334cac0">skill_smg</a> ) {</div>
<div class="line"><a id="l03904" name="l03904"></a><span class="lineno"> 3904</span>        aim_cap = std::max( 12.0, aim_cap );</div>
<div class="line"><a id="l03905" name="l03905"></a><span class="lineno"> 3905</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( gun_skill == <a class="code hl_variable" href="ranged_8cpp.html#a0f15a8372bc3f3abc8c0c79960c74764">skill_shotgun</a> ) {</div>
<div class="line"><a id="l03906" name="l03906"></a><span class="lineno"> 3906</span>        aim_cap = std::max( 12.0, aim_cap );</div>
<div class="line"><a id="l03907" name="l03907"></a><span class="lineno"> 3907</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( gun_skill == <a class="code hl_variable" href="ranged_8cpp.html#ace5ff5bc15ace2d6924995f0d04de94a">skill_pistol</a> ) {</div>
<div class="line"><a id="l03908" name="l03908"></a><span class="lineno"> 3908</span>        aim_cap = std::max( 15.0, aim_cap * 1.25 );</div>
<div class="line"><a id="l03909" name="l03909"></a><span class="lineno"> 3909</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( gun_skill == <a class="code hl_variable" href="ranged_8cpp.html#ab2508226b904e65441fcae52e0b2b998">skill_rifle</a> ) {</div>
<div class="line"><a id="l03910" name="l03910"></a><span class="lineno"> 3910</span>        aim_cap = std::max( 7.0, aim_cap - 5.0 );</div>
<div class="line"><a id="l03911" name="l03911"></a><span class="lineno"> 3911</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( gun_skill == <a class="code hl_variable" href="ranged_8cpp.html#a2f8b66e6fc62f3d92b208655f5525bba">skill_archery</a> ) {</div>
<div class="line"><a id="l03912" name="l03912"></a><span class="lineno"> 3912</span>        aim_cap = std::max( 13.0, aim_cap );</div>
<div class="line"><a id="l03913" name="l03913"></a><span class="lineno"> 3913</span>    } <span class="keywordflow">else</span> { <span class="comment">// Launchers, etc.</span></div>
<div class="line"><a id="l03914" name="l03914"></a><span class="lineno"> 3914</span>        aim_cap = std::max( 10.0, aim_cap );</div>
<div class="line"><a id="l03915" name="l03915"></a><span class="lineno"> 3915</span>    }</div>
<div class="line"><a id="l03916" name="l03916"></a><span class="lineno"> 3916</span>    <span class="keywordflow">return</span> aim_cap;</div>
<div class="line"><a id="l03917" name="l03917"></a><span class="lineno"> 3917</span>}</div>
<div class="ttc" id="aclassitem_html_a3d8542661f2e2a82e8cb3792584912f3"><div class="ttname"><a href="classitem.html#a3d8542661f2e2a82e8cb3792584912f3">item::gun_skill</a></div><div class="ttdeci">skill_id gun_skill() const</div><div class="ttdoc">The skill used to operate the gun.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l07212">item.cpp:7212</a></div></div>
<div class="ttc" id="aclassitem_html_a51eafbdf8b331d88b741c0c527f98eb9"><div class="ttname"><a href="classitem.html#a51eafbdf8b331d88b741c0c527f98eb9">item::volume</a></div><div class="ttdeci">units::volume volume(bool integral=false) const</div><div class="ttdoc">Total volume of an item accounting for all contained/integrated items NOTE: Result is rounded up to n...</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l05129">item.cpp:5129</a></div></div>
<div class="ttc" id="aclassstring__id_html"><div class="ttname"><a href="classstring__id.html">string_id&lt; Skill &gt;</a></div></div>
<div class="ttc" id="aranged_8cpp_html_a0f15a8372bc3f3abc8c0c79960c74764"><div class="ttname"><a href="ranged_8cpp.html#a0f15a8372bc3f3abc8c0c79960c74764">skill_shotgun</a></div><div class="ttdeci">static const skill_id skill_shotgun(&quot;shotgun&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a2f8b66e6fc62f3d92b208655f5525bba"><div class="ttname"><a href="ranged_8cpp.html#a2f8b66e6fc62f3d92b208655f5525bba">skill_archery</a></div><div class="ttdeci">static const skill_id skill_archery(&quot;archery&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a629add6779d8563b628372dc2334cac0"><div class="ttname"><a href="ranged_8cpp.html#a629add6779d8563b628372dc2334cac0">skill_smg</a></div><div class="ttdeci">static const skill_id skill_smg(&quot;smg&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_ab2508226b904e65441fcae52e0b2b998"><div class="ttname"><a href="ranged_8cpp.html#ab2508226b904e65441fcae52e0b2b998">skill_rifle</a></div><div class="ttdeci">static const skill_id skill_rifle(&quot;rifle&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_ace5ff5bc15ace2d6924995f0d04de94a"><div class="ttname"><a href="ranged_8cpp.html#ace5ff5bc15ace2d6924995f0d04de94a">skill_pistol</a></div><div class="ttdeci">static const skill_id skill_pistol(&quot;pistol&quot;)</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="item_8cpp_source.html#l07212">item::gun_skill()</a>, <a class="el" href="ranged_8cpp.html#a2f8b66e6fc62f3d92b208655f5525bba">skill_archery</a>, <a class="el" href="ranged_8cpp.html#ace5ff5bc15ace2d6924995f0d04de94a">skill_pistol</a>, <a class="el" href="ranged_8cpp.html#ab2508226b904e65441fcae52e0b2b998">skill_rifle</a>, <a class="el" href="ranged_8cpp.html#a0f15a8372bc3f3abc8c0c79960c74764">skill_shotgun</a>, <a class="el" href="ranged_8cpp.html#a629add6779d8563b628372dc2334cac0">skill_smg</a>, and <a class="el" href="item_8cpp_source.html#l05129">item::volume()</a>.</p>

<p class="reference">Referenced by <a class="el" href="ranged_8cpp_source.html#l03919">aim_per_move()</a>.</p>

</div>
</div>
<a id="aee24b0f617e2ee224a92d1c5422ae306" name="aee24b0f617e2ee224a92d1c5422ae306"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aee24b0f617e2ee224a92d1c5422ae306">&#9670;&nbsp;</a></span>aim_per_move()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double ranged::aim_per_move </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classCharacter.html">Character</a> &amp;&#160;</td>
          <td class="paramname"><em>who</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classitem.html">item</a> &amp;&#160;</td>
          <td class="paramname"><em>gun</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>recoil</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calculates aim improvement per move spent aiming at a given. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">recoil</td><td></td></tr>
  </table>
  </dd>
</dl>
Dexterity increases aiming speed 
<p class="definition">Definition at line <a class="el" href="ranged_8cpp_source.html#l03919">3919</a> of file <a class="el" href="ranged_8cpp_source.html">ranged.cpp</a>.</p>
<div class="fragment"><div class="line"><a id="l03920" name="l03920"></a><span class="lineno"> 3920</span>{</div>
<div class="line"><a id="l03921" name="l03921"></a><span class="lineno"> 3921</span>    <span class="keywordflow">if</span>( !gun.<a class="code hl_function" href="classitem.html#a2912b2e15a4eec07a5070fffbbd152e8">is_gun</a>() ) {</div>
<div class="line"><a id="l03922" name="l03922"></a><span class="lineno"> 3922</span>        <span class="keywordflow">return</span> 0.0;</div>
<div class="line"><a id="l03923" name="l03923"></a><span class="lineno"> 3923</span>    }</div>
<div class="line"><a id="l03924" name="l03924"></a><span class="lineno"> 3924</span> </div>
<div class="line"><a id="l03925" name="l03925"></a><span class="lineno"> 3925</span>    std::pair&lt;int, int&gt; best_sight = <a class="code hl_function" href="namespaceranged.html#a3dbef919e3efee8967ddbcba998a55f3">get_fastest_sight</a>( who, gun, recoil );</div>
<div class="line"><a id="l03926" name="l03926"></a><span class="lineno"> 3926</span>    <span class="keywordtype">int</span> sight_speed_modifier = best_sight.first;</div>
<div class="line"><a id="l03927" name="l03927"></a><span class="lineno"> 3927</span>    <span class="keywordtype">int</span> limit = best_sight.second;</div>
<div class="line"><a id="l03928" name="l03928"></a><span class="lineno"> 3928</span>    <span class="keywordflow">if</span>( sight_speed_modifier == INT_MIN ) {</div>
<div class="line"><a id="l03929" name="l03929"></a><span class="lineno"> 3929</span>        <span class="comment">// No suitable sights (already at maximum aim).</span></div>
<div class="line"><a id="l03930" name="l03930"></a><span class="lineno"> 3930</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a id="l03931" name="l03931"></a><span class="lineno"> 3931</span>    }</div>
<div class="line"><a id="l03932" name="l03932"></a><span class="lineno"> 3932</span> </div>
<div class="line"><a id="l03933" name="l03933"></a><span class="lineno"> 3933</span>    <span class="comment">// Overall strategy for determining aim speed is to sum the factors that contribute to it,</span></div>
<div class="line"><a id="l03934" name="l03934"></a><span class="lineno"> 3934</span>    <span class="comment">// then scale that speed by current recoil level.</span></div>
<div class="line"><a id="l03935" name="l03935"></a><span class="lineno"> 3935</span>    <span class="comment">// Player capabilities make aiming faster, and aim speed slows down as it approaches 0.</span></div>
<div class="line"><a id="l03936" name="l03936"></a><span class="lineno"> 3936</span>    <span class="comment">// Base speed is non-zero to prevent extreme rate changes as aim speed approaches 0.</span></div>
<div class="line"><a id="l03937" name="l03937"></a><span class="lineno"> 3937</span>    <span class="keywordtype">double</span> aim_speed = 10.0;</div>
<div class="line"><a id="l03938" name="l03938"></a><span class="lineno"> 3938</span> </div>
<div class="line"><a id="l03939" name="l03939"></a><span class="lineno"> 3939</span>    <a class="code hl_class" href="classstring__id.html">skill_id</a> gun_skill = gun.<a class="code hl_function" href="classitem.html#a3d8542661f2e2a82e8cb3792584912f3">gun_skill</a>();</div>
<div class="line"><a id="l03940" name="l03940"></a><span class="lineno"> 3940</span>    <span class="comment">// Ranges [0 - 10]</span></div>
<div class="line"><a id="l03941" name="l03941"></a><span class="lineno"> 3941</span>    aim_speed += <a class="code hl_function" href="namespaceranged.html#a21b558e37c054d606a8a13cd8f2a9fdd">aim_speed_skill_modifier</a>( who, gun_skill );</div>
<div class="line"><a id="l03942" name="l03942"></a><span class="lineno"> 3942</span> </div>
<div class="line"><a id="l03943" name="l03943"></a><span class="lineno"> 3943</span>    <span class="comment">// Range [0 - 12]</span><span class="comment"></span></div>
<div class="line"><a id="l03944" name="l03944"></a><span class="lineno"> 3944</span><span class="comment">    /** @EFFECT_DEX increases aiming speed */</span></div>
<div class="line"><a id="l03945" name="l03945"></a><span class="lineno"> 3945</span>    aim_speed += <a class="code hl_function" href="namespaceranged.html#ad6e6221390082d1784933039cae98ce4">aim_speed_dex_modifier</a>( who );</div>
<div class="line"><a id="l03946" name="l03946"></a><span class="lineno"> 3946</span> </div>
<div class="line"><a id="l03947" name="l03947"></a><span class="lineno"> 3947</span>    <span class="comment">// Range [0 - 10]</span></div>
<div class="line"><a id="l03948" name="l03948"></a><span class="lineno"> 3948</span>    aim_speed += sight_speed_modifier;</div>
<div class="line"><a id="l03949" name="l03949"></a><span class="lineno"> 3949</span> </div>
<div class="line"><a id="l03950" name="l03950"></a><span class="lineno"> 3950</span>    <span class="comment">// Each 5 points (combined) of hand encumbrance decreases aim speed by one unit.</span></div>
<div class="line"><a id="l03951" name="l03951"></a><span class="lineno"> 3951</span>    aim_speed -= <a class="code hl_function" href="namespaceranged.html#acf1831c2fdf09dc3f8df6df1a51a2dd0">aim_speed_encumbrance_modifier</a>( who );</div>
<div class="line"><a id="l03952" name="l03952"></a><span class="lineno"> 3952</span> </div>
<div class="line"><a id="l03953" name="l03953"></a><span class="lineno"> 3953</span>    aim_speed = std::min( aim_speed, <a class="code hl_function" href="namespaceranged.html#a25ff05a2a67dcbfc053c3bac0923f060">aim_cap_from_volume</a>( gun ) );</div>
<div class="line"><a id="l03954" name="l03954"></a><span class="lineno"> 3954</span> </div>
<div class="line"><a id="l03955" name="l03955"></a><span class="lineno"> 3955</span>    <span class="comment">// Just a raw scaling factor.</span></div>
<div class="line"><a id="l03956" name="l03956"></a><span class="lineno"> 3956</span>    aim_speed *= 6.5;</div>
<div class="line"><a id="l03957" name="l03957"></a><span class="lineno"> 3957</span> </div>
<div class="line"><a id="l03958" name="l03958"></a><span class="lineno"> 3958</span>    <span class="comment">// Scale rate logistically as recoil goes from MAX_RECOIL to 0.</span></div>
<div class="line"><a id="l03959" name="l03959"></a><span class="lineno"> 3959</span>    aim_speed *= 1.0 - <a class="code hl_function" href="cata__utility_8cpp.html#a6a85dc6d2ab7bcb093e77d20fcf171d6">logarithmic_range</a>( 0, <a class="code hl_variable" href="game__constants_8h.html#a8226e8a134603e5bc06df05efd13d8d1">MAX_RECOIL</a>, recoil );</div>
<div class="line"><a id="l03960" name="l03960"></a><span class="lineno"> 3960</span> </div>
<div class="line"><a id="l03961" name="l03961"></a><span class="lineno"> 3961</span>    <span class="comment">// Minimum improvement is 5MoA.  This mostly puts a cap on how long aiming for sniping takes.</span></div>
<div class="line"><a id="l03962" name="l03962"></a><span class="lineno"> 3962</span>    aim_speed = std::max( aim_speed, 5.0 );</div>
<div class="line"><a id="l03963" name="l03963"></a><span class="lineno"> 3963</span> </div>
<div class="line"><a id="l03964" name="l03964"></a><span class="lineno"> 3964</span>    <span class="comment">// Never improve by more than the currently used sights permit.</span></div>
<div class="line"><a id="l03965" name="l03965"></a><span class="lineno"> 3965</span>    <span class="keywordflow">return</span> std::min( aim_speed, recoil - limit );</div>
<div class="line"><a id="l03966" name="l03966"></a><span class="lineno"> 3966</span>}</div>
<div class="ttc" id="acata__utility_8cpp_html_a6a85dc6d2ab7bcb093e77d20fcf171d6"><div class="ttname"><a href="cata__utility_8cpp.html#a6a85dc6d2ab7bcb093e77d20fcf171d6">logarithmic_range</a></div><div class="ttdeci">double logarithmic_range(int min, int max, int pos)</div><div class="ttdoc">Normalized logistic function.</div><div class="ttdef"><b>Definition:</b> <a href="cata__utility_8cpp_source.html#l00074">cata_utility.cpp:74</a></div></div>
<div class="ttc" id="aclassitem_html_a2912b2e15a4eec07a5070fffbbd152e8"><div class="ttname"><a href="classitem.html#a2912b2e15a4eec07a5070fffbbd152e8">item::is_gun</a></div><div class="ttdeci">bool is_gun() const</div><div class="ttdoc">Can this item be used to perform a ranged attack?</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l06542">item.cpp:6542</a></div></div>
<div class="ttc" id="agame__constants_8h_html_a8226e8a134603e5bc06df05efd13d8d1"><div class="ttname"><a href="game__constants_8h.html#a8226e8a134603e5bc06df05efd13d8d1">MAX_RECOIL</a></div><div class="ttdeci">constexpr double MAX_RECOIL</div><div class="ttdef"><b>Definition:</b> <a href="game__constants_8h_source.html#l00131">game_constants.h:131</a></div></div>
<div class="ttc" id="anamespaceranged_html_a21b558e37c054d606a8a13cd8f2a9fdd"><div class="ttname"><a href="namespaceranged.html#a21b558e37c054d606a8a13cd8f2a9fdd">ranged::aim_speed_skill_modifier</a></div><div class="ttdeci">double aim_speed_skill_modifier(const Character &amp;who, const skill_id &amp;gun_skill)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l03872">ranged.cpp:3872</a></div></div>
<div class="ttc" id="anamespaceranged_html_a25ff05a2a67dcbfc053c3bac0923f060"><div class="ttname"><a href="namespaceranged.html#a25ff05a2a67dcbfc053c3bac0923f060">ranged::aim_cap_from_volume</a></div><div class="ttdeci">double aim_cap_from_volume(const item &amp;gun)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l03898">ranged.cpp:3898</a></div></div>
<div class="ttc" id="anamespaceranged_html_a3dbef919e3efee8967ddbcba998a55f3"><div class="ttname"><a href="namespaceranged.html#a3dbef919e3efee8967ddbcba998a55f3">ranged::get_fastest_sight</a></div><div class="ttdeci">std::pair&lt; int, int &gt; get_fastest_sight(const Character &amp;who, const item &amp;gun, double recoil)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l03830">ranged.cpp:3830</a></div></div>
<div class="ttc" id="anamespaceranged_html_acf1831c2fdf09dc3f8df6df1a51a2dd0"><div class="ttname"><a href="namespaceranged.html#acf1831c2fdf09dc3f8df6df1a51a2dd0">ranged::aim_speed_encumbrance_modifier</a></div><div class="ttdeci">double aim_speed_encumbrance_modifier(const Character &amp;who)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l03893">ranged.cpp:3893</a></div></div>
<div class="ttc" id="anamespaceranged_html_ad6e6221390082d1784933039cae98ce4"><div class="ttname"><a href="namespaceranged.html#ad6e6221390082d1784933039cae98ce4">ranged::aim_speed_dex_modifier</a></div><div class="ttdeci">double aim_speed_dex_modifier(const Character &amp;who)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l03888">ranged.cpp:3888</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="ranged_8cpp_source.html#l03898">aim_cap_from_volume()</a>, <a class="el" href="ranged_8cpp_source.html#l03888">aim_speed_dex_modifier()</a>, <a class="el" href="ranged_8cpp_source.html#l03893">aim_speed_encumbrance_modifier()</a>, <a class="el" href="ranged_8cpp_source.html#l03872">aim_speed_skill_modifier()</a>, <a class="el" href="ranged_8cpp_source.html#l03830">get_fastest_sight()</a>, <a class="el" href="item_8cpp_source.html#l07212">item::gun_skill()</a>, <a class="el" href="item_8cpp_source.html#l06542">item::is_gun()</a>, <a class="el" href="cata__utility_8cpp_source.html#l00074">logarithmic_range()</a>, and <a class="el" href="game__constants_8h_source.html#l00131">MAX_RECOIL</a>.</p>

<p class="reference">Referenced by <a class="el" href="npcmove_8cpp_source.html#l02196">npc::aim()</a>, <a class="el" href="ranged_8cpp_source.html#l01299">do_aim()</a>, <a class="el" href="ranged_8cpp_source.html#l00583">gun_engagement_moves()</a>, <a class="el" href="item_8cpp_source.html#l02020">item::gun_info()</a>, <a class="el" href="npcmove_8cpp_source.html#l01339">npc::method_of_attack()</a>, and <a class="el" href="ranged_8cpp_source.html#l03639">target_ui::panel_fire_mode_aim()</a>.</p>

</div>
</div>
<a id="ad6e6221390082d1784933039cae98ce4" name="ad6e6221390082d1784933039cae98ce4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad6e6221390082d1784933039cae98ce4">&#9670;&nbsp;</a></span>aim_speed_dex_modifier()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double ranged::aim_speed_dex_modifier </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classCharacter.html">Character</a> &amp;&#160;</td>
          <td class="paramname"><em>who</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="ranged_8cpp_source.html#l03888">3888</a> of file <a class="el" href="ranged_8cpp_source.html">ranged.cpp</a>.</p>
<div class="fragment"><div class="line"><a id="l03889" name="l03889"></a><span class="lineno"> 3889</span>{</div>
<div class="line"><a id="l03890" name="l03890"></a><span class="lineno"> 3890</span>    <span class="keywordflow">return</span> who.<a class="code hl_function" href="classCharacter.html#a34a927d0f161ac92ab0d462397828bd5">get_dex</a>() - 8;</div>
<div class="line"><a id="l03891" name="l03891"></a><span class="lineno"> 3891</span>}</div>
<div class="ttc" id="aclassCharacter_html_a34a927d0f161ac92ab0d462397828bd5"><div class="ttname"><a href="classCharacter.html#a34a927d0f161ac92ab0d462397828bd5">Character::get_dex</a></div><div class="ttdeci">virtual int get_dex() const</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l04094">character.cpp:4094</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="character_8cpp_source.html#l04094">Character::get_dex()</a>.</p>

<p class="reference">Referenced by <a class="el" href="ranged_8cpp_source.html#l03919">aim_per_move()</a>.</p>

</div>
</div>
<a id="acf1831c2fdf09dc3f8df6df1a51a2dd0" name="acf1831c2fdf09dc3f8df6df1a51a2dd0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acf1831c2fdf09dc3f8df6df1a51a2dd0">&#9670;&nbsp;</a></span>aim_speed_encumbrance_modifier()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double ranged::aim_speed_encumbrance_modifier </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classCharacter.html">Character</a> &amp;&#160;</td>
          <td class="paramname"><em>who</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="ranged_8cpp_source.html#l03893">3893</a> of file <a class="el" href="ranged_8cpp_source.html">ranged.cpp</a>.</p>
<div class="fragment"><div class="line"><a id="l03894" name="l03894"></a><span class="lineno"> 3894</span>{</div>
<div class="line"><a id="l03895" name="l03895"></a><span class="lineno"> 3895</span>    <span class="keywordflow">return</span> ( who.<a class="code hl_function" href="classCharacter.html#adc1fd84a88722a905e57fea8bfd5b6b0">encumb</a>( <a class="code hl_enumvalue" href="bodypart_8h.html#af618290c4c2de42aab87977ac7311980a2806629e65a2c2eb5d8049e29e77910e">bp_hand_l</a> ) + who.<a class="code hl_function" href="classCharacter.html#adc1fd84a88722a905e57fea8bfd5b6b0">encumb</a>( <a class="code hl_enumvalue" href="bodypart_8h.html#af618290c4c2de42aab87977ac7311980a54721306a0e05318b6d0440349c1a0fb">bp_hand_r</a> ) ) / 10.0;</div>
<div class="line"><a id="l03896" name="l03896"></a><span class="lineno"> 3896</span>}</div>
<div class="ttc" id="abodypart_8h_html_af618290c4c2de42aab87977ac7311980a2806629e65a2c2eb5d8049e29e77910e"><div class="ttname"><a href="bodypart_8h.html#af618290c4c2de42aab87977ac7311980a2806629e65a2c2eb5d8049e29e77910e">bp_hand_l</a></div><div class="ttdeci">@ bp_hand_l</div><div class="ttdef"><b>Definition:</b> <a href="bodypart_8h_source.html#l00047">bodypart.h:47</a></div></div>
<div class="ttc" id="abodypart_8h_html_af618290c4c2de42aab87977ac7311980a54721306a0e05318b6d0440349c1a0fb"><div class="ttname"><a href="bodypart_8h.html#af618290c4c2de42aab87977ac7311980a54721306a0e05318b6d0440349c1a0fb">bp_hand_r</a></div><div class="ttdeci">@ bp_hand_r</div><div class="ttdef"><b>Definition:</b> <a href="bodypart_8h_source.html#l00048">bodypart.h:48</a></div></div>
<div class="ttc" id="aclassCharacter_html_adc1fd84a88722a905e57fea8bfd5b6b0"><div class="ttname"><a href="classCharacter.html#adc1fd84a88722a905e57fea8bfd5b6b0">Character::encumb</a></div><div class="ttdeci">int encumb(body_part bp) const</div><div class="ttdoc">Returns ENC provided by armor, etc.</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l04027">character.cpp:4027</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="bodypart_8h_source.html#l00047">bp_hand_l</a>, <a class="el" href="bodypart_8h_source.html#l00048">bp_hand_r</a>, and <a class="el" href="character_8cpp_source.html#l04027">Character::encumb()</a>.</p>

<p class="reference">Referenced by <a class="el" href="ranged_8cpp_source.html#l03919">aim_per_move()</a>, and <a class="el" href="character__display_8cpp_source.html#l00208">get_encumbrance_description()</a>.</p>

</div>
</div>
<a id="a21b558e37c054d606a8a13cd8f2a9fdd" name="a21b558e37c054d606a8a13cd8f2a9fdd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a21b558e37c054d606a8a13cd8f2a9fdd">&#9670;&nbsp;</a></span>aim_speed_skill_modifier()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double ranged::aim_speed_skill_modifier </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classCharacter.html">Character</a> &amp;&#160;</td>
          <td class="paramname"><em>who</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="type__id_8h.html#a13f6e54f55e89d7c6cd86da6d0a7e785">skill_id</a> &amp;&#160;</td>
          <td class="paramname"><em>gun_skill</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
Pistol increases aiming speed for pistols Smg increases aiming speed for SMGs Rifle increases aiming speed for rifles Shotgun increases aiming speed for shotguns Launcher increases aiming speed for launchers 
<p class="definition">Definition at line <a class="el" href="ranged_8cpp_source.html#l03872">3872</a> of file <a class="el" href="ranged_8cpp_source.html">ranged.cpp</a>.</p>
<div class="fragment"><div class="line"><a id="l03873" name="l03873"></a><span class="lineno"> 3873</span>{</div>
<div class="line"><a id="l03874" name="l03874"></a><span class="lineno"> 3874</span>    <span class="keywordtype">double</span> skill_mult = 1.0;</div>
<div class="line"><a id="l03875" name="l03875"></a><span class="lineno"> 3875</span>    <span class="keywordflow">if</span>( gun_skill == <a class="code hl_variable" href="ranged_8cpp.html#ace5ff5bc15ace2d6924995f0d04de94a">skill_pistol</a> ) {</div>
<div class="line"><a id="l03876" name="l03876"></a><span class="lineno"> 3876</span>        skill_mult = 2.0;</div>
<div class="line"><a id="l03877" name="l03877"></a><span class="lineno"> 3877</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( gun_skill == <a class="code hl_variable" href="ranged_8cpp.html#ab2508226b904e65441fcae52e0b2b998">skill_rifle</a> ) {</div>
<div class="line"><a id="l03878" name="l03878"></a><span class="lineno"> 3878</span>        skill_mult = 0.9;</div>
<div class="line"><a id="l03879" name="l03879"></a><span class="lineno"> 3879</span>    }<span class="comment"></span></div>
<div class="line"><a id="l03880" name="l03880"></a><span class="lineno"> 3880</span><span class="comment">    /** @EFFECT_PISTOL increases aiming speed for pistols */</span><span class="comment"></span></div>
<div class="line"><a id="l03881" name="l03881"></a><span class="lineno"> 3881</span><span class="comment">    /** @EFFECT_SMG increases aiming speed for SMGs */</span><span class="comment"></span></div>
<div class="line"><a id="l03882" name="l03882"></a><span class="lineno"> 3882</span><span class="comment">    /** @EFFECT_RIFLE increases aiming speed for rifles */</span><span class="comment"></span></div>
<div class="line"><a id="l03883" name="l03883"></a><span class="lineno"> 3883</span><span class="comment">    /** @EFFECT_SHOTGUN increases aiming speed for shotguns */</span><span class="comment"></span></div>
<div class="line"><a id="l03884" name="l03884"></a><span class="lineno"> 3884</span><span class="comment">    /** @EFFECT_LAUNCHER increases aiming speed for launchers */</span></div>
<div class="line"><a id="l03885" name="l03885"></a><span class="lineno"> 3885</span>    <span class="keywordflow">return</span> skill_mult * std::min( <a class="code hl_variable" href="game__constants_8h.html#ae9c0ec5b4724c15132efddb8862ca652">MAX_SKILL</a>, who.<a class="code hl_function" href="classCharacter.html#afa95fe499ca6b55ab97f1b442a4c95c5">get_skill_level</a>( gun_skill ) );</div>
<div class="line"><a id="l03886" name="l03886"></a><span class="lineno"> 3886</span>}</div>
<div class="ttc" id="aclassCharacter_html_afa95fe499ca6b55ab97f1b442a4c95c5"><div class="ttname"><a href="classCharacter.html#afa95fe499ca6b55ab97f1b442a4c95c5">Character::get_skill_level</a></div><div class="ttdeci">int get_skill_level(const skill_id &amp;ident) const</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l03351">character.cpp:3351</a></div></div>
<div class="ttc" id="agame__constants_8h_html_ae9c0ec5b4724c15132efddb8862ca652"><div class="ttname"><a href="game__constants_8h.html#ae9c0ec5b4724c15132efddb8862ca652">MAX_SKILL</a></div><div class="ttdeci">static constexpr int MAX_SKILL</div><div class="ttdef"><b>Definition:</b> <a href="game__constants_8h_source.html#l00114">game_constants.h:114</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="character_8cpp_source.html#l03351">Character::get_skill_level()</a>, <a class="el" href="game__constants_8h_source.html#l00114">MAX_SKILL</a>, <a class="el" href="ranged_8cpp.html#ace5ff5bc15ace2d6924995f0d04de94a">skill_pistol</a>, and <a class="el" href="ranged_8cpp.html#ab2508226b904e65441fcae52e0b2b998">skill_rifle</a>.</p>

<p class="reference">Referenced by <a class="el" href="ranged_8cpp_source.html#l03919">aim_per_move()</a>.</p>

</div>
</div>
<a id="a5332ed56c9f0b3702e72aecdcaa1e7be" name="a5332ed56c9f0b3702e72aecdcaa1e7be"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5332ed56c9f0b3702e72aecdcaa1e7be">&#9670;&nbsp;</a></span>burst_penalty()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ranged::burst_penalty </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classCharacter.html">Character</a> &amp;&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classitem.html">item</a> &amp;&#160;</td>
          <td class="paramname"><em>gun</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>gun_recoil</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
Dexterity reduces burst penalty by flat amount Strength reduces burst fire penalty Pistol reduces burst fire penalty Smg reduces burst fire penalty Rifle reduces burst fire penalty Shotgun reduces burst fire penalty 
<p class="definition">Definition at line <a class="el" href="ranged_8cpp_source.html#l02162">2162</a> of file <a class="el" href="ranged_8cpp_source.html">ranged.cpp</a>.</p>
<div class="fragment"><div class="line"><a id="l02163" name="l02163"></a><span class="lineno"> 2163</span>{<span class="comment"></span></div>
<div class="line"><a id="l02164" name="l02164"></a><span class="lineno"> 2164</span><span class="comment">    ///\EFFECT_DEX reduces burst penalty by flat amount</span></div>
<div class="line"><a id="l02165" name="l02165"></a><span class="lineno"> 2165</span><span class="comment"></span>    <span class="keywordtype">int</span> dex_effect = p.<a class="code hl_function" href="classCharacter.html#a34a927d0f161ac92ab0d462397828bd5">get_dex</a>() * 10;<span class="comment"></span></div>
<div class="line"><a id="l02166" name="l02166"></a><span class="lineno"> 2166</span><span class="comment">    ///\EFFECT_STR reduces burst fire penalty</span></div>
<div class="line"><a id="l02167" name="l02167"></a><span class="lineno"> 2167</span><span class="comment"></span>    <span class="keywordtype">float</span> str_effect = p.<a class="code hl_function" href="classCharacter.html#a5aba683ccf77cb560a0a932308289bd9">get_str</a>() * 0.5f;</div>
<div class="line"><a id="l02168" name="l02168"></a><span class="lineno"> 2168</span><span class="comment"></span> </div>
<div class="line"><a id="l02169" name="l02169"></a><span class="lineno"> 2169</span><span class="comment">    /** @EFFECT_PISTOL reduces burst fire penalty */</span><span class="comment"></span></div>
<div class="line"><a id="l02170" name="l02170"></a><span class="lineno"> 2170</span><span class="comment">    /** @EFFECT_SMG reduces burst fire penalty */</span><span class="comment"></span></div>
<div class="line"><a id="l02171" name="l02171"></a><span class="lineno"> 2171</span><span class="comment">    /** @EFFECT_RIFLE reduces burst fire penalty */</span><span class="comment"></span></div>
<div class="line"><a id="l02172" name="l02172"></a><span class="lineno"> 2172</span><span class="comment">    /** @EFFECT_SHOTGUN reduces burst fire penalty */</span></div>
<div class="line"><a id="l02173" name="l02173"></a><span class="lineno"> 2173</span>    <span class="keywordtype">int</span> skill_lvl = std::min( p.<a class="code hl_function" href="classCharacter.html#afa95fe499ca6b55ab97f1b442a4c95c5">get_skill_level</a>( gun.<a class="code hl_function" href="classitem.html#a3d8542661f2e2a82e8cb3792584912f3">gun_skill</a>() ), <a class="code hl_variable" href="game__constants_8h.html#ae9c0ec5b4724c15132efddb8862ca652">MAX_SKILL</a> );</div>
<div class="line"><a id="l02174" name="l02174"></a><span class="lineno"> 2174</span> </div>
<div class="line"><a id="l02175" name="l02175"></a><span class="lineno"> 2175</span>    <span class="keywordflow">return</span> std::max&lt;int&gt;( 0, 3 * ( gun_recoil - dex_effect ) / std::max( 1.0f,</div>
<div class="line"><a id="l02176" name="l02176"></a><span class="lineno"> 2176</span>                          str_effect + skill_lvl ) );</div>
<div class="line"><a id="l02177" name="l02177"></a><span class="lineno"> 2177</span>}</div>
<div class="ttc" id="aclassCharacter_html_a5aba683ccf77cb560a0a932308289bd9"><div class="ttname"><a href="classCharacter.html#a5aba683ccf77cb560a0a932308289bd9">Character::get_str</a></div><div class="ttdeci">virtual int get_str() const</div><div class="ttdoc">Getters for stats exclusive to characters.</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l04090">character.cpp:4090</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="character_8cpp_source.html#l04094">Character::get_dex()</a>, <a class="el" href="character_8cpp_source.html#l03351">Character::get_skill_level()</a>, <a class="el" href="character_8cpp_source.html#l04090">Character::get_str()</a>, <a class="el" href="item_8cpp_source.html#l07212">item::gun_skill()</a>, and <a class="el" href="game__constants_8h_source.html#l00114">MAX_SKILL</a>.</p>

<p class="reference">Referenced by <a class="el" href="ranged_8cpp_source.html#l00805">calculate_dispersion()</a>, <a class="el" href="npcmove_8cpp_source.html#l02041">npc::confident_gun_mode_range()</a>, and <a class="el" href="item_8cpp_source.html#l02020">item::gun_info()</a>.</p>

</div>
</div>
<a id="a7a391700b761ffa6bc80dc0a998267cb" name="a7a391700b761ffa6bc80dc0a998267cb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7a391700b761ffa6bc80dc0a998267cb">&#9670;&nbsp;</a></span>draw_cone_aoe()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ranged::draw_cone_aoe </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structtripoint.html">tripoint</a> &amp;&#160;</td>
          <td class="paramname"><em>origin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::map&lt; <a class="el" href="structtripoint.html">tripoint</a>, double &gt; &amp;&#160;</td>
          <td class="paramname"><em>aoe</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="animation_8cpp_source.html#l01144">1144</a> of file <a class="el" href="animation_8cpp_source.html">animation.cpp</a>.</p>
<div class="fragment"><div class="line"><a id="l01145" name="l01145"></a><span class="lineno"> 1145</span>{</div>
<div class="line"><a id="l01146" name="l01146"></a><span class="lineno"> 1146</span>    <span class="keywordflow">if</span>( <a class="code hl_variable" href="cached__options_8cpp.html#a07c66893ce868671f9998dad80094cb1">test_mode</a> ) {</div>
<div class="line"><a id="l01147" name="l01147"></a><span class="lineno"> 1147</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01148" name="l01148"></a><span class="lineno"> 1148</span>    }</div>
<div class="line"><a id="l01149" name="l01149"></a><span class="lineno"> 1149</span> </div>
<div class="line"><a id="l01150" name="l01150"></a><span class="lineno"> 1150</span>    <a class="code hl_typedef" href="animation_8h.html#adc417821aec24e4672777ee602619cc2">bucketed_points</a> buckets = <a class="code hl_function" href="animation_8cpp.html#a8fc0a82b99c5c13bd3e7c63b3d47c3bf">bucket_by_distance</a>( <a class="code hl_enumeration" href="namespacecoords.html#ad99808a305ad40299e592d1266bed4a7">origin</a>, aoe );</div>
<div class="line"><a id="l01151" name="l01151"></a><span class="lineno"> 1151</span>    <span class="comment">// That hardcoded value could be improved... Not sure about the name</span></div>
<div class="line"><a id="l01152" name="l01152"></a><span class="lineno"> 1152</span>    <span class="keywordtype">size_t</span> max_bucket_count = std::min&lt;size_t&gt;( 10, aoe.size() );</div>
<div class="line"><a id="l01153" name="l01153"></a><span class="lineno"> 1153</span>    <a class="code hl_typedef" href="animation_8h.html#adc417821aec24e4672777ee602619cc2">bucketed_points</a> waves = <a class="code hl_function" href="animation_8cpp.html#a4136770e1e34083dc24be6a34ec18c1d">optimal_bucketing</a>( buckets, max_bucket_count );</div>
<div class="line"><a id="l01154" name="l01154"></a><span class="lineno"> 1154</span> </div>
<div class="line"><a id="l01155" name="l01155"></a><span class="lineno"> 1155</span><span class="preprocessor">#if defined(TILES)</span></div>
<div class="line"><a id="l01156" name="l01156"></a><span class="lineno"> 1156</span>    <span class="keywordflow">if</span>( !<a class="code hl_variable" href="cached__options_8cpp.html#a9b72c9314ac0439a25820b3abf2229f3">use_tiles</a> ) {</div>
<div class="line"><a id="l01157" name="l01157"></a><span class="lineno"> 1157</span>        <a class="code hl_function" href="animation_8cpp.html#a1b18612f445cf54b13f5a37623f7d355">draw_cone_aoe_curses</a>( <a class="code hl_enumeration" href="namespacecoords.html#ad99808a305ad40299e592d1266bed4a7">origin</a>, waves );</div>
<div class="line"><a id="l01158" name="l01158"></a><span class="lineno"> 1158</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01159" name="l01159"></a><span class="lineno"> 1159</span>    }</div>
<div class="line"><a id="l01160" name="l01160"></a><span class="lineno"> 1160</span> </div>
<div class="line"><a id="l01161" name="l01161"></a><span class="lineno"> 1161</span>    <span class="comment">// This is copied from explosion code</span></div>
<div class="line"><a id="l01162" name="l01162"></a><span class="lineno"> 1162</span>    <span class="comment">// Not sure if it couldn&#39;t be cleaner, without that lambda capture thing</span></div>
<div class="line"><a id="l01163" name="l01163"></a><span class="lineno"> 1163</span>    <a class="code hl_typedef" href="animation_8h.html#acb5b22df5818d9604feb0abd2f3c06b5">one_bucket</a> combined_layer;</div>
<div class="line"><a id="l01164" name="l01164"></a><span class="lineno"> 1164</span>    combined_layer.reserve( aoe.size() );</div>
<div class="line"><a id="l01165" name="l01165"></a><span class="lineno"> 1165</span> </div>
<div class="line"><a id="l01166" name="l01166"></a><span class="lineno"> 1166</span>    wave_animation anim;</div>
<div class="line"><a id="l01167" name="l01167"></a><span class="lineno"> 1167</span> </div>
<div class="line"><a id="l01168" name="l01168"></a><span class="lineno"> 1168</span>    <a class="code hl_typedef" href="memory__fast_8h.html#ada897699f31fc8b37c5af09d95d45840">shared_ptr_fast&lt;game::draw_callback_t&gt;</a> wave_cb =</div>
<div class="line"><a id="l01169" name="l01169"></a><span class="lineno"> 1169</span>    make_shared_fast&lt;game::draw_callback_t&gt;( [&amp;]() {</div>
<div class="line"><a id="l01170" name="l01170"></a><span class="lineno"> 1170</span>        tilecontext-&gt;init_draw_cone_aoe( <a class="code hl_enumeration" href="namespacecoords.html#ad99808a305ad40299e592d1266bed4a7">origin</a>, combined_layer );</div>
<div class="line"><a id="l01171" name="l01171"></a><span class="lineno"> 1171</span>    } );</div>
<div class="line"><a id="l01172" name="l01172"></a><span class="lineno"> 1172</span>    <a class="code hl_variable" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;add_draw_callback( wave_cb );</div>
<div class="line"><a id="l01173" name="l01173"></a><span class="lineno"> 1173</span> </div>
<div class="line"><a id="l01174" name="l01174"></a><span class="lineno"> 1174</span>    <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code hl_typedef" href="animation_8h.html#acb5b22df5818d9604feb0abd2f3c06b5">one_bucket</a> &amp;layer : waves ) {</div>
<div class="line"><a id="l01175" name="l01175"></a><span class="lineno"> 1175</span>        <span class="comment">// Older layers get a fade effect</span></div>
<div class="line"><a id="l01176" name="l01176"></a><span class="lineno"> 1176</span>        <span class="keywordflow">for</span>( <a class="code hl_struct" href="structpoint__with__value.html">point_with_value</a> &amp;pv : combined_layer ) {</div>
<div class="line"><a id="l01177" name="l01177"></a><span class="lineno"> 1177</span>            pv.val *= 1.0 - ( 2.0 / max_bucket_count );</div>
<div class="line"><a id="l01178" name="l01178"></a><span class="lineno"> 1178</span>        }</div>
<div class="line"><a id="l01179" name="l01179"></a><span class="lineno"> 1179</span>        combined_layer.insert( combined_layer.end(), layer.begin(), layer.end() );</div>
<div class="line"><a id="l01180" name="l01180"></a><span class="lineno"> 1180</span>        <span class="keywordflow">if</span>( std::any_of( combined_layer.begin(), combined_layer.end(),</div>
<div class="line"><a id="l01181" name="l01181"></a><span class="lineno"> 1181</span>        []( <span class="keyword">const</span> <a class="code hl_struct" href="structpoint__with__value.html">point_with_value</a> &amp; element ) {</div>
<div class="line"><a id="l01182" name="l01182"></a><span class="lineno"> 1182</span>        return is_point_visible( element.pt );</div>
<div class="line"><a id="l01183" name="l01183"></a><span class="lineno"> 1183</span>        } ) ) {</div>
<div class="line"><a id="l01184" name="l01184"></a><span class="lineno"> 1184</span>            anim.progress();</div>
<div class="line"><a id="l01185" name="l01185"></a><span class="lineno"> 1185</span>        }</div>
<div class="line"><a id="l01186" name="l01186"></a><span class="lineno"> 1186</span>    }</div>
<div class="line"><a id="l01187" name="l01187"></a><span class="lineno"> 1187</span> </div>
<div class="line"><a id="l01188" name="l01188"></a><span class="lineno"> 1188</span>    tilecontext-&gt;void_cone_aoe();</div>
<div class="line"><a id="l01189" name="l01189"></a><span class="lineno"> 1189</span><span class="preprocessor">#else</span></div>
<div class="line"><a id="l01190" name="l01190"></a><span class="lineno"> 1190</span>    <a class="code hl_function" href="animation_8cpp.html#a1b18612f445cf54b13f5a37623f7d355">draw_cone_aoe_curses</a>( <a class="code hl_enumeration" href="namespacecoords.html#ad99808a305ad40299e592d1266bed4a7">origin</a>, waves );</div>
<div class="line"><a id="l01191" name="l01191"></a><span class="lineno"> 1191</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01192" name="l01192"></a><span class="lineno"> 1192</span>}</div>
<div class="ttc" id="aanimation_8cpp_html_a1b18612f445cf54b13f5a37623f7d355"><div class="ttname"><a href="animation_8cpp.html#a1b18612f445cf54b13f5a37623f7d355">draw_cone_aoe_curses</a></div><div class="ttdeci">static void draw_cone_aoe_curses(const tripoint &amp;, const bucketed_points &amp;waves)</div><div class="ttdef"><b>Definition:</b> <a href="animation_8cpp_source.html#l01095">animation.cpp:1095</a></div></div>
<div class="ttc" id="aanimation_8cpp_html_a4136770e1e34083dc24be6a34ec18c1d"><div class="ttname"><a href="animation_8cpp.html#a4136770e1e34083dc24be6a34ec18c1d">optimal_bucketing</a></div><div class="ttdeci">bucketed_points optimal_bucketing(const bucketed_points &amp;buckets, size_t max_buckets)</div><div class="ttdef"><b>Definition:</b> <a href="animation_8cpp_source.html#l01058">animation.cpp:1058</a></div></div>
<div class="ttc" id="aanimation_8cpp_html_a8fc0a82b99c5c13bd3e7c63b3d47c3bf"><div class="ttname"><a href="animation_8cpp.html#a8fc0a82b99c5c13bd3e7c63b3d47c3bf">bucket_by_distance</a></div><div class="ttdeci">bucketed_points bucket_by_distance(const tripoint &amp;origin, const std::map&lt; tripoint, double &gt; &amp;to_bucket)</div><div class="ttdef"><b>Definition:</b> <a href="animation_8cpp_source.html#l01043">animation.cpp:1043</a></div></div>
<div class="ttc" id="aanimation_8h_html_acb5b22df5818d9604feb0abd2f3c06b5"><div class="ttname"><a href="animation_8h.html#acb5b22df5818d9604feb0abd2f3c06b5">one_bucket</a></div><div class="ttdeci">std::vector&lt; point_with_value &gt; one_bucket</div><div class="ttdef"><b>Definition:</b> <a href="animation_8h_source.html#l00044">animation.h:44</a></div></div>
<div class="ttc" id="aanimation_8h_html_adc417821aec24e4672777ee602619cc2"><div class="ttname"><a href="animation_8h.html#adc417821aec24e4672777ee602619cc2">bucketed_points</a></div><div class="ttdeci">std::list&lt; one_bucket &gt; bucketed_points</div><div class="ttdef"><b>Definition:</b> <a href="animation_8h_source.html#l00045">animation.h:45</a></div></div>
<div class="ttc" id="acached__options_8cpp_html_a07c66893ce868671f9998dad80094cb1"><div class="ttname"><a href="cached__options_8cpp.html#a07c66893ce868671f9998dad80094cb1">test_mode</a></div><div class="ttdeci">bool test_mode</div><div class="ttdoc">Set to true when running in test mode (e.g.</div><div class="ttdef"><b>Definition:</b> <a href="cached__options_8cpp_source.html#l00003">cached_options.cpp:3</a></div></div>
<div class="ttc" id="acached__options_8cpp_html_a9b72c9314ac0439a25820b3abf2229f3"><div class="ttname"><a href="cached__options_8cpp.html#a9b72c9314ac0439a25820b3abf2229f3">use_tiles</a></div><div class="ttdeci">bool use_tiles</div><div class="ttdoc">Use tiles for display.</div><div class="ttdef"><b>Definition:</b> <a href="cached__options_8cpp_source.html#l00006">cached_options.cpp:6</a></div></div>
<div class="ttc" id="agame_8cpp_html_abeb98e93502d73818b4a73fabe191bc1"><div class="ttname"><a href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a></div><div class="ttdeci">std::unique_ptr&lt; game &gt; g</div><div class="ttdef"><b>Definition:</b> <a href="game_8cpp_source.html#l00283">game.cpp:283</a></div></div>
<div class="ttc" id="amemory__fast_8h_html_ada897699f31fc8b37c5af09d95d45840"><div class="ttname"><a href="memory__fast_8h.html#ada897699f31fc8b37c5af09d95d45840">shared_ptr_fast</a></div><div class="ttdeci">std::shared_ptr&lt; T &gt; shared_ptr_fast</div><div class="ttdef"><b>Definition:</b> <a href="memory__fast_8h_source.html#l00016">memory_fast.h:16</a></div></div>
<div class="ttc" id="anamespacecoords_html_ad99808a305ad40299e592d1266bed4a7"><div class="ttname"><a href="namespacecoords.html#ad99808a305ad40299e592d1266bed4a7">coords::origin</a></div><div class="ttdeci">origin</div><div class="ttdef"><b>Definition:</b> <a href="coordinates_8h_source.html#l00057">coordinates.h:57</a></div></div>
<div class="ttc" id="astructpoint__with__value_html"><div class="ttname"><a href="structpoint__with__value.html">point_with_value</a></div><div class="ttdef"><b>Definition:</b> <a href="animation_8h_source.html#l00039">animation.h:39</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="animation_8cpp_source.html#l01043">bucket_by_distance()</a>, <a class="el" href="animation_8cpp_source.html#l01095">draw_cone_aoe_curses()</a>, <a class="el" href="game_8cpp_source.html#l00283">g</a>, <a class="el" href="animation_8cpp_source.html#l01058">optimal_bucketing()</a>, <a class="el" href="cached__options_8cpp_source.html#l00003">test_mode</a>, and <a class="el" href="cached__options_8cpp_source.html#l00006">use_tiles</a>.</p>

<p class="reference">Referenced by <a class="el" href="ranged__aoe_8cpp_source.html#l00044">execute_shaped_attack()</a>.</p>

</div>
</div>
<a id="a77dfe116a20cfa50c55a3c2073408e63" name="a77dfe116a20cfa50c55a3c2073408e63"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a77dfe116a20cfa50c55a3c2073408e63">&#9670;&nbsp;</a></span>effective_dispersion()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ranged::effective_dispersion </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classCharacter.html">Character</a> &amp;&#160;</td>
          <td class="paramname"><em>who</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>dispersion</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
Perception penalizes sight dispersion when low. 
<p class="definition">Definition at line <a class="el" href="ranged_8cpp_source.html#l03820">3820</a> of file <a class="el" href="ranged_8cpp_source.html">ranged.cpp</a>.</p>
<div class="fragment"><div class="line"><a id="l03821" name="l03821"></a><span class="lineno"> 3821</span>{<span class="comment"></span></div>
<div class="line"><a id="l03822" name="l03822"></a><span class="lineno"> 3822</span><span class="comment">    /** @EFFECT_PER penalizes sight dispersion when low. */</span></div>
<div class="line"><a id="l03823" name="l03823"></a><span class="lineno"> 3823</span>    dispersion += who.<a class="code hl_function" href="classCharacter.html#aaca0aa6cf36c88068ac22eb6b50102c2">ranged_per_mod</a>();</div>
<div class="line"><a id="l03824" name="l03824"></a><span class="lineno"> 3824</span> </div>
<div class="line"><a id="l03825" name="l03825"></a><span class="lineno"> 3825</span>    dispersion += who.<a class="code hl_function" href="classCharacter.html#adc1fd84a88722a905e57fea8bfd5b6b0">encumb</a>( <a class="code hl_enumvalue" href="bodypart_8h.html#af618290c4c2de42aab87977ac7311980a2055386ee220ee2ca3e61d13df65e868">bp_eyes</a> ) / 2;</div>
<div class="line"><a id="l03826" name="l03826"></a><span class="lineno"> 3826</span> </div>
<div class="line"><a id="l03827" name="l03827"></a><span class="lineno"> 3827</span>    <span class="keywordflow">return</span> std::max( dispersion, 0 );</div>
<div class="line"><a id="l03828" name="l03828"></a><span class="lineno"> 3828</span>}</div>
<div class="ttc" id="abodypart_8h_html_af618290c4c2de42aab87977ac7311980a2055386ee220ee2ca3e61d13df65e868"><div class="ttname"><a href="bodypart_8h.html#af618290c4c2de42aab87977ac7311980a2055386ee220ee2ca3e61d13df65e868">bp_eyes</a></div><div class="ttdeci">@ bp_eyes</div><div class="ttdef"><b>Definition:</b> <a href="bodypart_8h_source.html#l00043">bodypart.h:43</a></div></div>
<div class="ttc" id="aclassCharacter_html_aaca0aa6cf36c88068ac22eb6b50102c2"><div class="ttname"><a href="classCharacter.html#aaca0aa6cf36c88068ac22eb6b50102c2">Character::ranged_per_mod</a></div><div class="ttdeci">virtual int ranged_per_mod() const</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l04161">character.cpp:4161</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="bodypart_8h_source.html#l00043">bp_eyes</a>, <a class="el" href="character_8cpp_source.html#l04027">Character::encumb()</a>, and <a class="el" href="character_8cpp_source.html#l04161">Character::ranged_per_mod()</a>.</p>

<p class="reference">Referenced by <a class="el" href="ranged_8cpp_source.html#l01650">get_aim_types()</a>, <a class="el" href="ranged_8cpp_source.html#l03830">get_fastest_sight()</a>, <a class="el" href="ranged_8cpp_source.html#l03855">get_most_accurate_sight()</a>, <a class="el" href="item_8cpp_source.html#l02020">item::gun_info()</a>, <a class="el" href="ranged_8cpp_source.html#l03531">target_ui::panel_recoil()</a>, <a class="el" href="ranged_8cpp_source.html#l01564">print_aim()</a>, and <a class="el" href="ranged_8cpp_source.html#l02181">target_ui::run()</a>.</p>

</div>
</div>
<a id="ade9b38890f46ab6cbe94e1004f0ea5f1" name="ade9b38890f46ab6cbe94e1004f0ea5f1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ade9b38890f46ab6cbe94e1004f0ea5f1">&#9670;&nbsp;</a></span>execute_shaped_attack()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ranged::execute_shaped_attack </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classshape.html">shape</a> &amp;&#160;</td>
          <td class="paramname"><em>sh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structprojectile.html">projectile</a> &amp;&#160;</td>
          <td class="paramname"><em>proj</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classCreature.html">Creature</a> &amp;&#160;</td>
          <td class="paramname"><em>attacker</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>AoE attack, with area given by shape. </p>

<p class="definition">Definition at line <a class="el" href="ranged__aoe_8cpp_source.html#l00044">44</a> of file <a class="el" href="ranged__aoe_8cpp_source.html">ranged_aoe.cpp</a>.</p>
<div class="fragment"><div class="line"><a id="l00045" name="l00045"></a><span class="lineno">   45</span>{</div>
<div class="line"><a id="l00046" name="l00046"></a><span class="lineno">   46</span>    <a class="code hl_class" href="classmap.html">map</a> &amp;here = <a class="code hl_function" href="map_8cpp.html#acb0b34be6e497bdd2f9f40ae6929d562">get_map</a>();</div>
<div class="line"><a id="l00047" name="l00047"></a><span class="lineno">   47</span>    <span class="keyword">const</span> <span class="keyword">auto</span> sigdist_to_coverage = []( <span class="keyword">const</span> <span class="keywordtype">double</span> sigdist ) {</div>
<div class="line"><a id="l00048" name="l00048"></a><span class="lineno">   48</span>        <span class="keywordflow">return</span> std::min( 1.0, -sigdist );</div>
<div class="line"><a id="l00049" name="l00049"></a><span class="lineno">   49</span>    };</div>
<div class="line"><a id="l00050" name="l00050"></a><span class="lineno">   50</span>    <span class="keyword">const</span> <span class="keyword">auto</span> aoe_permeable = [&amp;here]( <span class="keyword">const</span> <a class="code hl_struct" href="structtripoint.html">tripoint</a> &amp; p ) {</div>
<div class="line"><a id="l00051" name="l00051"></a><span class="lineno">   51</span>        <span class="keywordflow">return</span> here.<a class="code hl_function" href="classmap.html#af563dc2397e71a053569cb45c6bb7e77">passable</a>( p ) ||</div>
<div class="line"><a id="l00052" name="l00052"></a><span class="lineno">   52</span>               <span class="comment">// Necessary evil. TODO: Make map::shoot not evil.</span></div>
<div class="line"><a id="l00053" name="l00053"></a><span class="lineno">   53</span>               ( here.<a class="code hl_function" href="classmap.html#a2e43e061dcdfc249076b990a7f174c78">is_transparent</a>( p ) &amp;&amp; here.<a class="code hl_function" href="classmap.html#a09ef3e8c2e6664e3ed98d1e1e18a4b4f">has_flag_furn</a>( <a class="code hl_enumvalue" href="mapdata_8h.html#aa04d037303ea30193f7cf0cd82304258a17333b0108a536601f817c86278e77bd">TFLAG_PERMEABLE</a>, p ) );</div>
<div class="line"><a id="l00054" name="l00054"></a><span class="lineno">   54</span>    };</div>
<div class="line"><a id="l00055" name="l00055"></a><span class="lineno">   55</span>    <span class="keyword">const</span> <a class="code hl_struct" href="structtripoint.html">tripoint</a> &amp;<a class="code hl_enumeration" href="namespacecoords.html#ad99808a305ad40299e592d1266bed4a7">origin</a> = sh.<a class="code hl_function" href="classshape.html#ae2f88d02730df890fb327ce57d86faac">get_origin</a>();</div>
<div class="line"><a id="l00056" name="l00056"></a><span class="lineno">   56</span>    std::priority_queue&lt;tripoint_distance&gt; queue;</div>
<div class="line"><a id="l00057" name="l00057"></a><span class="lineno">   57</span>    std::map&lt;tripoint, aoe_flood_node&gt; <a class="code hl_function" href="handle__action_8cpp.html#a18a5c5b03ba964c4d5d06e062510c99c">open</a>;</div>
<div class="line"><a id="l00058" name="l00058"></a><span class="lineno">   58</span>    std::set&lt;tripoint&gt; closed;</div>
<div class="line"><a id="l00059" name="l00059"></a><span class="lineno">   59</span> </div>
<div class="line"><a id="l00060" name="l00060"></a><span class="lineno">   60</span>    <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code hl_struct" href="structtripoint.html">tripoint</a> &amp;child : here.<a class="code hl_function" href="classmap.html#a4f5f812d7e89a998429958573a4c340f">points_in_radius</a>( <a class="code hl_enumeration" href="namespacecoords.html#ad99808a305ad40299e592d1266bed4a7">origin</a>, 1 ) ) {</div>
<div class="line"><a id="l00061" name="l00061"></a><span class="lineno">   61</span>        <span class="keywordtype">double</span> coverage = sigdist_to_coverage( sh.<a class="code hl_function" href="classshape.html#ad3d343b71c2a680f80bcd741e4c54b06">distance_at</a>( child ) );</div>
<div class="line"><a id="l00062" name="l00062"></a><span class="lineno">   62</span>        <span class="keywordflow">if</span>( coverage &gt; 0.0 &amp;&amp; !<a class="code hl_function" href="map_8cpp.html#acb0b34be6e497bdd2f9f40ae6929d562">get_map</a>().obstructed_by_vehicle_rotation( <a class="code hl_enumeration" href="namespacecoords.html#ad99808a305ad40299e592d1266bed4a7">origin</a>, child ) ) {</div>
<div class="line"><a id="l00063" name="l00063"></a><span class="lineno">   63</span>            <a class="code hl_function" href="handle__action_8cpp.html#a18a5c5b03ba964c4d5d06e062510c99c">open</a>[child] = <a class="code hl_struct" href="structaoe__flood__node.html">aoe_flood_node</a>( <a class="code hl_enumeration" href="namespacecoords.html#ad99808a305ad40299e592d1266bed4a7">origin</a>, 1.0 );</div>
<div class="line"><a id="l00064" name="l00064"></a><span class="lineno">   64</span>            queue.emplace( child, <a class="code hl_function" href="line_8h.html#ac316ae5a3a80221fde94d96fd20b3252">trig_dist_squared</a>( <a class="code hl_enumeration" href="namespacecoords.html#ad99808a305ad40299e592d1266bed4a7">origin</a>, child ) );</div>
<div class="line"><a id="l00065" name="l00065"></a><span class="lineno">   65</span>        }</div>
<div class="line"><a id="l00066" name="l00066"></a><span class="lineno">   66</span>    }</div>
<div class="line"><a id="l00067" name="l00067"></a><span class="lineno">   67</span> </div>
<div class="line"><a id="l00068" name="l00068"></a><span class="lineno">   68</span>    <a class="code hl_function" href="handle__action_8cpp.html#a18a5c5b03ba964c4d5d06e062510c99c">open</a>[<a class="code hl_enumeration" href="namespacecoords.html#ad99808a305ad40299e592d1266bed4a7">origin</a>] = <a class="code hl_struct" href="structaoe__flood__node.html">aoe_flood_node</a>( <a class="code hl_enumeration" href="namespacecoords.html#ad99808a305ad40299e592d1266bed4a7">origin</a>, 1.0 );</div>
<div class="line"><a id="l00069" name="l00069"></a><span class="lineno">   69</span> </div>
<div class="line"><a id="l00070" name="l00070"></a><span class="lineno">   70</span>    std::map&lt;tripoint, double&gt; final_coverage;</div>
<div class="line"><a id="l00071" name="l00071"></a><span class="lineno">   71</span>    <span class="keywordflow">while</span>( !queue.empty() ) {</div>
<div class="line"><a id="l00072" name="l00072"></a><span class="lineno">   72</span>        <a class="code hl_struct" href="structtripoint.html">tripoint</a> p = queue.top().p;</div>
<div class="line"><a id="l00073" name="l00073"></a><span class="lineno">   73</span>        queue.pop();</div>
<div class="line"><a id="l00074" name="l00074"></a><span class="lineno">   74</span>        <span class="keywordflow">if</span>( closed.count( p ) != 0 || !here.<a class="code hl_function" href="classmap.html#a46608709f68358365d0734b1063fed73">inbounds</a>( p ) ) {</div>
<div class="line"><a id="l00075" name="l00075"></a><span class="lineno">   75</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00076" name="l00076"></a><span class="lineno">   76</span>        }</div>
<div class="line"><a id="l00077" name="l00077"></a><span class="lineno">   77</span>        closed.insert( p );</div>
<div class="line"><a id="l00078" name="l00078"></a><span class="lineno">   78</span>        <span class="keywordtype">double</span> parent_coverage = <a class="code hl_function" href="handle__action_8cpp.html#a18a5c5b03ba964c4d5d06e062510c99c">open</a>.at( p ).parent_coverage;</div>
<div class="line"><a id="l00079" name="l00079"></a><span class="lineno">   79</span>        <span class="keywordflow">if</span>( parent_coverage &lt;= 0.0 ) {</div>
<div class="line"><a id="l00080" name="l00080"></a><span class="lineno">   80</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00081" name="l00081"></a><span class="lineno">   81</span>        }</div>
<div class="line"><a id="l00082" name="l00082"></a><span class="lineno">   82</span> </div>
<div class="line"><a id="l00083" name="l00083"></a><span class="lineno">   83</span>        <span class="keywordtype">double</span> current_coverage = parent_coverage;</div>
<div class="line"><a id="l00084" name="l00084"></a><span class="lineno">   84</span>        <span class="keywordflow">if</span>( aoe_permeable( p ) ) {</div>
<div class="line"><a id="l00085" name="l00085"></a><span class="lineno">   85</span>            <span class="comment">// noop</span></div>
<div class="line"><a id="l00086" name="l00086"></a><span class="lineno">   86</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00087" name="l00087"></a><span class="lineno">   87</span>            <a class="code hl_struct" href="structprojectile.html">projectile</a> proj_copy = proj;</div>
<div class="line"><a id="l00088" name="l00088"></a><span class="lineno">   88</span>            here.<a class="code hl_function" href="classmap.html#a30089f97bb31ba2ca2243c178a4a3c65">shoot</a>( p, proj_copy, <span class="keyword">false</span> );</div>
<div class="line"><a id="l00089" name="l00089"></a><span class="lineno">   89</span>            <span class="comment">// There should be a nicer way than rechecking after shoot</span></div>
<div class="line"><a id="l00090" name="l00090"></a><span class="lineno">   90</span>            <span class="keywordflow">if</span>( !aoe_permeable( p ) ) {</div>
<div class="line"><a id="l00091" name="l00091"></a><span class="lineno">   91</span>                <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00092" name="l00092"></a><span class="lineno">   92</span>            }</div>
<div class="line"><a id="l00093" name="l00093"></a><span class="lineno">   93</span> </div>
<div class="line"><a id="l00094" name="l00094"></a><span class="lineno">   94</span>            <span class="keywordtype">float</span> total_dmg = proj_copy.<a class="code hl_variable" href="structprojectile.html#a82d8f657f8cfc4e180c15bfab8ca8a6e">impact</a>.<a class="code hl_function" href="structdamage__instance.html#a96f6f6d008ed8744ce549cefcfec3951">total_damage</a>();</div>
<div class="line"><a id="l00095" name="l00095"></a><span class="lineno">   95</span>            <span class="keywordtype">float</span> old_total_dmg = proj.<a class="code hl_variable" href="structprojectile.html#a82d8f657f8cfc4e180c15bfab8ca8a6e">impact</a>.<a class="code hl_function" href="structdamage__instance.html#a96f6f6d008ed8744ce549cefcfec3951">total_damage</a>();</div>
<div class="line"><a id="l00096" name="l00096"></a><span class="lineno">   96</span>            <span class="keywordflow">if</span>( old_total_dmg != total_dmg ) {</div>
<div class="line"><a id="l00097" name="l00097"></a><span class="lineno">   97</span>                current_coverage *= std::min( 1.0f, old_total_dmg / total_dmg );</div>
<div class="line"><a id="l00098" name="l00098"></a><span class="lineno">   98</span>            }</div>
<div class="line"><a id="l00099" name="l00099"></a><span class="lineno">   99</span>        }</div>
<div class="line"><a id="l00100" name="l00100"></a><span class="lineno">  100</span> </div>
<div class="line"><a id="l00101" name="l00101"></a><span class="lineno">  101</span>        <span class="keywordflow">if</span>( current_coverage &gt; 0.0 ) {</div>
<div class="line"><a id="l00102" name="l00102"></a><span class="lineno">  102</span>            <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code hl_struct" href="structtripoint.html">tripoint</a> &amp;child : here.<a class="code hl_function" href="classmap.html#a4f5f812d7e89a998429958573a4c340f">points_in_radius</a>( p, 1 ) ) {</div>
<div class="line"><a id="l00103" name="l00103"></a><span class="lineno">  103</span>                <span class="keywordtype">double</span> coverage = sigdist_to_coverage( sh.<a class="code hl_function" href="classshape.html#ad3d343b71c2a680f80bcd741e4c54b06">distance_at</a>( child ) );</div>
<div class="line"><a id="l00104" name="l00104"></a><span class="lineno">  104</span>                <span class="keywordflow">if</span>( coverage &gt; 0.0 &amp;&amp; !<a class="code hl_function" href="map_8cpp.html#acb0b34be6e497bdd2f9f40ae6929d562">get_map</a>().obstructed_by_vehicle_rotation( p, child ) &amp;&amp;</div>
<div class="line"><a id="l00105" name="l00105"></a><span class="lineno">  105</span>                    closed.count( child ) == 0 &amp;&amp;</div>
<div class="line"><a id="l00106" name="l00106"></a><span class="lineno">  106</span>                    ( <a class="code hl_function" href="handle__action_8cpp.html#a18a5c5b03ba964c4d5d06e062510c99c">open</a>.count( child ) == 0 || <a class="code hl_function" href="handle__action_8cpp.html#a18a5c5b03ba964c4d5d06e062510c99c">open</a>.at( child ).parent_coverage &lt; current_coverage ) ) {</div>
<div class="line"><a id="l00107" name="l00107"></a><span class="lineno">  107</span>                    <a class="code hl_function" href="handle__action_8cpp.html#a18a5c5b03ba964c4d5d06e062510c99c">open</a>[child] = <a class="code hl_struct" href="structaoe__flood__node.html">aoe_flood_node</a>( p, current_coverage );</div>
<div class="line"><a id="l00108" name="l00108"></a><span class="lineno">  108</span>                    queue.emplace( child, <a class="code hl_function" href="line_8h.html#ac316ae5a3a80221fde94d96fd20b3252">trig_dist_squared</a>( <a class="code hl_enumeration" href="namespacecoords.html#ad99808a305ad40299e592d1266bed4a7">origin</a>, child ) );</div>
<div class="line"><a id="l00109" name="l00109"></a><span class="lineno">  109</span>                }</div>
<div class="line"><a id="l00110" name="l00110"></a><span class="lineno">  110</span>            }</div>
<div class="line"><a id="l00111" name="l00111"></a><span class="lineno">  111</span> </div>
<div class="line"><a id="l00112" name="l00112"></a><span class="lineno">  112</span>            final_coverage[p] = current_coverage;</div>
<div class="line"><a id="l00113" name="l00113"></a><span class="lineno">  113</span>        }</div>
<div class="line"><a id="l00114" name="l00114"></a><span class="lineno">  114</span>    }</div>
<div class="line"><a id="l00115" name="l00115"></a><span class="lineno">  115</span> </div>
<div class="line"><a id="l00116" name="l00116"></a><span class="lineno">  116</span>    <a class="code hl_function" href="namespaceranged.html#a7a391700b761ffa6bc80dc0a998267cb">draw_cone_aoe</a>( <a class="code hl_enumeration" href="namespacecoords.html#ad99808a305ad40299e592d1266bed4a7">origin</a>, final_coverage );</div>
<div class="line"><a id="l00117" name="l00117"></a><span class="lineno">  117</span> </div>
<div class="line"><a id="l00118" name="l00118"></a><span class="lineno">  118</span>    <span class="comment">// Here and not above because we want the animation first</span></div>
<div class="line"><a id="l00119" name="l00119"></a><span class="lineno">  119</span>    <span class="comment">// Terrain will be shown damaged, but having it in unknown state would complicate timing the animation</span></div>
<div class="line"><a id="l00120" name="l00120"></a><span class="lineno">  120</span>    <span class="keywordflow">for</span>( <span class="keyword">const</span> std::pair&lt;const tripoint, double&gt; &amp;pr : final_coverage ) {</div>
<div class="line"><a id="l00121" name="l00121"></a><span class="lineno">  121</span>        <a class="code hl_class" href="classCreature.html">Creature</a> *critter = <a class="code hl_variable" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;critter_at( pr.first );</div>
<div class="line"><a id="l00122" name="l00122"></a><span class="lineno">  122</span>        <span class="keywordflow">if</span>( critter != <span class="keyword">nullptr</span> ) {</div>
<div class="line"><a id="l00123" name="l00123"></a><span class="lineno">  123</span>            <a class="code hl_function" href="namespaceranged.html#a51e6279a2008714e5596da4f5fa1b00e">ranged::hit_with_aoe</a>( *critter, &amp;attacker, proj.<a class="code hl_variable" href="structprojectile.html#a82d8f657f8cfc4e180c15bfab8ca8a6e">impact</a> );</div>
<div class="line"><a id="l00124" name="l00124"></a><span class="lineno">  124</span>        }</div>
<div class="line"><a id="l00125" name="l00125"></a><span class="lineno">  125</span>    }</div>
<div class="line"><a id="l00126" name="l00126"></a><span class="lineno">  126</span>}</div>
<div class="ttc" id="aclassCreature_html"><div class="ttname"><a href="classCreature.html">Creature</a></div><div class="ttdef"><b>Definition:</b> <a href="creature_8h_source.html#l00077">creature.h:78</a></div></div>
<div class="ttc" id="aclassmap_html"><div class="ttname"><a href="classmap.html">map</a></div><div class="ttdoc">Manage and cache data about a part of the map.</div><div class="ttdef"><b>Definition:</b> <a href="map_8h_source.html#l00383">map.h:384</a></div></div>
<div class="ttc" id="aclassmap_html_a09ef3e8c2e6664e3ed98d1e1e18a4b4f"><div class="ttname"><a href="classmap.html#a09ef3e8c2e6664e3ed98d1e1e18a4b4f">map::has_flag_furn</a></div><div class="ttdeci">bool has_flag_furn(const std::string &amp;flag, const tripoint &amp;p) const</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l02398">map.cpp:2398</a></div></div>
<div class="ttc" id="aclassmap_html_a2e43e061dcdfc249076b990a7f174c78"><div class="ttname"><a href="classmap.html#a2e43e061dcdfc249076b990a7f174c78">map::is_transparent</a></div><div class="ttdeci">bool is_transparent(const tripoint &amp;p) const</div><div class="ttdoc">Returns whether the tile at p is transparent(you can look past it).</div><div class="ttdef"><b>Definition:</b> <a href="lightmap_8cpp_source.html#l00690">lightmap.cpp:690</a></div></div>
<div class="ttc" id="aclassmap_html_a30089f97bb31ba2ca2243c178a4a3c65"><div class="ttname"><a href="classmap.html#a30089f97bb31ba2ca2243c178a4a3c65">map::shoot</a></div><div class="ttdeci">void shoot(const tripoint &amp;p, projectile &amp;proj, bool hit_items)</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l03821">map.cpp:3821</a></div></div>
<div class="ttc" id="aclassmap_html_a46608709f68358365d0734b1063fed73"><div class="ttname"><a href="classmap.html#a46608709f68358365d0734b1063fed73">map::inbounds</a></div><div class="ttdeci">virtual bool inbounds(const tripoint &amp;p) const</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l07895">map.cpp:7895</a></div></div>
<div class="ttc" id="aclassmap_html_a4f5f812d7e89a998429958573a4c340f"><div class="ttname"><a href="classmap.html#a4f5f812d7e89a998429958573a4c340f">map::points_in_radius</a></div><div class="ttdeci">tripoint_range&lt; tripoint &gt; points_in_radius(const tripoint &amp;center, size_t radius, size_t radiusz=0) const</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l08754">map.cpp:8754</a></div></div>
<div class="ttc" id="aclassmap_html_af563dc2397e71a053569cb45c6bb7e77"><div class="ttname"><a href="classmap.html#af563dc2397e71a053569cb45c6bb7e77">map::passable</a></div><div class="ttdeci">bool passable(const tripoint &amp;p) const</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l01864">map.cpp:1864</a></div></div>
<div class="ttc" id="aclassshape_html_ad3d343b71c2a680f80bcd741e4c54b06"><div class="ttname"><a href="classshape.html#ad3d343b71c2a680f80bcd741e4c54b06">shape::distance_at</a></div><div class="ttdeci">double distance_at(const tripoint &amp;p) const</div><div class="ttdef"><b>Definition:</b> <a href="shape_8cpp_source.html#l00037">shape.cpp:37</a></div></div>
<div class="ttc" id="aclassshape_html_ae2f88d02730df890fb327ce57d86faac"><div class="ttname"><a href="classshape.html#ae2f88d02730df890fb327ce57d86faac">shape::get_origin</a></div><div class="ttdeci">const tripoint &amp; get_origin() const</div><div class="ttdef"><b>Definition:</b> <a href="shape_8cpp_source.html#l00016">shape.cpp:16</a></div></div>
<div class="ttc" id="ahandle__action_8cpp_html_a18a5c5b03ba964c4d5d06e062510c99c"><div class="ttname"><a href="handle__action_8cpp.html#a18a5c5b03ba964c4d5d06e062510c99c">open</a></div><div class="ttdeci">static void open()</div><div class="ttdef"><b>Definition:</b> <a href="handle__action_8cpp_source.html#l00516">handle_action.cpp:516</a></div></div>
<div class="ttc" id="aline_8h_html_ac316ae5a3a80221fde94d96fd20b3252"><div class="ttname"><a href="line_8h.html#ac316ae5a3a80221fde94d96fd20b3252">trig_dist_squared</a></div><div class="ttdeci">int trig_dist_squared(const tripoint &amp;loc1, const tripoint &amp;loc2)</div><div class="ttdef"><b>Definition:</b> <a href="line_8h_source.html#l00136">line.h:136</a></div></div>
<div class="ttc" id="amap_8cpp_html_acb0b34be6e497bdd2f9f40ae6929d562"><div class="ttname"><a href="map_8cpp.html#acb0b34be6e497bdd2f9f40ae6929d562">get_map</a></div><div class="ttdeci">map &amp; get_map()</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l00147">map.cpp:147</a></div></div>
<div class="ttc" id="amapdata_8h_html_aa04d037303ea30193f7cf0cd82304258a17333b0108a536601f817c86278e77bd"><div class="ttname"><a href="mapdata_8h.html#aa04d037303ea30193f7cf0cd82304258a17333b0108a536601f817c86278e77bd">TFLAG_PERMEABLE</a></div><div class="ttdeci">@ TFLAG_PERMEABLE</div><div class="ttdef"><b>Definition:</b> <a href="mapdata_8h_source.html#l00304">mapdata.h:304</a></div></div>
<div class="ttc" id="anamespaceranged_html_a51e6279a2008714e5596da4f5fa1b00e"><div class="ttname"><a href="namespaceranged.html#a51e6279a2008714e5596da4f5fa1b00e">ranged::hit_with_aoe</a></div><div class="ttdeci">dealt_damage_instance hit_with_aoe(Creature &amp;target, Creature *source, const damage_instance &amp;di)</div><div class="ttdef"><b>Definition:</b> <a href="creature_8cpp_source.html#l00622">creature.cpp:622</a></div></div>
<div class="ttc" id="anamespaceranged_html_a7a391700b761ffa6bc80dc0a998267cb"><div class="ttname"><a href="namespaceranged.html#a7a391700b761ffa6bc80dc0a998267cb">ranged::draw_cone_aoe</a></div><div class="ttdeci">void draw_cone_aoe(const tripoint &amp;origin, const std::map&lt; tripoint, double &gt; &amp;aoe)</div><div class="ttdef"><b>Definition:</b> <a href="animation_8cpp_source.html#l01144">animation.cpp:1144</a></div></div>
<div class="ttc" id="astructaoe__flood__node_html"><div class="ttname"><a href="structaoe__flood__node.html">aoe_flood_node</a></div><div class="ttdef"><b>Definition:</b> <a href="ranged__aoe_8cpp_source.html#l00030">ranged_aoe.cpp:30</a></div></div>
<div class="ttc" id="astructdamage__instance_html_a96f6f6d008ed8744ce549cefcfec3951"><div class="ttname"><a href="structdamage__instance.html#a96f6f6d008ed8744ce549cefcfec3951">damage_instance::total_damage</a></div><div class="ttdeci">float total_damage() const</div><div class="ttdef"><b>Definition:</b> <a href="damage_8cpp_source.html#l00075">damage.cpp:75</a></div></div>
<div class="ttc" id="astructprojectile_html"><div class="ttname"><a href="structprojectile.html">projectile</a></div><div class="ttdef"><b>Definition:</b> <a href="projectile_8h_source.html#l00020">projectile.h:20</a></div></div>
<div class="ttc" id="astructprojectile_html_a82d8f657f8cfc4e180c15bfab8ca8a6e"><div class="ttname"><a href="structprojectile.html#a82d8f657f8cfc4e180c15bfab8ca8a6e">projectile::impact</a></div><div class="ttdeci">damage_instance impact</div><div class="ttdef"><b>Definition:</b> <a href="projectile_8h_source.html#l00021">projectile.h:21</a></div></div>
<div class="ttc" id="astructtripoint_html"><div class="ttname"><a href="structtripoint.html">tripoint</a></div><div class="ttdef"><b>Definition:</b> <a href="point_8h_source.html#l00133">point.h:133</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="shape_8cpp_source.html#l00037">shape::distance_at()</a>, <a class="el" href="animation_8cpp_source.html#l01144">draw_cone_aoe()</a>, <a class="el" href="game_8cpp_source.html#l00283">g</a>, <a class="el" href="map_8cpp_source.html#l00147">get_map()</a>, <a class="el" href="shape_8cpp_source.html#l00016">shape::get_origin()</a>, <a class="el" href="map_8cpp_source.html#l02398">map::has_flag_furn()</a>, <a class="el" href="creature_8cpp_source.html#l00622">hit_with_aoe()</a>, <a class="el" href="projectile_8h_source.html#l00021">projectile::impact</a>, <a class="el" href="map_8cpp_source.html#l07895">map::inbounds()</a>, <a class="el" href="lightmap_8cpp_source.html#l00690">map::is_transparent()</a>, <a class="el" href="handle__action_8cpp_source.html#l00516">open()</a>, <a class="el" href="map_8cpp_source.html#l01864">map::passable()</a>, <a class="el" href="map_8cpp_source.html#l08754">map::points_in_radius()</a>, <a class="el" href="map_8cpp_source.html#l03821">map::shoot()</a>, <a class="el" href="mapdata_8h_source.html#l00304">TFLAG_PERMEABLE</a>, <a class="el" href="damage_8cpp_source.html#l00075">damage_instance::total_damage()</a>, and <a class="el" href="line_8h_source.html#l00136">trig_dist_squared()</a>.</p>

<p class="reference">Referenced by <a class="el" href="ranged_8cpp_source.html#l00822">fire_gun()</a>.</p>

</div>
</div>
<a id="a7b4da33d1d9391123845f299f1f156dc" name="a7b4da33d1d9391123845f299f1f156dc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7b4da33d1d9391123845f299f1f156dc">&#9670;&nbsp;</a></span>expected_coverage()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::map&lt; <a class="el" href="structtripoint.html">tripoint</a>, double &gt; ranged::expected_coverage </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classshape.html">shape</a> &amp;&#160;</td>
          <td class="paramname"><em>sh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classmap.html">map</a> &amp;&#160;</td>
          <td class="paramname"><em>here</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>bash_power</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="ranged__aoe_8cpp_source.html#l00129">129</a> of file <a class="el" href="ranged__aoe_8cpp_source.html">ranged_aoe.cpp</a>.</p>
<div class="fragment"><div class="line"><a id="l00130" name="l00130"></a><span class="lineno">  130</span>{</div>
<div class="line"><a id="l00131" name="l00131"></a><span class="lineno">  131</span>    <span class="keyword">const</span> <span class="keyword">auto</span> sigdist_to_coverage = []( <span class="keyword">const</span> <span class="keywordtype">double</span> sigdist ) {</div>
<div class="line"><a id="l00132" name="l00132"></a><span class="lineno">  132</span>        <span class="keywordflow">return</span> std::min( 1.0, -sigdist );</div>
<div class="line"><a id="l00133" name="l00133"></a><span class="lineno">  133</span>    };</div>
<div class="line"><a id="l00134" name="l00134"></a><span class="lineno">  134</span>    <span class="keyword">const</span> <a class="code hl_struct" href="structtripoint.html">tripoint</a> &amp;<a class="code hl_enumeration" href="namespacecoords.html#ad99808a305ad40299e592d1266bed4a7">origin</a> = sh.<a class="code hl_function" href="classshape.html#ae2f88d02730df890fb327ce57d86faac">get_origin</a>();</div>
<div class="line"><a id="l00135" name="l00135"></a><span class="lineno">  135</span>    std::priority_queue&lt;tripoint_distance&gt; queue;</div>
<div class="line"><a id="l00136" name="l00136"></a><span class="lineno">  136</span>    std::map&lt;tripoint, aoe_flood_node&gt; <a class="code hl_function" href="handle__action_8cpp.html#a18a5c5b03ba964c4d5d06e062510c99c">open</a>;</div>
<div class="line"><a id="l00137" name="l00137"></a><span class="lineno">  137</span>    std::set&lt;tripoint&gt; closed;</div>
<div class="line"><a id="l00138" name="l00138"></a><span class="lineno">  138</span> </div>
<div class="line"><a id="l00139" name="l00139"></a><span class="lineno">  139</span>    <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code hl_struct" href="structtripoint.html">tripoint</a> &amp;child : here.<a class="code hl_function" href="classmap.html#a4f5f812d7e89a998429958573a4c340f">points_in_radius</a>( <a class="code hl_enumeration" href="namespacecoords.html#ad99808a305ad40299e592d1266bed4a7">origin</a>, 1 ) ) {</div>
<div class="line"><a id="l00140" name="l00140"></a><span class="lineno">  140</span>        <span class="keywordtype">double</span> coverage = sigdist_to_coverage( sh.<a class="code hl_function" href="classshape.html#ad3d343b71c2a680f80bcd741e4c54b06">distance_at</a>( child ) );</div>
<div class="line"><a id="l00141" name="l00141"></a><span class="lineno">  141</span>        <span class="keywordflow">if</span>( coverage &gt; 0.0 &amp;&amp; !<a class="code hl_function" href="map_8cpp.html#acb0b34be6e497bdd2f9f40ae6929d562">get_map</a>().obstructed_by_vehicle_rotation( <a class="code hl_enumeration" href="namespacecoords.html#ad99808a305ad40299e592d1266bed4a7">origin</a>, child ) ) {</div>
<div class="line"><a id="l00142" name="l00142"></a><span class="lineno">  142</span>            <a class="code hl_function" href="handle__action_8cpp.html#a18a5c5b03ba964c4d5d06e062510c99c">open</a>[child] = <a class="code hl_struct" href="structaoe__flood__node.html">aoe_flood_node</a>( <a class="code hl_enumeration" href="namespacecoords.html#ad99808a305ad40299e592d1266bed4a7">origin</a>, 1.0 );</div>
<div class="line"><a id="l00143" name="l00143"></a><span class="lineno">  143</span>            queue.emplace( child, <a class="code hl_function" href="line_8h.html#ac316ae5a3a80221fde94d96fd20b3252">trig_dist_squared</a>( <a class="code hl_enumeration" href="namespacecoords.html#ad99808a305ad40299e592d1266bed4a7">origin</a>, child ) );</div>
<div class="line"><a id="l00144" name="l00144"></a><span class="lineno">  144</span>        }</div>
<div class="line"><a id="l00145" name="l00145"></a><span class="lineno">  145</span>    }</div>
<div class="line"><a id="l00146" name="l00146"></a><span class="lineno">  146</span> </div>
<div class="line"><a id="l00147" name="l00147"></a><span class="lineno">  147</span>    <a class="code hl_function" href="handle__action_8cpp.html#a18a5c5b03ba964c4d5d06e062510c99c">open</a>[<a class="code hl_enumeration" href="namespacecoords.html#ad99808a305ad40299e592d1266bed4a7">origin</a>] = <a class="code hl_struct" href="structaoe__flood__node.html">aoe_flood_node</a>( <a class="code hl_enumeration" href="namespacecoords.html#ad99808a305ad40299e592d1266bed4a7">origin</a>, 1.0 );</div>
<div class="line"><a id="l00148" name="l00148"></a><span class="lineno">  148</span> </div>
<div class="line"><a id="l00149" name="l00149"></a><span class="lineno">  149</span>    std::map&lt;tripoint, double&gt; final_coverage;</div>
<div class="line"><a id="l00150" name="l00150"></a><span class="lineno">  150</span>    <span class="keywordflow">while</span>( !queue.empty() ) {</div>
<div class="line"><a id="l00151" name="l00151"></a><span class="lineno">  151</span>        <a class="code hl_struct" href="structtripoint.html">tripoint</a> p = queue.top().p;</div>
<div class="line"><a id="l00152" name="l00152"></a><span class="lineno">  152</span>        queue.pop();</div>
<div class="line"><a id="l00153" name="l00153"></a><span class="lineno">  153</span>        <span class="keywordflow">if</span>( closed.count( p ) != 0 ) {</div>
<div class="line"><a id="l00154" name="l00154"></a><span class="lineno">  154</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00155" name="l00155"></a><span class="lineno">  155</span>        }</div>
<div class="line"><a id="l00156" name="l00156"></a><span class="lineno">  156</span>        closed.insert( p );</div>
<div class="line"><a id="l00157" name="l00157"></a><span class="lineno">  157</span>        <span class="keywordtype">double</span> parent_coverage = <a class="code hl_function" href="handle__action_8cpp.html#a18a5c5b03ba964c4d5d06e062510c99c">open</a>.at( p ).parent_coverage;</div>
<div class="line"><a id="l00158" name="l00158"></a><span class="lineno">  158</span>        <span class="keywordflow">if</span>( parent_coverage &lt;= 0.0 ) {</div>
<div class="line"><a id="l00159" name="l00159"></a><span class="lineno">  159</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00160" name="l00160"></a><span class="lineno">  160</span>        }</div>
<div class="line"><a id="l00161" name="l00161"></a><span class="lineno">  161</span> </div>
<div class="line"><a id="l00162" name="l00162"></a><span class="lineno">  162</span>        <span class="keywordtype">double</span> current_coverage = parent_coverage;</div>
<div class="line"><a id="l00163" name="l00163"></a><span class="lineno">  163</span>        <span class="keywordflow">if</span>( here.<a class="code hl_function" href="classmap.html#af563dc2397e71a053569cb45c6bb7e77">passable</a>( p ) ||</div>
<div class="line"><a id="l00164" name="l00164"></a><span class="lineno">  164</span>            <span class="comment">// Necessary evil. TODO: Make map::shoot not evil.</span></div>
<div class="line"><a id="l00165" name="l00165"></a><span class="lineno">  165</span>            ( here.<a class="code hl_function" href="classmap.html#a2e43e061dcdfc249076b990a7f174c78">is_transparent</a>( p ) &amp;&amp; here.<a class="code hl_function" href="classmap.html#a09ef3e8c2e6664e3ed98d1e1e18a4b4f">has_flag_furn</a>( <a class="code hl_enumvalue" href="mapdata_8h.html#aa04d037303ea30193f7cf0cd82304258a17333b0108a536601f817c86278e77bd">TFLAG_PERMEABLE</a>, p ) ) ) {</div>
<div class="line"><a id="l00166" name="l00166"></a><span class="lineno">  166</span>            <span class="comment">// noop</span></div>
<div class="line"><a id="l00167" name="l00167"></a><span class="lineno">  167</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00168" name="l00168"></a><span class="lineno">  168</span>            <span class="keywordtype">int</span> bash_str = here.<a class="code hl_function" href="classmap.html#a0b83bb9cbf7265f78eaad06dc1f7b8c3">bash_strength</a>( p );</div>
<div class="line"><a id="l00169" name="l00169"></a><span class="lineno">  169</span>            <span class="keywordtype">int</span> bash_res = here.<a class="code hl_function" href="classmap.html#adfb4f21d749696fdd25c7b37ba2b7b21">bash_resistance</a>( p );</div>
<div class="line"><a id="l00170" name="l00170"></a><span class="lineno">  170</span>            <span class="keywordflow">if</span>( bash_power &lt; bash_res ) {</div>
<div class="line"><a id="l00171" name="l00171"></a><span class="lineno">  171</span>                <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00172" name="l00172"></a><span class="lineno">  172</span>            }</div>
<div class="line"><a id="l00173" name="l00173"></a><span class="lineno">  173</span>            <span class="keywordtype">int</span> range_width = bash_str - bash_res + 1;</div>
<div class="line"><a id="l00174" name="l00174"></a><span class="lineno">  174</span>            <span class="keywordtype">int</span> fail_width = bash_str - bash_power;</div>
<div class="line"><a id="l00175" name="l00175"></a><span class="lineno">  175</span>            <span class="keywordtype">double</span> fail_chance = <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>( fail_width ) / ( range_width );</div>
<div class="line"><a id="l00176" name="l00176"></a><span class="lineno">  176</span>            current_coverage *= 1.0 - std::max( 0.0, fail_chance );</div>
<div class="line"><a id="l00177" name="l00177"></a><span class="lineno">  177</span>        }</div>
<div class="line"><a id="l00178" name="l00178"></a><span class="lineno">  178</span> </div>
<div class="line"><a id="l00179" name="l00179"></a><span class="lineno">  179</span>        <span class="keywordflow">if</span>( here.<a class="code hl_function" href="classmap.html#aa487d96256c3d35db7a1bf273156b64a">veh_at</a>( p ) ) {</div>
<div class="line"><a id="l00180" name="l00180"></a><span class="lineno">  180</span>            <span class="comment">// If a vehicle part is blocking, assume it&#39;s indestructible</span></div>
<div class="line"><a id="l00181" name="l00181"></a><span class="lineno">  181</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00182" name="l00182"></a><span class="lineno">  182</span>        }</div>
<div class="line"><a id="l00183" name="l00183"></a><span class="lineno">  183</span> </div>
<div class="line"><a id="l00184" name="l00184"></a><span class="lineno">  184</span>        <span class="keywordflow">if</span>( current_coverage &gt; 0.0 ) {</div>
<div class="line"><a id="l00185" name="l00185"></a><span class="lineno">  185</span>            <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code hl_struct" href="structtripoint.html">tripoint</a> &amp;child : here.<a class="code hl_function" href="classmap.html#a4f5f812d7e89a998429958573a4c340f">points_in_radius</a>( p, 1 ) ) {</div>
<div class="line"><a id="l00186" name="l00186"></a><span class="lineno">  186</span>                <span class="keywordtype">double</span> coverage = sigdist_to_coverage( sh.<a class="code hl_function" href="classshape.html#ad3d343b71c2a680f80bcd741e4c54b06">distance_at</a>( child ) );</div>
<div class="line"><a id="l00187" name="l00187"></a><span class="lineno">  187</span>                <span class="keywordflow">if</span>( coverage &gt; 0.0 &amp;&amp; !<a class="code hl_function" href="map_8cpp.html#acb0b34be6e497bdd2f9f40ae6929d562">get_map</a>().obstructed_by_vehicle_rotation( p, child ) &amp;&amp;</div>
<div class="line"><a id="l00188" name="l00188"></a><span class="lineno">  188</span>                    closed.count( child ) == 0 &amp;&amp;</div>
<div class="line"><a id="l00189" name="l00189"></a><span class="lineno">  189</span>                    ( <a class="code hl_function" href="handle__action_8cpp.html#a18a5c5b03ba964c4d5d06e062510c99c">open</a>.count( child ) == 0 || <a class="code hl_function" href="handle__action_8cpp.html#a18a5c5b03ba964c4d5d06e062510c99c">open</a>.at( child ).parent_coverage &lt; current_coverage ) ) {</div>
<div class="line"><a id="l00190" name="l00190"></a><span class="lineno">  190</span>                    <a class="code hl_function" href="handle__action_8cpp.html#a18a5c5b03ba964c4d5d06e062510c99c">open</a>[child] = <a class="code hl_struct" href="structaoe__flood__node.html">aoe_flood_node</a>( p, current_coverage );</div>
<div class="line"><a id="l00191" name="l00191"></a><span class="lineno">  191</span>                    queue.emplace( child, <a class="code hl_function" href="line_8h.html#ac316ae5a3a80221fde94d96fd20b3252">trig_dist_squared</a>( <a class="code hl_enumeration" href="namespacecoords.html#ad99808a305ad40299e592d1266bed4a7">origin</a>, child ) );</div>
<div class="line"><a id="l00192" name="l00192"></a><span class="lineno">  192</span>                }</div>
<div class="line"><a id="l00193" name="l00193"></a><span class="lineno">  193</span>            }</div>
<div class="line"><a id="l00194" name="l00194"></a><span class="lineno">  194</span>            final_coverage[p] = current_coverage;</div>
<div class="line"><a id="l00195" name="l00195"></a><span class="lineno">  195</span>        }</div>
<div class="line"><a id="l00196" name="l00196"></a><span class="lineno">  196</span>    }</div>
<div class="line"><a id="l00197" name="l00197"></a><span class="lineno">  197</span> </div>
<div class="line"><a id="l00198" name="l00198"></a><span class="lineno">  198</span>    final_coverage.erase( <a class="code hl_enumeration" href="namespacecoords.html#ad99808a305ad40299e592d1266bed4a7">origin</a> );</div>
<div class="line"><a id="l00199" name="l00199"></a><span class="lineno">  199</span>    <span class="keywordflow">return</span> final_coverage;</div>
<div class="line"><a id="l00200" name="l00200"></a><span class="lineno">  200</span>}</div>
<div class="ttc" id="aclassmap_html_a0b83bb9cbf7265f78eaad06dc1f7b8c3"><div class="ttname"><a href="classmap.html#a0b83bb9cbf7265f78eaad06dc1f7b8c3">map::bash_strength</a></div><div class="ttdeci">int bash_strength(const tripoint &amp;p, bool allow_floor=false) const</div><div class="ttdoc">Returns max_str of the furniture or terrain at p.</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l02542">map.cpp:2542</a></div></div>
<div class="ttc" id="aclassmap_html_aa487d96256c3d35db7a1bf273156b64a"><div class="ttname"><a href="classmap.html#aa487d96256c3d35db7a1bf273156b64a">map::veh_at</a></div><div class="ttdeci">optional_vpart_position veh_at(const tripoint &amp;p) const</div><div class="ttdoc">Checks if tile is occupied by vehicle and by which part.</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l01073">map.cpp:1073</a></div></div>
<div class="ttc" id="aclassmap_html_adfb4f21d749696fdd25c7b37ba2b7b21"><div class="ttname"><a href="classmap.html#adfb4f21d749696fdd25c7b37ba2b7b21">map::bash_resistance</a></div><div class="ttdeci">int bash_resistance(const tripoint &amp;p, bool allow_floor=false) const</div><div class="ttdoc">Returns min_str of the furniture or terrain at p.</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l02556">map.cpp:2556</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="map_8cpp_source.html#l02556">map::bash_resistance()</a>, <a class="el" href="map_8cpp_source.html#l02542">map::bash_strength()</a>, <a class="el" href="shape_8cpp_source.html#l00037">shape::distance_at()</a>, <a class="el" href="map_8cpp_source.html#l00147">get_map()</a>, <a class="el" href="shape_8cpp_source.html#l00016">shape::get_origin()</a>, <a class="el" href="map_8cpp_source.html#l02398">map::has_flag_furn()</a>, <a class="el" href="lightmap_8cpp_source.html#l00690">map::is_transparent()</a>, <a class="el" href="handle__action_8cpp_source.html#l00516">open()</a>, <a class="el" href="map_8cpp_source.html#l01864">map::passable()</a>, <a class="el" href="map_8cpp_source.html#l08754">map::points_in_radius()</a>, <a class="el" href="mapdata_8h_source.html#l00304">TFLAG_PERMEABLE</a>, <a class="el" href="line_8h_source.html#l00136">trig_dist_squared()</a>, and <a class="el" href="map_8cpp_source.html#l01073">map::veh_at()</a>.</p>

<p class="reference">Referenced by <a class="el" href="ranged_8cpp_source.html#l02570">target_ui::set_cursor_pos()</a>.</p>

</div>
</div>
<a id="ae09161f6a90d6bc3282a1e0f50c439b2" name="ae09161f6a90d6bc3282a1e0f50c439b2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae09161f6a90d6bc3282a1e0f50c439b2">&#9670;&nbsp;</a></span>fire_gun() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ranged::fire_gun </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classCharacter.html">Character</a> &amp;&#160;</td>
          <td class="paramname"><em>who</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structtripoint.html">tripoint</a> &amp;&#160;</td>
          <td class="paramname"><em>target</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>shots</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classitem.html">item</a> &amp;&#160;</td>
          <td class="paramname"><em>gun</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classitem__location.html">item_location</a>&#160;</td>
          <td class="paramname"><em>ammo</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Fire a gun or auxiliary gunmod (ignoring any current mode) </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">who</td><td><a class="el" href="classCharacter.html">Character</a> whose stats to use </td></tr>
    <tr><td class="paramname">target</td><td>Where the first shot is aimed at (may vary for later shots) </td></tr>
    <tr><td class="paramname">shots</td><td>Maximum number of shots to fire (less may be fired in some circumstances) </td></tr>
    <tr><td class="paramname">gun</td><td>Item to fire (which does not necessary have to be in the characters possession) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Number of shots actually fired </dd></dl>

<p class="definition">Definition at line <a class="el" href="ranged_8cpp_source.html#l00822">822</a> of file <a class="el" href="ranged_8cpp_source.html">ranged.cpp</a>.</p>
<div class="fragment"><div class="line"><a id="l00824" name="l00824"></a><span class="lineno">  824</span>{</div>
<div class="line"><a id="l00825" name="l00825"></a><span class="lineno">  825</span>    <span class="keywordtype">int</span> attack_moves = <a class="code hl_function" href="namespaceranged.html#ad3183129b44ab2775b50bb90da5c5333">time_to_attack</a>( who, gun, ammo );</div>
<div class="line"><a id="l00826" name="l00826"></a><span class="lineno">  826</span> </div>
<div class="line"><a id="l00827" name="l00827"></a><span class="lineno">  827</span>    <span class="keywordflow">if</span>( !gun.<a class="code hl_function" href="classitem.html#a2912b2e15a4eec07a5070fffbbd152e8">is_gun</a>() ) {</div>
<div class="line"><a id="l00828" name="l00828"></a><span class="lineno">  828</span>        <a class="code hl_define" href="debug_8h.html#a87e509562277a7ada3a75330d00cb445">debugmsg</a>( <span class="stringliteral">&quot;%s tried to fire non-gun (%s).&quot;</span>, who.<a class="code hl_variable" href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">name</a>, gun.<a class="code hl_function" href="classitem.html#a7e78e26dcf9b357cda769c3ca2938eda">tname</a>() );</div>
<div class="line"><a id="l00829" name="l00829"></a><span class="lineno">  829</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a id="l00830" name="l00830"></a><span class="lineno">  830</span>    }</div>
<div class="line"><a id="l00831" name="l00831"></a><span class="lineno">  831</span> </div>
<div class="line"><a id="l00832" name="l00832"></a><span class="lineno">  832</span>    <span class="keywordflow">if</span>( gun.<a class="code hl_function" href="classitem.html#a7dc5d9ccf5638ae80cebe1864050fa26">ammo_required</a>() &gt; 0 &amp;&amp; !gun.<a class="code hl_function" href="classitem.html#a26c025fd4909bd31c8e91ed87905507b">ammo_remaining</a>() &amp;&amp; !ammo ) {</div>
<div class="line"><a id="l00833" name="l00833"></a><span class="lineno">  833</span>        <a class="code hl_define" href="debug_8h.html#a87e509562277a7ada3a75330d00cb445">debugmsg</a>( <span class="stringliteral">&quot;%s&#39;s gun %s is empty and has no ammo for reloading.&quot;</span>, who.<a class="code hl_variable" href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">name</a>, gun.<a class="code hl_function" href="classitem.html#a7e78e26dcf9b357cda769c3ca2938eda">tname</a>() );</div>
<div class="line"><a id="l00834" name="l00834"></a><span class="lineno">  834</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a id="l00835" name="l00835"></a><span class="lineno">  835</span>    }</div>
<div class="line"><a id="l00836" name="l00836"></a><span class="lineno">  836</span> </div>
<div class="line"><a id="l00837" name="l00837"></a><span class="lineno">  837</span>    <span class="keywordtype">bool</span> is_mech_weapon = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00838" name="l00838"></a><span class="lineno">  838</span>    <span class="keywordflow">if</span>( who.<a class="code hl_function" href="classCharacter.html#a67b51491c2529df09755e07bc633cc55">is_mounted</a>() &amp;&amp; who.<a class="code hl_variable" href="classCharacter.html#ac3d46549b7cdaac1f98991167ad5f1b3">mounted_creature</a>-&gt;has_flag( <a class="code hl_enumvalue" href="mtype_8h.html#afa4c966d04d2ddb261a7cde725eca842a674d4fc8b69d5ad8a6a2154d471ba941">MF_RIDEABLE_MECH</a> ) ) {</div>
<div class="line"><a id="l00839" name="l00839"></a><span class="lineno">  839</span>        is_mech_weapon = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00840" name="l00840"></a><span class="lineno">  840</span>    }</div>
<div class="line"><a id="l00841" name="l00841"></a><span class="lineno">  841</span> </div>
<div class="line"><a id="l00842" name="l00842"></a><span class="lineno">  842</span>    <span class="keywordtype">int</span> shots = max_shots;</div>
<div class="line"><a id="l00843" name="l00843"></a><span class="lineno">  843</span>    <span class="comment">// Number of shots to fire is limited by the amount of remaining ammo</span></div>
<div class="line"><a id="l00844" name="l00844"></a><span class="lineno">  844</span>    <span class="keywordflow">if</span>( gun.<a class="code hl_function" href="classitem.html#a7dc5d9ccf5638ae80cebe1864050fa26">ammo_required</a>() ) {</div>
<div class="line"><a id="l00845" name="l00845"></a><span class="lineno">  845</span>        <span class="keyword">const</span> <span class="keywordtype">int</span> ammo_left = ammo ? ammo.<a class="code hl_function" href="classitem__location.html#a350bb267073f30205f780b394324a32c">get_item</a>()-&gt;<a class="code hl_function" href="classitem.html#a016494fa25a7a403fe78fadbd90b267b">count</a>() : gun.<a class="code hl_function" href="classitem.html#a26c025fd4909bd31c8e91ed87905507b">ammo_remaining</a>();</div>
<div class="line"><a id="l00846" name="l00846"></a><span class="lineno">  846</span>        shots = std::min( shots, ammo_left / gun.<a class="code hl_function" href="classitem.html#a7dc5d9ccf5638ae80cebe1864050fa26">ammo_required</a>() );</div>
<div class="line"><a id="l00847" name="l00847"></a><span class="lineno">  847</span>    }</div>
<div class="line"><a id="l00848" name="l00848"></a><span class="lineno">  848</span> </div>
<div class="line"><a id="l00849" name="l00849"></a><span class="lineno">  849</span>    <span class="comment">// cap our maximum burst size by the amount of UPS power left</span></div>
<div class="line"><a id="l00850" name="l00850"></a><span class="lineno">  850</span>    <span class="keywordflow">if</span>( !gun.<a class="code hl_function" href="classitem.html#aaa5aeb6f838927babb10ede535cf2a73">has_flag</a>( <a class="code hl_function" href="ranged_8cpp.html#a08cb2ed99917b1260118f74991ece915">flag_VEHICLE</a> ) &amp;&amp; gun.<a class="code hl_function" href="classitem.html#af6bd135500675d45eb9b79b196d9558e">get_gun_ups_drain</a>() &gt; 0 ) {</div>
<div class="line"><a id="l00851" name="l00851"></a><span class="lineno">  851</span>        shots = std::min( shots, <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>( who.<a class="code hl_function" href="classvisitable.html#a517e20b6f6c13b8316d5cce8e310b871">charges_of</a>( <a class="code hl_variable" href="ranged_8cpp.html#a55a80a9bbab1925d5462d46d355c2b6e">itype_UPS</a> ) /</div>
<div class="line"><a id="l00852" name="l00852"></a><span class="lineno">  852</span>                          gun.<a class="code hl_function" href="classitem.html#af6bd135500675d45eb9b79b196d9558e">get_gun_ups_drain</a>() ) );</div>
<div class="line"><a id="l00853" name="l00853"></a><span class="lineno">  853</span>    }</div>
<div class="line"><a id="l00854" name="l00854"></a><span class="lineno">  854</span> </div>
<div class="line"><a id="l00855" name="l00855"></a><span class="lineno">  855</span>    <span class="keywordflow">if</span>( shots &lt;= 0 ) {</div>
<div class="line"><a id="l00856" name="l00856"></a><span class="lineno">  856</span>        <a class="code hl_define" href="debug_8h.html#a87e509562277a7ada3a75330d00cb445">debugmsg</a>( <span class="stringliteral">&quot;Attempted to fire zero or negative shots using %s&quot;</span>, gun.<a class="code hl_function" href="classitem.html#a7e78e26dcf9b357cda769c3ca2938eda">tname</a>() );</div>
<div class="line"><a id="l00857" name="l00857"></a><span class="lineno">  857</span>    }</div>
<div class="line"><a id="l00858" name="l00858"></a><span class="lineno">  858</span> </div>
<div class="line"><a id="l00859" name="l00859"></a><span class="lineno">  859</span>    std::optional&lt;shape_factory&gt; <a class="code hl_class" href="classshape.html">shape</a> = <a class="code hl_function" href="namespaceranged.html#ae6187116a03c20b18135711490b2e961">ranged::get_shape_factory</a>( gun );</div>
<div class="line"><a id="l00860" name="l00860"></a><span class="lineno">  860</span> </div>
<div class="line"><a id="l00861" name="l00861"></a><span class="lineno">  861</span>    <a class="code hl_class" href="classmap.html">map</a> &amp;here = <a class="code hl_function" href="map_8cpp.html#acb0b34be6e497bdd2f9f40ae6929d562">get_map</a>();</div>
<div class="line"><a id="l00862" name="l00862"></a><span class="lineno">  862</span>    <span class="comment">// Shaped attacks don&#39;t allow aiming, so they don&#39;t suffer from lack of aim either</span></div>
<div class="line"><a id="l00863" name="l00863"></a><span class="lineno">  863</span>    <span class="keywordtype">int</span> character_recoil = <a class="code hl_class" href="classshape.html">shape</a> ? <a class="code hl_function" href="namespaceranged.html#a6c1943d0fc446952875c5a5cb88cf3fc">recoil_vehicle</a>( who ) : <a class="code hl_function" href="namespaceranged.html#a9fab96fd0829b448bad76e542e320156">recoil_total</a>( who );</div>
<div class="line"><a id="l00864" name="l00864"></a><span class="lineno">  864</span>    <span class="comment">// Penalty is (intentionally) based off mode shots, not ammo-limited.</span></div>
<div class="line"><a id="l00865" name="l00865"></a><span class="lineno">  865</span>    <a class="code hl_class" href="classdispersion__sources.html">dispersion_sources</a> dispersion = <a class="code hl_function" href="ranged_8cpp.html#a90d3db03c7b6819b7684020b9c04153e">calculate_dispersion</a>( here, who, gun, character_recoil,</div>
<div class="line"><a id="l00866" name="l00866"></a><span class="lineno">  866</span>                                    max_shots &gt; 1 );</div>
<div class="line"><a id="l00867" name="l00867"></a><span class="lineno">  867</span> </div>
<div class="line"><a id="l00868" name="l00868"></a><span class="lineno">  868</span>    <span class="keywordtype">bool</span> aoe_attack = gun.<a class="code hl_function" href="classitem.html#a3d8542661f2e2a82e8cb3792584912f3">gun_skill</a>() == <a class="code hl_variable" href="ranged_8cpp.html#a0c6f7a1d7eeb2c38d69b568d85eb9f0d">skill_launcher</a> || <a class="code hl_class" href="classshape.html">shape</a>;</div>
<div class="line"><a id="l00869" name="l00869"></a><span class="lineno">  869</span>    <a class="code hl_struct" href="structtripoint.html">tripoint</a> aim = target;</div>
<div class="line"><a id="l00870" name="l00870"></a><span class="lineno">  870</span>    <span class="keywordtype">int</span> curshot = 0;</div>
<div class="line"><a id="l00871" name="l00871"></a><span class="lineno">  871</span>    <span class="keywordtype">int</span> hits = 0; <span class="comment">// total shots on target</span></div>
<div class="line"><a id="l00872" name="l00872"></a><span class="lineno">  872</span>    <span class="keywordflow">while</span>( curshot != shots ) {</div>
<div class="line"><a id="l00873" name="l00873"></a><span class="lineno">  873</span>        <span class="keywordflow">if</span>( !!ammo &amp;&amp; !gun.<a class="code hl_function" href="classitem.html#a26c025fd4909bd31c8e91ed87905507b">ammo_remaining</a>() ) {</div>
<div class="line"><a id="l00874" name="l00874"></a><span class="lineno">  874</span>            gun.<a class="code hl_function" href="classitem.html#af964cdb27cc2d5a69fa8ffd48d1c8b23">reload</a>( <a class="code hl_function" href="avatar_8cpp.html#a2eddae690431cd32ce7a091217d68a3a">get_avatar</a>(), <a class="code hl_function" href="namespaceavatar__action.html#a76ba74774376a08222b8cdcce08f7304">std::move</a>( ammo ), 1 );</div>
<div class="line"><a id="l00875" name="l00875"></a><span class="lineno">  875</span>        }</div>
<div class="line"><a id="l00876" name="l00876"></a><span class="lineno">  876</span>        <span class="keywordflow">if</span>( gun.<a class="code hl_variable" href="classitem.html#a12a6fa8aac1350f3ca4362a1bdccd9b0">faults</a>.count( <a class="code hl_variable" href="ranged_8cpp.html#ace607007c38b8d55a601963b24f89e7e">fault_gun_chamber_spent</a> ) &amp;&amp; curshot == 0 ) {</div>
<div class="line"><a id="l00877" name="l00877"></a><span class="lineno">  877</span>            who.<a class="code hl_variable" href="classCreature.html#a8c5a392caa213bee9581b47e9f0e2052">moves</a> -= 50;</div>
<div class="line"><a id="l00878" name="l00878"></a><span class="lineno">  878</span>            gun.<a class="code hl_variable" href="classitem.html#a12a6fa8aac1350f3ca4362a1bdccd9b0">faults</a>.erase( <a class="code hl_variable" href="ranged_8cpp.html#ace607007c38b8d55a601963b24f89e7e">fault_gun_chamber_spent</a> );</div>
<div class="line"><a id="l00879" name="l00879"></a><span class="lineno">  879</span>            who.<a class="code hl_function" href="classCreature.html#a91dc4715c36eef7d116f944be9a4d435">add_msg_if_player</a>( <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;You cycle your %s manually.&quot;</span> ), gun.<a class="code hl_function" href="classitem.html#a7e78e26dcf9b357cda769c3ca2938eda">tname</a>() );</div>
<div class="line"><a id="l00880" name="l00880"></a><span class="lineno">  880</span>        }</div>
<div class="line"><a id="l00881" name="l00881"></a><span class="lineno">  881</span> </div>
<div class="line"><a id="l00882" name="l00882"></a><span class="lineno">  882</span>        <span class="keywordflow">if</span>( !<a class="code hl_function" href="namespaceranged.html#abf8b46e1f1dae2e7a3d4ff75b9495026">ranged::handle_gun_damage</a>( who, gun ) ) {</div>
<div class="line"><a id="l00883" name="l00883"></a><span class="lineno">  883</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00884" name="l00884"></a><span class="lineno">  884</span>        }</div>
<div class="line"><a id="l00885" name="l00885"></a><span class="lineno">  885</span> </div>
<div class="line"><a id="l00886" name="l00886"></a><span class="lineno">  886</span>        <span class="comment">// If this is a vehicle mounted turret, which vehicle is it mounted on?</span></div>
<div class="line"><a id="l00887" name="l00887"></a><span class="lineno">  887</span>        <span class="keyword">const</span> <a class="code hl_class" href="classvehicle.html">vehicle</a> *in_veh = who.<a class="code hl_function" href="classCreature.html#a6fb79df9315dc2bed6f34d9a2e37da90">has_effect</a>( <a class="code hl_variable" href="ranged_8cpp.html#a3be9304af3e12dfef2f28becb7b93011">effect_on_roof</a> )</div>
<div class="line"><a id="l00888" name="l00888"></a><span class="lineno">  888</span>                                ? <a class="code hl_function" href="vpart__position_8h.html#a67bd76da258293f1443f1356308381dc">veh_pointer_or_null</a>( here.<a class="code hl_function" href="classmap.html#aa487d96256c3d35db7a1bf273156b64a">veh_at</a>( who.<a class="code hl_function" href="classCharacter.html#ad24859164517ed6e392e21df69527199">pos</a>() ) )</div>
<div class="line"><a id="l00889" name="l00889"></a><span class="lineno">  889</span>                                : nullptr;</div>
<div class="line"><a id="l00890" name="l00890"></a><span class="lineno">  890</span>        <a class="code hl_struct" href="structprojectile.html">projectile</a> <a class="code hl_struct" href="structprojectile.html">projectile</a> = <a class="code hl_function" href="ranged_8cpp.html#ab0db3d2d826960249b5a1d47fa7881ff">make_gun_projectile</a>( gun );</div>
<div class="line"><a id="l00891" name="l00891"></a><span class="lineno">  891</span> </div>
<div class="line"><a id="l00892" name="l00892"></a><span class="lineno">  892</span>        <span class="comment">// Damage reduction from insufficient strength, if using a STR_DRAW weapon.</span></div>
<div class="line"><a id="l00893" name="l00893"></a><span class="lineno">  893</span>        <a class="code hl_struct" href="structprojectile.html">projectile</a>.<a class="code hl_variable" href="structprojectile.html#a82d8f657f8cfc4e180c15bfab8ca8a6e">impact</a>.<a class="code hl_function" href="structdamage__instance.html#a6cc673dba3d2de116c2579c3eda7ed23">mult_damage</a>( <a class="code hl_function" href="namespaceranged.html#a32d7ead84f4eb01b4050fdbbca0767ea">ranged::str_draw_damage_modifier</a>( gun, who ) );</div>
<div class="line"><a id="l00894" name="l00894"></a><span class="lineno">  894</span> </div>
<div class="line"><a id="l00895" name="l00895"></a><span class="lineno">  895</span>        <span class="keywordflow">if</span>( who.<a class="code hl_function" href="classCharacter.html#af06dd97724f4f05df782e7a4b4f9cfe1">has_trait</a>( <a class="code hl_variable" href="ranged_8cpp.html#a7a08490346831114f00f3e44cbe454e3">trait_NORANGEDCRIT</a> ) ) {</div>
<div class="line"><a id="l00896" name="l00896"></a><span class="lineno">  896</span>            <a class="code hl_struct" href="structprojectile.html">projectile</a>.<a class="code hl_function" href="structprojectile.html#a05d90cbb1c83669dd7c23477c8f35963">add_effect</a>( <a class="code hl_variable" href="ranged_8cpp.html#a99d97c99b6e5d138e7daa56d509e13ed">ammo_effect_NO_CRIT</a> );</div>
<div class="line"><a id="l00897" name="l00897"></a><span class="lineno">  897</span>        }</div>
<div class="line"><a id="l00898" name="l00898"></a><span class="lineno">  898</span>        <span class="keywordflow">if</span>( !<a class="code hl_class" href="classshape.html">shape</a> ) {</div>
<div class="line"><a id="l00899" name="l00899"></a><span class="lineno">  899</span>            <span class="keyword">auto</span> shot = <a class="code hl_function" href="ballistics_8cpp.html#aeded5f16540ef8f873a7d9eb5edca240">projectile_attack</a>( <a class="code hl_struct" href="structprojectile.html">projectile</a>, who.<a class="code hl_function" href="classCharacter.html#ad24859164517ed6e392e21df69527199">pos</a>(), aim, dispersion, &amp;who, in_veh );</div>
<div class="line"><a id="l00900" name="l00900"></a><span class="lineno">  900</span>            <span class="keywordflow">if</span>( shot.missed_by &lt;= .1 ) {</div>
<div class="line"><a id="l00901" name="l00901"></a><span class="lineno">  901</span>                <span class="comment">// TODO: check head existence for headshot</span></div>
<div class="line"><a id="l00902" name="l00902"></a><span class="lineno">  902</span>                <a class="code hl_variable" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;events().send&lt;<a class="code hl_enumvalue" href="event_8h.html#a430b444c74dd3fd1472a31714ec5f1cea365dbc32084e314b4788756b6fa66ecb">event_type::character_gets_headshot</a>&gt;( who.<a class="code hl_function" href="classCharacter.html#adb54bdcb284abb66b6be99c8ae225065">getID</a>() );</div>
<div class="line"><a id="l00903" name="l00903"></a><span class="lineno">  903</span>            }</div>
<div class="line"><a id="l00904" name="l00904"></a><span class="lineno">  904</span> </div>
<div class="line"><a id="l00905" name="l00905"></a><span class="lineno">  905</span>            <span class="keywordflow">if</span>( shot.hit_critter ) {</div>
<div class="line"><a id="l00906" name="l00906"></a><span class="lineno">  906</span>                hits++;</div>
<div class="line"><a id="l00907" name="l00907"></a><span class="lineno">  907</span>            }</div>
<div class="line"><a id="l00908" name="l00908"></a><span class="lineno">  908</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00909" name="l00909"></a><span class="lineno">  909</span>            <span class="comment">// 30 degree cap, like for projectiles</span></div>
<div class="line"><a id="l00910" name="l00910"></a><span class="lineno">  910</span>            <span class="keywordtype">double</span> angle_offset_arcmin = std::min( dispersion.<a class="code hl_function" href="classdispersion__sources.html#acaee96ee2b8a0c87b6fb5a9e2d4285d9">roll</a>(), 1800.0 ) * ( <a class="code hl_function" href="rng_8cpp.html#aad28bdad07401a34ecf9912708f8b750">one_in</a>( 2 ) ? 1 : -1 );</div>
<div class="line"><a id="l00911" name="l00911"></a><span class="lineno">  911</span>            <span class="keywordtype">double</span> angle_offset = <a class="code hl_function" href="namespaceunits.html#a1bd284bde31c6b9124add6c8362c8a90">units::to_radians</a>( <a class="code hl_function" href="namespaceunits.html#a8841cc418c4abd052eab82f152a5af07">units::from_arcmin</a>( angle_offset_arcmin ) );</div>
<div class="line"><a id="l00912" name="l00912"></a><span class="lineno">  912</span>            <span class="keywordtype">double</span> dx = aim.<a class="code hl_variable" href="structtripoint.html#affdc0d5b75024cbfacd208a495def3dc">x</a> - who.<a class="code hl_function" href="classCharacter.html#a464e960411f87bd3be76d5142dc255cb">posx</a>();</div>
<div class="line"><a id="l00913" name="l00913"></a><span class="lineno">  913</span>            <span class="keywordtype">double</span> dy = aim.<a class="code hl_variable" href="structtripoint.html#a89f6c0a16e2bfd7ce4f1f1d20404c4d7">y</a> - who.<a class="code hl_function" href="classCharacter.html#a4b4d2e6bf4190c6470b282ce60183c0f">posy</a>();</div>
<div class="line"><a id="l00914" name="l00914"></a><span class="lineno">  914</span>            <span class="keywordtype">double</span> new_angle = <a class="code hl_function" href="line_8cpp.html#a711942c507897b552b002459e43d1ebc">atan2</a>( dy, dx ) + angle_offset;</div>
<div class="line"><a id="l00915" name="l00915"></a><span class="lineno">  915</span>            <span class="comment">// Always using trig here, rotations in maximum metric are weird</span></div>
<div class="line"><a id="l00916" name="l00916"></a><span class="lineno">  916</span>            <span class="keywordtype">double</span> length = <a class="code hl_function" href="coordinates_8h.html#adf2fa43699f878fca49a987112d4aa03">trig_dist</a>( who.<a class="code hl_function" href="classCharacter.html#ad24859164517ed6e392e21df69527199">pos</a>(), aim );</div>
<div class="line"><a id="l00917" name="l00917"></a><span class="lineno">  917</span>            <a class="code hl_struct" href="structrl__vec3d.html">rl_vec3d</a> vec_pos( who.<a class="code hl_function" href="classCharacter.html#ad24859164517ed6e392e21df69527199">pos</a>() );</div>
<div class="line"><a id="l00918" name="l00918"></a><span class="lineno">  918</span>            <a class="code hl_struct" href="structrl__vec3d.html">rl_vec3d</a> new_aim = vec_pos + <a class="code hl_struct" href="structrl__vec3d.html">rl_vec3d</a>( length, 0, 0 ).<a class="code hl_function" href="structrl__vec3d.html#ace319a14c1ba51cb637cdd28d8cddc8c">rotated</a>( new_angle );</div>
<div class="line"><a id="l00919" name="l00919"></a><span class="lineno">  919</span>            <a class="code hl_function" href="namespaceranged.html#ade9b38890f46ab6cbe94e1004f0ea5f1">ranged::execute_shaped_attack</a>( *<a class="code hl_class" href="classshape.html">shape</a>-&gt;create( vec_pos, new_aim ), <a class="code hl_struct" href="structprojectile.html">projectile</a>, who );</div>
<div class="line"><a id="l00920" name="l00920"></a><span class="lineno">  920</span>        }</div>
<div class="line"><a id="l00921" name="l00921"></a><span class="lineno">  921</span>        curshot++;</div>
<div class="line"><a id="l00922" name="l00922"></a><span class="lineno">  922</span> </div>
<div class="line"><a id="l00923" name="l00923"></a><span class="lineno">  923</span>        <a class="code hl_function" href="namespaceranged.html#ab65b29a98e9d9b297fe6d631afc0bf1c">ranged::make_gun_sound_effect</a>( who, shots &gt; 1, gun );</div>
<div class="line"><a id="l00924" name="l00924"></a><span class="lineno">  924</span> </div>
<div class="line"><a id="l00925" name="l00925"></a><span class="lineno">  925</span>        <a class="code hl_function" href="ranged_8cpp.html#a8b90a63ce217d881ddad6a7456c4a98e">cycle_action</a>( gun, who.<a class="code hl_function" href="classCharacter.html#ad24859164517ed6e392e21df69527199">pos</a>() );</div>
<div class="line"><a id="l00926" name="l00926"></a><span class="lineno">  926</span> </div>
<div class="line"><a id="l00927" name="l00927"></a><span class="lineno">  927</span>        <span class="keywordflow">if</span>( who.<a class="code hl_function" href="classCharacter.html#af06dd97724f4f05df782e7a4b4f9cfe1">has_trait</a>( <a class="code hl_variable" href="ranged_8cpp.html#a512959ad2b35ea057f2fed5445fc23c4">trait_PYROMANIA</a> ) &amp;&amp;</div>
<div class="line"><a id="l00928" name="l00928"></a><span class="lineno">  928</span>            !who.<a class="code hl_function" href="classCharacter.html#a51a6b8e64f0e18cd2d0bbfcff2edae57">has_morale</a>( <a class="code hl_variable" href="morale__types_8cpp.html#a7a7fa39cff1d7efe58e013c63b7f0ee6">MORALE_PYROMANIA_STARTFIRE</a> ) &amp;&amp;</div>
<div class="line"><a id="l00929" name="l00929"></a><span class="lineno">  929</span>            gun.<a class="code hl_function" href="classitem.html#aaa5aeb6f838927babb10ede535cf2a73">has_flag</a>( <a class="code hl_function" href="ranged_8cpp.html#add0bf5e67088357d1ff569fc62addb60">flag_PYROMANIAC_WEAPON</a> ) ) {</div>
<div class="line"><a id="l00930" name="l00930"></a><span class="lineno">  930</span>            who.<a class="code hl_function" href="classCreature.html#a91dc4715c36eef7d116f944be9a4d435">add_msg_if_player</a>( <a class="code hl_enumvalue" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea2f644bab8f796b847285eab073040f10">m_good</a>, <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;You feel a surge of euphoria as flames roar out of the %s!&quot;</span> ),</div>
<div class="line"><a id="l00931" name="l00931"></a><span class="lineno">  931</span>                                   gun.<a class="code hl_function" href="classitem.html#a7e78e26dcf9b357cda769c3ca2938eda">tname</a>() );</div>
<div class="line"><a id="l00932" name="l00932"></a><span class="lineno">  932</span>            who.<a class="code hl_function" href="classCharacter.html#ab6b6b317ae10bfb8f358fe289d645c96">add_morale</a>( <a class="code hl_variable" href="morale__types_8cpp.html#a7a7fa39cff1d7efe58e013c63b7f0ee6">MORALE_PYROMANIA_STARTFIRE</a>, 15, 15, 8_hours, 6_hours );</div>
<div class="line"><a id="l00933" name="l00933"></a><span class="lineno">  933</span>            who.<a class="code hl_function" href="classCharacter.html#ac55733961846b5c57183bd3b0fde9eae">rem_morale</a>( <a class="code hl_variable" href="morale__types_8cpp.html#ae932ffaaef9c3a4092fc8727141405bf">MORALE_PYROMANIA_NOFIRE</a> );</div>
<div class="line"><a id="l00934" name="l00934"></a><span class="lineno">  934</span>        }</div>
<div class="line"><a id="l00935" name="l00935"></a><span class="lineno">  935</span> </div>
<div class="line"><a id="l00936" name="l00936"></a><span class="lineno">  936</span>        <span class="keywordflow">if</span>( gun.<a class="code hl_function" href="classitem.html#ae00bce86206993cc672387f9a2c77f92">ammo_consume</a>( gun.<a class="code hl_function" href="classitem.html#a7dc5d9ccf5638ae80cebe1864050fa26">ammo_required</a>(), who.<a class="code hl_function" href="classCharacter.html#ad24859164517ed6e392e21df69527199">pos</a>() ) != gun.<a class="code hl_function" href="classitem.html#a7dc5d9ccf5638ae80cebe1864050fa26">ammo_required</a>() ) {</div>
<div class="line"><a id="l00937" name="l00937"></a><span class="lineno">  937</span>            <a class="code hl_define" href="debug_8h.html#a87e509562277a7ada3a75330d00cb445">debugmsg</a>( <span class="stringliteral">&quot;Unexpected shortage of ammo whilst firing %s&quot;</span>, gun.<a class="code hl_function" href="classitem.html#a7e78e26dcf9b357cda769c3ca2938eda">tname</a>() );</div>
<div class="line"><a id="l00938" name="l00938"></a><span class="lineno">  938</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00939" name="l00939"></a><span class="lineno">  939</span>        }</div>
<div class="line"><a id="l00940" name="l00940"></a><span class="lineno">  940</span> </div>
<div class="line"><a id="l00941" name="l00941"></a><span class="lineno">  941</span>        <span class="keywordflow">if</span>( !gun.<a class="code hl_function" href="classitem.html#aaa5aeb6f838927babb10ede535cf2a73">has_flag</a>( <a class="code hl_function" href="ranged_8cpp.html#a08cb2ed99917b1260118f74991ece915">flag_VEHICLE</a> ) ) {</div>
<div class="line"><a id="l00942" name="l00942"></a><span class="lineno">  942</span>            who.<a class="code hl_function" href="classCharacter.html#a3d0ec2b4e80527bd2daad576c2bbb187">use_charges</a>( <a class="code hl_variable" href="ranged_8cpp.html#a55a80a9bbab1925d5462d46d355c2b6e">itype_UPS</a>, gun.<a class="code hl_function" href="classitem.html#af6bd135500675d45eb9b79b196d9558e">get_gun_ups_drain</a>() );</div>
<div class="line"><a id="l00943" name="l00943"></a><span class="lineno">  943</span>        }</div>
<div class="line"><a id="l00944" name="l00944"></a><span class="lineno">  944</span> </div>
<div class="line"><a id="l00945" name="l00945"></a><span class="lineno">  945</span>        <span class="keywordflow">if</span>( aoe_attack ) {</div>
<div class="line"><a id="l00946" name="l00946"></a><span class="lineno">  946</span>            <span class="keywordflow">continue</span>; <span class="comment">// skip retargeting for launchers</span></div>
<div class="line"><a id="l00947" name="l00947"></a><span class="lineno">  947</span>        }</div>
<div class="line"><a id="l00948" name="l00948"></a><span class="lineno">  948</span>    }</div>
<div class="line"><a id="l00949" name="l00949"></a><span class="lineno">  949</span> </div>
<div class="line"><a id="l00950" name="l00950"></a><span class="lineno">  950</span>    <span class="keywordflow">if</span>( gun.<a class="code hl_function" href="classitem.html#aaa5aeb6f838927babb10ede535cf2a73">has_flag</a>( <a class="code hl_function" href="ranged_8cpp.html#a30c9d25adcf2167a8bff0fe6ca21fdaf">flag_RELOAD_AND_SHOOT</a> ) ) {</div>
<div class="line"><a id="l00951" name="l00951"></a><span class="lineno">  951</span>        <span class="comment">// Reset aim for bows and other reload-and-shoot weapons.</span></div>
<div class="line"><a id="l00952" name="l00952"></a><span class="lineno">  952</span>        who.<a class="code hl_variable" href="classCharacter.html#a057d68671b298012a18f4e289b39935d">recoil</a> = <a class="code hl_variable" href="game__constants_8h.html#a8226e8a134603e5bc06df05efd13d8d1">MAX_RECOIL</a>;</div>
<div class="line"><a id="l00953" name="l00953"></a><span class="lineno">  953</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00954" name="l00954"></a><span class="lineno">  954</span>        <span class="comment">// Now actually apply recoil for the future shots</span></div>
<div class="line"><a id="l00955" name="l00955"></a><span class="lineno">  955</span>        <span class="comment">// But only for one shot, because bursts kinda suck</span></div>
<div class="line"><a id="l00956" name="l00956"></a><span class="lineno">  956</span>        <span class="keywordtype">int</span> gun_recoil = gun.<a class="code hl_function" href="classitem.html#a4dbbda81cd9bc9ed386b9c5bf71d5acd">gun_recoil</a>( <a class="code hl_function" href="ranged_8cpp.html#a6bfc75cd10b0d4de99dc6dcb44abc85b">can_use_bipod</a>( here, who.<a class="code hl_function" href="classCharacter.html#ad24859164517ed6e392e21df69527199">pos</a>() ) );</div>
<div class="line"><a id="l00957" name="l00957"></a><span class="lineno">  957</span> </div>
<div class="line"><a id="l00958" name="l00958"></a><span class="lineno">  958</span>        <span class="comment">// If user is currently able to fire a mounted gun freely, penalize recoil based on size class.</span></div>
<div class="line"><a id="l00959" name="l00959"></a><span class="lineno">  959</span>        <span class="keywordflow">if</span>( gun.<a class="code hl_function" href="classitem.html#aaa5aeb6f838927babb10ede535cf2a73">has_flag</a>( <a class="code hl_function" href="ranged_8cpp.html#a9a327f2be95a30526c2d1ab6a31f72b2">flag_MOUNTED_GUN</a> ) &amp;&amp; !<a class="code hl_function" href="ranged_8cpp.html#a6bfc75cd10b0d4de99dc6dcb44abc85b">can_use_bipod</a>( here, who.<a class="code hl_function" href="classCharacter.html#ad24859164517ed6e392e21df69527199">pos</a>() ) ) {</div>
<div class="line"><a id="l00960" name="l00960"></a><span class="lineno">  960</span>            <span class="keywordflow">if</span>( who.<a class="code hl_function" href="classCharacter.html#aa5ca0f6c4fb1c08bb93ece1c9746c368">get_size</a>() == <a class="code hl_enumvalue" href="creature_8h.html#a94151e401c177b20ea9b8bcadf74f592a75a0e62060c8f624b2c71038a5a77ae9">MS_HUGE</a> ) {</div>
<div class="line"><a id="l00961" name="l00961"></a><span class="lineno">  961</span>                gun_recoil = gun_recoil * 2;</div>
<div class="line"><a id="l00962" name="l00962"></a><span class="lineno">  962</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00963" name="l00963"></a><span class="lineno">  963</span>                gun_recoil = gun_recoil * 3;</div>
<div class="line"><a id="l00964" name="l00964"></a><span class="lineno">  964</span>            }</div>
<div class="line"><a id="l00965" name="l00965"></a><span class="lineno">  965</span>        }</div>
<div class="line"><a id="l00966" name="l00966"></a><span class="lineno">  966</span> </div>
<div class="line"><a id="l00967" name="l00967"></a><span class="lineno">  967</span>        who.<a class="code hl_variable" href="classCharacter.html#a057d68671b298012a18f4e289b39935d">recoil</a> += gun_recoil;</div>
<div class="line"><a id="l00968" name="l00968"></a><span class="lineno">  968</span>        <span class="keywordflow">if</span>( is_mech_weapon ) {</div>
<div class="line"><a id="l00969" name="l00969"></a><span class="lineno">  969</span>            <span class="comment">// mechs can handle recoil far better. they are built around their main gun.</span></div>
<div class="line"><a id="l00970" name="l00970"></a><span class="lineno">  970</span>            who.<a class="code hl_variable" href="classCharacter.html#a057d68671b298012a18f4e289b39935d">recoil</a> = who.<a class="code hl_variable" href="classCharacter.html#a057d68671b298012a18f4e289b39935d">recoil</a> / 2;</div>
<div class="line"><a id="l00971" name="l00971"></a><span class="lineno">  971</span>        }</div>
<div class="line"><a id="l00972" name="l00972"></a><span class="lineno">  972</span>        who.<a class="code hl_variable" href="classCharacter.html#a057d68671b298012a18f4e289b39935d">recoil</a> = std::min( <a class="code hl_variable" href="game__constants_8h.html#a8226e8a134603e5bc06df05efd13d8d1">MAX_RECOIL</a>, who.<a class="code hl_variable" href="classCharacter.html#a057d68671b298012a18f4e289b39935d">recoil</a> );</div>
<div class="line"><a id="l00973" name="l00973"></a><span class="lineno">  973</span>    }</div>
<div class="line"><a id="l00974" name="l00974"></a><span class="lineno">  974</span> </div>
<div class="line"><a id="l00975" name="l00975"></a><span class="lineno">  975</span>    <span class="comment">// Use different amounts of time depending on the type of gun and our skill</span></div>
<div class="line"><a id="l00976" name="l00976"></a><span class="lineno">  976</span>    who.<a class="code hl_variable" href="classCreature.html#a8c5a392caa213bee9581b47e9f0e2052">moves</a> -= attack_moves;</div>
<div class="line"><a id="l00977" name="l00977"></a><span class="lineno">  977</span> </div>
<div class="line"><a id="l00978" name="l00978"></a><span class="lineno">  978</span>    <span class="comment">// Practice the base gun skill proportionally to number of hits, but always by one.</span></div>
<div class="line"><a id="l00979" name="l00979"></a><span class="lineno">  979</span>    who.<a class="code hl_function" href="classCreature.html#acb1d0a1210d3dd4c86350f3ad4c58649">as_player</a>()-&gt;<a class="code hl_function" href="classCharacter.html#a3d70ebd707bada8879208e98f07f7223">practice</a>( <a class="code hl_variable" href="ranged_8cpp.html#a3eadead4a9aa7fee079c0b1acce7965e">skill_gun</a>, ( hits + 1 ) * 5 );</div>
<div class="line"><a id="l00980" name="l00980"></a><span class="lineno">  980</span>    <span class="comment">// launchers train weapon skill for both hits and misses.</span></div>
<div class="line"><a id="l00981" name="l00981"></a><span class="lineno">  981</span>    <span class="keywordtype">int</span> practice_units = aoe_attack ? curshot : hits;</div>
<div class="line"><a id="l00982" name="l00982"></a><span class="lineno">  982</span>    who.<a class="code hl_function" href="classCreature.html#acb1d0a1210d3dd4c86350f3ad4c58649">as_player</a>()-&gt;<a class="code hl_function" href="classCharacter.html#a3d70ebd707bada8879208e98f07f7223">practice</a>( gun.<a class="code hl_function" href="classitem.html#a3d8542661f2e2a82e8cb3792584912f3">gun_skill</a>(), ( practice_units + 1 ) * 5 );</div>
<div class="line"><a id="l00983" name="l00983"></a><span class="lineno">  983</span> </div>
<div class="line"><a id="l00984" name="l00984"></a><span class="lineno">  984</span>    <span class="keywordflow">return</span> curshot;</div>
<div class="line"><a id="l00985" name="l00985"></a><span class="lineno">  985</span>}</div>
<div class="ttc" id="aavatar_8cpp_html_a2eddae690431cd32ce7a091217d68a3a"><div class="ttname"><a href="avatar_8cpp.html#a2eddae690431cd32ce7a091217d68a3a">get_avatar</a></div><div class="ttdeci">avatar &amp; get_avatar()</div><div class="ttdef"><b>Definition:</b> <a href="avatar_8cpp_source.html#l00104">avatar.cpp:104</a></div></div>
<div class="ttc" id="aballistics_8cpp_html_aeded5f16540ef8f873a7d9eb5edca240"><div class="ttname"><a href="ballistics_8cpp.html#aeded5f16540ef8f873a7d9eb5edca240">projectile_attack</a></div><div class="ttdeci">dealt_projectile_attack projectile_attack(const projectile &amp;proj_arg, const tripoint &amp;source, const tripoint &amp;target_arg, const dispersion_sources &amp;dispersion, Creature *origin, const vehicle *in_veh)</div><div class="ttdoc">Fires a projectile at the target point from the source point with total_dispersion dispersion.</div><div class="ttdef"><b>Definition:</b> <a href="ballistics_8cpp_source.html#l00201">ballistics.cpp:201</a></div></div>
<div class="ttc" id="aclassCharacter_html_a057d68671b298012a18f4e289b39935d"><div class="ttname"><a href="classCharacter.html#a057d68671b298012a18f4e289b39935d">Character::recoil</a></div><div class="ttdeci">double recoil</div><div class="ttdef"><b>Definition:</b> <a href="character_8h_source.html#l00571">character.h:571</a></div></div>
<div class="ttc" id="aclassCharacter_html_a3d0ec2b4e80527bd2daad576c2bbb187"><div class="ttname"><a href="classCharacter.html#a3d0ec2b4e80527bd2daad576c2bbb187">Character::use_charges</a></div><div class="ttdeci">std::list&lt; item &gt; use_charges(const itype_id &amp;what, int qty, const std::function&lt; bool(const item &amp;)&gt; &amp;filter=return_true&lt; item &gt;)</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l09665">character.cpp:9665</a></div></div>
<div class="ttc" id="aclassCharacter_html_a3d70ebd707bada8879208e98f07f7223"><div class="ttname"><a href="classCharacter.html#a3d70ebd707bada8879208e98f07f7223">Character::practice</a></div><div class="ttdeci">void practice(const skill_id &amp;id, int amount, int cap=99, bool suppress_warning=false)</div><div class="ttdoc">This handles giving xp for a skill.</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l03417">character.cpp:3417</a></div></div>
<div class="ttc" id="aclassCharacter_html_a464e960411f87bd3be76d5142dc255cb"><div class="ttname"><a href="classCharacter.html#a464e960411f87bd3be76d5142dc255cb">Character::posx</a></div><div class="ttdeci">int posx() const override</div><div class="ttdef"><b>Definition:</b> <a href="character_8h_source.html#l00797">character.h:797</a></div></div>
<div class="ttc" id="aclassCharacter_html_a4b4d2e6bf4190c6470b282ce60183c0f"><div class="ttname"><a href="classCharacter.html#a4b4d2e6bf4190c6470b282ce60183c0f">Character::posy</a></div><div class="ttdeci">int posy() const override</div><div class="ttdef"><b>Definition:</b> <a href="character_8h_source.html#l00800">character.h:800</a></div></div>
<div class="ttc" id="aclassCharacter_html_a51a6b8e64f0e18cd2d0bbfcff2edae57"><div class="ttname"><a href="classCharacter.html#a51a6b8e64f0e18cd2d0bbfcff2edae57">Character::has_morale</a></div><div class="ttdeci">bool has_morale(const morale_type &amp;type) const</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l09106">character.cpp:9106</a></div></div>
<div class="ttc" id="aclassCharacter_html_a6592c35167738421f3e04ca8808d37db"><div class="ttname"><a href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">Character::name</a></div><div class="ttdeci">std::string name</div><div class="ttdef"><b>Definition:</b> <a href="character_8h_source.html#l01566">character.h:1566</a></div></div>
<div class="ttc" id="aclassCharacter_html_a67b51491c2529df09755e07bc633cc55"><div class="ttname"><a href="classCharacter.html#a67b51491c2529df09755e07bc633cc55">Character::is_mounted</a></div><div class="ttdeci">bool is_mounted() const</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l01082">character.cpp:1082</a></div></div>
<div class="ttc" id="aclassCharacter_html_aa5ca0f6c4fb1c08bb93ece1c9746c368"><div class="ttname"><a href="classCharacter.html#aa5ca0f6c4fb1c08bb93ece1c9746c368">Character::get_size</a></div><div class="ttdeci">m_size get_size() const override</div><div class="ttdoc">Get size class of character.</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l00575">character.cpp:575</a></div></div>
<div class="ttc" id="aclassCharacter_html_ab6b6b317ae10bfb8f358fe289d645c96"><div class="ttname"><a href="classCharacter.html#ab6b6b317ae10bfb8f358fe289d645c96">Character::add_morale</a></div><div class="ttdeci">void add_morale(const morale_type &amp;type, int bonus, int max_bonus=0, const time_duration &amp;duration=1_hours, const time_duration &amp;decay_start=30_minutes, bool capped=false, const itype *item_type=nullptr)</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l09095">character.cpp:9095</a></div></div>
<div class="ttc" id="aclassCharacter_html_ac3d46549b7cdaac1f98991167ad5f1b3"><div class="ttname"><a href="classCharacter.html#ac3d46549b7cdaac1f98991167ad5f1b3">Character::mounted_creature</a></div><div class="ttdeci">shared_ptr_fast&lt; monster &gt; mounted_creature</div><div class="ttdef"><b>Definition:</b> <a href="character_8h_source.html#l01617">character.h:1617</a></div></div>
<div class="ttc" id="aclassCharacter_html_ac55733961846b5c57183bd3b0fde9eae"><div class="ttname"><a href="classCharacter.html#ac55733961846b5c57183bd3b0fde9eae">Character::rem_morale</a></div><div class="ttdeci">void rem_morale(const morale_type &amp;type)</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l09116">character.cpp:9116</a></div></div>
<div class="ttc" id="aclassCharacter_html_ad24859164517ed6e392e21df69527199"><div class="ttname"><a href="classCharacter.html#ad24859164517ed6e392e21df69527199">Character::pos</a></div><div class="ttdeci">const tripoint &amp; pos() const override</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l00601">character.cpp:601</a></div></div>
<div class="ttc" id="aclassCharacter_html_adb54bdcb284abb66b6be99c8ae225065"><div class="ttname"><a href="classCharacter.html#adb54bdcb284abb66b6be99c8ae225065">Character::getID</a></div><div class="ttdeci">character_id getID() const</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l00494">character.cpp:494</a></div></div>
<div class="ttc" id="aclassCharacter_html_af06dd97724f4f05df782e7a4b4f9cfe1"><div class="ttname"><a href="classCharacter.html#af06dd97724f4f05df782e7a4b4f9cfe1">Character::has_trait</a></div><div class="ttdeci">bool has_trait(const trait_id &amp;b) const override</div><div class="ttdoc">Returns true if the player has the entered trait.</div><div class="ttdef"><b>Definition:</b> <a href="mutation_8cpp_source.html#l00101">mutation.cpp:101</a></div></div>
<div class="ttc" id="aclassCreature_html_a6fb79df9315dc2bed6f34d9a2e37da90"><div class="ttname"><a href="classCreature.html#a6fb79df9315dc2bed6f34d9a2e37da90">Creature::has_effect</a></div><div class="ttdeci">bool has_effect(const efftype_id &amp;eff_id, body_part bp=num_bp) const</div><div class="ttdoc">Check if creature has the matching effect.</div><div class="ttdef"><b>Definition:</b> <a href="creature_8cpp_source.html#l01206">creature.cpp:1206</a></div></div>
<div class="ttc" id="aclassCreature_html_a8c5a392caa213bee9581b47e9f0e2052"><div class="ttname"><a href="classCreature.html#a8c5a392caa213bee9581b47e9f0e2052">Creature::moves</a></div><div class="ttdeci">int moves</div><div class="ttdef"><b>Definition:</b> <a href="creature_8h_source.html#l00582">creature.h:582</a></div></div>
<div class="ttc" id="aclassCreature_html_a91dc4715c36eef7d116f944be9a4d435"><div class="ttname"><a href="classCreature.html#a91dc4715c36eef7d116f944be9a4d435">Creature::add_msg_if_player</a></div><div class="ttdeci">virtual void add_msg_if_player(const std::string &amp;) const</div><div class="ttdef"><b>Definition:</b> <a href="creature_8h_source.html#l00605">creature.h:605</a></div></div>
<div class="ttc" id="aclassCreature_html_acb1d0a1210d3dd4c86350f3ad4c58649"><div class="ttname"><a href="classCreature.html#acb1d0a1210d3dd4c86350f3ad4c58649">Creature::as_player</a></div><div class="ttdeci">virtual player * as_player()</div><div class="ttdef"><b>Definition:</b> <a href="creature_8h_source.html#l00122">creature.h:122</a></div></div>
<div class="ttc" id="aclassdispersion__sources_html"><div class="ttname"><a href="classdispersion__sources.html">dispersion_sources</a></div><div class="ttdef"><b>Definition:</b> <a href="dispersion_8h_source.html#l00008">dispersion.h:9</a></div></div>
<div class="ttc" id="aclassdispersion__sources_html_acaee96ee2b8a0c87b6fb5a9e2d4285d9"><div class="ttname"><a href="classdispersion__sources.html#acaee96ee2b8a0c87b6fb5a9e2d4285d9">dispersion_sources::roll</a></div><div class="ttdeci">double roll() const</div><div class="ttdef"><b>Definition:</b> <a href="dispersion_8cpp_source.html#l00005">dispersion.cpp:5</a></div></div>
<div class="ttc" id="aclassitem__location_html_a350bb267073f30205f780b394324a32c"><div class="ttname"><a href="classitem__location.html#a350bb267073f30205f780b394324a32c">item_location::get_item</a></div><div class="ttdeci">item * get_item()</div><div class="ttdoc">Gets the selected item or nullptr.</div><div class="ttdef"><b>Definition:</b> <a href="item__location_8cpp_source.html#l00768">item_location.cpp:768</a></div></div>
<div class="ttc" id="aclassitem_html_a016494fa25a7a403fe78fadbd90b267b"><div class="ttname"><a href="classitem.html#a016494fa25a7a403fe78fadbd90b267b">item::count</a></div><div class="ttdeci">int count() const</div><div class="ttdoc">If count_by_charges(), returns charges, otherwise 1.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l06035">item.cpp:6035</a></div></div>
<div class="ttc" id="aclassitem_html_a12a6fa8aac1350f3ca4362a1bdccd9b0"><div class="ttname"><a href="classitem.html#a12a6fa8aac1350f3ca4362a1bdccd9b0">item::faults</a></div><div class="ttdeci">std::set&lt; fault_id &gt; faults</div><div class="ttdoc">What faults (if any) currently apply to this item.</div><div class="ttdef"><b>Definition:</b> <a href="item_8h_source.html#l02164">item.h:2164</a></div></div>
<div class="ttc" id="aclassitem_html_a26c025fd4909bd31c8e91ed87905507b"><div class="ttname"><a href="classitem.html#a26c025fd4909bd31c8e91ed87905507b">item::ammo_remaining</a></div><div class="ttdeci">int ammo_remaining() const</div><div class="ttdoc">Quantity of ammunition currently loaded in tool, gun or auxiliary gunmod.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l07399">item.cpp:7399</a></div></div>
<div class="ttc" id="aclassitem_html_a4dbbda81cd9bc9ed386b9c5bf71d5acd"><div class="ttname"><a href="classitem.html#a4dbbda81cd9bc9ed386b9c5bf71d5acd">item::gun_recoil</a></div><div class="ttdeci">int gun_recoil(bool bipod=false) const</div><div class="ttdoc">Get effective recoil considering handling, loaded ammo and effects of attached gunmods.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l07341">item.cpp:7341</a></div></div>
<div class="ttc" id="aclassitem_html_a7dc5d9ccf5638ae80cebe1864050fa26"><div class="ttname"><a href="classitem.html#a7dc5d9ccf5638ae80cebe1864050fa26">item::ammo_required</a></div><div class="ttdeci">int ammo_required() const</div><div class="ttdoc">Quantity of ammunition consumed per usage of tool or with each shot of gun.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l07469">item.cpp:7469</a></div></div>
<div class="ttc" id="aclassitem_html_a7e78e26dcf9b357cda769c3ca2938eda"><div class="ttname"><a href="classitem.html#a7e78e26dcf9b357cda769c3ca2938eda">item::tname</a></div><div class="ttdeci">std::string tname(unsigned int quantity=1, bool with_prefix=true, unsigned int truncate=0) const</div><div class="ttdoc">Return the (translated) item name.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l04574">item.cpp:4574</a></div></div>
<div class="ttc" id="aclassitem_html_aaa5aeb6f838927babb10ede535cf2a73"><div class="ttname"><a href="classitem.html#aaa5aeb6f838927babb10ede535cf2a73">item::has_flag</a></div><div class="ttdeci">bool has_flag(const std::string &amp;flag) const</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l05328">item.cpp:5328</a></div></div>
<div class="ttc" id="aclassitem_html_ae00bce86206993cc672387f9a2c77f92"><div class="ttname"><a href="classitem.html#ae00bce86206993cc672387f9a2c77f92">item::ammo_consume</a></div><div class="ttdeci">int ammo_consume(int qty, const tripoint &amp;pos)</div><div class="ttdoc">Consume ammo (if available) and return the amount of ammo that was consumed.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l07497">item.cpp:7497</a></div></div>
<div class="ttc" id="aclassitem_html_af6bd135500675d45eb9b79b196d9558e"><div class="ttname"><a href="classitem.html#af6bd135500675d45eb9b79b196d9558e">item::get_gun_ups_drain</a></div><div class="ttdeci">int get_gun_ups_drain() const</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l09961">item.cpp:9961</a></div></div>
<div class="ttc" id="aclassitem_html_af964cdb27cc2d5a69fa8ffd48d1c8b23"><div class="ttname"><a href="classitem.html#af964cdb27cc2d5a69fa8ffd48d1c8b23">item::reload</a></div><div class="ttdeci">bool reload(player &amp;u, item_location loc, int qty)</div><div class="ttdoc">Reload item using ammo from location returning true if successful.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l08127">item.cpp:8127</a></div></div>
<div class="ttc" id="aclassshape_html"><div class="ttname"><a href="classshape.html">shape</a></div><div class="ttdoc">Class describing shapes in 3D space.</div><div class="ttdef"><b>Definition:</b> <a href="shape_8h_source.html#l00021">shape.h:22</a></div></div>
<div class="ttc" id="aclassvehicle_html"><div class="ttname"><a href="classvehicle.html">vehicle</a></div><div class="ttdoc">A vehicle as a whole with all its components.</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8h_source.html#l00675">vehicle.h:676</a></div></div>
<div class="ttc" id="aclassvisitable_html_a517e20b6f6c13b8316d5cce8e310b871"><div class="ttname"><a href="classvisitable.html#a517e20b6f6c13b8316d5cce8e310b871">visitable::charges_of</a></div><div class="ttdeci">int charges_of(const itype_id &amp;what, int limit=INT_MAX, const std::function&lt; bool(const item &amp;)&gt; &amp;filter=return_true&lt; item &gt;, std::function&lt; void(int)&gt; visitor=nullptr) const</div><div class="ttdoc">Count maximum available charges from this instance and any contained items.</div><div class="ttdef"><b>Definition:</b> <a href="visitable_8cpp_source.html#l00946">visitable.cpp:946</a></div></div>
<div class="ttc" id="acoordinates_8h_html_adf2fa43699f878fca49a987112d4aa03"><div class="ttname"><a href="coordinates_8h.html#adf2fa43699f878fca49a987112d4aa03">trig_dist</a></div><div class="ttdeci">int trig_dist(const coords::coord_point&lt; Point, Origin, Scale &gt; &amp;loc1, const coords::coord_point&lt; Point, Origin, Scale &gt; &amp;loc2)</div><div class="ttdef"><b>Definition:</b> <a href="coordinates_8h_source.html#l00512">coordinates.h:512</a></div></div>
<div class="ttc" id="acreature_8h_html_a94151e401c177b20ea9b8bcadf74f592a75a0e62060c8f624b2c71038a5a77ae9"><div class="ttname"><a href="creature_8h.html#a94151e401c177b20ea9b8bcadf74f592a75a0e62060c8f624b2c71038a5a77ae9">MS_HUGE</a></div><div class="ttdeci">@ MS_HUGE</div><div class="ttdef"><b>Definition:</b> <a href="creature_8h_source.html#l00062">creature.h:62</a></div></div>
<div class="ttc" id="adebug_8h_html_a87e509562277a7ada3a75330d00cb445"><div class="ttname"><a href="debug_8h.html#a87e509562277a7ada3a75330d00cb445">debugmsg</a></div><div class="ttdeci">#define debugmsg(...)</div><div class="ttdoc">Debug message of level DL::Error and class DC::DebugMsg, also includes the source file name and line,...</div><div class="ttdef"><b>Definition:</b> <a href="debug_8h_source.html#l00074">debug.h:74</a></div></div>
<div class="ttc" id="aenums_8h_html_a3baf36d700701401b6baf94db93d096ea2f644bab8f796b847285eab073040f10"><div class="ttname"><a href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea2f644bab8f796b847285eab073040f10">m_good</a></div><div class="ttdeci">@ m_good</div><div class="ttdef"><b>Definition:</b> <a href="enums_8h_source.html#l00260">enums.h:260</a></div></div>
<div class="ttc" id="aevent_8h_html_a430b444c74dd3fd1472a31714ec5f1cea365dbc32084e314b4788756b6fa66ecb"><div class="ttname"><a href="event_8h.html#a430b444c74dd3fd1472a31714ec5f1cea365dbc32084e314b4788756b6fa66ecb">event_type::character_gets_headshot</a></div><div class="ttdeci">@ character_gets_headshot</div></div>
<div class="ttc" id="aline_8cpp_html_a711942c507897b552b002459e43d1ebc"><div class="ttname"><a href="line_8cpp.html#a711942c507897b552b002459e43d1ebc">atan2</a></div><div class="ttdeci">units::angle atan2(point p)</div><div class="ttdef"><b>Definition:</b> <a href="line_8cpp_source.html#l00321">line.cpp:321</a></div></div>
<div class="ttc" id="amorale__types_8cpp_html_a7a7fa39cff1d7efe58e013c63b7f0ee6"><div class="ttname"><a href="morale__types_8cpp.html#a7a7fa39cff1d7efe58e013c63b7f0ee6">MORALE_PYROMANIA_STARTFIRE</a></div><div class="ttdeci">const morale_type MORALE_PYROMANIA_STARTFIRE(&quot;morale_pyromania_startfire&quot;)</div></div>
<div class="ttc" id="amorale__types_8cpp_html_ae932ffaaef9c3a4092fc8727141405bf"><div class="ttname"><a href="morale__types_8cpp.html#ae932ffaaef9c3a4092fc8727141405bf">MORALE_PYROMANIA_NOFIRE</a></div><div class="ttdeci">const morale_type MORALE_PYROMANIA_NOFIRE(&quot;morale_pyromania_nofire&quot;)</div></div>
<div class="ttc" id="amtype_8h_html_afa4c966d04d2ddb261a7cde725eca842a674d4fc8b69d5ad8a6a2154d471ba941"><div class="ttname"><a href="mtype_8h.html#afa4c966d04d2ddb261a7cde725eca842a674d4fc8b69d5ad8a6a2154d471ba941">MF_RIDEABLE_MECH</a></div><div class="ttdeci">@ MF_RIDEABLE_MECH</div><div class="ttdef"><b>Definition:</b> <a href="mtype_8h_source.html#l00115">mtype.h:115</a></div></div>
<div class="ttc" id="anamespaceavatar__action_html_a76ba74774376a08222b8cdcce08f7304"><div class="ttname"><a href="namespaceavatar__action.html#a76ba74774376a08222b8cdcce08f7304">avatar_action::move</a></div><div class="ttdeci">bool move(avatar &amp;you, map &amp;m, const tripoint &amp;d)</div><div class="ttdef"><b>Definition:</b> <a href="avatar__action_8cpp_source.html#l00096">avatar_action.cpp:96</a></div></div>
<div class="ttc" id="anamespaceranged_html_a32d7ead84f4eb01b4050fdbbca0767ea"><div class="ttname"><a href="namespaceranged.html#a32d7ead84f4eb01b4050fdbbca0767ea">ranged::str_draw_damage_modifier</a></div><div class="ttdeci">float str_draw_damage_modifier(const item &amp;it, const Character &amp;p)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01031">ranged.cpp:1031</a></div></div>
<div class="ttc" id="anamespaceranged_html_a6c1943d0fc446952875c5a5cb88cf3fc"><div class="ttname"><a href="namespaceranged.html#a6c1943d0fc446952875c5a5cb88cf3fc">ranged::recoil_vehicle</a></div><div class="ttdeci">double recoil_vehicle(const Character &amp;who)</div><div class="ttdoc">Get maximum recoil penalty due to vehicle motion.</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l02073">ranged.cpp:2073</a></div></div>
<div class="ttc" id="anamespaceranged_html_a9fab96fd0829b448bad76e542e320156"><div class="ttname"><a href="namespaceranged.html#a9fab96fd0829b448bad76e542e320156">ranged::recoil_total</a></div><div class="ttdeci">double recoil_total(const Character &amp;who)</div><div class="ttdoc">Current total maximum recoil penalty from all sources.</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l02085">ranged.cpp:2085</a></div></div>
<div class="ttc" id="anamespaceranged_html_ab65b29a98e9d9b297fe6d631afc0bf1c"><div class="ttname"><a href="namespaceranged.html#ab65b29a98e9d9b297fe6d631afc0bf1c">ranged::make_gun_sound_effect</a></div><div class="ttdeci">void make_gun_sound_effect(const Character &amp;who, bool burst, const item &amp;gun)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01802">ranged.cpp:1802</a></div></div>
<div class="ttc" id="anamespaceranged_html_abf8b46e1f1dae2e7a3d4ff75b9495026"><div class="ttname"><a href="namespaceranged.html#abf8b46e1f1dae2e7a3d4ff75b9495026">ranged::handle_gun_damage</a></div><div class="ttdeci">bool handle_gun_damage(Character &amp;shooter, item &amp;it)</div><div class="ttdoc">Returns true if a gun misfires, jams, or has other problems, else returns false.</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00600">ranged.cpp:600</a></div></div>
<div class="ttc" id="anamespaceranged_html_ad3183129b44ab2775b50bb90da5c5333"><div class="ttname"><a href="namespaceranged.html#ad3183129b44ab2775b50bb90da5c5333">ranged::time_to_attack</a></div><div class="ttdeci">int time_to_attack(const Character &amp;p, const item &amp;firing, const item_location loc)</div><div class="ttdoc">Calculates time taken to fire gun.</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01734">ranged.cpp:1734</a></div></div>
<div class="ttc" id="anamespaceranged_html_ade9b38890f46ab6cbe94e1004f0ea5f1"><div class="ttname"><a href="namespaceranged.html#ade9b38890f46ab6cbe94e1004f0ea5f1">ranged::execute_shaped_attack</a></div><div class="ttdeci">void execute_shaped_attack(const shape &amp;sh, const projectile &amp;proj, Creature &amp;attacker)</div><div class="ttdoc">AoE attack, with area given by shape.</div><div class="ttdef"><b>Definition:</b> <a href="ranged__aoe_8cpp_source.html#l00044">ranged_aoe.cpp:44</a></div></div>
<div class="ttc" id="anamespaceranged_html_ae6187116a03c20b18135711490b2e961"><div class="ttname"><a href="namespaceranged.html#ae6187116a03c20b18135711490b2e961">ranged::get_shape_factory</a></div><div class="ttdeci">std::optional&lt; shape_factory &gt; get_shape_factory(const item &amp;gun)</div><div class="ttdoc">Returns shaped attack used by the gun+ammo, if set.</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l03968">ranged.cpp:3968</a></div></div>
<div class="ttc" id="anamespaceunits_html_a1bd284bde31c6b9124add6c8362c8a90"><div class="ttname"><a href="namespaceunits.html#a1bd284bde31c6b9124add6c8362c8a90">units::to_radians</a></div><div class="ttdeci">constexpr double to_radians(const units::angle v)</div><div class="ttdef"><b>Definition:</b> <a href="units__angle_8h_source.html#l00025">units_angle.h:25</a></div></div>
<div class="ttc" id="anamespaceunits_html_a8841cc418c4abd052eab82f152a5af07"><div class="ttname"><a href="namespaceunits.html#a8841cc418c4abd052eab82f152a5af07">units::from_arcmin</a></div><div class="ttdeci">constexpr quantity&lt; double, angle_in_radians_tag &gt; from_arcmin(const value_type v)</div><div class="ttdef"><b>Definition:</b> <a href="units__angle_8h_source.html#l00042">units_angle.h:42</a></div></div>
<div class="ttc" id="aranged_8cpp_html_a08cb2ed99917b1260118f74991ece915"><div class="ttname"><a href="ranged_8cpp.html#a08cb2ed99917b1260118f74991ece915">flag_VEHICLE</a></div><div class="ttdeci">static const std::string flag_VEHICLE(&quot;VEHICLE&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a0c6f7a1d7eeb2c38d69b568d85eb9f0d"><div class="ttname"><a href="ranged_8cpp.html#a0c6f7a1d7eeb2c38d69b568d85eb9f0d">skill_launcher</a></div><div class="ttdeci">static const skill_id skill_launcher(&quot;launcher&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a30c9d25adcf2167a8bff0fe6ca21fdaf"><div class="ttname"><a href="ranged_8cpp.html#a30c9d25adcf2167a8bff0fe6ca21fdaf">flag_RELOAD_AND_SHOOT</a></div><div class="ttdeci">static const std::string flag_RELOAD_AND_SHOOT(&quot;RELOAD_AND_SHOOT&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a3be9304af3e12dfef2f28becb7b93011"><div class="ttname"><a href="ranged_8cpp.html#a3be9304af3e12dfef2f28becb7b93011">effect_on_roof</a></div><div class="ttdeci">static const efftype_id effect_on_roof(&quot;on_roof&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a3eadead4a9aa7fee079c0b1acce7965e"><div class="ttname"><a href="ranged_8cpp.html#a3eadead4a9aa7fee079c0b1acce7965e">skill_gun</a></div><div class="ttdeci">static const skill_id skill_gun(&quot;gun&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a512959ad2b35ea057f2fed5445fc23c4"><div class="ttname"><a href="ranged_8cpp.html#a512959ad2b35ea057f2fed5445fc23c4">trait_PYROMANIA</a></div><div class="ttdeci">static const trait_id trait_PYROMANIA(&quot;PYROMANIA&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a55a80a9bbab1925d5462d46d355c2b6e"><div class="ttname"><a href="ranged_8cpp.html#a55a80a9bbab1925d5462d46d355c2b6e">itype_UPS</a></div><div class="ttdeci">static const itype_id itype_UPS(&quot;UPS&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a6bfc75cd10b0d4de99dc6dcb44abc85b"><div class="ttname"><a href="ranged_8cpp.html#a6bfc75cd10b0d4de99dc6dcb44abc85b">can_use_bipod</a></div><div class="ttdeci">bool can_use_bipod(const map &amp;m, const tripoint &amp;pos)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00791">ranged.cpp:791</a></div></div>
<div class="ttc" id="aranged_8cpp_html_a7a08490346831114f00f3e44cbe454e3"><div class="ttname"><a href="ranged_8cpp.html#a7a08490346831114f00f3e44cbe454e3">trait_NORANGEDCRIT</a></div><div class="ttdeci">static const trait_id trait_NORANGEDCRIT(&quot;NO_RANGED_CRIT&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a8b90a63ce217d881ddad6a7456c4a98e"><div class="ttname"><a href="ranged_8cpp.html#a8b90a63ce217d881ddad6a7456c4a98e">cycle_action</a></div><div class="ttdeci">static void cycle_action(item &amp;weap, const tripoint &amp;pos)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01753">ranged.cpp:1753</a></div></div>
<div class="ttc" id="aranged_8cpp_html_a90d3db03c7b6819b7684020b9c04153e"><div class="ttname"><a href="ranged_8cpp.html#a90d3db03c7b6819b7684020b9c04153e">calculate_dispersion</a></div><div class="ttdeci">dispersion_sources calculate_dispersion(const map &amp;m, const Character &amp;who, const item &amp;gun, int at_recoil, bool burst)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00805">ranged.cpp:805</a></div></div>
<div class="ttc" id="aranged_8cpp_html_a99d97c99b6e5d138e7daa56d509e13ed"><div class="ttname"><a href="ranged_8cpp.html#a99d97c99b6e5d138e7daa56d509e13ed">ammo_effect_NO_CRIT</a></div><div class="ttdeci">static const ammo_effect_str_id ammo_effect_NO_CRIT(&quot;NO_CRIT&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a9a327f2be95a30526c2d1ab6a31f72b2"><div class="ttname"><a href="ranged_8cpp.html#a9a327f2be95a30526c2d1ab6a31f72b2">flag_MOUNTED_GUN</a></div><div class="ttdeci">static const std::string flag_MOUNTED_GUN(&quot;MOUNTED_GUN&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_ab0db3d2d826960249b5a1d47fa7881ff"><div class="ttname"><a href="ranged_8cpp.html#ab0db3d2d826960249b5a1d47fa7881ff">make_gun_projectile</a></div><div class="ttdeci">static projectile make_gun_projectile(const item &amp;gun)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01689">ranged.cpp:1689</a></div></div>
<div class="ttc" id="aranged_8cpp_html_ace607007c38b8d55a601963b24f89e7e"><div class="ttname"><a href="ranged_8cpp.html#ace607007c38b8d55a601963b24f89e7e">fault_gun_chamber_spent</a></div><div class="ttdeci">static const fault_id fault_gun_chamber_spent(&quot;fault_gun_chamber_spent&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_add0bf5e67088357d1ff569fc62addb60"><div class="ttname"><a href="ranged_8cpp.html#add0bf5e67088357d1ff569fc62addb60">flag_PYROMANIAC_WEAPON</a></div><div class="ttdeci">static const std::string flag_PYROMANIAC_WEAPON(&quot;PYROMANIAC_WEAPON&quot;)</div></div>
<div class="ttc" id="arng_8cpp_html_aad28bdad07401a34ecf9912708f8b750"><div class="ttname"><a href="rng_8cpp.html#aad28bdad07401a34ecf9912708f8b750">one_in</a></div><div class="ttdeci">bool one_in(int chance)</div><div class="ttdef"><b>Definition:</b> <a href="rng_8cpp_source.html#l00065">rng.cpp:65</a></div></div>
<div class="ttc" id="astructdamage__instance_html_a6cc673dba3d2de116c2579c3eda7ed23"><div class="ttname"><a href="structdamage__instance.html#a6cc673dba3d2de116c2579c3eda7ed23">damage_instance::mult_damage</a></div><div class="ttdeci">void mult_damage(double multiplier, bool pre_armor=false)</div><div class="ttdef"><b>Definition:</b> <a href="damage_8cpp_source.html#l00048">damage.cpp:48</a></div></div>
<div class="ttc" id="astructprojectile_html_a05d90cbb1c83669dd7c23477c8f35963"><div class="ttname"><a href="structprojectile.html#a05d90cbb1c83669dd7c23477c8f35963">projectile::add_effect</a></div><div class="ttdeci">void add_effect(const ammo_effect_str_id &amp;id)</div><div class="ttdef"><b>Definition:</b> <a href="projectile_8h_source.html#l00058">projectile.h:58</a></div></div>
<div class="ttc" id="astructrl__vec3d_html"><div class="ttname"><a href="structrl__vec3d.html">rl_vec3d</a></div><div class="ttdef"><b>Definition:</b> <a href="point__float_8h_source.html#l00037">point_float.h:37</a></div></div>
<div class="ttc" id="astructrl__vec3d_html_ace319a14c1ba51cb637cdd28d8cddc8c"><div class="ttname"><a href="structrl__vec3d.html#ace319a14c1ba51cb637cdd28d8cddc8c">rl_vec3d::rotated</a></div><div class="ttdeci">rl_vec3d rotated(float angle) const</div><div class="ttdef"><b>Definition:</b> <a href="line_8cpp_source.html#l00656">line.cpp:656</a></div></div>
<div class="ttc" id="astructtripoint_html_a89f6c0a16e2bfd7ce4f1f1d20404c4d7"><div class="ttname"><a href="structtripoint.html#a89f6c0a16e2bfd7ce4f1f1d20404c4d7">tripoint::y</a></div><div class="ttdeci">int y</div><div class="ttdef"><b>Definition:</b> <a href="point_8h_source.html#l00137">point.h:137</a></div></div>
<div class="ttc" id="astructtripoint_html_affdc0d5b75024cbfacd208a495def3dc"><div class="ttname"><a href="structtripoint.html#affdc0d5b75024cbfacd208a495def3dc">tripoint::x</a></div><div class="ttdeci">int x</div><div class="ttdef"><b>Definition:</b> <a href="point_8h_source.html#l00136">point.h:136</a></div></div>
<div class="ttc" id="atranslations_8h_html_aa829053017e23ef22d44dccecba63a34"><div class="ttname"><a href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a></div><div class="ttdeci">#define _(msg)</div><div class="ttdef"><b>Definition:</b> <a href="translations_8h_source.html#l00116">translations.h:116</a></div></div>
<div class="ttc" id="avpart__position_8h_html_a67bd76da258293f1443f1356308381dc"><div class="ttname"><a href="vpart__position_8h.html#a67bd76da258293f1443f1356308381dc">veh_pointer_or_null</a></div><div class="ttdeci">vehicle * veh_pointer_or_null(const optional_vpart_position &amp;p)</div><div class="ttdef"><b>Definition:</b> <a href="vpart__position_8h_source.html#l00156">vpart_position.h:156</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="translations_8h_source.html#l00116">_</a>, <a class="el" href="projectile_8h_source.html#l00058">projectile::add_effect()</a>, <a class="el" href="character_8cpp_source.html#l09095">Character::add_morale()</a>, <a class="el" href="creature_8h_source.html#l00605">Creature::add_msg_if_player()</a>, <a class="el" href="item_8cpp_source.html#l07497">item::ammo_consume()</a>, <a class="el" href="ranged_8cpp.html#a99d97c99b6e5d138e7daa56d509e13ed">ammo_effect_NO_CRIT</a>, <a class="el" href="item_8cpp_source.html#l07399">item::ammo_remaining()</a>, <a class="el" href="item_8cpp_source.html#l07469">item::ammo_required()</a>, <a class="el" href="creature_8h_source.html#l00122">Creature::as_player()</a>, <a class="el" href="line_8cpp_source.html#l00321">atan2()</a>, <a class="el" href="ranged_8cpp_source.html#l00805">calculate_dispersion()</a>, <a class="el" href="ranged_8cpp_source.html#l00791">can_use_bipod()</a>, <a class="el" href="event_8h.html#a430b444c74dd3fd1472a31714ec5f1cea365dbc32084e314b4788756b6fa66ecb">character_gets_headshot</a>, <a class="el" href="visitable_8cpp_source.html#l00946">visitable&lt; T &gt;::charges_of()</a>, <a class="el" href="item_8cpp_source.html#l06035">item::count()</a>, <a class="el" href="ranged_8cpp_source.html#l01753">cycle_action()</a>, <a class="el" href="debug_8h_source.html#l00074">debugmsg</a>, <a class="el" href="ranged_8cpp.html#a3be9304af3e12dfef2f28becb7b93011">effect_on_roof</a>, <a class="el" href="ranged__aoe_8cpp_source.html#l00044">execute_shaped_attack()</a>, <a class="el" href="ranged_8cpp.html#ace607007c38b8d55a601963b24f89e7e">fault_gun_chamber_spent</a>, <a class="el" href="item_8h_source.html#l02164">item::faults</a>, <a class="el" href="ranged_8cpp.html#a9a327f2be95a30526c2d1ab6a31f72b2">flag_MOUNTED_GUN()</a>, <a class="el" href="ranged_8cpp.html#add0bf5e67088357d1ff569fc62addb60">flag_PYROMANIAC_WEAPON()</a>, <a class="el" href="ranged_8cpp.html#a30c9d25adcf2167a8bff0fe6ca21fdaf">flag_RELOAD_AND_SHOOT()</a>, <a class="el" href="ranged_8cpp.html#a08cb2ed99917b1260118f74991ece915">flag_VEHICLE()</a>, <a class="el" href="units__angle_8h_source.html#l00042">units::from_arcmin()</a>, <a class="el" href="game_8cpp_source.html#l00283">g</a>, <a class="el" href="avatar_8cpp_source.html#l00104">get_avatar()</a>, <a class="el" href="item_8cpp_source.html#l09961">item::get_gun_ups_drain()</a>, <a class="el" href="item__location_8cpp_source.html#l00768">item_location::get_item()</a>, <a class="el" href="map_8cpp_source.html#l00147">get_map()</a>, <a class="el" href="ranged_8cpp_source.html#l03968">get_shape_factory()</a>, <a class="el" href="character_8cpp_source.html#l00575">Character::get_size()</a>, <a class="el" href="character_8cpp_source.html#l00494">Character::getID()</a>, <a class="el" href="item_8cpp_source.html#l07341">item::gun_recoil()</a>, <a class="el" href="item_8cpp_source.html#l07212">item::gun_skill()</a>, <a class="el" href="ranged_8cpp_source.html#l00600">handle_gun_damage()</a>, <a class="el" href="creature_8cpp_source.html#l01206">Creature::has_effect()</a>, <a class="el" href="item_8cpp_source.html#l05328">item::has_flag()</a>, <a class="el" href="character_8cpp_source.html#l09106">Character::has_morale()</a>, <a class="el" href="mutation_8cpp_source.html#l00101">Character::has_trait()</a>, <a class="el" href="projectile_8h_source.html#l00021">projectile::impact</a>, <a class="el" href="item_8cpp_source.html#l06542">item::is_gun()</a>, <a class="el" href="character_8cpp_source.html#l01082">Character::is_mounted()</a>, <a class="el" href="ranged_8cpp.html#a55a80a9bbab1925d5462d46d355c2b6e">itype_UPS</a>, <a class="el" href="enums_8h_source.html#l00260">m_good</a>, <a class="el" href="ranged_8cpp_source.html#l01689">make_gun_projectile()</a>, <a class="el" href="ranged_8cpp_source.html#l01802">make_gun_sound_effect()</a>, <a class="el" href="game__constants_8h_source.html#l00131">MAX_RECOIL</a>, <a class="el" href="mtype_8h_source.html#l00115">MF_RIDEABLE_MECH</a>, <a class="el" href="morale__types_8cpp.html#ae932ffaaef9c3a4092fc8727141405bf">MORALE_PYROMANIA_NOFIRE</a>, <a class="el" href="morale__types_8cpp.html#a7a7fa39cff1d7efe58e013c63b7f0ee6">MORALE_PYROMANIA_STARTFIRE</a>, <a class="el" href="character_8h_source.html#l01617">Character::mounted_creature</a>, <a class="el" href="avatar__action_8cpp_source.html#l00096">avatar_action::move()</a>, <a class="el" href="creature_8h_source.html#l00582">Creature::moves</a>, <a class="el" href="creature_8h_source.html#l00062">MS_HUGE</a>, <a class="el" href="damage_8cpp_source.html#l00048">damage_instance::mult_damage()</a>, <a class="el" href="character_8h_source.html#l01566">Character::name</a>, <a class="el" href="rng_8cpp_source.html#l00065">one_in()</a>, <a class="el" href="character_8cpp_source.html#l00601">Character::pos()</a>, <a class="el" href="character_8h_source.html#l00797">Character::posx()</a>, <a class="el" href="character_8h_source.html#l00800">Character::posy()</a>, <a class="el" href="character_8cpp_source.html#l03417">Character::practice()</a>, <a class="el" href="ballistics_8cpp_source.html#l00201">projectile_attack()</a>, <a class="el" href="character_8h_source.html#l00571">Character::recoil</a>, <a class="el" href="ranged_8cpp_source.html#l02085">recoil_total()</a>, <a class="el" href="ranged_8cpp_source.html#l02073">recoil_vehicle()</a>, <a class="el" href="item_8cpp_source.html#l08127">item::reload()</a>, <a class="el" href="character_8cpp_source.html#l09116">Character::rem_morale()</a>, <a class="el" href="dispersion_8cpp_source.html#l00005">dispersion_sources::roll()</a>, <a class="el" href="line_8cpp_source.html#l00656">rl_vec3d::rotated()</a>, <a class="el" href="ranged_8cpp.html#a3eadead4a9aa7fee079c0b1acce7965e">skill_gun</a>, <a class="el" href="ranged_8cpp.html#a0c6f7a1d7eeb2c38d69b568d85eb9f0d">skill_launcher</a>, <a class="el" href="ranged_8cpp_source.html#l01031">str_draw_damage_modifier()</a>, <a class="el" href="ranged_8cpp_source.html#l01734">time_to_attack()</a>, <a class="el" href="item_8cpp_source.html#l04574">item::tname()</a>, <a class="el" href="units__angle_8h_source.html#l00025">units::to_radians()</a>, <a class="el" href="ranged_8cpp.html#a7a08490346831114f00f3e44cbe454e3">trait_NORANGEDCRIT</a>, <a class="el" href="ranged_8cpp.html#a512959ad2b35ea057f2fed5445fc23c4">trait_PYROMANIA</a>, <a class="el" href="coordinates_8h_source.html#l00512">trig_dist()</a>, <a class="el" href="character_8cpp_source.html#l09665">Character::use_charges()</a>, <a class="el" href="map_8cpp_source.html#l01073">map::veh_at()</a>, <a class="el" href="vpart__position_8h_source.html#l00156">veh_pointer_or_null()</a>, <a class="el" href="point_8h_source.html#l00136">tripoint::x</a>, and <a class="el" href="point_8h_source.html#l00137">tripoint::y</a>.</p>

</div>
</div>
<a id="a0bb67d4debaf06355d3b7c8234fda44e" name="a0bb67d4debaf06355d3b7c8234fda44e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0bb67d4debaf06355d3b7c8234fda44e">&#9670;&nbsp;</a></span>fire_gun() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ranged::fire_gun </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classCharacter.html">Character</a> &amp;&#160;</td>
          <td class="paramname"><em>who</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structtripoint.html">tripoint</a> &amp;&#160;</td>
          <td class="paramname"><em>target</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>shots</em> = <code>1</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Fire wielded gun or auxiliary gunmod (ignoring any current mode) </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">who</td><td><a class="el" href="classCharacter.html">Character</a> whose stats to use (must be wielding a gun) </td></tr>
    <tr><td class="paramname">target</td><td>Where the first shot is aimed at (may vary for later shots) </td></tr>
    <tr><td class="paramname">shots</td><td>Maximum number of shots to fire (less may be fired in some circumstances) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Number of shots actually fired </dd></dl>

<p class="definition">Definition at line <a class="el" href="ranged_8cpp_source.html#l00817">817</a> of file <a class="el" href="ranged_8cpp_source.html">ranged.cpp</a>.</p>
<div class="fragment"><div class="line"><a id="l00818" name="l00818"></a><span class="lineno">  818</span>{</div>
<div class="line"><a id="l00819" name="l00819"></a><span class="lineno">  819</span>    <span class="keywordflow">return</span> <a class="code hl_function" href="namespaceranged.html#a0bb67d4debaf06355d3b7c8234fda44e">fire_gun</a>( who, target, shots, who.<a class="code hl_function" href="classCharacter.html#a9cec37becf60e594b4978cb8f8c5278b">primary_weapon</a>(), <a class="code hl_class" href="classitem__location.html">item_location</a>() );</div>
<div class="line"><a id="l00820" name="l00820"></a><span class="lineno">  820</span>}</div>
<div class="ttc" id="aclassCharacter_html_a9cec37becf60e594b4978cb8f8c5278b"><div class="ttname"><a href="classCharacter.html#a9cec37becf60e594b4978cb8f8c5278b">Character::primary_weapon</a></div><div class="ttdeci">item &amp; primary_weapon()</div><div class="ttdoc">Legacy code hack, don't use.</div><div class="ttdef"><b>Definition:</b> <a href="melee_8cpp_source.html#l00166">melee.cpp:166</a></div></div>
<div class="ttc" id="aclassitem__location_html"><div class="ttname"><a href="classitem__location.html">item_location</a></div><div class="ttdoc">A lightweight handle to an item independent of it's location Unlike a raw pointer can be (de-)seriali...</div><div class="ttdef"><b>Definition:</b> <a href="item__location_8h_source.html#l00022">item_location.h:23</a></div></div>
<div class="ttc" id="anamespaceranged_html_a0bb67d4debaf06355d3b7c8234fda44e"><div class="ttname"><a href="namespaceranged.html#a0bb67d4debaf06355d3b7c8234fda44e">ranged::fire_gun</a></div><div class="ttdeci">int fire_gun(Character &amp;who, const tripoint &amp;target, int shots=1)</div><div class="ttdoc">Fire wielded gun or auxiliary gunmod (ignoring any current mode)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00817">ranged.cpp:817</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="ranged_8cpp_source.html#l00817">fire_gun()</a>, and <a class="el" href="melee_8cpp_source.html#l00166">Character::primary_weapon()</a>.</p>

<p class="reference">Referenced by <a class="el" href="npcmove_8cpp_source.html#l00957">npc::execute_action()</a>, <a class="el" href="activity__actor_8cpp_source.html#l00157">aim_activity_actor::finish()</a>, <a class="el" href="turret_8cpp_source.html#l00292">turret_data::fire()</a>, <a class="el" href="ranged_8cpp_source.html#l00817">fire_gun()</a>, <a class="el" href="monattack_8cpp_source.html#l03364">mattack::frag()</a>, <a class="el" href="monattack_8cpp_source.html#l03314">mattack::rifle()</a>, <a class="el" href="mattack__actors_8cpp_source.html#l00643">gun_actor::shoot()</a>, and <a class="el" href="monattack_8cpp_source.html#l03425">mattack::tankgun()</a>.</p>

</div>
</div>
<a id="a751a40c271349c3ea821c5badd49e42f" name="a751a40c271349c3ea821c5badd49e42f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a751a40c271349c3ea821c5badd49e42f">&#9670;&nbsp;</a></span>get_aim_types()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt; <a class="el" href="structranged_1_1aim__type.html">ranged::aim_type</a> &gt; ranged::get_aim_types </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classCharacter.html">Character</a> &amp;&#160;</td>
          <td class="paramname"><em>who</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classitem.html">item</a> &amp;&#160;</td>
          <td class="paramname"><em>gun</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="ranged_8cpp_source.html#l01650">1650</a> of file <a class="el" href="ranged_8cpp_source.html">ranged.cpp</a>.</p>
<div class="fragment"><div class="line"><a id="l01651" name="l01651"></a><span class="lineno"> 1651</span>{</div>
<div class="line"><a id="l01652" name="l01652"></a><span class="lineno"> 1652</span>    std::vector&lt;aim_type&gt; aim_types = <a class="code hl_function" href="ranged_8cpp.html#ab0033d3db60c6ee845390884df113b31">get_default_aim_type</a>();</div>
<div class="line"><a id="l01653" name="l01653"></a><span class="lineno"> 1653</span>    <span class="keywordflow">if</span>( !gun.<a class="code hl_function" href="classitem.html#a2912b2e15a4eec07a5070fffbbd152e8">is_gun</a>() ) {</div>
<div class="line"><a id="l01654" name="l01654"></a><span class="lineno"> 1654</span>        <span class="keywordflow">return</span> aim_types;</div>
<div class="line"><a id="l01655" name="l01655"></a><span class="lineno"> 1655</span>    }</div>
<div class="line"><a id="l01656" name="l01656"></a><span class="lineno"> 1656</span>    <span class="keywordtype">int</span> sight_dispersion = <a class="code hl_function" href="namespaceranged.html#a77dfe116a20cfa50c55a3c2073408e63">effective_dispersion</a>( who, gun.<a class="code hl_function" href="classitem.html#af0b7e5875297be57d675270f57ff775a">sight_dispersion</a>() );</div>
<div class="line"><a id="l01657" name="l01657"></a><span class="lineno"> 1657</span>    <span class="comment">// Aiming thresholds are dependent on weapon sight dispersion, attempting to place thresholds</span></div>
<div class="line"><a id="l01658" name="l01658"></a><span class="lineno"> 1658</span>    <span class="comment">// at 10%, 5% and 0% of the difference between MAX_RECOIL and sight dispersion.</span></div>
<div class="line"><a id="l01659" name="l01659"></a><span class="lineno"> 1659</span>    std::vector&lt;int&gt; thresholds = {</div>
<div class="line"><a id="l01660" name="l01660"></a><span class="lineno"> 1660</span>        <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>( ( ( <a class="code hl_variable" href="game__constants_8h.html#a8226e8a134603e5bc06df05efd13d8d1">MAX_RECOIL</a> - sight_dispersion ) / 10.0 ) + sight_dispersion ),</div>
<div class="line"><a id="l01661" name="l01661"></a><span class="lineno"> 1661</span>        <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>( ( ( <a class="code hl_variable" href="game__constants_8h.html#a8226e8a134603e5bc06df05efd13d8d1">MAX_RECOIL</a> - sight_dispersion ) / 20.0 ) + sight_dispersion ),</div>
<div class="line"><a id="l01662" name="l01662"></a><span class="lineno"> 1662</span>        <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>( sight_dispersion )</div>
<div class="line"><a id="l01663" name="l01663"></a><span class="lineno"> 1663</span>    };</div>
<div class="line"><a id="l01664" name="l01664"></a><span class="lineno"> 1664</span>    <span class="comment">// Remove duplicate thresholds.</span></div>
<div class="line"><a id="l01665" name="l01665"></a><span class="lineno"> 1665</span>    std::vector&lt;int&gt;::iterator thresholds_it = std::adjacent_find( thresholds.begin(),</div>
<div class="line"><a id="l01666" name="l01666"></a><span class="lineno"> 1666</span>            thresholds.end() );</div>
<div class="line"><a id="l01667" name="l01667"></a><span class="lineno"> 1667</span>    <span class="keywordflow">while</span>( thresholds_it != thresholds.end() ) {</div>
<div class="line"><a id="l01668" name="l01668"></a><span class="lineno"> 1668</span>        thresholds.erase( thresholds_it );</div>
<div class="line"><a id="l01669" name="l01669"></a><span class="lineno"> 1669</span>        thresholds_it = std::adjacent_find( thresholds.begin(), thresholds.end() );</div>
<div class="line"><a id="l01670" name="l01670"></a><span class="lineno"> 1670</span>    }</div>
<div class="line"><a id="l01671" name="l01671"></a><span class="lineno"> 1671</span>    thresholds_it = thresholds.begin();</div>
<div class="line"><a id="l01672" name="l01672"></a><span class="lineno"> 1672</span>    aim_types.push_back( aim_type { <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Regular&quot;</span> ), <span class="stringliteral">&quot;AIMED_SHOT&quot;</span>, <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;[%c] to aim and fire.&quot;</span> ),</div>
<div class="line"><a id="l01673" name="l01673"></a><span class="lineno"> 1673</span>                                    <span class="keyword">true</span>, *thresholds_it } );</div>
<div class="line"><a id="l01674" name="l01674"></a><span class="lineno"> 1674</span>    thresholds_it++;</div>
<div class="line"><a id="l01675" name="l01675"></a><span class="lineno"> 1675</span>    <span class="keywordflow">if</span>( thresholds_it != thresholds.end() ) {</div>
<div class="line"><a id="l01676" name="l01676"></a><span class="lineno"> 1676</span>        aim_types.push_back( aim_type { <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Careful&quot;</span> ), <span class="stringliteral">&quot;CAREFUL_SHOT&quot;</span>,</div>
<div class="line"><a id="l01677" name="l01677"></a><span class="lineno"> 1677</span>                                        <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;[%c] to take careful aim and fire.&quot;</span> ), <span class="keyword">true</span>,</div>
<div class="line"><a id="l01678" name="l01678"></a><span class="lineno"> 1678</span>                                        *thresholds_it } );</div>
<div class="line"><a id="l01679" name="l01679"></a><span class="lineno"> 1679</span>        thresholds_it++;</div>
<div class="line"><a id="l01680" name="l01680"></a><span class="lineno"> 1680</span>    }</div>
<div class="line"><a id="l01681" name="l01681"></a><span class="lineno"> 1681</span>    <span class="keywordflow">if</span>( thresholds_it != thresholds.end() ) {</div>
<div class="line"><a id="l01682" name="l01682"></a><span class="lineno"> 1682</span>        aim_types.push_back( aim_type { <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Precise&quot;</span> ), <span class="stringliteral">&quot;PRECISE_SHOT&quot;</span>,</div>
<div class="line"><a id="l01683" name="l01683"></a><span class="lineno"> 1683</span>                                        <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;[%c] to take precise aim and fire.&quot;</span> ), <span class="keyword">true</span>,</div>
<div class="line"><a id="l01684" name="l01684"></a><span class="lineno"> 1684</span>                                        *thresholds_it } );</div>
<div class="line"><a id="l01685" name="l01685"></a><span class="lineno"> 1685</span>    }</div>
<div class="line"><a id="l01686" name="l01686"></a><span class="lineno"> 1686</span>    <span class="keywordflow">return</span> aim_types;</div>
<div class="line"><a id="l01687" name="l01687"></a><span class="lineno"> 1687</span>}</div>
<div class="ttc" id="aclassitem_html_af0b7e5875297be57d675270f57ff775a"><div class="ttname"><a href="classitem.html#af0b7e5875297be57d675270f57ff775a">item::sight_dispersion</a></div><div class="ttdeci">int sight_dispersion() const</div><div class="ttdoc">Get lowest dispersion of either integral or any attached sights.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l07273">item.cpp:7273</a></div></div>
<div class="ttc" id="anamespaceranged_html_a77dfe116a20cfa50c55a3c2073408e63"><div class="ttname"><a href="namespaceranged.html#a77dfe116a20cfa50c55a3c2073408e63">ranged::effective_dispersion</a></div><div class="ttdeci">int effective_dispersion(const Character &amp;who, int dispersion)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l03820">ranged.cpp:3820</a></div></div>
<div class="ttc" id="aranged_8cpp_html_ab0033d3db60c6ee845390884df113b31"><div class="ttname"><a href="ranged_8cpp.html#ab0033d3db60c6ee845390884df113b31">get_default_aim_type</a></div><div class="ttdeci">static std::vector&lt; ranged::aim_type &gt; get_default_aim_type()</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01351">ranged.cpp:1351</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="translations_8h_source.html#l00116">_</a>, <a class="el" href="ranged_8cpp_source.html#l03820">effective_dispersion()</a>, <a class="el" href="ranged_8cpp_source.html#l01351">get_default_aim_type()</a>, <a class="el" href="item_8cpp_source.html#l06542">item::is_gun()</a>, <a class="el" href="game__constants_8h_source.html#l00131">MAX_RECOIL</a>, and <a class="el" href="item_8cpp_source.html#l07273">item::sight_dispersion()</a>.</p>

<p class="reference">Referenced by <a class="el" href="item_8cpp_source.html#l02020">item::gun_info()</a>, <a class="el" href="npcmove_8cpp_source.html#l02079">item::ideal_ranged_dps()</a>, <a class="el" href="ranged_8cpp_source.html#l02429">target_ui::init_window_and_input()</a>, and <a class="el" href="ranged_8cpp_source.html#l01564">print_aim()</a>.</p>

</div>
</div>
<a id="a3dbef919e3efee8967ddbcba998a55f3" name="a3dbef919e3efee8967ddbcba998a55f3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3dbef919e3efee8967ddbcba998a55f3">&#9670;&nbsp;</a></span>get_fastest_sight()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::pair&lt; int, int &gt; ranged::get_fastest_sight </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classCharacter.html">Character</a> &amp;&#160;</td>
          <td class="paramname"><em>who</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classitem.html">item</a> &amp;&#160;</td>
          <td class="paramname"><em>gun</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>recoil</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="ranged_8cpp_source.html#l03830">3830</a> of file <a class="el" href="ranged_8cpp_source.html">ranged.cpp</a>.</p>
<div class="fragment"><div class="line"><a id="l03832" name="l03832"></a><span class="lineno"> 3832</span>{</div>
<div class="line"><a id="l03833" name="l03833"></a><span class="lineno"> 3833</span>    <span class="comment">// Get fastest sight that can be used to improve aim further below @ref recoil.</span></div>
<div class="line"><a id="l03834" name="l03834"></a><span class="lineno"> 3834</span>    <span class="keywordtype">int</span> sight_speed_modifier = INT_MIN;</div>
<div class="line"><a id="l03835" name="l03835"></a><span class="lineno"> 3835</span>    <span class="keywordtype">int</span> limit = 0;</div>
<div class="line"><a id="l03836" name="l03836"></a><span class="lineno"> 3836</span>    <span class="keywordflow">if</span>( <a class="code hl_function" href="namespaceranged.html#a77dfe116a20cfa50c55a3c2073408e63">effective_dispersion</a>( who, gun.<a class="code hl_variable" href="classitem.html#ac1d2c4c33b8a499812f3437cb2fad742">type</a>-&gt;<a class="code hl_variable" href="structitype.html#a623ec8243b1e599086fa3a23c3179370">gun</a>-&gt;sight_dispersion ) &lt; recoil ) {</div>
<div class="line"><a id="l03837" name="l03837"></a><span class="lineno"> 3837</span>        sight_speed_modifier = gun.<a class="code hl_function" href="classitem.html#aaa5aeb6f838927babb10ede535cf2a73">has_flag</a>( <a class="code hl_function" href="ranged_8cpp.html#a473d946b810b948e6d47e6bcc7e64d04">flag_DISABLE_SIGHTS</a> ) ? 0 : 6;</div>
<div class="line"><a id="l03838" name="l03838"></a><span class="lineno"> 3838</span>        limit = <a class="code hl_function" href="namespaceranged.html#a77dfe116a20cfa50c55a3c2073408e63">effective_dispersion</a>( who, gun.<a class="code hl_variable" href="classitem.html#ac1d2c4c33b8a499812f3437cb2fad742">type</a>-&gt;<a class="code hl_variable" href="structitype.html#a623ec8243b1e599086fa3a23c3179370">gun</a>-&gt;sight_dispersion );</div>
<div class="line"><a id="l03839" name="l03839"></a><span class="lineno"> 3839</span>    }</div>
<div class="line"><a id="l03840" name="l03840"></a><span class="lineno"> 3840</span> </div>
<div class="line"><a id="l03841" name="l03841"></a><span class="lineno"> 3841</span>    <span class="keywordflow">for</span>( <span class="keyword">const</span> <span class="keyword">auto</span> e : gun.<a class="code hl_function" href="classitem.html#acd78321ba4d5c09d39f1d58d20b68484">gunmods</a>() ) {</div>
<div class="line"><a id="l03842" name="l03842"></a><span class="lineno"> 3842</span>        <span class="keyword">const</span> <a class="code hl_struct" href="structislot__gunmod.html">islot_gunmod</a> &amp;<a class="code hl_enumeration" href="namespaceenchant__vals.html#acd6a6ebb27f9ecb82b3bce1d3aef2998">mod</a> = *e-&gt;type-&gt;gunmod;</div>
<div class="line"><a id="l03843" name="l03843"></a><span class="lineno"> 3843</span>        <span class="keywordflow">if</span>( <a class="code hl_enumeration" href="namespaceenchant__vals.html#acd6a6ebb27f9ecb82b3bce1d3aef2998">mod</a>.sight_dispersion &lt; 0 || <a class="code hl_enumeration" href="namespaceenchant__vals.html#acd6a6ebb27f9ecb82b3bce1d3aef2998">mod</a>.aim_speed &lt; 0 ) {</div>
<div class="line"><a id="l03844" name="l03844"></a><span class="lineno"> 3844</span>            <span class="keywordflow">continue</span>; <span class="comment">// skip gunmods which don&#39;t provide a sight</span></div>
<div class="line"><a id="l03845" name="l03845"></a><span class="lineno"> 3845</span>        }</div>
<div class="line"><a id="l03846" name="l03846"></a><span class="lineno"> 3846</span>        <span class="keywordflow">if</span>( <a class="code hl_function" href="namespaceranged.html#a77dfe116a20cfa50c55a3c2073408e63">effective_dispersion</a>( who, <a class="code hl_enumeration" href="namespaceenchant__vals.html#acd6a6ebb27f9ecb82b3bce1d3aef2998">mod</a>.sight_dispersion ) &lt; recoil &amp;&amp;</div>
<div class="line"><a id="l03847" name="l03847"></a><span class="lineno"> 3847</span>            <a class="code hl_enumeration" href="namespaceenchant__vals.html#acd6a6ebb27f9ecb82b3bce1d3aef2998">mod</a>.aim_speed &gt; sight_speed_modifier ) {</div>
<div class="line"><a id="l03848" name="l03848"></a><span class="lineno"> 3848</span>            sight_speed_modifier = <a class="code hl_enumeration" href="namespaceenchant__vals.html#acd6a6ebb27f9ecb82b3bce1d3aef2998">mod</a>.aim_speed;</div>
<div class="line"><a id="l03849" name="l03849"></a><span class="lineno"> 3849</span>            limit = <a class="code hl_function" href="namespaceranged.html#a77dfe116a20cfa50c55a3c2073408e63">effective_dispersion</a>( who, <a class="code hl_enumeration" href="namespaceenchant__vals.html#acd6a6ebb27f9ecb82b3bce1d3aef2998">mod</a>.sight_dispersion );</div>
<div class="line"><a id="l03850" name="l03850"></a><span class="lineno"> 3850</span>        }</div>
<div class="line"><a id="l03851" name="l03851"></a><span class="lineno"> 3851</span>    }</div>
<div class="line"><a id="l03852" name="l03852"></a><span class="lineno"> 3852</span>    <span class="keywordflow">return</span> std::make_pair( sight_speed_modifier, limit );</div>
<div class="line"><a id="l03853" name="l03853"></a><span class="lineno"> 3853</span>}</div>
<div class="ttc" id="aclassitem_html_ac1d2c4c33b8a499812f3437cb2fad742"><div class="ttname"><a href="classitem.html#ac1d2c4c33b8a499812f3437cb2fad742">item::type</a></div><div class="ttdeci">const itype * type</div><div class="ttdef"><b>Definition:</b> <a href="item_8h_source.html#l02160">item.h:2160</a></div></div>
<div class="ttc" id="aclassitem_html_acd78321ba4d5c09d39f1d58d20b68484"><div class="ttname"><a href="classitem.html#acd78321ba4d5c09d39f1d58d20b68484">item::gunmods</a></div><div class="ttdeci">std::vector&lt; item * &gt; gunmods()</div><div class="ttdoc">Returns all gunmods currently attached to this item (always empty if item not a gun)</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l07752">item.cpp:7752</a></div></div>
<div class="ttc" id="anamespaceenchant__vals_html_acd6a6ebb27f9ecb82b3bce1d3aef2998"><div class="ttname"><a href="namespaceenchant__vals.html#acd6a6ebb27f9ecb82b3bce1d3aef2998">enchant_vals::mod</a></div><div class="ttdeci">mod</div><div class="ttdef"><b>Definition:</b> <a href="magic__enchantment_8h_source.html#l00026">magic_enchantment.h:26</a></div></div>
<div class="ttc" id="aranged_8cpp_html_a473d946b810b948e6d47e6bcc7e64d04"><div class="ttname"><a href="ranged_8cpp.html#a473d946b810b948e6d47e6bcc7e64d04">flag_DISABLE_SIGHTS</a></div><div class="ttdeci">static const std::string flag_DISABLE_SIGHTS(&quot;DISABLE_SIGHTS&quot;)</div></div>
<div class="ttc" id="astructislot__gunmod_html"><div class="ttname"><a href="structislot__gunmod.html">islot_gunmod</a></div><div class="ttdef"><b>Definition:</b> <a href="itype_8h_source.html#l00546">itype.h:546</a></div></div>
<div class="ttc" id="astructitype_html_a623ec8243b1e599086fa3a23c3179370"><div class="ttname"><a href="structitype.html#a623ec8243b1e599086fa3a23c3179370">itype::gun</a></div><div class="ttdeci">cata::value_ptr&lt; islot_gun &gt; gun</div><div class="ttdef"><b>Definition:</b> <a href="itype_8h_source.html#l00827">itype.h:827</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="ranged_8cpp_source.html#l03820">effective_dispersion()</a>, <a class="el" href="ranged_8cpp.html#a473d946b810b948e6d47e6bcc7e64d04">flag_DISABLE_SIGHTS()</a>, <a class="el" href="itype_8h_source.html#l00827">itype::gun</a>, <a class="el" href="item_8cpp_source.html#l07752">item::gunmods()</a>, <a class="el" href="item_8cpp_source.html#l05328">item::has_flag()</a>, and <a class="el" href="item_8h_source.html#l02160">item::type</a>.</p>

<p class="reference">Referenced by <a class="el" href="ranged_8cpp_source.html#l03919">aim_per_move()</a>.</p>

</div>
</div>
<a id="ad70a4328dc4c6c69d45b40f23d90195d" name="ad70a4328dc4c6c69d45b40f23d90195d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad70a4328dc4c6c69d45b40f23d90195d">&#9670;&nbsp;</a></span>get_most_accurate_sight()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ranged::get_most_accurate_sight </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classCharacter.html">Character</a> &amp;&#160;</td>
          <td class="paramname"><em>who</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classitem.html">item</a> &amp;&#160;</td>
          <td class="paramname"><em>gun</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="ranged_8cpp_source.html#l03855">3855</a> of file <a class="el" href="ranged_8cpp_source.html">ranged.cpp</a>.</p>
<div class="fragment"><div class="line"><a id="l03856" name="l03856"></a><span class="lineno"> 3856</span>{</div>
<div class="line"><a id="l03857" name="l03857"></a><span class="lineno"> 3857</span>    <span class="keywordflow">if</span>( !gun.<a class="code hl_function" href="classitem.html#a2912b2e15a4eec07a5070fffbbd152e8">is_gun</a>() ) {</div>
<div class="line"><a id="l03858" name="l03858"></a><span class="lineno"> 3858</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a id="l03859" name="l03859"></a><span class="lineno"> 3859</span>    }</div>
<div class="line"><a id="l03860" name="l03860"></a><span class="lineno"> 3860</span> </div>
<div class="line"><a id="l03861" name="l03861"></a><span class="lineno"> 3861</span>    <span class="keywordtype">int</span> limit = <a class="code hl_function" href="namespaceranged.html#a77dfe116a20cfa50c55a3c2073408e63">effective_dispersion</a>( who, gun.<a class="code hl_variable" href="classitem.html#ac1d2c4c33b8a499812f3437cb2fad742">type</a>-&gt;<a class="code hl_variable" href="structitype.html#a623ec8243b1e599086fa3a23c3179370">gun</a>-&gt;sight_dispersion );</div>
<div class="line"><a id="l03862" name="l03862"></a><span class="lineno"> 3862</span>    <span class="keywordflow">for</span>( <span class="keyword">const</span> <span class="keyword">auto</span> e : gun.<a class="code hl_function" href="classitem.html#acd78321ba4d5c09d39f1d58d20b68484">gunmods</a>() ) {</div>
<div class="line"><a id="l03863" name="l03863"></a><span class="lineno"> 3863</span>        <span class="keyword">const</span> <a class="code hl_struct" href="structislot__gunmod.html">islot_gunmod</a> &amp;<a class="code hl_enumeration" href="namespaceenchant__vals.html#acd6a6ebb27f9ecb82b3bce1d3aef2998">mod</a> = *e-&gt;type-&gt;gunmod;</div>
<div class="line"><a id="l03864" name="l03864"></a><span class="lineno"> 3864</span>        <span class="keywordflow">if</span>( <a class="code hl_enumeration" href="namespaceenchant__vals.html#acd6a6ebb27f9ecb82b3bce1d3aef2998">mod</a>.aim_speed &gt;= 0 ) {</div>
<div class="line"><a id="l03865" name="l03865"></a><span class="lineno"> 3865</span>            limit = std::min( limit, <a class="code hl_function" href="namespaceranged.html#a77dfe116a20cfa50c55a3c2073408e63">effective_dispersion</a>( who, <a class="code hl_enumeration" href="namespaceenchant__vals.html#acd6a6ebb27f9ecb82b3bce1d3aef2998">mod</a>.sight_dispersion ) );</div>
<div class="line"><a id="l03866" name="l03866"></a><span class="lineno"> 3866</span>        }</div>
<div class="line"><a id="l03867" name="l03867"></a><span class="lineno"> 3867</span>    }</div>
<div class="line"><a id="l03868" name="l03868"></a><span class="lineno"> 3868</span> </div>
<div class="line"><a id="l03869" name="l03869"></a><span class="lineno"> 3869</span>    <span class="keywordflow">return</span> limit;</div>
<div class="line"><a id="l03870" name="l03870"></a><span class="lineno"> 3870</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="ranged_8cpp_source.html#l03820">effective_dispersion()</a>, <a class="el" href="itype_8h_source.html#l00827">itype::gun</a>, <a class="el" href="item_8cpp_source.html#l07752">item::gunmods()</a>, <a class="el" href="item_8cpp_source.html#l06542">item::is_gun()</a>, and <a class="el" href="item_8h_source.html#l02160">item::type</a>.</p>

<p class="reference">Referenced by <a class="el" href="ranged_8cpp_source.html#l01967">npc_ai::best_mode_for_range()</a>, <a class="el" href="npc_8cpp_source.html#l01198">npc::invalidate_range_cache()</a>, and <a class="el" href="npcmove_8cpp_source.html#l01339">npc::method_of_attack()</a>.</p>

</div>
</div>
<a id="ae6187116a03c20b18135711490b2e961" name="ae6187116a03c20b18135711490b2e961"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae6187116a03c20b18135711490b2e961">&#9670;&nbsp;</a></span>get_shape_factory()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="generic__factory_8h.html#a1159dbaba81931271dbfe5b9c7f041b3">std::optional</a>&lt; <a class="el" href="classshape__factory.html">shape_factory</a> &gt; ranged::get_shape_factory </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classitem.html">item</a> &amp;&#160;</td>
          <td class="paramname"><em>gun</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns shaped attack used by the gun+ammo, if set. </p>

<p class="definition">Definition at line <a class="el" href="ranged_8cpp_source.html#l03968">3968</a> of file <a class="el" href="ranged_8cpp_source.html">ranged.cpp</a>.</p>
<div class="fragment"><div class="line"><a id="l03969" name="l03969"></a><span class="lineno"> 3969</span>{</div>
<div class="line"><a id="l03970" name="l03970"></a><span class="lineno"> 3970</span>    <span class="keywordflow">if</span>( gun.<a class="code hl_function" href="classitem.html#a624c3b7ec10ae766a9e75718af71e647">ammo_current</a>() &amp;&amp; gun.<a class="code hl_function" href="classitem.html#a624c3b7ec10ae766a9e75718af71e647">ammo_current</a>()-&gt;<a class="code hl_variable" href="structitype.html#a7cb80d77696cefb42ac6e75756b47e60">ammo</a> ) {</div>
<div class="line"><a id="l03971" name="l03971"></a><span class="lineno"> 3971</span>        <span class="keywordflow">return</span> gun.<a class="code hl_function" href="classitem.html#a624c3b7ec10ae766a9e75718af71e647">ammo_current</a>()-&gt;<a class="code hl_variable" href="structitype.html#a7cb80d77696cefb42ac6e75756b47e60">ammo</a>-&gt;shape;</div>
<div class="line"><a id="l03972" name="l03972"></a><span class="lineno"> 3972</span>    }</div>
<div class="line"><a id="l03973" name="l03973"></a><span class="lineno"> 3973</span> </div>
<div class="line"><a id="l03974" name="l03974"></a><span class="lineno"> 3974</span>    <span class="keywordflow">return</span> {};</div>
<div class="line"><a id="l03975" name="l03975"></a><span class="lineno"> 3975</span>}</div>
<div class="ttc" id="aclassitem_html_a624c3b7ec10ae766a9e75718af71e647"><div class="ttname"><a href="classitem.html#a624c3b7ec10ae766a9e75718af71e647">item::ammo_current</a></div><div class="ttdeci">itype_id ammo_current() const</div><div class="ttdoc">Specific ammo type, returns &quot;null&quot; if item is neither ammo nor loaded with any.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l07576">item.cpp:7576</a></div></div>
<div class="ttc" id="astructitype_html_a7cb80d77696cefb42ac6e75756b47e60"><div class="ttname"><a href="structitype.html#a7cb80d77696cefb42ac6e75756b47e60">itype::ammo</a></div><div class="ttdeci">cata::value_ptr&lt; islot_ammo &gt; ammo</div><div class="ttdef"><b>Definition:</b> <a href="itype_8h_source.html#l00832">itype.h:832</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="itype_8h_source.html#l00832">itype::ammo</a>, and <a class="el" href="item_8cpp_source.html#l07576">item::ammo_current()</a>.</p>

<p class="reference">Referenced by <a class="el" href="npcmove_8cpp_source.html#l02041">npc::confident_gun_mode_range()</a>, and <a class="el" href="ranged_8cpp_source.html#l00822">fire_gun()</a>.</p>

</div>
</div>
<a id="a4c8c85e0249f67213d9994612315aa3e" name="a4c8c85e0249f67213d9994612315aa3e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4c8c85e0249f67213d9994612315aa3e">&#9670;&nbsp;</a></span>get_str_draw_penalty()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float ranged::get_str_draw_penalty </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classitem.html">item</a> &amp;&#160;</td>
          <td class="paramname"><em>it</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classCharacter.html">Character</a> &amp;&#160;</td>
          <td class="paramname"><em>p</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Penalties potentially incurred by STR_DRAW weapons. </p>

<p class="definition">Definition at line <a class="el" href="ranged_8cpp_source.html#l01019">1019</a> of file <a class="el" href="ranged_8cpp_source.html">ranged.cpp</a>.</p>
<div class="fragment"><div class="line"><a id="l01020" name="l01020"></a><span class="lineno"> 1020</span>{</div>
<div class="line"><a id="l01021" name="l01021"></a><span class="lineno"> 1021</span>    <span class="comment">// We only care if weapon has STR_DRAW, and that the user is weaker than required strength.</span></div>
<div class="line"><a id="l01022" name="l01022"></a><span class="lineno"> 1022</span>    <span class="comment">// Also avoid dividing by zero, and skip if we&#39;d just get a result of 1 anyway.</span></div>
<div class="line"><a id="l01023" name="l01023"></a><span class="lineno"> 1023</span>    <span class="keywordflow">if</span>( !it.<a class="code hl_function" href="classitem.html#aaa5aeb6f838927babb10ede535cf2a73">has_flag</a>( <a class="code hl_function" href="ranged_8cpp.html#a3756f1dde5d862fe1b0f0240dfc13e6a">flag_STR_DRAW</a> ) || p.<a class="code hl_function" href="classCharacter.html#a5aba683ccf77cb560a0a932308289bd9">get_str</a>() &gt;= it.<a class="code hl_function" href="classitem.html#a2899a37f781e1efea9465a98277141c7">get_min_str</a>() || it.<a class="code hl_function" href="classitem.html#a2899a37f781e1efea9465a98277141c7">get_min_str</a>() &lt;= 1 ) {</div>
<div class="line"><a id="l01024" name="l01024"></a><span class="lineno"> 1024</span>        <span class="keywordflow">return</span> 1.0f;</div>
<div class="line"><a id="l01025" name="l01025"></a><span class="lineno"> 1025</span>    }</div>
<div class="line"><a id="l01026" name="l01026"></a><span class="lineno"> 1026</span>    <span class="comment">// We also don&#39;t want to actually reduce values to zero, even if user is debuffed to zero strength.</span></div>
<div class="line"><a id="l01027" name="l01027"></a><span class="lineno"> 1027</span>    <span class="keywordtype">float</span> archer_str = std::max( 1, p.<a class="code hl_function" href="classCharacter.html#a5aba683ccf77cb560a0a932308289bd9">get_str</a>() );</div>
<div class="line"><a id="l01028" name="l01028"></a><span class="lineno"> 1028</span>    <span class="keywordflow">return</span> ( archer_str / it.<a class="code hl_function" href="classitem.html#a2899a37f781e1efea9465a98277141c7">get_min_str</a>() );</div>
<div class="line"><a id="l01029" name="l01029"></a><span class="lineno"> 1029</span>}</div>
<div class="ttc" id="aclassitem_html_a2899a37f781e1efea9465a98277141c7"><div class="ttname"><a href="classitem.html#a2899a37f781e1efea9465a98277141c7">item::get_min_str</a></div><div class="ttdeci">int get_min_str() const</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l10073">item.cpp:10073</a></div></div>
<div class="ttc" id="aranged_8cpp_html_a3756f1dde5d862fe1b0f0240dfc13e6a"><div class="ttname"><a href="ranged_8cpp.html#a3756f1dde5d862fe1b0f0240dfc13e6a">flag_STR_DRAW</a></div><div class="ttdeci">static const std::string flag_STR_DRAW(&quot;STR_DRAW&quot;)</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="ranged_8cpp.html#a3756f1dde5d862fe1b0f0240dfc13e6a">flag_STR_DRAW()</a>, <a class="el" href="item_8cpp_source.html#l10073">item::get_min_str()</a>, <a class="el" href="character_8cpp_source.html#l04090">Character::get_str()</a>, and <a class="el" href="item_8cpp_source.html#l05328">item::has_flag()</a>.</p>

<p class="reference">Referenced by <a class="el" href="item_8cpp_source.html#l01461">item::basic_info()</a>, <a class="el" href="ranged_8cpp_source.html#l03703">gunmode_checks_common()</a>, <a class="el" href="ranged_8cpp_source.html#l01031">str_draw_damage_modifier()</a>, <a class="el" href="ranged_8cpp_source.html#l01045">str_draw_dispersion_modifier()</a>, and <a class="el" href="ranged_8cpp_source.html#l01057">str_draw_range_modifier()</a>.</p>

</div>
</div>
<a id="a8b31304e61913a0072ad6df6e16bc932" name="a8b31304e61913a0072ad6df6e16bc932"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8b31304e61913a0072ad6df6e16bc932">&#9670;&nbsp;</a></span>get_weapon_dispersion()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classdispersion__sources.html">dispersion_sources</a> ranged::get_weapon_dispersion </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classCharacter.html">Character</a> &amp;&#160;</td>
          <td class="paramname"><em>who</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classitem.html">item</a> &amp;&#160;</td>
          <td class="paramname"><em>obj</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get weapon's dispersion value modified accoring to character stats. </p>
Driving reduces the inaccuracy penalty when using guns whilst driving Gun improves usage of accurate weapons and sights 
<p class="definition">Definition at line <a class="el" href="ranged_8cpp_source.html#l01917">1917</a> of file <a class="el" href="ranged_8cpp_source.html">ranged.cpp</a>.</p>
<div class="fragment"><div class="line"><a id="l01918" name="l01918"></a><span class="lineno"> 1918</span>{</div>
<div class="line"><a id="l01919" name="l01919"></a><span class="lineno"> 1919</span>    <span class="keywordtype">int</span> weapon_dispersion = <a class="code hl_function" href="classint__id.html#a315169d32cce4267b7c8dceff4b0d1d7">obj</a>.gun_dispersion();</div>
<div class="line"><a id="l01920" name="l01920"></a><span class="lineno"> 1920</span>    <a class="code hl_class" href="classdispersion__sources.html">dispersion_sources</a> dispersion( weapon_dispersion );</div>
<div class="line"><a id="l01921" name="l01921"></a><span class="lineno"> 1921</span>    dispersion.add_range( who.<a class="code hl_function" href="classCharacter.html#aaef1f2b773b9e659b6b69f813ea4dafb">ranged_dex_mod</a>() );</div>
<div class="line"><a id="l01922" name="l01922"></a><span class="lineno"> 1922</span> </div>
<div class="line"><a id="l01923" name="l01923"></a><span class="lineno"> 1923</span>    dispersion.add_range( ( who.<a class="code hl_function" href="classCharacter.html#adc1fd84a88722a905e57fea8bfd5b6b0">encumb</a>( <a class="code hl_enumvalue" href="bodypart_8h.html#af618290c4c2de42aab87977ac7311980a441080ba1d3930d38f635658d9b28e01">bp_arm_l</a> ) + who.<a class="code hl_function" href="classCharacter.html#adc1fd84a88722a905e57fea8bfd5b6b0">encumb</a>( <a class="code hl_enumvalue" href="bodypart_8h.html#af618290c4c2de42aab87977ac7311980ae5f21c7494ad730a0c6abf6957976cb3">bp_arm_r</a> ) ) / 5.0 );</div>
<div class="line"><a id="l01924" name="l01924"></a><span class="lineno"> 1924</span> </div>
<div class="line"><a id="l01925" name="l01925"></a><span class="lineno"> 1925</span>    <span class="keywordflow">if</span>( <a class="code hl_function" href="ranged_8cpp.html#a4f63cd5153d42291194a203f8928a74b">is_driving</a>( who ) ) {</div>
<div class="line"><a id="l01926" name="l01926"></a><span class="lineno"> 1926</span>        <span class="comment">// get volume of gun (or for auxiliary gunmods the parent gun)</span></div>
<div class="line"><a id="l01927" name="l01927"></a><span class="lineno"> 1927</span>        <span class="keyword">const</span> <a class="code hl_class" href="classitem.html">item</a> *parent = who.<a class="code hl_function" href="classvisitable.html#af49d5ef7b3f2f0a8664c23097a56373f">has_item</a>( <a class="code hl_function" href="classint__id.html#a315169d32cce4267b7c8dceff4b0d1d7">obj</a> ) ? who.<a class="code hl_function" href="classvisitable.html#a073dab39ca059a87742a05300402ab01">find_parent</a>( <a class="code hl_function" href="classint__id.html#a315169d32cce4267b7c8dceff4b0d1d7">obj</a> ) : <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l01928" name="l01928"></a><span class="lineno"> 1928</span>        <span class="keyword">const</span> <span class="keywordtype">int</span> vol = ( parent ? parent-&gt;<a class="code hl_function" href="classitem.html#a51eafbdf8b331d88b741c0c527f98eb9">volume</a>() : <a class="code hl_function" href="classint__id.html#a315169d32cce4267b7c8dceff4b0d1d7">obj</a>.volume() ) / 250_ml;</div>
<div class="line"><a id="l01929" name="l01929"></a><span class="lineno"> 1929</span><span class="comment"></span> </div>
<div class="line"><a id="l01930" name="l01930"></a><span class="lineno"> 1930</span><span class="comment">        /** @EFFECT_DRIVING reduces the inaccuracy penalty when using guns whilst driving */</span></div>
<div class="line"><a id="l01931" name="l01931"></a><span class="lineno"> 1931</span>        dispersion.add_range( std::max( vol - who.<a class="code hl_function" href="classCharacter.html#afa95fe499ca6b55ab97f1b442a4c95c5">get_skill_level</a>( <a class="code hl_variable" href="ranged_8cpp.html#afee8dcfd12a225c469ee6171063d7594">skill_driving</a> ), 1 ) * 20 );</div>
<div class="line"><a id="l01932" name="l01932"></a><span class="lineno"> 1932</span>    }</div>
<div class="line"><a id="l01933" name="l01933"></a><span class="lineno"> 1933</span><span class="comment"></span> </div>
<div class="line"><a id="l01934" name="l01934"></a><span class="lineno"> 1934</span><span class="comment">    /** @EFFECT_GUN improves usage of accurate weapons and sights */</span></div>
<div class="line"><a id="l01935" name="l01935"></a><span class="lineno"> 1935</span>    <span class="keywordtype">double</span> avgSkill = <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>( who.<a class="code hl_function" href="classCharacter.html#afa95fe499ca6b55ab97f1b442a4c95c5">get_skill_level</a>( <a class="code hl_variable" href="ranged_8cpp.html#a3eadead4a9aa7fee079c0b1acce7965e">skill_gun</a> ) +</div>
<div class="line"><a id="l01936" name="l01936"></a><span class="lineno"> 1936</span>                                           who.<a class="code hl_function" href="classCharacter.html#afa95fe499ca6b55ab97f1b442a4c95c5">get_skill_level</a>( <a class="code hl_function" href="classint__id.html#a315169d32cce4267b7c8dceff4b0d1d7">obj</a>.gun_skill() ) ) / 2.0;</div>
<div class="line"><a id="l01937" name="l01937"></a><span class="lineno"> 1937</span>    avgSkill = std::min( avgSkill, <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>( <a class="code hl_variable" href="game__constants_8h.html#ae9c0ec5b4724c15132efddb8862ca652">MAX_SKILL</a> ) );</div>
<div class="line"><a id="l01938" name="l01938"></a><span class="lineno"> 1938</span> </div>
<div class="line"><a id="l01939" name="l01939"></a><span class="lineno"> 1939</span>    dispersion.add_range( <a class="code hl_function" href="ranged_8cpp.html#a217238d7885e55ae74878bbb1f99cddd">dispersion_from_skill</a>( avgSkill, weapon_dispersion ) );</div>
<div class="line"><a id="l01940" name="l01940"></a><span class="lineno"> 1940</span> </div>
<div class="line"><a id="l01941" name="l01941"></a><span class="lineno"> 1941</span>    <span class="keywordflow">if</span>( who.<a class="code hl_function" href="classCharacter.html#a5751b689e5a4ecd43b6de5c3e2d31541">has_bionic</a>( <a class="code hl_variable" href="ranged_8cpp.html#a0919705e5cea2aa623cbda27d0cae0b6">bio_targeting</a> ) ) {</div>
<div class="line"><a id="l01942" name="l01942"></a><span class="lineno"> 1942</span>        dispersion.add_multiplier( 0.75 );</div>
<div class="line"><a id="l01943" name="l01943"></a><span class="lineno"> 1943</span>    }</div>
<div class="line"><a id="l01944" name="l01944"></a><span class="lineno"> 1944</span> </div>
<div class="line"><a id="l01945" name="l01945"></a><span class="lineno"> 1945</span>    <span class="comment">// If using a bow you lack the strength for, increase based on how much weaker shooter is.</span></div>
<div class="line"><a id="l01946" name="l01946"></a><span class="lineno"> 1946</span>    dispersion.add_multiplier( 1 / <a class="code hl_function" href="namespaceranged.html#a613a2847b3c06998d6117f2630fc9ed5">ranged::str_draw_dispersion_modifier</a>( <a class="code hl_function" href="classint__id.html#a315169d32cce4267b7c8dceff4b0d1d7">obj</a>, who ) );</div>
<div class="line"><a id="l01947" name="l01947"></a><span class="lineno"> 1947</span> </div>
<div class="line"><a id="l01948" name="l01948"></a><span class="lineno"> 1948</span>    <span class="comment">// Range is effectively four times longer when shooting unflagged/flagged guns underwater/out of water.</span></div>
<div class="line"><a id="l01949" name="l01949"></a><span class="lineno"> 1949</span>    <span class="keywordflow">if</span>( who.<a class="code hl_function" href="classCreature.html#a5a2346f549de9c87e8f2afeec1e71366">is_underwater</a>() != <a class="code hl_function" href="classint__id.html#a315169d32cce4267b7c8dceff4b0d1d7">obj</a>.has_flag( <a class="code hl_function" href="ranged_8cpp.html#ab6ca472fa792b69b4a6afa8ca9e63a58">flag_UNDERWATER_GUN</a> ) ) {</div>
<div class="line"><a id="l01950" name="l01950"></a><span class="lineno"> 1950</span>        <span class="comment">// Adding dispersion for additional debuff</span></div>
<div class="line"><a id="l01951" name="l01951"></a><span class="lineno"> 1951</span>        dispersion.add_range( 150 );</div>
<div class="line"><a id="l01952" name="l01952"></a><span class="lineno"> 1952</span>        dispersion.add_multiplier( 4 );</div>
<div class="line"><a id="l01953" name="l01953"></a><span class="lineno"> 1953</span>    }</div>
<div class="line"><a id="l01954" name="l01954"></a><span class="lineno"> 1954</span> </div>
<div class="line"><a id="l01955" name="l01955"></a><span class="lineno"> 1955</span>    <span class="comment">// If user is currently able to fire a mounted gun freely, penalize dispersion based on size class.</span></div>
<div class="line"><a id="l01956" name="l01956"></a><span class="lineno"> 1956</span>    <span class="keywordflow">if</span>( <a class="code hl_function" href="classint__id.html#a315169d32cce4267b7c8dceff4b0d1d7">obj</a>.has_flag( <a class="code hl_function" href="ranged_8cpp.html#a9a327f2be95a30526c2d1ab6a31f72b2">flag_MOUNTED_GUN</a> ) &amp;&amp; !<a class="code hl_function" href="ranged_8cpp.html#a6bfc75cd10b0d4de99dc6dcb44abc85b">can_use_bipod</a>( <a class="code hl_function" href="map_8cpp.html#acb0b34be6e497bdd2f9f40ae6929d562">get_map</a>(), who.<a class="code hl_function" href="classCharacter.html#ad24859164517ed6e392e21df69527199">pos</a>() ) ) {</div>
<div class="line"><a id="l01957" name="l01957"></a><span class="lineno"> 1957</span>        <span class="keywordflow">if</span>( who.<a class="code hl_function" href="classCharacter.html#aa5ca0f6c4fb1c08bb93ece1c9746c368">get_size</a>() == <a class="code hl_enumvalue" href="creature_8h.html#a94151e401c177b20ea9b8bcadf74f592a75a0e62060c8f624b2c71038a5a77ae9">MS_HUGE</a> ) {</div>
<div class="line"><a id="l01958" name="l01958"></a><span class="lineno"> 1958</span>            dispersion.add_multiplier( 2 );</div>
<div class="line"><a id="l01959" name="l01959"></a><span class="lineno"> 1959</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01960" name="l01960"></a><span class="lineno"> 1960</span>            dispersion.add_multiplier( 3 );</div>
<div class="line"><a id="l01961" name="l01961"></a><span class="lineno"> 1961</span>        }</div>
<div class="line"><a id="l01962" name="l01962"></a><span class="lineno"> 1962</span>    }</div>
<div class="line"><a id="l01963" name="l01963"></a><span class="lineno"> 1963</span> </div>
<div class="line"><a id="l01964" name="l01964"></a><span class="lineno"> 1964</span>    <span class="keywordflow">return</span> dispersion;</div>
<div class="line"><a id="l01965" name="l01965"></a><span class="lineno"> 1965</span>}</div>
<div class="ttc" id="abodypart_8h_html_af618290c4c2de42aab87977ac7311980a441080ba1d3930d38f635658d9b28e01"><div class="ttname"><a href="bodypart_8h.html#af618290c4c2de42aab87977ac7311980a441080ba1d3930d38f635658d9b28e01">bp_arm_l</a></div><div class="ttdeci">@ bp_arm_l</div><div class="ttdef"><b>Definition:</b> <a href="bodypart_8h_source.html#l00045">bodypart.h:45</a></div></div>
<div class="ttc" id="abodypart_8h_html_af618290c4c2de42aab87977ac7311980ae5f21c7494ad730a0c6abf6957976cb3"><div class="ttname"><a href="bodypart_8h.html#af618290c4c2de42aab87977ac7311980ae5f21c7494ad730a0c6abf6957976cb3">bp_arm_r</a></div><div class="ttdeci">@ bp_arm_r</div><div class="ttdef"><b>Definition:</b> <a href="bodypart_8h_source.html#l00046">bodypart.h:46</a></div></div>
<div class="ttc" id="aclassCharacter_html_a5751b689e5a4ecd43b6de5c3e2d31541"><div class="ttname"><a href="classCharacter.html#a5751b689e5a4ecd43b6de5c3e2d31541">Character::has_bionic</a></div><div class="ttdeci">bool has_bionic(const bionic_id &amp;b) const</div><div class="ttdoc">Returns true if the player has the entered bionic id.</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l01814">character.cpp:1814</a></div></div>
<div class="ttc" id="aclassCharacter_html_aaef1f2b773b9e659b6b69f813ea4dafb"><div class="ttname"><a href="classCharacter.html#aaef1f2b773b9e659b6b69f813ea4dafb">Character::ranged_dex_mod</a></div><div class="ttdeci">virtual int ranged_dex_mod() const</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l04155">character.cpp:4155</a></div></div>
<div class="ttc" id="aclassCreature_html_a5a2346f549de9c87e8f2afeec1e71366"><div class="ttname"><a href="classCreature.html#a5a2346f549de9c87e8f2afeec1e71366">Creature::is_underwater</a></div><div class="ttdeci">virtual bool is_underwater() const</div><div class="ttdef"><b>Definition:</b> <a href="creature_8cpp_source.html#l00171">creature.cpp:171</a></div></div>
<div class="ttc" id="aclassint__id_html_a315169d32cce4267b7c8dceff4b0d1d7"><div class="ttname"><a href="classint__id.html#a315169d32cce4267b7c8dceff4b0d1d7">int_id::obj</a></div><div class="ttdeci">const ammo_effect &amp; obj() const</div><div class="ttdef"><b>Definition:</b> <a href="ammo__effect_8cpp_source.html#l00026">ammo_effect.cpp:26</a></div></div>
<div class="ttc" id="aclassitem_html"><div class="ttname"><a href="classitem.html">item</a></div><div class="ttdef"><b>Definition:</b> <a href="item_8h_source.html#l00209">item.h:210</a></div></div>
<div class="ttc" id="aclassvisitable_html_a073dab39ca059a87742a05300402ab01"><div class="ttname"><a href="classvisitable.html#a073dab39ca059a87742a05300402ab01">visitable::find_parent</a></div><div class="ttdeci">item * find_parent(const item &amp;it)</div><div class="ttdoc">Determine the immediate parent container (if any) for an item.</div><div class="ttdef"><b>Definition:</b> <a href="visitable_8cpp_source.html#l00049">visitable.cpp:49</a></div></div>
<div class="ttc" id="aclassvisitable_html_af49d5ef7b3f2f0a8664c23097a56373f"><div class="ttname"><a href="classvisitable.html#af49d5ef7b3f2f0a8664c23097a56373f">visitable::has_item</a></div><div class="ttdeci">bool has_item(const item &amp;it) const</div><div class="ttdoc">Returns true if this visitable instance contains the item.</div><div class="ttdef"><b>Definition:</b> <a href="visitable_8cpp_source.html#l00095">visitable.cpp:95</a></div></div>
<div class="ttc" id="anamespaceranged_html_a613a2847b3c06998d6117f2630fc9ed5"><div class="ttname"><a href="namespaceranged.html#a613a2847b3c06998d6117f2630fc9ed5">ranged::str_draw_dispersion_modifier</a></div><div class="ttdeci">float str_draw_dispersion_modifier(const item &amp;it, const Character &amp;p)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01045">ranged.cpp:1045</a></div></div>
<div class="ttc" id="aranged_8cpp_html_a0919705e5cea2aa623cbda27d0cae0b6"><div class="ttname"><a href="ranged_8cpp.html#a0919705e5cea2aa623cbda27d0cae0b6">bio_targeting</a></div><div class="ttdeci">static const bionic_id bio_targeting(&quot;bio_targeting&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a217238d7885e55ae74878bbb1f99cddd"><div class="ttname"><a href="ranged_8cpp.html#a217238d7885e55ae74878bbb1f99cddd">dispersion_from_skill</a></div><div class="ttdeci">static double dispersion_from_skill(double skill, double weapon_dispersion)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01894">ranged.cpp:1894</a></div></div>
<div class="ttc" id="aranged_8cpp_html_a4f63cd5153d42291194a203f8928a74b"><div class="ttname"><a href="ranged_8cpp.html#a4f63cd5153d42291194a203f8928a74b">is_driving</a></div><div class="ttdeci">static bool is_driving(const Character &amp;p)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01888">ranged.cpp:1888</a></div></div>
<div class="ttc" id="aranged_8cpp_html_ab6ca472fa792b69b4a6afa8ca9e63a58"><div class="ttname"><a href="ranged_8cpp.html#ab6ca472fa792b69b4a6afa8ca9e63a58">flag_UNDERWATER_GUN</a></div><div class="ttdeci">static const std::string flag_UNDERWATER_GUN(&quot;UNDERWATER_GUN&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_afee8dcfd12a225c469ee6171063d7594"><div class="ttname"><a href="ranged_8cpp.html#afee8dcfd12a225c469ee6171063d7594">skill_driving</a></div><div class="ttdeci">static const skill_id skill_driving(&quot;driving&quot;)</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="dispersion_8h_source.html#l00023">dispersion_sources::add_multiplier()</a>, <a class="el" href="dispersion_8h_source.html#l00020">dispersion_sources::add_range()</a>, <a class="el" href="ranged_8cpp.html#a0919705e5cea2aa623cbda27d0cae0b6">bio_targeting</a>, <a class="el" href="bodypart_8h_source.html#l00045">bp_arm_l</a>, <a class="el" href="bodypart_8h_source.html#l00046">bp_arm_r</a>, <a class="el" href="ranged_8cpp_source.html#l00791">can_use_bipod()</a>, <a class="el" href="ranged_8cpp_source.html#l01894">dispersion_from_skill()</a>, <a class="el" href="character_8cpp_source.html#l04027">Character::encumb()</a>, <a class="el" href="visitable_8cpp_source.html#l00049">visitable&lt; T &gt;::find_parent()</a>, <a class="el" href="ranged_8cpp.html#a9a327f2be95a30526c2d1ab6a31f72b2">flag_MOUNTED_GUN()</a>, <a class="el" href="ranged_8cpp.html#ab6ca472fa792b69b4a6afa8ca9e63a58">flag_UNDERWATER_GUN()</a>, <a class="el" href="map_8cpp_source.html#l00147">get_map()</a>, <a class="el" href="character_8cpp_source.html#l00575">Character::get_size()</a>, <a class="el" href="character_8cpp_source.html#l03351">Character::get_skill_level()</a>, <a class="el" href="character_8cpp_source.html#l01814">Character::has_bionic()</a>, <a class="el" href="visitable_8cpp_source.html#l00095">visitable&lt; T &gt;::has_item()</a>, <a class="el" href="ranged_8cpp_source.html#l01888">is_driving()</a>, <a class="el" href="creature_8cpp_source.html#l00171">Creature::is_underwater()</a>, <a class="el" href="game__constants_8h_source.html#l00114">MAX_SKILL</a>, <a class="el" href="creature_8h_source.html#l00062">MS_HUGE</a>, <a class="el" href="ammo__effect_8cpp_source.html#l00026">int_id&lt; T &gt;::obj()</a>, <a class="el" href="character_8cpp_source.html#l00601">Character::pos()</a>, <a class="el" href="character_8cpp_source.html#l04155">Character::ranged_dex_mod()</a>, <a class="el" href="ranged_8cpp.html#afee8dcfd12a225c469ee6171063d7594">skill_driving</a>, <a class="el" href="ranged_8cpp.html#a3eadead4a9aa7fee079c0b1acce7965e">skill_gun</a>, <a class="el" href="ranged_8cpp_source.html#l01045">str_draw_dispersion_modifier()</a>, and <a class="el" href="item_8cpp_source.html#l05129">item::volume()</a>.</p>

<p class="reference">Referenced by <a class="el" href="ranged_8cpp_source.html#l00805">calculate_dispersion()</a>, <a class="el" href="npcmove_8cpp_source.html#l02041">npc::confident_gun_mode_range()</a>, <a class="el" href="item_8cpp_source.html#l02020">item::gun_info()</a>, <a class="el" href="ranged_8cpp_source.html#l02009">npc_ai::gun_value()</a>, and <a class="el" href="ranged_8cpp_source.html#l01564">print_aim()</a>.</p>

</div>
</div>
<a id="a1091f2ff573108fbf6d9f56f0c1d2187" name="a1091f2ff573108fbf6d9f56f0c1d2187"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1091f2ff573108fbf6d9f56f0c1d2187">&#9670;&nbsp;</a></span>gun_engagement_moves()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ranged::gun_engagement_moves </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classCharacter.html">Character</a> &amp;&#160;</td>
          <td class="paramname"><em>who</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classitem.html">item</a> &amp;&#160;</td>
          <td class="paramname"><em>gun</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>target</em> = <code>0</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>start</em> = <code><a class="el" href="game__constants_8h.html#a8226e8a134603e5bc06df05efd13d8d1">MAX_RECOIL</a></code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>How many moves does it take to aim gun to the target accuracy. </p>

<p class="definition">Definition at line <a class="el" href="ranged_8cpp_source.html#l00583">583</a> of file <a class="el" href="ranged_8cpp_source.html">ranged.cpp</a>.</p>
<div class="fragment"><div class="line"><a id="l00584" name="l00584"></a><span class="lineno">  584</span>{</div>
<div class="line"><a id="l00585" name="l00585"></a><span class="lineno">  585</span>    <span class="keywordtype">int</span> mv = 0;</div>
<div class="line"><a id="l00586" name="l00586"></a><span class="lineno">  586</span>    <span class="keywordtype">double</span> penalty = start;</div>
<div class="line"><a id="l00587" name="l00587"></a><span class="lineno">  587</span> </div>
<div class="line"><a id="l00588" name="l00588"></a><span class="lineno">  588</span>    <span class="keywordflow">while</span>( penalty &gt; target ) {</div>
<div class="line"><a id="l00589" name="l00589"></a><span class="lineno">  589</span>        <span class="keywordtype">double</span> adj = <a class="code hl_function" href="namespaceranged.html#aee24b0f617e2ee224a92d1c5422ae306">ranged::aim_per_move</a>( who, gun, penalty );</div>
<div class="line"><a id="l00590" name="l00590"></a><span class="lineno">  590</span>        <span class="keywordflow">if</span>( adj &lt;= 0 ) {</div>
<div class="line"><a id="l00591" name="l00591"></a><span class="lineno">  591</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00592" name="l00592"></a><span class="lineno">  592</span>        }</div>
<div class="line"><a id="l00593" name="l00593"></a><span class="lineno">  593</span>        penalty -= adj;</div>
<div class="line"><a id="l00594" name="l00594"></a><span class="lineno">  594</span>        mv++;</div>
<div class="line"><a id="l00595" name="l00595"></a><span class="lineno">  595</span>    }</div>
<div class="line"><a id="l00596" name="l00596"></a><span class="lineno">  596</span> </div>
<div class="line"><a id="l00597" name="l00597"></a><span class="lineno">  597</span>    <span class="keywordflow">return</span> mv;</div>
<div class="line"><a id="l00598" name="l00598"></a><span class="lineno">  598</span>}</div>
<div class="ttc" id="anamespaceranged_html_aee24b0f617e2ee224a92d1c5422ae306"><div class="ttname"><a href="namespaceranged.html#aee24b0f617e2ee224a92d1c5422ae306">ranged::aim_per_move</a></div><div class="ttdeci">double aim_per_move(const Character &amp;who, const item &amp;gun, double recoil)</div><div class="ttdoc">Calculates aim improvement per move spent aiming at a given.</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l03919">ranged.cpp:3919</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="ranged_8cpp_source.html#l03919">aim_per_move()</a>.</p>

<p class="reference">Referenced by <a class="el" href="dump_8cpp_source.html#l00039">game::dump_stats()</a>, <a class="el" href="item_8cpp_source.html#l02020">item::gun_info()</a>, <a class="el" href="npcmove_8cpp_source.html#l02079">item::ideal_ranged_dps()</a>, and <a class="el" href="ranged_8cpp_source.html#l01564">print_aim()</a>.</p>

</div>
</div>
<a id="aed4420a1fd77e160a72de2a528e56da5" name="aed4420a1fd77e160a72de2a528e56da5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aed4420a1fd77e160a72de2a528e56da5">&#9670;&nbsp;</a></span>gunmode_checks_common()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool ranged::gunmode_checks_common </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classavatar.html">avatar</a> &amp;&#160;</td>
          <td class="paramname"><em>you</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classmap.html">map</a> &amp;&#160;</td>
          <td class="paramname"><em>m</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; std::string &gt; &amp;&#160;</td>
          <td class="paramname"><em>messages</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classgun__mode.html">gun_mode</a> &amp;&#160;</td>
          <td class="paramname"><em>gmode</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Common checks for gunmode (when firing a weapon / manually firing turret) </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">messages</td><td>Used to store messages describing failed checks </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>True if all conditions are true </dd></dl>

<p class="definition">Definition at line <a class="el" href="ranged_8cpp_source.html#l03703">3703</a> of file <a class="el" href="ranged_8cpp_source.html">ranged.cpp</a>.</p>
<div class="fragment"><div class="line"><a id="l03705" name="l03705"></a><span class="lineno"> 3705</span>{</div>
<div class="line"><a id="l03706" name="l03706"></a><span class="lineno"> 3706</span>    <span class="keywordtype">bool</span> <a class="code hl_enumeration" href="namespacedetail_1_1digits.html#aad69d2373aa047bdd9e81494bf3da5ae">result</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l03707" name="l03707"></a><span class="lineno"> 3707</span> </div>
<div class="line"><a id="l03708" name="l03708"></a><span class="lineno"> 3708</span>    <span class="comment">// Check that passed gun mode is valid and we are able to use it</span></div>
<div class="line"><a id="l03709" name="l03709"></a><span class="lineno"> 3709</span>    <span class="keywordflow">if</span>( !( gmode &amp;&amp; you.<a class="code hl_function" href="classCharacter.html#a4eddeb86babf626e7869882079b40651">can_use</a>( *gmode ) ) ) {</div>
<div class="line"><a id="l03710" name="l03710"></a><span class="lineno"> 3710</span>        messages.push_back( <a class="code hl_function" href="string__formatter_8h.html#a8964099387da2f95396c67566bafce3d">string_format</a>( <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;You can&#39;t currently fire your %s.&quot;</span> ),</div>
<div class="line"><a id="l03711" name="l03711"></a><span class="lineno"> 3711</span>                                           gmode-&gt;<a class="code hl_function" href="classitem.html#a7e78e26dcf9b357cda769c3ca2938eda">tname</a>() ) );</div>
<div class="line"><a id="l03712" name="l03712"></a><span class="lineno"> 3712</span>        <a class="code hl_enumeration" href="namespacedetail_1_1digits.html#aad69d2373aa047bdd9e81494bf3da5ae">result</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l03713" name="l03713"></a><span class="lineno"> 3713</span>    }</div>
<div class="line"><a id="l03714" name="l03714"></a><span class="lineno"> 3714</span> </div>
<div class="line"><a id="l03715" name="l03715"></a><span class="lineno"> 3715</span>    <span class="keyword">const</span> <a class="code hl_class" href="classoptional__vpart__position.html">optional_vpart_position</a> vp = m.<a class="code hl_function" href="classmap.html#aa487d96256c3d35db7a1bf273156b64a">veh_at</a>( you.<a class="code hl_function" href="classCharacter.html#ad24859164517ed6e392e21df69527199">pos</a>() );</div>
<div class="line"><a id="l03716" name="l03716"></a><span class="lineno"> 3716</span>    <span class="keywordflow">if</span>( vp &amp;&amp; vp-&gt;vehicle().player_in_control( you ) &amp;&amp; ( gmode-&gt;<a class="code hl_function" href="classitem.html#af373f646c1ee172941490dc7cc04bbcd">is_two_handed</a>( you ) ||</div>
<div class="line"><a id="l03717" name="l03717"></a><span class="lineno"> 3717</span>            gmode-&gt;<a class="code hl_function" href="classitem.html#aaa5aeb6f838927babb10ede535cf2a73">has_flag</a>( <a class="code hl_function" href="ranged_8cpp.html#a02edfa7a6cb1a0f7a67ae1aca7a34753">flag_FIRE_TWOHAND</a> ) ) ) {</div>
<div class="line"><a id="l03718" name="l03718"></a><span class="lineno"> 3718</span>        messages.push_back( <a class="code hl_function" href="string__formatter_8h.html#a8964099387da2f95396c67566bafce3d">string_format</a>( <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;You can&#39;t fire your %s while driving.&quot;</span> ),</div>
<div class="line"><a id="l03719" name="l03719"></a><span class="lineno"> 3719</span>                                           gmode-&gt;<a class="code hl_function" href="classitem.html#a7e78e26dcf9b357cda769c3ca2938eda">tname</a>() ) );</div>
<div class="line"><a id="l03720" name="l03720"></a><span class="lineno"> 3720</span>        <a class="code hl_enumeration" href="namespacedetail_1_1digits.html#aad69d2373aa047bdd9e81494bf3da5ae">result</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l03721" name="l03721"></a><span class="lineno"> 3721</span>    }</div>
<div class="line"><a id="l03722" name="l03722"></a><span class="lineno"> 3722</span> </div>
<div class="line"><a id="l03723" name="l03723"></a><span class="lineno"> 3723</span>    <span class="keywordflow">if</span>( gmode-&gt;<a class="code hl_function" href="classitem.html#aaa5aeb6f838927babb10ede535cf2a73">has_flag</a>( <a class="code hl_function" href="ranged_8cpp.html#a02edfa7a6cb1a0f7a67ae1aca7a34753">flag_FIRE_TWOHAND</a> ) &amp;&amp; ( !you.<a class="code hl_function" href="classCharacter.html#a8e2d2e1c01bfbb36401ae221300370f5">has_two_arms</a>() ||</div>
<div class="line"><a id="l03724" name="l03724"></a><span class="lineno"> 3724</span>            you.<a class="code hl_function" href="classCharacter.html#a3aaa75382f6308a729369c7f2ccf0600">worn_with_flag</a>( <a class="code hl_function" href="ranged_8cpp.html#aeac06317fd010c6001b6b71968bc15c1">flag_RESTRICT_HANDS</a> ) ) ) {</div>
<div class="line"><a id="l03725" name="l03725"></a><span class="lineno"> 3725</span>        messages.push_back( <a class="code hl_function" href="string__formatter_8h.html#a8964099387da2f95396c67566bafce3d">string_format</a>( <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;You need two free hands to fire your %s.&quot;</span> ),</div>
<div class="line"><a id="l03726" name="l03726"></a><span class="lineno"> 3726</span>                                           gmode-&gt;<a class="code hl_function" href="classitem.html#a7e78e26dcf9b357cda769c3ca2938eda">tname</a>() ) );</div>
<div class="line"><a id="l03727" name="l03727"></a><span class="lineno"> 3727</span>        <a class="code hl_enumeration" href="namespacedetail_1_1digits.html#aad69d2373aa047bdd9e81494bf3da5ae">result</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l03728" name="l03728"></a><span class="lineno"> 3728</span>    }</div>
<div class="line"><a id="l03729" name="l03729"></a><span class="lineno"> 3729</span> </div>
<div class="line"><a id="l03730" name="l03730"></a><span class="lineno"> 3730</span>    <span class="keywordflow">if</span>( <a class="code hl_function" href="namespaceranged.html#a4c8c85e0249f67213d9994612315aa3e">ranged::get_str_draw_penalty</a>( *gmode, you ) &lt; 0.5f ) {</div>
<div class="line"><a id="l03731" name="l03731"></a><span class="lineno"> 3731</span>        messages.push_back( <a class="code hl_function" href="string__formatter_8h.html#a8964099387da2f95396c67566bafce3d">string_format</a>( <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;You don&#39;t have enough strength to fire your %s.&quot;</span> ),</div>
<div class="line"><a id="l03732" name="l03732"></a><span class="lineno"> 3732</span>                                           gmode-&gt;<a class="code hl_function" href="classitem.html#a7e78e26dcf9b357cda769c3ca2938eda">tname</a>() ) );</div>
<div class="line"><a id="l03733" name="l03733"></a><span class="lineno"> 3733</span>        <a class="code hl_enumeration" href="namespacedetail_1_1digits.html#aad69d2373aa047bdd9e81494bf3da5ae">result</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l03734" name="l03734"></a><span class="lineno"> 3734</span>    }</div>
<div class="line"><a id="l03735" name="l03735"></a><span class="lineno"> 3735</span> </div>
<div class="line"><a id="l03736" name="l03736"></a><span class="lineno"> 3736</span>    <span class="keywordflow">return</span> <a class="code hl_enumeration" href="namespacedetail_1_1digits.html#aad69d2373aa047bdd9e81494bf3da5ae">result</a>;</div>
<div class="line"><a id="l03737" name="l03737"></a><span class="lineno"> 3737</span>}</div>
<div class="ttc" id="aclassCharacter_html_a3aaa75382f6308a729369c7f2ccf0600"><div class="ttname"><a href="classCharacter.html#a3aaa75382f6308a729369c7f2ccf0600">Character::worn_with_flag</a></div><div class="ttdeci">bool worn_with_flag(const std::string &amp;flag, const bodypart_id &amp;bp=bodypart_str_id::NULL_ID()) const</div><div class="ttdoc">Returns true if the player is wearing an item with the given flag.</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l03264">character.cpp:3264</a></div></div>
<div class="ttc" id="aclassCharacter_html_a4eddeb86babf626e7869882079b40651"><div class="ttname"><a href="classCharacter.html#a4eddeb86babf626e7869882079b40651">Character::can_use</a></div><div class="ttdeci">bool can_use(const item &amp;it, const item &amp;context=item()) const</div><div class="ttdoc">Checks if character stats and skills meet minimum requirements for the item.</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l02736">character.cpp:2736</a></div></div>
<div class="ttc" id="aclassCharacter_html_a8e2d2e1c01bfbb36401ae221300370f5"><div class="ttname"><a href="classCharacter.html#a8e2d2e1c01bfbb36401ae221300370f5">Character::has_two_arms</a></div><div class="ttdeci">bool has_two_arms() const</div><div class="ttdoc">Returns true if the player has two functioning arms.</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l01220">character.cpp:1220</a></div></div>
<div class="ttc" id="aclassitem_html_af373f646c1ee172941490dc7cc04bbcd"><div class="ttname"><a href="classitem.html#af373f646c1ee172941490dc7cc04bbcd">item::is_two_handed</a></div><div class="ttdeci">bool is_two_handed(const Character &amp;guy) const</div><div class="ttdoc">Whether the character needs both hands to wield this item.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l06429">item.cpp:6429</a></div></div>
<div class="ttc" id="aclassoptional__vpart__position_html"><div class="ttname"><a href="classoptional__vpart__position.html">optional_vpart_position</a></div><div class="ttdoc">Simple wrapper to forward functions that may return a std::optional to vpart_position.</div><div class="ttdef"><b>Definition:</b> <a href="vpart__position_8h_source.html#l00103">vpart_position.h:104</a></div></div>
<div class="ttc" id="anamespacedetail_1_1digits_html_aad69d2373aa047bdd9e81494bf3da5ae"><div class="ttname"><a href="namespacedetail_1_1digits.html#aad69d2373aa047bdd9e81494bf3da5ae">detail::digits::result</a></div><div class="ttdeci">result</div><div class="ttdef"><b>Definition:</b> <a href="fmtlib__format-inl_8h_source.html#l01626">fmtlib_format-inl.h:1626</a></div></div>
<div class="ttc" id="anamespaceranged_html_a4c8c85e0249f67213d9994612315aa3e"><div class="ttname"><a href="namespaceranged.html#a4c8c85e0249f67213d9994612315aa3e">ranged::get_str_draw_penalty</a></div><div class="ttdeci">float get_str_draw_penalty(const item &amp;it, const Character &amp;p)</div><div class="ttdoc">Penalties potentially incurred by STR_DRAW weapons.</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01019">ranged.cpp:1019</a></div></div>
<div class="ttc" id="aranged_8cpp_html_a02edfa7a6cb1a0f7a67ae1aca7a34753"><div class="ttname"><a href="ranged_8cpp.html#a02edfa7a6cb1a0f7a67ae1aca7a34753">flag_FIRE_TWOHAND</a></div><div class="ttdeci">static const std::string flag_FIRE_TWOHAND(&quot;FIRE_TWOHAND&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_aeac06317fd010c6001b6b71968bc15c1"><div class="ttname"><a href="ranged_8cpp.html#aeac06317fd010c6001b6b71968bc15c1">flag_RESTRICT_HANDS</a></div><div class="ttdeci">static const std::string flag_RESTRICT_HANDS(&quot;RESTRICT_HANDS&quot;)</div></div>
<div class="ttc" id="astring__formatter_8h_html_a8964099387da2f95396c67566bafce3d"><div class="ttname"><a href="string__formatter_8h.html#a8964099387da2f95396c67566bafce3d">string_format</a></div><div class="ttdeci">std::string string_format(std::string_view format, Args &amp;&amp;...args)</div><div class="ttdoc">Simple wrapper over string_formatter::parse.</div><div class="ttdef"><b>Definition:</b> <a href="string__formatter_8h_source.html#l00430">string_formatter.h:430</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="translations_8h_source.html#l00116">_</a>, <a class="el" href="character_8cpp_source.html#l02736">Character::can_use()</a>, <a class="el" href="ranged_8cpp.html#a02edfa7a6cb1a0f7a67ae1aca7a34753">flag_FIRE_TWOHAND()</a>, <a class="el" href="ranged_8cpp.html#aeac06317fd010c6001b6b71968bc15c1">flag_RESTRICT_HANDS()</a>, <a class="el" href="ranged_8cpp_source.html#l01019">get_str_draw_penalty()</a>, <a class="el" href="item_8cpp_source.html#l05328">item::has_flag()</a>, <a class="el" href="character_8cpp_source.html#l01220">Character::has_two_arms()</a>, <a class="el" href="item_8cpp_source.html#l06429">item::is_two_handed()</a>, <a class="el" href="character_8cpp_source.html#l00601">Character::pos()</a>, <a class="el" href="string__formatter_8h_source.html#l00430">string_format()</a>, <a class="el" href="item_8cpp_source.html#l04574">item::tname()</a>, <a class="el" href="map_8cpp_source.html#l01073">map::veh_at()</a>, and <a class="el" href="character_8cpp_source.html#l03264">Character::worn_with_flag()</a>.</p>

<p class="reference">Referenced by <a class="el" href="avatar__action_8cpp_source.html#l00669">can_fire_turret()</a>, <a class="el" href="avatar__action_8cpp_source.html#l00631">avatar_action::can_fire_weapon()</a>, and <a class="el" href="ranged_8cpp_source.html#l02784">target_ui::update_status()</a>.</p>

</div>
</div>
<a id="a743f9e35b20c136e56ca9e9480fb27bc" name="a743f9e35b20c136e56ca9e9480fb27bc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a743f9e35b20c136e56ca9e9480fb27bc">&#9670;&nbsp;</a></span>gunmode_checks_weapon()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool ranged::gunmode_checks_weapon </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classavatar.html">avatar</a> &amp;&#160;</td>
          <td class="paramname"><em>you</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classmap.html">map</a> &amp;&#160;</td>
          <td class="paramname"><em>m</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; std::string &gt; &amp;&#160;</td>
          <td class="paramname"><em>messages</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classgun__mode.html">gun_mode</a> &amp;&#160;</td>
          <td class="paramname"><em>gmode</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Various checks for gunmode when firing a weapon. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">messages</td><td>Used to store messages describing failed checks </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>True if all conditions are true </dd></dl>

<p class="definition">Definition at line <a class="el" href="ranged_8cpp_source.html#l03739">3739</a> of file <a class="el" href="ranged_8cpp_source.html">ranged.cpp</a>.</p>
<div class="fragment"><div class="line"><a id="l03741" name="l03741"></a><span class="lineno"> 3741</span>{</div>
<div class="line"><a id="l03742" name="l03742"></a><span class="lineno"> 3742</span>    <span class="keywordtype">bool</span> <a class="code hl_enumeration" href="namespacedetail_1_1digits.html#aad69d2373aa047bdd9e81494bf3da5ae">result</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l03743" name="l03743"></a><span class="lineno"> 3743</span> </div>
<div class="line"><a id="l03744" name="l03744"></a><span class="lineno"> 3744</span>    <span class="keywordflow">if</span>( !gmode-&gt;<a class="code hl_function" href="classitem.html#a8efcfdc21aadbc25a8cc95cf54685489">ammo_sufficient</a>() &amp;&amp; !gmode-&gt;<a class="code hl_function" href="classitem.html#aaa5aeb6f838927babb10ede535cf2a73">has_flag</a>( <a class="code hl_function" href="ranged_8cpp.html#a30c9d25adcf2167a8bff0fe6ca21fdaf">flag_RELOAD_AND_SHOOT</a> ) ) {</div>
<div class="line"><a id="l03745" name="l03745"></a><span class="lineno"> 3745</span>        <span class="keywordflow">if</span>( !gmode-&gt;<a class="code hl_function" href="classitem.html#a26c025fd4909bd31c8e91ed87905507b">ammo_remaining</a>() ) {</div>
<div class="line"><a id="l03746" name="l03746"></a><span class="lineno"> 3746</span>            messages.push_back( <a class="code hl_function" href="string__formatter_8h.html#a8964099387da2f95396c67566bafce3d">string_format</a>( <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Your %s is empty!&quot;</span> ), gmode-&gt;<a class="code hl_function" href="classitem.html#a7e78e26dcf9b357cda769c3ca2938eda">tname</a>() ) );</div>
<div class="line"><a id="l03747" name="l03747"></a><span class="lineno"> 3747</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l03748" name="l03748"></a><span class="lineno"> 3748</span>            messages.push_back( <a class="code hl_function" href="string__formatter_8h.html#a8964099387da2f95396c67566bafce3d">string_format</a>( <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Your %s needs %i charges to fire!&quot;</span> ),</div>
<div class="line"><a id="l03749" name="l03749"></a><span class="lineno"> 3749</span>                                               gmode-&gt;<a class="code hl_function" href="classitem.html#a7e78e26dcf9b357cda769c3ca2938eda">tname</a>(), gmode-&gt;<a class="code hl_function" href="classitem.html#a7dc5d9ccf5638ae80cebe1864050fa26">ammo_required</a>() ) );</div>
<div class="line"><a id="l03750" name="l03750"></a><span class="lineno"> 3750</span>        }</div>
<div class="line"><a id="l03751" name="l03751"></a><span class="lineno"> 3751</span>        <a class="code hl_enumeration" href="namespacedetail_1_1digits.html#aad69d2373aa047bdd9e81494bf3da5ae">result</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l03752" name="l03752"></a><span class="lineno"> 3752</span>    }</div>
<div class="line"><a id="l03753" name="l03753"></a><span class="lineno"> 3753</span> </div>
<div class="line"><a id="l03754" name="l03754"></a><span class="lineno"> 3754</span>    <span class="keywordflow">if</span>( gmode-&gt;<a class="code hl_function" href="classitem.html#af6bd135500675d45eb9b79b196d9558e">get_gun_ups_drain</a>() &gt; 0 ) {</div>
<div class="line"><a id="l03755" name="l03755"></a><span class="lineno"> 3755</span>        <span class="keyword">const</span> <span class="keywordtype">int</span> ups_drain = gmode-&gt;<a class="code hl_function" href="classitem.html#af6bd135500675d45eb9b79b196d9558e">get_gun_ups_drain</a>();</div>
<div class="line"><a id="l03756" name="l03756"></a><span class="lineno"> 3756</span>        <span class="keyword">const</span> <span class="keywordtype">int</span> adv_ups_drain = std::max( 1, ups_drain * 3 / 5 );</div>
<div class="line"><a id="l03757" name="l03757"></a><span class="lineno"> 3757</span>        <span class="keywordtype">bool</span> is_mech_weapon = <span class="keyword">false</span>;</div>
<div class="line"><a id="l03758" name="l03758"></a><span class="lineno"> 3758</span>        <span class="keywordflow">if</span>( you.<a class="code hl_function" href="classCharacter.html#a67b51491c2529df09755e07bc633cc55">is_mounted</a>() ) {</div>
<div class="line"><a id="l03759" name="l03759"></a><span class="lineno"> 3759</span>            <a class="code hl_class" href="classmonster.html">monster</a> *mons = <a class="code hl_function" href="character_8cpp.html#a2fcb25d686f4a35fca374c6f71280311">get_player_character</a>().<a class="code hl_variable" href="classCharacter.html#ac3d46549b7cdaac1f98991167ad5f1b3">mounted_creature</a>.get();</div>
<div class="line"><a id="l03760" name="l03760"></a><span class="lineno"> 3760</span>            <span class="keywordflow">if</span>( !mons-&gt;<a class="code hl_variable" href="classmonster.html#aa30f973bf524ba275ada847f6118b048">type</a>-&gt;<a class="code hl_variable" href="structmtype.html#abe1e1f1cacb0be37406c667e226003c4">mech_weapon</a>.<a class="code hl_function" href="classstring__id.html#ac180a60056901aaf79f5c4b728a257bd">is_empty</a>() ) {</div>
<div class="line"><a id="l03761" name="l03761"></a><span class="lineno"> 3761</span>                is_mech_weapon = <span class="keyword">true</span>;</div>
<div class="line"><a id="l03762" name="l03762"></a><span class="lineno"> 3762</span>            }</div>
<div class="line"><a id="l03763" name="l03763"></a><span class="lineno"> 3763</span>        }</div>
<div class="line"><a id="l03764" name="l03764"></a><span class="lineno"> 3764</span>        <span class="keywordflow">if</span>( !is_mech_weapon ) {</div>
<div class="line"><a id="l03765" name="l03765"></a><span class="lineno"> 3765</span>            <span class="keywordflow">if</span>( !( you.<a class="code hl_function" href="classCharacter.html#a9bff3208a5e121c4e3a71b81b378e4e7">has_charges</a>( <a class="code hl_variable" href="ranged_8cpp.html#ae89306fd36cf36b57fe05dad0db3f71b">itype_UPS_off</a>, ups_drain ) ||</div>
<div class="line"><a id="l03766" name="l03766"></a><span class="lineno"> 3766</span>                   you.<a class="code hl_function" href="classCharacter.html#a9bff3208a5e121c4e3a71b81b378e4e7">has_charges</a>( <a class="code hl_variable" href="ranged_8cpp.html#a1c359a305b979b2e5fc87d15db51e903">itype_adv_UPS_off</a>, adv_ups_drain ) ||</div>
<div class="line"><a id="l03767" name="l03767"></a><span class="lineno"> 3767</span>                   ( you.<a class="code hl_function" href="classCharacter.html#af9c7419575e23d52745c94009929fafb">has_active_bionic</a>( <a class="code hl_variable" href="ranged_8cpp.html#ac48fadf8e0cc0bf9f6800029de9084d6">bio_ups</a> ) &amp;&amp;</div>
<div class="line"><a id="l03768" name="l03768"></a><span class="lineno"> 3768</span>                     you.<a class="code hl_function" href="classCharacter.html#add22510ff2fa20a662868b4dd86e030e">get_power_level</a>() &gt;= <a class="code hl_function" href="namespaceunits.html#ada24d52c1ffd0df8d52a363d013d3231">units::from_kilojoule</a>( ups_drain ) ) ) ) {</div>
<div class="line"><a id="l03769" name="l03769"></a><span class="lineno"> 3769</span>                messages.push_back( <a class="code hl_function" href="string__formatter_8h.html#a8964099387da2f95396c67566bafce3d">string_format</a>(</div>
<div class="line"><a id="l03770" name="l03770"></a><span class="lineno"> 3770</span>                                        <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;You need a UPS with at least %2$d charges or an advanced UPS with at least %3$d charges to fire the %1$s!&quot;</span> ),</div>
<div class="line"><a id="l03771" name="l03771"></a><span class="lineno"> 3771</span>                                        gmode-&gt;<a class="code hl_function" href="classitem.html#a7e78e26dcf9b357cda769c3ca2938eda">tname</a>(), ups_drain, adv_ups_drain ) );</div>
<div class="line"><a id="l03772" name="l03772"></a><span class="lineno"> 3772</span>                <a class="code hl_enumeration" href="namespacedetail_1_1digits.html#aad69d2373aa047bdd9e81494bf3da5ae">result</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l03773" name="l03773"></a><span class="lineno"> 3773</span>            }</div>
<div class="line"><a id="l03774" name="l03774"></a><span class="lineno"> 3774</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l03775" name="l03775"></a><span class="lineno"> 3775</span>            <span class="keywordflow">if</span>( !you.<a class="code hl_function" href="classCharacter.html#a9bff3208a5e121c4e3a71b81b378e4e7">has_charges</a>( <a class="code hl_variable" href="ranged_8cpp.html#a55a80a9bbab1925d5462d46d355c2b6e">itype_UPS</a>, ups_drain ) ) {</div>
<div class="line"><a id="l03776" name="l03776"></a><span class="lineno"> 3776</span>                messages.push_back( <a class="code hl_function" href="string__formatter_8h.html#a8964099387da2f95396c67566bafce3d">string_format</a>( <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Your mech has an empty battery, its %s will not fire.&quot;</span> ),</div>
<div class="line"><a id="l03777" name="l03777"></a><span class="lineno"> 3777</span>                                                   gmode-&gt;<a class="code hl_function" href="classitem.html#a7e78e26dcf9b357cda769c3ca2938eda">tname</a>() ) );</div>
<div class="line"><a id="l03778" name="l03778"></a><span class="lineno"> 3778</span>                <a class="code hl_enumeration" href="namespacedetail_1_1digits.html#aad69d2373aa047bdd9e81494bf3da5ae">result</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l03779" name="l03779"></a><span class="lineno"> 3779</span>            }</div>
<div class="line"><a id="l03780" name="l03780"></a><span class="lineno"> 3780</span>        }</div>
<div class="line"><a id="l03781" name="l03781"></a><span class="lineno"> 3781</span>    }</div>
<div class="line"><a id="l03782" name="l03782"></a><span class="lineno"> 3782</span> </div>
<div class="line"><a id="l03783" name="l03783"></a><span class="lineno"> 3783</span>    <span class="keywordflow">if</span>( gmode-&gt;<a class="code hl_function" href="classitem.html#aaa5aeb6f838927babb10ede535cf2a73">has_flag</a>( <a class="code hl_function" href="ranged_8cpp.html#a9a327f2be95a30526c2d1ab6a31f72b2">flag_MOUNTED_GUN</a> ) ) {</div>
<div class="line"><a id="l03784" name="l03784"></a><span class="lineno"> 3784</span> </div>
<div class="line"><a id="l03785" name="l03785"></a><span class="lineno"> 3785</span>        <span class="keywordtype">bool</span> mech_mount = <span class="keyword">false</span>;</div>
<div class="line"><a id="l03786" name="l03786"></a><span class="lineno"> 3786</span>        <span class="keywordflow">if</span>( you.<a class="code hl_function" href="classCharacter.html#a67b51491c2529df09755e07bc633cc55">is_mounted</a>() &amp;&amp; you.<a class="code hl_variable" href="classCharacter.html#ac3d46549b7cdaac1f98991167ad5f1b3">mounted_creature</a>-&gt;has_flag( <a class="code hl_enumvalue" href="mtype_8h.html#afa4c966d04d2ddb261a7cde725eca842a674d4fc8b69d5ad8a6a2154d471ba941">MF_RIDEABLE_MECH</a> ) ) {</div>
<div class="line"><a id="l03787" name="l03787"></a><span class="lineno"> 3787</span>            mech_mount = <span class="keyword">true</span>;</div>
<div class="line"><a id="l03788" name="l03788"></a><span class="lineno"> 3788</span>        }</div>
<div class="line"><a id="l03789" name="l03789"></a><span class="lineno"> 3789</span> </div>
<div class="line"><a id="l03790" name="l03790"></a><span class="lineno"> 3790</span>        <span class="keyword">const</span> <span class="keywordtype">bool</span> v_mountable = <span class="keyword">static_cast&lt;</span><span class="keywordtype">bool</span><span class="keyword">&gt;</span>( m.<a class="code hl_function" href="classmap.html#aa487d96256c3d35db7a1bf273156b64a">veh_at</a>( you.<a class="code hl_function" href="classCharacter.html#ad24859164517ed6e392e21df69527199">pos</a>() ).<a class="code hl_function" href="classoptional__vpart__position.html#a4c78451e42e97753079ecd2a54c7143d">part_with_feature</a>( <span class="stringliteral">&quot;MOUNTABLE&quot;</span>,</div>
<div class="line"><a id="l03791" name="l03791"></a><span class="lineno"> 3791</span>                                 <span class="keyword">true</span> ) );</div>
<div class="line"><a id="l03792" name="l03792"></a><span class="lineno"> 3792</span>        <span class="keywordtype">bool</span> t_mountable = m.<a class="code hl_function" href="classmap.html#a516c0764134cc86b57297811520395f7">has_flag_ter_or_furn</a>( <a class="code hl_function" href="ranged_8cpp.html#abca795246deac76d5cf0515c16bb75c8">flag_MOUNTABLE</a>, you.<a class="code hl_function" href="classCharacter.html#ad24859164517ed6e392e21df69527199">pos</a>() );</div>
<div class="line"><a id="l03793" name="l03793"></a><span class="lineno"> 3793</span>        <span class="keywordflow">if</span>( !mech_mount &amp;&amp; !t_mountable &amp;&amp; !v_mountable &amp;&amp; !( you.<a class="code hl_function" href="classCharacter.html#aa5ca0f6c4fb1c08bb93ece1c9746c368">get_size</a>() &gt; <a class="code hl_enumvalue" href="creature_8h.html#a94151e401c177b20ea9b8bcadf74f592aaef7580aead8b8a18bc50cb6c1f98b31">MS_MEDIUM</a> ) ) {</div>
<div class="line"><a id="l03794" name="l03794"></a><span class="lineno"> 3794</span>            messages.push_back( <a class="code hl_function" href="string__formatter_8h.html#a8964099387da2f95396c67566bafce3d">string_format</a>(</div>
<div class="line"><a id="l03795" name="l03795"></a><span class="lineno"> 3795</span>                                    <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;You must stand near acceptable terrain or furniture to fire the %s.  A table, a mound of dirt, a broken window, etc.&quot;</span> ),</div>
<div class="line"><a id="l03796" name="l03796"></a><span class="lineno"> 3796</span>                                    gmode-&gt;<a class="code hl_function" href="classitem.html#a7e78e26dcf9b357cda769c3ca2938eda">tname</a>() ) );</div>
<div class="line"><a id="l03797" name="l03797"></a><span class="lineno"> 3797</span>            <a class="code hl_enumeration" href="namespacedetail_1_1digits.html#aad69d2373aa047bdd9e81494bf3da5ae">result</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l03798" name="l03798"></a><span class="lineno"> 3798</span>        }</div>
<div class="line"><a id="l03799" name="l03799"></a><span class="lineno"> 3799</span>    }</div>
<div class="line"><a id="l03800" name="l03800"></a><span class="lineno"> 3800</span> </div>
<div class="line"><a id="l03801" name="l03801"></a><span class="lineno"> 3801</span>    <span class="keywordflow">return</span> <a class="code hl_enumeration" href="namespacedetail_1_1digits.html#aad69d2373aa047bdd9e81494bf3da5ae">result</a>;</div>
<div class="line"><a id="l03802" name="l03802"></a><span class="lineno"> 3802</span>}</div>
<div class="ttc" id="acharacter_8cpp_html_a2fcb25d686f4a35fca374c6f71280311"><div class="ttname"><a href="character_8cpp.html#a2fcb25d686f4a35fca374c6f71280311">get_player_character</a></div><div class="ttdeci">Character &amp; get_player_character()</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l00402">character.cpp:402</a></div></div>
<div class="ttc" id="aclassCharacter_html_a9bff3208a5e121c4e3a71b81b378e4e7"><div class="ttname"><a href="classCharacter.html#a9bff3208a5e121c4e3a71b81b378e4e7">Character::has_charges</a></div><div class="ttdeci">bool has_charges(const itype_id &amp;it, int quantity, const std::function&lt; bool(const item &amp;)&gt; &amp;filter=return_true&lt; item &gt;) const</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l09605">character.cpp:9605</a></div></div>
<div class="ttc" id="aclassCharacter_html_add22510ff2fa20a662868b4dd86e030e"><div class="ttname"><a href="classCharacter.html#add22510ff2fa20a662868b4dd86e030e">Character::get_power_level</a></div><div class="ttdeci">units::energy get_power_level() const</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l01904">character.cpp:1904</a></div></div>
<div class="ttc" id="aclassCharacter_html_af9c7419575e23d52745c94009929fafb"><div class="ttname"><a href="classCharacter.html#af9c7419575e23d52745c94009929fafb">Character::has_active_bionic</a></div><div class="ttdeci">bool has_active_bionic(const bionic_id &amp;b) const</div><div class="ttdoc">Returns true if the player has the entered bionic id and it is powered on.</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l01824">character.cpp:1824</a></div></div>
<div class="ttc" id="aclassitem_html_a8efcfdc21aadbc25a8cc95cf54685489"><div class="ttname"><a href="classitem.html#a8efcfdc21aadbc25a8cc95cf54685489">item::ammo_sufficient</a></div><div class="ttdeci">bool ammo_sufficient(int qty=1) const</div><div class="ttdoc">Check if sufficient ammo is loaded for given number of uses.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l07492">item.cpp:7492</a></div></div>
<div class="ttc" id="aclassmap_html_a516c0764134cc86b57297811520395f7"><div class="ttname"><a href="classmap.html#a516c0764134cc86b57297811520395f7">map::has_flag_ter_or_furn</a></div><div class="ttdeci">bool has_flag_ter_or_furn(const std::string &amp;flag, const tripoint &amp;p) const</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l02403">map.cpp:2403</a></div></div>
<div class="ttc" id="aclassmonster_html"><div class="ttname"><a href="classmonster.html">monster</a></div><div class="ttdef"><b>Definition:</b> <a href="monster_8h_source.html#l00084">monster.h:85</a></div></div>
<div class="ttc" id="aclassmonster_html_aa30f973bf524ba275ada847f6118b048"><div class="ttname"><a href="classmonster.html#aa30f973bf524ba275ada847f6118b048">monster::type</a></div><div class="ttdeci">const mtype * type</div><div class="ttdef"><b>Definition:</b> <a href="monster_8h_source.html#l00478">monster.h:478</a></div></div>
<div class="ttc" id="aclassoptional__vpart__position_html_a4c78451e42e97753079ecd2a54c7143d"><div class="ttname"><a href="classoptional__vpart__position.html#a4c78451e42e97753079ecd2a54c7143d">optional_vpart_position::part_with_feature</a></div><div class="ttdeci">std::optional&lt; vpart_reference &gt; part_with_feature(const std::string &amp;f, bool unbroken) const</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8cpp_source.html#l02482">vehicle.cpp:2482</a></div></div>
<div class="ttc" id="aclassstring__id_html_ac180a60056901aaf79f5c4b728a257bd"><div class="ttname"><a href="classstring__id.html#ac180a60056901aaf79f5c4b728a257bd">string_id::is_empty</a></div><div class="ttdeci">bool is_empty() const</div><div class="ttdoc">Returns whether this id is empty.</div><div class="ttdef"><b>Definition:</b> <a href="string__id_8h_source.html#l00298">string_id.h:298</a></div></div>
<div class="ttc" id="acreature_8h_html_a94151e401c177b20ea9b8bcadf74f592aaef7580aead8b8a18bc50cb6c1f98b31"><div class="ttname"><a href="creature_8h.html#a94151e401c177b20ea9b8bcadf74f592aaef7580aead8b8a18bc50cb6c1f98b31">MS_MEDIUM</a></div><div class="ttdeci">@ MS_MEDIUM</div><div class="ttdef"><b>Definition:</b> <a href="creature_8h_source.html#l00060">creature.h:60</a></div></div>
<div class="ttc" id="anamespaceunits_html_ada24d52c1ffd0df8d52a363d013d3231"><div class="ttname"><a href="namespaceunits.html#ada24d52c1ffd0df8d52a363d013d3231">units::from_kilojoule</a></div><div class="ttdeci">constexpr quantity&lt; value_type, energy_in_joule_tag &gt; from_kilojoule(const value_type v)</div><div class="ttdef"><b>Definition:</b> <a href="units__energy_8h_source.html#l00032">units_energy.h:32</a></div></div>
<div class="ttc" id="aranged_8cpp_html_a1c359a305b979b2e5fc87d15db51e903"><div class="ttname"><a href="ranged_8cpp.html#a1c359a305b979b2e5fc87d15db51e903">itype_adv_UPS_off</a></div><div class="ttdeci">static const itype_id itype_adv_UPS_off(&quot;adv_UPS_off&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_abca795246deac76d5cf0515c16bb75c8"><div class="ttname"><a href="ranged_8cpp.html#abca795246deac76d5cf0515c16bb75c8">flag_MOUNTABLE</a></div><div class="ttdeci">static const std::string flag_MOUNTABLE(&quot;MOUNTABLE&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_ac48fadf8e0cc0bf9f6800029de9084d6"><div class="ttname"><a href="ranged_8cpp.html#ac48fadf8e0cc0bf9f6800029de9084d6">bio_ups</a></div><div class="ttdeci">static const bionic_id bio_ups(&quot;bio_ups&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_ae89306fd36cf36b57fe05dad0db3f71b"><div class="ttname"><a href="ranged_8cpp.html#ae89306fd36cf36b57fe05dad0db3f71b">itype_UPS_off</a></div><div class="ttdeci">static const itype_id itype_UPS_off(&quot;UPS_off&quot;)</div></div>
<div class="ttc" id="astructmtype_html_abe1e1f1cacb0be37406c667e226003c4"><div class="ttname"><a href="structmtype.html#abe1e1f1cacb0be37406c667e226003c4">mtype::mech_weapon</a></div><div class="ttdeci">itype_id mech_weapon</div><div class="ttdoc">If this monster is a rideable mech with built-in weapons, this is the weapons id.</div><div class="ttdef"><b>Definition:</b> <a href="mtype_8h_source.html#l00368">mtype.h:368</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="translations_8h_source.html#l00116">_</a>, <a class="el" href="item_8cpp_source.html#l07399">item::ammo_remaining()</a>, <a class="el" href="item_8cpp_source.html#l07469">item::ammo_required()</a>, <a class="el" href="item_8cpp_source.html#l07492">item::ammo_sufficient()</a>, <a class="el" href="ranged_8cpp.html#ac48fadf8e0cc0bf9f6800029de9084d6">bio_ups</a>, <a class="el" href="ranged_8cpp.html#abca795246deac76d5cf0515c16bb75c8">flag_MOUNTABLE()</a>, <a class="el" href="ranged_8cpp.html#a9a327f2be95a30526c2d1ab6a31f72b2">flag_MOUNTED_GUN()</a>, <a class="el" href="ranged_8cpp.html#a30c9d25adcf2167a8bff0fe6ca21fdaf">flag_RELOAD_AND_SHOOT()</a>, <a class="el" href="units__energy_8h_source.html#l00032">units::from_kilojoule()</a>, <a class="el" href="item_8cpp_source.html#l09961">item::get_gun_ups_drain()</a>, <a class="el" href="character_8cpp_source.html#l00402">get_player_character()</a>, <a class="el" href="character_8cpp_source.html#l01904">Character::get_power_level()</a>, <a class="el" href="character_8cpp_source.html#l00575">Character::get_size()</a>, <a class="el" href="character_8cpp_source.html#l01824">Character::has_active_bionic()</a>, <a class="el" href="character_8cpp_source.html#l09605">Character::has_charges()</a>, <a class="el" href="item_8cpp_source.html#l05328">item::has_flag()</a>, <a class="el" href="map_8cpp_source.html#l02403">map::has_flag_ter_or_furn()</a>, <a class="el" href="string__id_8h_source.html#l00298">string_id&lt; T &gt;::is_empty()</a>, <a class="el" href="character_8cpp_source.html#l01082">Character::is_mounted()</a>, <a class="el" href="ranged_8cpp.html#a1c359a305b979b2e5fc87d15db51e903">itype_adv_UPS_off</a>, <a class="el" href="ranged_8cpp.html#a55a80a9bbab1925d5462d46d355c2b6e">itype_UPS</a>, <a class="el" href="ranged_8cpp.html#ae89306fd36cf36b57fe05dad0db3f71b">itype_UPS_off</a>, <a class="el" href="mtype_8h_source.html#l00368">mtype::mech_weapon</a>, <a class="el" href="mtype_8h_source.html#l00115">MF_RIDEABLE_MECH</a>, <a class="el" href="character_8h_source.html#l01617">Character::mounted_creature</a>, <a class="el" href="creature_8h_source.html#l00060">MS_MEDIUM</a>, <a class="el" href="vehicle_8cpp_source.html#l02482">optional_vpart_position::part_with_feature()</a>, <a class="el" href="character_8cpp_source.html#l00601">Character::pos()</a>, <a class="el" href="string__formatter_8h_source.html#l00430">string_format()</a>, <a class="el" href="item_8cpp_source.html#l04574">item::tname()</a>, <a class="el" href="monster_8h_source.html#l00478">monster::type</a>, and <a class="el" href="map_8cpp_source.html#l01073">map::veh_at()</a>.</p>

<p class="reference">Referenced by <a class="el" href="avatar__action_8cpp_source.html#l00631">avatar_action::can_fire_weapon()</a>, and <a class="el" href="ranged_8cpp_source.html#l02784">target_ui::update_status()</a>.</p>

</div>
</div>
<a id="abf8b46e1f1dae2e7a3d4ff75b9495026" name="abf8b46e1f1dae2e7a3d4ff75b9495026"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abf8b46e1f1dae2e7a3d4ff75b9495026">&#9670;&nbsp;</a></span>handle_gun_damage()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool ranged::handle_gun_damage </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classCharacter.html">Character</a> &amp;&#160;</td>
          <td class="paramname"><em>shooter</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classitem.html">item</a> &amp;&#160;</td>
          <td class="paramname"><em>it</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns true if a gun misfires, jams, or has other problems, else returns false. </p>

<p class="definition">Definition at line <a class="el" href="ranged_8cpp_source.html#l00600">600</a> of file <a class="el" href="ranged_8cpp_source.html">ranged.cpp</a>.</p>
<div class="fragment"><div class="line"><a id="l00601" name="l00601"></a><span class="lineno">  601</span>{</div>
<div class="line"><a id="l00602" name="l00602"></a><span class="lineno">  602</span>    <span class="comment">// Below item (maximum dirt possible) should be greater than or equal to dirt range in item_group.cpp. Also keep in mind that monster drops can have specific ranges and these should be below the max!</span></div>
<div class="line"><a id="l00603" name="l00603"></a><span class="lineno">  603</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> dirt_max_dbl = 10000;</div>
<div class="line"><a id="l00604" name="l00604"></a><span class="lineno">  604</span>    <span class="keywordflow">if</span>( !it.<a class="code hl_function" href="classitem.html#a2912b2e15a4eec07a5070fffbbd152e8">is_gun</a>() ) {</div>
<div class="line"><a id="l00605" name="l00605"></a><span class="lineno">  605</span>        <a class="code hl_define" href="debug_8h.html#a87e509562277a7ada3a75330d00cb445">debugmsg</a>( <span class="stringliteral">&quot;Tried to handle_gun_damage of a non-gun %s&quot;</span>, it.<a class="code hl_function" href="classitem.html#a7e78e26dcf9b357cda769c3ca2938eda">tname</a>() );</div>
<div class="line"><a id="l00606" name="l00606"></a><span class="lineno">  606</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00607" name="l00607"></a><span class="lineno">  607</span>    }</div>
<div class="line"><a id="l00608" name="l00608"></a><span class="lineno">  608</span> </div>
<div class="line"><a id="l00609" name="l00609"></a><span class="lineno">  609</span>    <span class="keywordtype">int</span> dirt = it.<a class="code hl_function" href="classitem.html#a0b12108a604ac9d940716bb8f1368cf5">get_var</a>( <span class="stringliteral">&quot;dirt&quot;</span>, 0 );</div>
<div class="line"><a id="l00610" name="l00610"></a><span class="lineno">  610</span>    <span class="keywordtype">int</span> dirtadder = 0;</div>
<div class="line"><a id="l00611" name="l00611"></a><span class="lineno">  611</span>    <span class="keywordtype">double</span> dirt_dbl = <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>( dirt );</div>
<div class="line"><a id="l00612" name="l00612"></a><span class="lineno">  612</span>    <span class="keywordflow">if</span>( it.<a class="code hl_variable" href="classitem.html#a12a6fa8aac1350f3ca4362a1bdccd9b0">faults</a>.count( <a class="code hl_variable" href="ranged_8cpp.html#ace607007c38b8d55a601963b24f89e7e">fault_gun_chamber_spent</a> ) ) {</div>
<div class="line"><a id="l00613" name="l00613"></a><span class="lineno">  613</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00614" name="l00614"></a><span class="lineno">  614</span>    }</div>
<div class="line"><a id="l00615" name="l00615"></a><span class="lineno">  615</span> </div>
<div class="line"><a id="l00616" name="l00616"></a><span class="lineno">  616</span>    <span class="keyword">const</span> <span class="keyword">auto</span> &amp;curammo_effects = it.<a class="code hl_function" href="classitem.html#a75fa277bb39c1d2922137986c67d48fb">ammo_effects</a>();</div>
<div class="line"><a id="l00617" name="l00617"></a><span class="lineno">  617</span>    <span class="keyword">const</span> <a class="code hl_struct" href="structislot__gun.html">islot_gun</a> &amp;firing = *it.<a class="code hl_variable" href="classitem.html#ac1d2c4c33b8a499812f3437cb2fad742">type</a>-&gt;<a class="code hl_variable" href="structitype.html#a623ec8243b1e599086fa3a23c3179370">gun</a>;</div>
<div class="line"><a id="l00618" name="l00618"></a><span class="lineno">  618</span>    <span class="comment">// misfire chance based on dirt accumulation. Formula is designed to make chance of jam highly unlikely at low dirt levels, but levels increase geometrically as the dirt level reaches max (10,000). The number used is just a figure I found reasonable after plugging the number into excel and changing it until the probability made sense at high, medium, and low levels of dirt.</span></div>
<div class="line"><a id="l00619" name="l00619"></a><span class="lineno">  619</span>    <span class="keywordflow">if</span>( !it.<a class="code hl_function" href="classitem.html#aaa5aeb6f838927babb10ede535cf2a73">has_flag</a>( <a class="code hl_function" href="ranged_8cpp.html#ab2dd3d8bd3db68ab02a94d2d26d2fc5a">flag_NEVER_JAMS</a> ) &amp;&amp;</div>
<div class="line"><a id="l00620" name="l00620"></a><span class="lineno">  620</span>        <a class="code hl_function" href="calendar_8cpp.html#a359120c15f92d54a49fec9de7bcb571f">x_in_y</a>( dirt_dbl * dirt_dbl * dirt_dbl,</div>
<div class="line"><a id="l00621" name="l00621"></a><span class="lineno">  621</span>                1000000000000.0 ) ) {</div>
<div class="line"><a id="l00622" name="l00622"></a><span class="lineno">  622</span>        shooter.<a class="code hl_function" href="classCreature.html#a7cf71d2bd6c350f2ceda3f1d64046e63">add_msg_player_or_npc</a>(</div>
<div class="line"><a id="l00623" name="l00623"></a><span class="lineno">  623</span>            <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Your %s misfires with a muffled click!&quot;</span> ),</div>
<div class="line"><a id="l00624" name="l00624"></a><span class="lineno">  624</span>            <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;&lt;npcname&gt;&#39;s %s misfires with a muffled click!&quot;</span> ),</div>
<div class="line"><a id="l00625" name="l00625"></a><span class="lineno">  625</span>            it.<a class="code hl_function" href="classitem.html#a7e78e26dcf9b357cda769c3ca2938eda">tname</a>() );</div>
<div class="line"><a id="l00626" name="l00626"></a><span class="lineno">  626</span>        <span class="comment">// at high dirt levels the chance to misfire gets to significant levels. 10,000 is max and 7800 is quite high so above that the player gets some relief in the form of exchanging time for some dirt reduction. Basically jiggling the parts loose to remove some dirt and get a few more shots out.</span></div>
<div class="line"><a id="l00627" name="l00627"></a><span class="lineno">  627</span>        <span class="keywordflow">if</span>( dirt_dbl &gt;</div>
<div class="line"><a id="l00628" name="l00628"></a><span class="lineno">  628</span>            7800 ) {</div>
<div class="line"><a id="l00629" name="l00629"></a><span class="lineno">  629</span>            shooter.<a class="code hl_function" href="classCreature.html#a7cf71d2bd6c350f2ceda3f1d64046e63">add_msg_player_or_npc</a>(</div>
<div class="line"><a id="l00630" name="l00630"></a><span class="lineno">  630</span>                <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Perhaps taking the ammo out of your %s and reloading will help.&quot;</span> ),</div>
<div class="line"><a id="l00631" name="l00631"></a><span class="lineno">  631</span>                <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Perhaps taking the ammo out of &lt;npcname&gt;&#39;s %s and reloading will help.&quot;</span> ),</div>
<div class="line"><a id="l00632" name="l00632"></a><span class="lineno">  632</span>                it.<a class="code hl_function" href="classitem.html#a7e78e26dcf9b357cda769c3ca2938eda">tname</a>() );</div>
<div class="line"><a id="l00633" name="l00633"></a><span class="lineno">  633</span>        }</div>
<div class="line"><a id="l00634" name="l00634"></a><span class="lineno">  634</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00635" name="l00635"></a><span class="lineno">  635</span>    }</div>
<div class="line"><a id="l00636" name="l00636"></a><span class="lineno">  636</span> </div>
<div class="line"><a id="l00637" name="l00637"></a><span class="lineno">  637</span>    <span class="comment">// Here we check if we&#39;re underwater and whether we should misfire.</span></div>
<div class="line"><a id="l00638" name="l00638"></a><span class="lineno">  638</span>    <span class="comment">// As a result this causes no damage to the firearm, note that some guns are waterproof</span></div>
<div class="line"><a id="l00639" name="l00639"></a><span class="lineno">  639</span>    <span class="comment">// and so are immune to this effect, note also that WATERPROOF_GUN status does not</span></div>
<div class="line"><a id="l00640" name="l00640"></a><span class="lineno">  640</span>    <span class="comment">// mean the gun will actually be accurate underwater.</span></div>
<div class="line"><a id="l00641" name="l00641"></a><span class="lineno">  641</span>    <span class="keywordtype">int</span> effective_durability = firing.<a class="code hl_variable" href="structislot__gun.html#a40255e8d661dc99204ed70dbe6013a02">durability</a>;</div>
<div class="line"><a id="l00642" name="l00642"></a><span class="lineno">  642</span>    <span class="keywordflow">if</span>( shooter.<a class="code hl_function" href="classCreature.html#a5a2346f549de9c87e8f2afeec1e71366">is_underwater</a>() &amp;&amp; !it.<a class="code hl_function" href="classitem.html#aaa5aeb6f838927babb10ede535cf2a73">has_flag</a>( <span class="stringliteral">&quot;WATERPROOF_GUN&quot;</span> ) &amp;&amp;</div>
<div class="line"><a id="l00643" name="l00643"></a><span class="lineno">  643</span>        <a class="code hl_function" href="rng_8cpp.html#aad28bdad07401a34ecf9912708f8b750">one_in</a>( effective_durability ) ) {</div>
<div class="line"><a id="l00644" name="l00644"></a><span class="lineno">  644</span>        shooter.<a class="code hl_function" href="classCreature.html#a7cf71d2bd6c350f2ceda3f1d64046e63">add_msg_player_or_npc</a>( <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Your %s misfires with a wet click!&quot;</span> ),</div>
<div class="line"><a id="l00645" name="l00645"></a><span class="lineno">  645</span>                                       <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;&lt;npcname&gt;&#39;s %s misfires with a wet click!&quot;</span> ),</div>
<div class="line"><a id="l00646" name="l00646"></a><span class="lineno">  646</span>                                       it.<a class="code hl_function" href="classitem.html#a7e78e26dcf9b357cda769c3ca2938eda">tname</a>() );</div>
<div class="line"><a id="l00647" name="l00647"></a><span class="lineno">  647</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00648" name="l00648"></a><span class="lineno">  648</span>        <span class="comment">// Here we check for a chance for the weapon to suffer a mechanical malfunction.</span></div>
<div class="line"><a id="l00649" name="l00649"></a><span class="lineno">  649</span>        <span class="comment">// Note that some weapons never jam up &#39;NEVER_JAMS&#39; and thus are immune to this</span></div>
<div class="line"><a id="l00650" name="l00650"></a><span class="lineno">  650</span>        <span class="comment">// effect as current guns have a durability between 5 and 9 this results in</span></div>
<div class="line"><a id="l00651" name="l00651"></a><span class="lineno">  651</span>        <span class="comment">// a chance of mechanical failure between 1/(64*3) and 1/(1024*3) on any given shot.</span></div>
<div class="line"><a id="l00652" name="l00652"></a><span class="lineno">  652</span>        <span class="comment">// the malfunction can&#39;t cause damage</span></div>
<div class="line"><a id="l00653" name="l00653"></a><span class="lineno">  653</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code hl_function" href="rng_8cpp.html#aad28bdad07401a34ecf9912708f8b750">one_in</a>( ( 2 &lt;&lt; effective_durability ) * 3 ) &amp;&amp; !it.<a class="code hl_function" href="classitem.html#aaa5aeb6f838927babb10ede535cf2a73">has_flag</a>( <a class="code hl_function" href="ranged_8cpp.html#ab2dd3d8bd3db68ab02a94d2d26d2fc5a">flag_NEVER_JAMS</a> ) ) {</div>
<div class="line"><a id="l00654" name="l00654"></a><span class="lineno">  654</span>        shooter.<a class="code hl_function" href="classCreature.html#a7cf71d2bd6c350f2ceda3f1d64046e63">add_msg_player_or_npc</a>( <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Your %s malfunctions!&quot;</span> ),</div>
<div class="line"><a id="l00655" name="l00655"></a><span class="lineno">  655</span>                                       <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;&lt;npcname&gt;&#39;s %s malfunctions!&quot;</span> ),</div>
<div class="line"><a id="l00656" name="l00656"></a><span class="lineno">  656</span>                                       it.<a class="code hl_function" href="classitem.html#a7e78e26dcf9b357cda769c3ca2938eda">tname</a>() );</div>
<div class="line"><a id="l00657" name="l00657"></a><span class="lineno">  657</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00658" name="l00658"></a><span class="lineno">  658</span>        <span class="comment">// Here we check for a chance for the weapon to suffer a misfire due to</span></div>
<div class="line"><a id="l00659" name="l00659"></a><span class="lineno">  659</span>        <span class="comment">// using player-made &#39;RECYCLED&#39; bullets. Note that not all forms of</span></div>
<div class="line"><a id="l00660" name="l00660"></a><span class="lineno">  660</span>        <span class="comment">// player-made ammunition have this effect.</span></div>
<div class="line"><a id="l00661" name="l00661"></a><span class="lineno">  661</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( curammo_effects.count( <a class="code hl_variable" href="ranged_8cpp.html#afa18fa10e4bc2e18f3911cebb559b7bd">ammo_effect_RECYCLED</a> ) &amp;&amp; <a class="code hl_function" href="rng_8cpp.html#aad28bdad07401a34ecf9912708f8b750">one_in</a>( 256 ) ) {</div>
<div class="line"><a id="l00662" name="l00662"></a><span class="lineno">  662</span>        shooter.<a class="code hl_function" href="classCreature.html#a7cf71d2bd6c350f2ceda3f1d64046e63">add_msg_player_or_npc</a>( <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Your %s misfires with a muffled click!&quot;</span> ),</div>
<div class="line"><a id="l00663" name="l00663"></a><span class="lineno">  663</span>                                       <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;&lt;npcname&gt;&#39;s %s misfires with a muffled click!&quot;</span> ),</div>
<div class="line"><a id="l00664" name="l00664"></a><span class="lineno">  664</span>                                       it.<a class="code hl_function" href="classitem.html#a7e78e26dcf9b357cda769c3ca2938eda">tname</a>() );</div>
<div class="line"><a id="l00665" name="l00665"></a><span class="lineno">  665</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00666" name="l00666"></a><span class="lineno">  666</span>        <span class="comment">// Here we check for a chance for attached mods to get damaged if they are flagged as &#39;CONSUMABLE&#39;.</span></div>
<div class="line"><a id="l00667" name="l00667"></a><span class="lineno">  667</span>        <span class="comment">// This is mostly for crappy handmade expedient stuff  or things that rarely receive damage during normal usage.</span></div>
<div class="line"><a id="l00668" name="l00668"></a><span class="lineno">  668</span>        <span class="comment">// Default chance is 1/10000 unless set via json, damage is proportional to caliber(see below).</span></div>
<div class="line"><a id="l00669" name="l00669"></a><span class="lineno">  669</span>        <span class="comment">// Can be toned down with &#39;consume_divisor.&#39;</span></div>
<div class="line"><a id="l00670" name="l00670"></a><span class="lineno">  670</span> </div>
<div class="line"><a id="l00671" name="l00671"></a><span class="lineno">  671</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( it.<a class="code hl_function" href="classitem.html#aaa5aeb6f838927babb10ede535cf2a73">has_flag</a>( <a class="code hl_function" href="ranged_8cpp.html#a916c022e69240915ee6678d0170882d3">flag_CONSUMABLE</a> ) &amp;&amp; !curammo_effects.count( <a class="code hl_variable" href="ranged_8cpp.html#a4823a8b924c5e1c83c8e1e1a316e1ae7">ammo_effect_LASER</a> ) &amp;&amp;</div>
<div class="line"><a id="l00672" name="l00672"></a><span class="lineno">  672</span>               !curammo_effects.count( <a class="code hl_variable" href="ranged_8cpp.html#aaf09bb55e60a45b1eb81e989d0758e93">ammo_effect_PLASMA</a> ) &amp;&amp; !curammo_effects.count( <a class="code hl_variable" href="ranged_8cpp.html#a02a98acfc0759dc42a3683ec82f936a9">ammo_effect_EMP</a> ) ) {</div>
<div class="line"><a id="l00673" name="l00673"></a><span class="lineno">  673</span>        <span class="keywordtype">int</span> uncork = ( ( 10 * it.<a class="code hl_function" href="classitem.html#a4adcc4a3a5f5fb20a4d245d79109640a">ammo_data</a>()-&gt;<a class="code hl_variable" href="structitype.html#a7cb80d77696cefb42ac6e75756b47e60">ammo</a>-&gt;loudness )</div>
<div class="line"><a id="l00674" name="l00674"></a><span class="lineno">  674</span>                       + ( it.<a class="code hl_function" href="classitem.html#a4adcc4a3a5f5fb20a4d245d79109640a">ammo_data</a>()-&gt;<a class="code hl_variable" href="structitype.html#a7cb80d77696cefb42ac6e75756b47e60">ammo</a>-&gt;recoil / 2 ) ) / 100;</div>
<div class="line"><a id="l00675" name="l00675"></a><span class="lineno">  675</span>        uncork = std::pow( uncork, 3 ) * 6.5;</div>
<div class="line"><a id="l00676" name="l00676"></a><span class="lineno">  676</span>        <span class="keywordflow">for</span>( <span class="keyword">auto</span> <a class="code hl_enumeration" href="namespaceenchant__vals.html#acd6a6ebb27f9ecb82b3bce1d3aef2998">mod</a> : it.<a class="code hl_function" href="classitem.html#acd78321ba4d5c09d39f1d58d20b68484">gunmods</a>() ) {</div>
<div class="line"><a id="l00677" name="l00677"></a><span class="lineno">  677</span>            <span class="keywordflow">if</span>( <a class="code hl_enumeration" href="namespaceenchant__vals.html#acd6a6ebb27f9ecb82b3bce1d3aef2998">mod</a>-&gt;has_flag( <a class="code hl_function" href="ranged_8cpp.html#a916c022e69240915ee6678d0170882d3">flag_CONSUMABLE</a> ) ) {</div>
<div class="line"><a id="l00678" name="l00678"></a><span class="lineno">  678</span>                <span class="keywordtype">int</span> dmgamt = uncork / <a class="code hl_enumeration" href="namespaceenchant__vals.html#acd6a6ebb27f9ecb82b3bce1d3aef2998">mod</a>-&gt;type-&gt;gunmod-&gt;consume_divisor;</div>
<div class="line"><a id="l00679" name="l00679"></a><span class="lineno">  679</span>                <span class="keywordtype">int</span> modconsume = <a class="code hl_enumeration" href="namespaceenchant__vals.html#acd6a6ebb27f9ecb82b3bce1d3aef2998">mod</a>-&gt;type-&gt;gunmod-&gt;consume_chance;</div>
<div class="line"><a id="l00680" name="l00680"></a><span class="lineno">  680</span>                <span class="keywordtype">int</span> initstate = it.<a class="code hl_function" href="classitem.html#ae8a58c6fe3c80cded11d6f3ccfa548a3">damage</a>();</div>
<div class="line"><a id="l00681" name="l00681"></a><span class="lineno">  681</span>                <span class="comment">// fuzz damage if it&#39;s small</span></div>
<div class="line"><a id="l00682" name="l00682"></a><span class="lineno">  682</span>                <span class="keywordflow">if</span>( dmgamt &lt; 1000 ) {</div>
<div class="line"><a id="l00683" name="l00683"></a><span class="lineno">  683</span>                    dmgamt = <a class="code hl_function" href="artifact_8cpp.html#a70800e95389f34dd34186fafaea2a840">rng</a>( dmgamt, dmgamt + 200 );</div>
<div class="line"><a id="l00684" name="l00684"></a><span class="lineno">  684</span>                    <span class="comment">// ignore damage if inconsequential.</span></div>
<div class="line"><a id="l00685" name="l00685"></a><span class="lineno">  685</span>                }</div>
<div class="line"><a id="l00686" name="l00686"></a><span class="lineno">  686</span>                <span class="keywordflow">if</span>( dmgamt &lt; 800 ) {</div>
<div class="line"><a id="l00687" name="l00687"></a><span class="lineno">  687</span>                    dmgamt = 0;</div>
<div class="line"><a id="l00688" name="l00688"></a><span class="lineno">  688</span>                }</div>
<div class="line"><a id="l00689" name="l00689"></a><span class="lineno">  689</span>                <span class="keywordflow">if</span>( <a class="code hl_function" href="rng_8cpp.html#aad28bdad07401a34ecf9912708f8b750">one_in</a>( modconsume ) ) {</div>
<div class="line"><a id="l00690" name="l00690"></a><span class="lineno">  690</span>                    <span class="keywordflow">if</span>( <a class="code hl_enumeration" href="namespaceenchant__vals.html#acd6a6ebb27f9ecb82b3bce1d3aef2998">mod</a>-&gt;mod_damage( dmgamt ) ) {</div>
<div class="line"><a id="l00691" name="l00691"></a><span class="lineno">  691</span>                        shooter.<a class="code hl_function" href="classCreature.html#a7cf71d2bd6c350f2ceda3f1d64046e63">add_msg_player_or_npc</a>( <a class="code hl_enumvalue" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea72e7b82d57a6df0d4263c2043139b1b1">m_bad</a>, <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Your attached %s is destroyed by your shot!&quot;</span> ),</div>
<div class="line"><a id="l00692" name="l00692"></a><span class="lineno">  692</span>                                                       <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;&lt;npcname&gt;&#39;s attached %s is destroyed by their shot!&quot;</span> ),</div>
<div class="line"><a id="l00693" name="l00693"></a><span class="lineno">  693</span>                                                       <a class="code hl_enumeration" href="namespaceenchant__vals.html#acd6a6ebb27f9ecb82b3bce1d3aef2998">mod</a>-&gt;tname() );</div>
<div class="line"><a id="l00694" name="l00694"></a><span class="lineno">  694</span>                        shooter.<a class="code hl_function" href="classCharacter.html#a35f89e2e6eb1144b623be5281f4f221b">i_rem</a>( <a class="code hl_enumeration" href="namespaceenchant__vals.html#acd6a6ebb27f9ecb82b3bce1d3aef2998">mod</a> );</div>
<div class="line"><a id="l00695" name="l00695"></a><span class="lineno">  695</span>                    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( it.<a class="code hl_function" href="classitem.html#ae8a58c6fe3c80cded11d6f3ccfa548a3">damage</a>() &gt; initstate ) {</div>
<div class="line"><a id="l00696" name="l00696"></a><span class="lineno">  696</span>                        shooter.<a class="code hl_function" href="classCreature.html#a7cf71d2bd6c350f2ceda3f1d64046e63">add_msg_player_or_npc</a>( <a class="code hl_enumvalue" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea72e7b82d57a6df0d4263c2043139b1b1">m_bad</a>, <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Your attached %s is damaged by your shot!&quot;</span> ),</div>
<div class="line"><a id="l00697" name="l00697"></a><span class="lineno">  697</span>                                                       <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;&lt;npcname&gt;&#39;s %s is damaged by their shot!&quot;</span> ),</div>
<div class="line"><a id="l00698" name="l00698"></a><span class="lineno">  698</span>                                                       <a class="code hl_enumeration" href="namespaceenchant__vals.html#acd6a6ebb27f9ecb82b3bce1d3aef2998">mod</a>-&gt;tname() );</div>
<div class="line"><a id="l00699" name="l00699"></a><span class="lineno">  699</span>                    }</div>
<div class="line"><a id="l00700" name="l00700"></a><span class="lineno">  700</span>                }</div>
<div class="line"><a id="l00701" name="l00701"></a><span class="lineno">  701</span>            }</div>
<div class="line"><a id="l00702" name="l00702"></a><span class="lineno">  702</span>        }</div>
<div class="line"><a id="l00703" name="l00703"></a><span class="lineno">  703</span>    }</div>
<div class="line"><a id="l00704" name="l00704"></a><span class="lineno">  704</span>    <span class="keywordflow">if</span>( it.<a class="code hl_function" href="classitem.html#a45bcd33992b7d26eb4ae9f76a16b58fa">has_fault</a>( <a class="code hl_variable" href="ranged_8cpp.html#ad73ddd0cc91027278ca5627eaa4ef206">fault_gun_unlubricated</a> ) &amp;&amp;</div>
<div class="line"><a id="l00705" name="l00705"></a><span class="lineno">  705</span>        <a class="code hl_function" href="calendar_8cpp.html#a359120c15f92d54a49fec9de7bcb571f">x_in_y</a>( dirt_dbl, dirt_max_dbl ) ) {</div>
<div class="line"><a id="l00706" name="l00706"></a><span class="lineno">  706</span>        shooter.<a class="code hl_function" href="classCreature.html#a7cf71d2bd6c350f2ceda3f1d64046e63">add_msg_player_or_npc</a>( <a class="code hl_enumvalue" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea72e7b82d57a6df0d4263c2043139b1b1">m_bad</a>, <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Your %s emits a grimace-inducing screech!&quot;</span> ),</div>
<div class="line"><a id="l00707" name="l00707"></a><span class="lineno">  707</span>                                       <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;&lt;npcname&gt;&#39;s %s emits a grimace-inducing screech!&quot;</span> ),</div>
<div class="line"><a id="l00708" name="l00708"></a><span class="lineno">  708</span>                                       it.<a class="code hl_function" href="classitem.html#a7e78e26dcf9b357cda769c3ca2938eda">tname</a>() );</div>
<div class="line"><a id="l00709" name="l00709"></a><span class="lineno">  709</span>        it.<a class="code hl_function" href="classitem.html#aca60af3c295738c2c1fddf0fd669f9a1">inc_damage</a>();</div>
<div class="line"><a id="l00710" name="l00710"></a><span class="lineno">  710</span>    }</div>
<div class="line"><a id="l00711" name="l00711"></a><span class="lineno">  711</span>    <span class="keywordflow">if</span>( ( ( !curammo_effects.count( <a class="code hl_variable" href="ranged_8cpp.html#ab97e95eba84f451228755a351c0476f7">ammo_effect_NON_FOULING</a> ) &amp;&amp; !it.<a class="code hl_function" href="classitem.html#aaa5aeb6f838927babb10ede535cf2a73">has_flag</a>( <a class="code hl_function" href="ranged_8cpp.html#aa125c6da24f14c1bec090943b0174e58">flag_NON_FOULING</a> ) ) ||</div>
<div class="line"><a id="l00712" name="l00712"></a><span class="lineno">  712</span>          ( it.<a class="code hl_function" href="classitem.html#a45bcd33992b7d26eb4ae9f76a16b58fa">has_fault</a>( <a class="code hl_variable" href="ranged_8cpp.html#ad73ddd0cc91027278ca5627eaa4ef206">fault_gun_unlubricated</a> ) ) ) &amp;&amp;</div>
<div class="line"><a id="l00713" name="l00713"></a><span class="lineno">  713</span>        !it.<a class="code hl_function" href="classitem.html#aaa5aeb6f838927babb10ede535cf2a73">has_flag</a>( <a class="code hl_function" href="ranged_8cpp.html#ad23a05e76b668009068f0e453c33692b">flag_PRIMITIVE_RANGED_WEAPON</a> ) ) {</div>
<div class="line"><a id="l00714" name="l00714"></a><span class="lineno">  714</span>        <span class="keywordflow">if</span>( curammo_effects.count( <a class="code hl_variable" href="ranged_8cpp.html#a680b9ce8c9824607142f83b2260dd3ef">ammo_effect_BLACKPOWDER</a> ) ||</div>
<div class="line"><a id="l00715" name="l00715"></a><span class="lineno">  715</span>            it.<a class="code hl_function" href="classitem.html#a45bcd33992b7d26eb4ae9f76a16b58fa">has_fault</a>( <a class="code hl_variable" href="ranged_8cpp.html#ad73ddd0cc91027278ca5627eaa4ef206">fault_gun_unlubricated</a> ) ) {</div>
<div class="line"><a id="l00716" name="l00716"></a><span class="lineno">  716</span>            <span class="keywordflow">if</span>( ( ( it.<a class="code hl_function" href="classitem.html#a4adcc4a3a5f5fb20a4d245d79109640a">ammo_data</a>()-&gt;<a class="code hl_variable" href="structitype.html#a7cb80d77696cefb42ac6e75756b47e60">ammo</a>-&gt;recoil &lt; firing.<a class="code hl_variable" href="structislot__gun.html#a68eca15622f086d544820aabcb2a865a">min_cycle_recoil</a> ) ||</div>
<div class="line"><a id="l00717" name="l00717"></a><span class="lineno">  717</span>                  ( it.<a class="code hl_function" href="classitem.html#a45bcd33992b7d26eb4ae9f76a16b58fa">has_fault</a>( <a class="code hl_variable" href="ranged_8cpp.html#ad73ddd0cc91027278ca5627eaa4ef206">fault_gun_unlubricated</a> ) &amp;&amp; <a class="code hl_function" href="rng_8cpp.html#aad28bdad07401a34ecf9912708f8b750">one_in</a>( 16 ) ) ) &amp;&amp;</div>
<div class="line"><a id="l00718" name="l00718"></a><span class="lineno">  718</span>                it.<a class="code hl_function" href="classitem.html#adaaa3ece39eb40637371659dad8550e3">faults_potential</a>().count( <a class="code hl_variable" href="ranged_8cpp.html#ace607007c38b8d55a601963b24f89e7e">fault_gun_chamber_spent</a> ) ) {</div>
<div class="line"><a id="l00719" name="l00719"></a><span class="lineno">  719</span>                shooter.<a class="code hl_function" href="classCreature.html#a7cf71d2bd6c350f2ceda3f1d64046e63">add_msg_player_or_npc</a>( <a class="code hl_enumvalue" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea72e7b82d57a6df0d4263c2043139b1b1">m_bad</a>, <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Your %s fails to cycle!&quot;</span> ),</div>
<div class="line"><a id="l00720" name="l00720"></a><span class="lineno">  720</span>                                               <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;&lt;npcname&gt;&#39;s %s fails to cycle!&quot;</span> ),</div>
<div class="line"><a id="l00721" name="l00721"></a><span class="lineno">  721</span>                                               it.<a class="code hl_function" href="classitem.html#a7e78e26dcf9b357cda769c3ca2938eda">tname</a>() );</div>
<div class="line"><a id="l00722" name="l00722"></a><span class="lineno">  722</span>                it.<a class="code hl_variable" href="classitem.html#a12a6fa8aac1350f3ca4362a1bdccd9b0">faults</a>.insert( <a class="code hl_variable" href="ranged_8cpp.html#ace607007c38b8d55a601963b24f89e7e">fault_gun_chamber_spent</a> );</div>
<div class="line"><a id="l00723" name="l00723"></a><span class="lineno">  723</span>                <span class="comment">// Don&#39;t return false in this case; this shot happens, follow-up ones won&#39;t.</span></div>
<div class="line"><a id="l00724" name="l00724"></a><span class="lineno">  724</span>            }</div>
<div class="line"><a id="l00725" name="l00725"></a><span class="lineno">  725</span>        }</div>
<div class="line"><a id="l00726" name="l00726"></a><span class="lineno">  726</span>        <span class="comment">// These are the dirtying/fouling mechanics</span></div>
<div class="line"><a id="l00727" name="l00727"></a><span class="lineno">  727</span>        <span class="keywordflow">if</span>( !curammo_effects.count( <a class="code hl_variable" href="ranged_8cpp.html#ab97e95eba84f451228755a351c0476f7">ammo_effect_NON_FOULING</a> ) &amp;&amp; !it.<a class="code hl_function" href="classitem.html#aaa5aeb6f838927babb10ede535cf2a73">has_flag</a>( <a class="code hl_function" href="ranged_8cpp.html#aa125c6da24f14c1bec090943b0174e58">flag_NON_FOULING</a> ) ) {</div>
<div class="line"><a id="l00728" name="l00728"></a><span class="lineno">  728</span>            <span class="keywordflow">if</span>( dirt &lt; <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>( dirt_max_dbl ) ) {</div>
<div class="line"><a id="l00729" name="l00729"></a><span class="lineno">  729</span>                dirtadder = curammo_effects.count( <a class="code hl_variable" href="ranged_8cpp.html#a680b9ce8c9824607142f83b2260dd3ef">ammo_effect_BLACKPOWDER</a> ) * ( 200 -</div>
<div class="line"><a id="l00730" name="l00730"></a><span class="lineno">  730</span>                            ( firing.<a class="code hl_variable" href="structislot__gun.html#a014b797e92e543ea47be93a1d6771a90">blackpowder_tolerance</a> *</div>
<div class="line"><a id="l00731" name="l00731"></a><span class="lineno">  731</span>                              2 ) );</div>
<div class="line"><a id="l00732" name="l00732"></a><span class="lineno">  732</span>                <span class="comment">// dirtadder is the dirt-increasing number for shots fired with gunpowder-based ammo. Usually dirt level increases by 1, unless it&#39;s blackpowder, in which case it increases by a higher number, but there is a reduction for blackpowder resistance of a weapon.</span></div>
<div class="line"><a id="l00733" name="l00733"></a><span class="lineno">  733</span>                <span class="keywordflow">if</span>( dirtadder &lt; 0 ) {</div>
<div class="line"><a id="l00734" name="l00734"></a><span class="lineno">  734</span>                    dirtadder = 0;</div>
<div class="line"><a id="l00735" name="l00735"></a><span class="lineno">  735</span>                }</div>
<div class="line"><a id="l00736" name="l00736"></a><span class="lineno">  736</span>                <span class="comment">// in addition to increasing dirt level faster, regular gunpowder fouling is also capped at 7,150, not 10,000. So firing with regular gunpowder can never make the gun quite as bad as firing it with black gunpowder. At 7,150 the chance to jam is significantly lower (though still significant) than it is at 10,000, the absolute cap.</span></div>
<div class="line"><a id="l00737" name="l00737"></a><span class="lineno">  737</span>                <span class="keywordflow">if</span>( curammo_effects.count( <a class="code hl_variable" href="ranged_8cpp.html#a680b9ce8c9824607142f83b2260dd3ef">ammo_effect_BLACKPOWDER</a> ) ||</div>
<div class="line"><a id="l00738" name="l00738"></a><span class="lineno">  738</span>                    dirt &lt; 7150 ) {</div>
<div class="line"><a id="l00739" name="l00739"></a><span class="lineno">  739</span>                    it.<a class="code hl_function" href="classitem.html#a4938361b8fe897c4e85d66020ef91aff">set_var</a>( <span class="stringliteral">&quot;dirt&quot;</span>, std::min( <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>( dirt_max_dbl ), dirt + dirtadder + 1 ) );</div>
<div class="line"><a id="l00740" name="l00740"></a><span class="lineno">  740</span>                }</div>
<div class="line"><a id="l00741" name="l00741"></a><span class="lineno">  741</span>            }</div>
<div class="line"><a id="l00742" name="l00742"></a><span class="lineno">  742</span>            dirt = it.<a class="code hl_function" href="classitem.html#a0b12108a604ac9d940716bb8f1368cf5">get_var</a>( <span class="stringliteral">&quot;dirt&quot;</span>, 0 );</div>
<div class="line"><a id="l00743" name="l00743"></a><span class="lineno">  743</span>            dirt_dbl = <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>( dirt );</div>
<div class="line"><a id="l00744" name="l00744"></a><span class="lineno">  744</span>            <span class="keywordflow">if</span>( dirt &gt; 0 &amp;&amp; !it.<a class="code hl_variable" href="classitem.html#a12a6fa8aac1350f3ca4362a1bdccd9b0">faults</a>.count( <a class="code hl_variable" href="ranged_8cpp.html#a6a67c1570499e9c4ab345a0c6f1ba026">fault_gun_blackpowder</a> ) ) {</div>
<div class="line"><a id="l00745" name="l00745"></a><span class="lineno">  745</span>                it.<a class="code hl_variable" href="classitem.html#a12a6fa8aac1350f3ca4362a1bdccd9b0">faults</a>.insert( <a class="code hl_variable" href="ranged_8cpp.html#a0ea533037e4a6a02394d39e2d62174bc">fault_gun_dirt</a> );</div>
<div class="line"><a id="l00746" name="l00746"></a><span class="lineno">  746</span>            }</div>
<div class="line"><a id="l00747" name="l00747"></a><span class="lineno">  747</span>            <span class="keywordflow">if</span>( dirt &gt; 0 &amp;&amp; curammo_effects.count( <a class="code hl_variable" href="ranged_8cpp.html#a680b9ce8c9824607142f83b2260dd3ef">ammo_effect_BLACKPOWDER</a> ) ) {</div>
<div class="line"><a id="l00748" name="l00748"></a><span class="lineno">  748</span>                it.<a class="code hl_variable" href="classitem.html#a12a6fa8aac1350f3ca4362a1bdccd9b0">faults</a>.erase( <a class="code hl_variable" href="ranged_8cpp.html#a0ea533037e4a6a02394d39e2d62174bc">fault_gun_dirt</a> );</div>
<div class="line"><a id="l00749" name="l00749"></a><span class="lineno">  749</span>                it.<a class="code hl_variable" href="classitem.html#a12a6fa8aac1350f3ca4362a1bdccd9b0">faults</a>.insert( <a class="code hl_variable" href="ranged_8cpp.html#a6a67c1570499e9c4ab345a0c6f1ba026">fault_gun_blackpowder</a> );</div>
<div class="line"><a id="l00750" name="l00750"></a><span class="lineno">  750</span>            }</div>
<div class="line"><a id="l00751" name="l00751"></a><span class="lineno">  751</span>            <span class="comment">// end fouling mechanics</span></div>
<div class="line"><a id="l00752" name="l00752"></a><span class="lineno">  752</span>        }</div>
<div class="line"><a id="l00753" name="l00753"></a><span class="lineno">  753</span>    }</div>
<div class="line"><a id="l00754" name="l00754"></a><span class="lineno">  754</span>    <span class="comment">// chance to damage gun due to high levels of dirt. Very unlikely, especially at lower levels and impossible below 5,000. Lower than the chance of a jam at the same levels. 555555... is an arbitrary number that I came up with after playing with the formula in excel. It makes sense at low, medium, and high levels of dirt.</span></div>
<div class="line"><a id="l00755" name="l00755"></a><span class="lineno">  755</span>    <span class="keywordflow">if</span>( dirt_dbl &gt; 5000 &amp;&amp;</div>
<div class="line"><a id="l00756" name="l00756"></a><span class="lineno">  756</span>        <a class="code hl_function" href="calendar_8cpp.html#a359120c15f92d54a49fec9de7bcb571f">x_in_y</a>( dirt_dbl * dirt_dbl * dirt_dbl,</div>
<div class="line"><a id="l00757" name="l00757"></a><span class="lineno">  757</span>                5555555555555 ) ) {</div>
<div class="line"><a id="l00758" name="l00758"></a><span class="lineno">  758</span>        shooter.<a class="code hl_function" href="classCreature.html#a7cf71d2bd6c350f2ceda3f1d64046e63">add_msg_player_or_npc</a>( <a class="code hl_enumvalue" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea72e7b82d57a6df0d4263c2043139b1b1">m_bad</a>, <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Your %s is damaged by the high pressure!&quot;</span> ),</div>
<div class="line"><a id="l00759" name="l00759"></a><span class="lineno">  759</span>                                       <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;&lt;npcname&gt;&#39;s %s is damaged by the high pressure!&quot;</span> ),</div>
<div class="line"><a id="l00760" name="l00760"></a><span class="lineno">  760</span>                                       it.<a class="code hl_function" href="classitem.html#a7e78e26dcf9b357cda769c3ca2938eda">tname</a>() );</div>
<div class="line"><a id="l00761" name="l00761"></a><span class="lineno">  761</span>        <span class="comment">// Don&#39;t increment until after the message</span></div>
<div class="line"><a id="l00762" name="l00762"></a><span class="lineno">  762</span>        it.<a class="code hl_function" href="classitem.html#aca60af3c295738c2c1fddf0fd669f9a1">inc_damage</a>();</div>
<div class="line"><a id="l00763" name="l00763"></a><span class="lineno">  763</span>    }</div>
<div class="line"><a id="l00764" name="l00764"></a><span class="lineno">  764</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l00765" name="l00765"></a><span class="lineno">  765</span>}</div>
<div class="ttc" id="aartifact_8cpp_html_a70800e95389f34dd34186fafaea2a840"><div class="ttname"><a href="artifact_8cpp.html#a70800e95389f34dd34186fafaea2a840">rng</a></div><div class="ttdeci">units::quantity&lt; V, B &gt; rng(const units::quantity&lt; V, B &gt; &amp;min, const units::quantity&lt; V, B &gt; &amp;max)</div><div class="ttdef"><b>Definition:</b> <a href="artifact_8cpp_source.html#l00032">artifact.cpp:32</a></div></div>
<div class="ttc" id="acalendar_8cpp_html_a359120c15f92d54a49fec9de7bcb571f"><div class="ttname"><a href="calendar_8cpp.html#a359120c15f92d54a49fec9de7bcb571f">x_in_y</a></div><div class="ttdeci">bool x_in_y(const time_duration &amp;a, const time_duration &amp;b)</div><div class="ttdef"><b>Definition:</b> <a href="calendar_8cpp_source.html#l00521">calendar.cpp:521</a></div></div>
<div class="ttc" id="aclassCharacter_html_a35f89e2e6eb1144b623be5281f4f221b"><div class="ttname"><a href="classCharacter.html#a35f89e2e6eb1144b623be5281f4f221b">Character::i_rem</a></div><div class="ttdeci">item i_rem(int pos)</div><div class="ttdoc">Remove a specific item from player possession.</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l02372">character.cpp:2372</a></div></div>
<div class="ttc" id="aclassCreature_html_a7cf71d2bd6c350f2ceda3f1d64046e63"><div class="ttname"><a href="classCreature.html#a7cf71d2bd6c350f2ceda3f1d64046e63">Creature::add_msg_player_or_npc</a></div><div class="ttdeci">virtual void add_msg_player_or_npc(const std::string &amp;, const std::string &amp;) const</div><div class="ttdef"><b>Definition:</b> <a href="creature_8h_source.html#l00689">creature.h:689</a></div></div>
<div class="ttc" id="aclassitem_html_a0b12108a604ac9d940716bb8f1368cf5"><div class="ttname"><a href="classitem.html#a0b12108a604ac9d940716bb8f1368cf5">item::get_var</a></div><div class="ttdeci">double get_var(const std::string &amp;name, double default_value) const</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l01033">item.cpp:1033</a></div></div>
<div class="ttc" id="aclassitem_html_a45bcd33992b7d26eb4ae9f76a16b58fa"><div class="ttname"><a href="classitem.html#a45bcd33992b7d26eb4ae9f76a16b58fa">item::has_fault</a></div><div class="ttdeci">bool has_fault(const fault_id &amp;fault) const</div><div class="ttdoc">Does this item have the specified fault.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l05318">item.cpp:5318</a></div></div>
<div class="ttc" id="aclassitem_html_a4938361b8fe897c4e85d66020ef91aff"><div class="ttname"><a href="classitem.html#a4938361b8fe897c4e85d66020ef91aff">item::set_var</a></div><div class="ttdeci">void set_var(const std::string &amp;name, int value)</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l01003">item.cpp:1003</a></div></div>
<div class="ttc" id="aclassitem_html_a4adcc4a3a5f5fb20a4d245d79109640a"><div class="ttname"><a href="classitem.html#a4adcc4a3a5f5fb20a4d245d79109640a">item::ammo_data</a></div><div class="ttdeci">const itype * ammo_data() const</div><div class="ttdoc">Specific ammo data, returns nullptr if item is neither ammo nor loaded with any.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l07550">item.cpp:7550</a></div></div>
<div class="ttc" id="aclassitem_html_a75fa277bb39c1d2922137986c67d48fb"><div class="ttname"><a href="classitem.html#a75fa277bb39c1d2922137986c67d48fb">item::ammo_effects</a></div><div class="ttdeci">std::set&lt; ammo_effect_str_id &gt; ammo_effects(bool with_ammo=true) const</div><div class="ttdoc">Get ammo effects for item optionally inclusive of any resulting from the loaded ammo.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l07645">item.cpp:7645</a></div></div>
<div class="ttc" id="aclassitem_html_aca60af3c295738c2c1fddf0fd669f9a1"><div class="ttname"><a href="classitem.html#aca60af3c295738c2c1fddf0fd669f9a1">item::inc_damage</a></div><div class="ttdeci">bool inc_damage(damage_type dt)</div><div class="ttdoc">Increment item damage by itype::damage_scale constrained by max_damage.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l06278">item.cpp:6278</a></div></div>
<div class="ttc" id="aclassitem_html_adaaa3ece39eb40637371659dad8550e3"><div class="ttname"><a href="classitem.html#adaaa3ece39eb40637371659dad8550e3">item::faults_potential</a></div><div class="ttdeci">std::set&lt; fault_id &gt; faults_potential() const</div><div class="ttdoc">What faults can potentially occur with this item?</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l06829">item.cpp:6829</a></div></div>
<div class="ttc" id="aclassitem_html_ae8a58c6fe3c80cded11d6f3ccfa548a3"><div class="ttname"><a href="classitem.html#ae8a58c6fe3c80cded11d6f3ccfa548a3">item::damage</a></div><div class="ttdeci">int damage() const</div><div class="ttdoc">How much damage has the item sustained?</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l00699">item.cpp:699</a></div></div>
<div class="ttc" id="aenums_8h_html_a3baf36d700701401b6baf94db93d096ea72e7b82d57a6df0d4263c2043139b1b1"><div class="ttname"><a href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea72e7b82d57a6df0d4263c2043139b1b1">m_bad</a></div><div class="ttdeci">@ m_bad</div><div class="ttdef"><b>Definition:</b> <a href="enums_8h_source.html#l00261">enums.h:261</a></div></div>
<div class="ttc" id="aranged_8cpp_html_a02a98acfc0759dc42a3683ec82f936a9"><div class="ttname"><a href="ranged_8cpp.html#a02a98acfc0759dc42a3683ec82f936a9">ammo_effect_EMP</a></div><div class="ttdeci">static const ammo_effect_str_id ammo_effect_EMP(&quot;EMP&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a0ea533037e4a6a02394d39e2d62174bc"><div class="ttname"><a href="ranged_8cpp.html#a0ea533037e4a6a02394d39e2d62174bc">fault_gun_dirt</a></div><div class="ttdeci">static const fault_id fault_gun_dirt(&quot;fault_gun_dirt&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a4823a8b924c5e1c83c8e1e1a316e1ae7"><div class="ttname"><a href="ranged_8cpp.html#a4823a8b924c5e1c83c8e1e1a316e1ae7">ammo_effect_LASER</a></div><div class="ttdeci">static const ammo_effect_str_id ammo_effect_LASER(&quot;LASER&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a680b9ce8c9824607142f83b2260dd3ef"><div class="ttname"><a href="ranged_8cpp.html#a680b9ce8c9824607142f83b2260dd3ef">ammo_effect_BLACKPOWDER</a></div><div class="ttdeci">static const ammo_effect_str_id ammo_effect_BLACKPOWDER(&quot;BLACKPOWDER&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a6a67c1570499e9c4ab345a0c6f1ba026"><div class="ttname"><a href="ranged_8cpp.html#a6a67c1570499e9c4ab345a0c6f1ba026">fault_gun_blackpowder</a></div><div class="ttdeci">static const fault_id fault_gun_blackpowder(&quot;fault_gun_blackpowder&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a916c022e69240915ee6678d0170882d3"><div class="ttname"><a href="ranged_8cpp.html#a916c022e69240915ee6678d0170882d3">flag_CONSUMABLE</a></div><div class="ttdeci">static const std::string flag_CONSUMABLE(&quot;CONSUMABLE&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_aa125c6da24f14c1bec090943b0174e58"><div class="ttname"><a href="ranged_8cpp.html#aa125c6da24f14c1bec090943b0174e58">flag_NON_FOULING</a></div><div class="ttdeci">static const std::string flag_NON_FOULING(&quot;NON-FOULING&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_aaf09bb55e60a45b1eb81e989d0758e93"><div class="ttname"><a href="ranged_8cpp.html#aaf09bb55e60a45b1eb81e989d0758e93">ammo_effect_PLASMA</a></div><div class="ttdeci">static const ammo_effect_str_id ammo_effect_PLASMA(&quot;PLASMA&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_ab2dd3d8bd3db68ab02a94d2d26d2fc5a"><div class="ttname"><a href="ranged_8cpp.html#ab2dd3d8bd3db68ab02a94d2d26d2fc5a">flag_NEVER_JAMS</a></div><div class="ttdeci">static const std::string flag_NEVER_JAMS(&quot;NEVER_JAMS&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_ab97e95eba84f451228755a351c0476f7"><div class="ttname"><a href="ranged_8cpp.html#ab97e95eba84f451228755a351c0476f7">ammo_effect_NON_FOULING</a></div><div class="ttdeci">static const ammo_effect_str_id ammo_effect_NON_FOULING(&quot;NON-FOULING&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_ad23a05e76b668009068f0e453c33692b"><div class="ttname"><a href="ranged_8cpp.html#ad23a05e76b668009068f0e453c33692b">flag_PRIMITIVE_RANGED_WEAPON</a></div><div class="ttdeci">static const std::string flag_PRIMITIVE_RANGED_WEAPON(&quot;PRIMITIVE_RANGED_WEAPON&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_ad73ddd0cc91027278ca5627eaa4ef206"><div class="ttname"><a href="ranged_8cpp.html#ad73ddd0cc91027278ca5627eaa4ef206">fault_gun_unlubricated</a></div><div class="ttdeci">static const fault_id fault_gun_unlubricated(&quot;fault_gun_unlubricated&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_afa18fa10e4bc2e18f3911cebb559b7bd"><div class="ttname"><a href="ranged_8cpp.html#afa18fa10e4bc2e18f3911cebb559b7bd">ammo_effect_RECYCLED</a></div><div class="ttdeci">static const ammo_effect_str_id ammo_effect_RECYCLED(&quot;RECYCLED&quot;)</div></div>
<div class="ttc" id="astructislot__gun_html"><div class="ttname"><a href="structislot__gun.html">islot_gun</a></div><div class="ttdef"><b>Definition:</b> <a href="itype_8h_source.html#l00459">itype.h:459</a></div></div>
<div class="ttc" id="astructislot__gun_html_a014b797e92e543ea47be93a1d6771a90"><div class="ttname"><a href="structislot__gun.html#a014b797e92e543ea47be93a1d6771a90">islot_gun::blackpowder_tolerance</a></div><div class="ttdeci">int blackpowder_tolerance</div><div class="ttdoc">One in X chance for gun to require major cleanup after firing blackpowder shot.</div><div class="ttdef"><b>Definition:</b> <a href="itype_8h_source.html#l00502">itype.h:502</a></div></div>
<div class="ttc" id="astructislot__gun_html_a40255e8d661dc99204ed70dbe6013a02"><div class="ttname"><a href="structislot__gun.html#a40255e8d661dc99204ed70dbe6013a02">islot_gun::durability</a></div><div class="ttdeci">int durability</div><div class="ttdoc">Gun durability, affects gun being damaged during shooting.</div><div class="ttdef"><b>Definition:</b> <a href="itype_8h_source.html#l00471">itype.h:471</a></div></div>
<div class="ttc" id="astructislot__gun_html_a68eca15622f086d544820aabcb2a865a"><div class="ttname"><a href="structislot__gun.html#a68eca15622f086d544820aabcb2a865a">islot_gun::min_cycle_recoil</a></div><div class="ttdeci">int min_cycle_recoil</div><div class="ttdoc">Minimum ammo recoil for gun to be able to fire more than once per attack.</div><div class="ttdef"><b>Definition:</b> <a href="itype_8h_source.html#l00506">itype.h:506</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="translations_8h_source.html#l00116">_</a>, <a class="el" href="creature_8h_source.html#l00689">Creature::add_msg_player_or_npc()</a>, <a class="el" href="itype_8h_source.html#l00832">itype::ammo</a>, <a class="el" href="item_8cpp_source.html#l07550">item::ammo_data()</a>, <a class="el" href="ranged_8cpp.html#a680b9ce8c9824607142f83b2260dd3ef">ammo_effect_BLACKPOWDER</a>, <a class="el" href="ranged_8cpp.html#a02a98acfc0759dc42a3683ec82f936a9">ammo_effect_EMP</a>, <a class="el" href="ranged_8cpp.html#a4823a8b924c5e1c83c8e1e1a316e1ae7">ammo_effect_LASER</a>, <a class="el" href="ranged_8cpp.html#ab97e95eba84f451228755a351c0476f7">ammo_effect_NON_FOULING</a>, <a class="el" href="ranged_8cpp.html#aaf09bb55e60a45b1eb81e989d0758e93">ammo_effect_PLASMA</a>, <a class="el" href="ranged_8cpp.html#afa18fa10e4bc2e18f3911cebb559b7bd">ammo_effect_RECYCLED</a>, <a class="el" href="item_8cpp_source.html#l07645">item::ammo_effects()</a>, <a class="el" href="itype_8h_source.html#l00502">islot_gun::blackpowder_tolerance</a>, <a class="el" href="item_8cpp_source.html#l00699">item::damage()</a>, <a class="el" href="debug_8h_source.html#l00074">debugmsg</a>, <a class="el" href="itype_8h_source.html#l00471">islot_gun::durability</a>, <a class="el" href="ranged_8cpp.html#a6a67c1570499e9c4ab345a0c6f1ba026">fault_gun_blackpowder</a>, <a class="el" href="ranged_8cpp.html#ace607007c38b8d55a601963b24f89e7e">fault_gun_chamber_spent</a>, <a class="el" href="ranged_8cpp.html#a0ea533037e4a6a02394d39e2d62174bc">fault_gun_dirt</a>, <a class="el" href="ranged_8cpp.html#ad73ddd0cc91027278ca5627eaa4ef206">fault_gun_unlubricated</a>, <a class="el" href="item_8h_source.html#l02164">item::faults</a>, <a class="el" href="item_8cpp_source.html#l06829">item::faults_potential()</a>, <a class="el" href="ranged_8cpp.html#a916c022e69240915ee6678d0170882d3">flag_CONSUMABLE()</a>, <a class="el" href="ranged_8cpp.html#ab2dd3d8bd3db68ab02a94d2d26d2fc5a">flag_NEVER_JAMS()</a>, <a class="el" href="ranged_8cpp.html#aa125c6da24f14c1bec090943b0174e58">flag_NON_FOULING()</a>, <a class="el" href="ranged_8cpp.html#ad23a05e76b668009068f0e453c33692b">flag_PRIMITIVE_RANGED_WEAPON()</a>, <a class="el" href="item_8cpp_source.html#l01033">item::get_var()</a>, <a class="el" href="itype_8h_source.html#l00827">itype::gun</a>, <a class="el" href="item_8cpp_source.html#l07752">item::gunmods()</a>, <a class="el" href="item_8cpp_source.html#l05318">item::has_fault()</a>, <a class="el" href="item_8cpp_source.html#l05328">item::has_flag()</a>, <a class="el" href="character_8cpp_source.html#l02372">Character::i_rem()</a>, <a class="el" href="item_8cpp_source.html#l06278">item::inc_damage()</a>, <a class="el" href="item_8cpp_source.html#l06542">item::is_gun()</a>, <a class="el" href="creature_8cpp_source.html#l00171">Creature::is_underwater()</a>, <a class="el" href="enums_8h_source.html#l00261">m_bad</a>, <a class="el" href="itype_8h_source.html#l00506">islot_gun::min_cycle_recoil</a>, <a class="el" href="rng_8cpp_source.html#l00065">one_in()</a>, <a class="el" href="artifact_8cpp_source.html#l00032">rng()</a>, <a class="el" href="item_8cpp_source.html#l01003">item::set_var()</a>, <a class="el" href="item_8cpp_source.html#l04574">item::tname()</a>, <a class="el" href="item_8h_source.html#l02160">item::type</a>, and <a class="el" href="calendar_8cpp_source.html#l00521">x_in_y()</a>.</p>

<p class="reference">Referenced by <a class="el" href="ranged_8cpp_source.html#l00822">fire_gun()</a>.</p>

</div>
</div>
<a id="ad0ad7f6e4c593e68012655f0befed8cf" name="ad0ad7f6e4c593e68012655f0befed8cf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad0ad7f6e4c593e68012655f0befed8cf">&#9670;&nbsp;</a></span>hit_chance()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double ranged::hit_chance </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classdispersion__sources.html">dispersion_sources</a> &amp;&#160;</td>
          <td class="paramname"><em>dispersion</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>range</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>target_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>missed_by</em> = <code>1.0</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The chance that a fired shot reaches required accuracy - by default grazing shot. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">dispersion</td><td>accuracy of the shot. Must be a purely normal distribution. </td></tr>
    <tr><td class="paramname">range</td><td>distance between the shooter and the target. </td></tr>
    <tr><td class="paramname">target_size</td><td>size of the target, in the range (0, 1]. </td></tr>
    <tr><td class="paramname">missed_by</td><td>maximum degree of miss, in the range (0, 1]. Effectively a multiplier on</td></tr>
    <tr><td class="paramname">target_size.</td><td></td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="ballistics_8cpp_source.html#l00514">514</a> of file <a class="el" href="ballistics_8cpp_source.html">ballistics.cpp</a>.</p>
<div class="fragment"><div class="line"><a id="l00516" name="l00516"></a><span class="lineno">  516</span>{</div>
<div class="line"><a id="l00517" name="l00517"></a><span class="lineno">  517</span>    <span class="keywordflow">if</span>( <a class="code hl_enumvalue" href="character_8h.html#addab86bfe6fd0bf8c22ec43df3ec051da1c21724609ac70f1573fd4b755c64ddb">range</a> &lt;= 0 ) {</div>
<div class="line"><a id="l00518" name="l00518"></a><span class="lineno">  518</span>        <span class="keywordflow">return</span> 1.0;</div>
<div class="line"><a id="l00519" name="l00519"></a><span class="lineno">  519</span>    }</div>
<div class="line"><a id="l00520" name="l00520"></a><span class="lineno">  520</span> </div>
<div class="line"><a id="l00521" name="l00521"></a><span class="lineno">  521</span>    <span class="keywordtype">double</span> missed_by_tiles = missed_by * target_size;</div>
<div class="line"><a id="l00522" name="l00522"></a><span class="lineno">  522</span> </div>
<div class="line"><a id="l00523" name="l00523"></a><span class="lineno">  523</span>    <span class="comment">//          T = (2*D**2 * (1 - cos V)) ** 0.5   (from iso_tangent)</span></div>
<div class="line"><a id="l00524" name="l00524"></a><span class="lineno">  524</span>    <span class="comment">//      cos V = 1 - T**2 / (2*D**2)</span></div>
<div class="line"><a id="l00525" name="l00525"></a><span class="lineno">  525</span>    <span class="keywordtype">double</span> cosV = 1 - missed_by_tiles * missed_by_tiles / ( 2 * <a class="code hl_enumvalue" href="character_8h.html#addab86bfe6fd0bf8c22ec43df3ec051da1c21724609ac70f1573fd4b755c64ddb">range</a> * <a class="code hl_enumvalue" href="character_8h.html#addab86bfe6fd0bf8c22ec43df3ec051da1c21724609ac70f1573fd4b755c64ddb">range</a> );</div>
<div class="line"><a id="l00526" name="l00526"></a><span class="lineno">  526</span>    <span class="keywordtype">double</span> needed_dispersion = ( cosV &lt; -1.0 ? <a class="code hl_define" href="math__defines_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a> : acos( cosV ) ) * 180 * 60 / <a class="code hl_define" href="math__defines_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>;</div>
<div class="line"><a id="l00527" name="l00527"></a><span class="lineno">  527</span> </div>
<div class="line"><a id="l00528" name="l00528"></a><span class="lineno">  528</span>    <span class="keywordflow">return</span> <a class="code hl_function" href="cata__utility_8cpp.html#aedad91155e8b8c3f459bd5c588b80dd0">normal_cdf</a>( needed_dispersion, dispersion.<a class="code hl_function" href="classdispersion__sources.html#acef366e9f542abaeaa4babeeee3b78e2">avg</a>(), dispersion.<a class="code hl_function" href="classdispersion__sources.html#acef366e9f542abaeaa4babeeee3b78e2">avg</a>() / 2 );</div>
<div class="line"><a id="l00529" name="l00529"></a><span class="lineno">  529</span>}</div>
<div class="ttc" id="acata__utility_8cpp_html_aedad91155e8b8c3f459bd5c588b80dd0"><div class="ttname"><a href="cata__utility_8cpp.html#aedad91155e8b8c3f459bd5c588b80dd0">normal_cdf</a></div><div class="ttdeci">double normal_cdf(double x, double mean, double stddev)</div><div class="ttdoc">Cumulative distribution function of a certain normal distribution.</div><div class="ttdef"><b>Definition:</b> <a href="cata__utility_8cpp_source.html#l00107">cata_utility.cpp:107</a></div></div>
<div class="ttc" id="acharacter_8h_html_addab86bfe6fd0bf8c22ec43df3ec051da1c21724609ac70f1573fd4b755c64ddb"><div class="ttname"><a href="character_8h.html#addab86bfe6fd0bf8c22ec43df3ec051da1c21724609ac70f1573fd4b755c64ddb">range</a></div><div class="ttdeci">@ range</div><div class="ttdef"><b>Definition:</b> <a href="character_8h_source.html#l00104">character.h:104</a></div></div>
<div class="ttc" id="aclassdispersion__sources_html_acef366e9f542abaeaa4babeeee3b78e2"><div class="ttname"><a href="classdispersion__sources.html#acef366e9f542abaeaa4babeeee3b78e2">dispersion_sources::avg</a></div><div class="ttdeci">double avg() const</div><div class="ttdef"><b>Definition:</b> <a href="dispersion_8cpp_source.html#l00035">dispersion.cpp:35</a></div></div>
<div class="ttc" id="amath__defines_8h_html_ae71449b1cc6e6250b91f539153a7a0d3"><div class="ttname"><a href="math__defines_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a></div><div class="ttdeci">#define M_PI</div><div class="ttdef"><b>Definition:</b> <a href="math__defines_8h_source.html#l00021">math_defines.h:21</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="dispersion_8cpp_source.html#l00035">dispersion_sources::avg()</a>, <a class="el" href="math__defines_8h_source.html#l00021">M_PI</a>, <a class="el" href="cata__utility_8cpp_source.html#l00107">normal_cdf()</a>, and <a class="el" href="character_8h_source.html#l00104">range</a>.</p>

</div>
</div>
<a id="a51e6279a2008714e5596da4f5fa1b00e" name="a51e6279a2008714e5596da4f5fa1b00e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a51e6279a2008714e5596da4f5fa1b00e">&#9670;&nbsp;</a></span>hit_with_aoe()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structdealt__damage__instance.html">dealt_damage_instance</a> ranged::hit_with_aoe </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classCreature.html">Creature</a> &amp;&#160;</td>
          <td class="paramname"><em>target</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classCreature.html">Creature</a> *&#160;</td>
          <td class="paramname"><em>source</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structdamage__instance.html">damage_instance</a> &amp;&#160;</td>
          <td class="paramname"><em>di</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="creature_8cpp_source.html#l00622">622</a> of file <a class="el" href="creature_8cpp_source.html">creature.cpp</a>.</p>
<div class="fragment"><div class="line"><a id="l00623" name="l00623"></a><span class="lineno">  623</span>{</div>
<div class="line"><a id="l00624" name="l00624"></a><span class="lineno">  624</span>    <span class="keyword">const</span> <span class="keyword">auto</span> <a class="code hl_variable" href="bodypart_8h.html#a089a199d69623f528a3883672f0a084e">all_body_parts</a> = target.<a class="code hl_function" href="classCreature.html#ac4dbde454c86b3296f53681c60612974">get_body</a>();</div>
<div class="line"><a id="l00625" name="l00625"></a><span class="lineno">  625</span>    <span class="keywordtype">float</span> hit_size_sum = std::accumulate( <a class="code hl_variable" href="bodypart_8h.html#a089a199d69623f528a3883672f0a084e">all_body_parts</a>.begin(), <a class="code hl_variable" href="bodypart_8h.html#a089a199d69623f528a3883672f0a084e">all_body_parts</a>.end(), 0.0f,</div>
<div class="line"><a id="l00626" name="l00626"></a><span class="lineno">  626</span>    []( <span class="keywordtype">float</span> acc, <span class="keyword">const</span> std::pair&lt;bodypart_str_id, bodypart&gt; &amp;pr ) {</div>
<div class="line"><a id="l00627" name="l00627"></a><span class="lineno">  627</span>        return acc + pr.first-&gt;hit_size;</div>
<div class="line"><a id="l00628" name="l00628"></a><span class="lineno">  628</span>    } );</div>
<div class="line"><a id="l00629" name="l00629"></a><span class="lineno">  629</span>    <a class="code hl_struct" href="structdealt__damage__instance.html">dealt_damage_instance</a> dealt_damage;</div>
<div class="line"><a id="l00630" name="l00630"></a><span class="lineno">  630</span>    <span class="comment">// This should be set to only body part that was damaged, or null, if not exactly one was damaged</span></div>
<div class="line"><a id="l00631" name="l00631"></a><span class="lineno">  631</span>    <a class="code hl_class" href="classstring__id.html">bodypart_str_id</a> bp_hit = <a class="code hl_function" href="classstring__id.html#ae29dd8ed38d2b5eb443a65ad46f10b2d">bodypart_str_id::NULL_ID</a>();</div>
<div class="line"><a id="l00632" name="l00632"></a><span class="lineno">  632</span>    <span class="keywordtype">bool</span> hit_multiple_bps = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00633" name="l00633"></a><span class="lineno">  633</span>    <span class="keywordflow">for</span>( <span class="keyword">const</span> std::pair&lt;const bodypart_str_id, bodypart&gt; &amp;pr : <a class="code hl_variable" href="bodypart_8h.html#a089a199d69623f528a3883672f0a084e">all_body_parts</a> ) {</div>
<div class="line"><a id="l00634" name="l00634"></a><span class="lineno">  634</span>        <span class="keywordtype">bool</span> hit_this_bp = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00635" name="l00635"></a><span class="lineno">  635</span>        <a class="code hl_struct" href="structdamage__instance.html">damage_instance</a> impact = di;</div>
<div class="line"><a id="l00636" name="l00636"></a><span class="lineno">  636</span>        impact.<a class="code hl_function" href="structdamage__instance.html#a6cc673dba3d2de116c2579c3eda7ed23">mult_damage</a>( pr.first-&gt;hit_size / hit_size_sum );</div>
<div class="line"><a id="l00637" name="l00637"></a><span class="lineno">  637</span>        <a class="code hl_struct" href="structdealt__damage__instance.html">dealt_damage_instance</a> bp_damage = target.<a class="code hl_function" href="classCreature.html#a75ad96eb6ce27d3c1df250965b4de7b5">deal_damage</a>( source, pr.first.id(), impact );</div>
<div class="line"><a id="l00638" name="l00638"></a><span class="lineno">  638</span>        <span class="keywordflow">for</span>( <span class="keywordtype">size_t</span> i = 0; i &lt; dealt_damage.<a class="code hl_variable" href="structdealt__damage__instance.html#a406b816a99913bd6a91b000cc7198a7c">dealt_dams</a>.size(); i++ ) {</div>
<div class="line"><a id="l00639" name="l00639"></a><span class="lineno">  639</span>            dealt_damage.<a class="code hl_variable" href="structdealt__damage__instance.html#a406b816a99913bd6a91b000cc7198a7c">dealt_dams</a>[i] += bp_damage.<a class="code hl_variable" href="structdealt__damage__instance.html#a406b816a99913bd6a91b000cc7198a7c">dealt_dams</a>[i];</div>
<div class="line"><a id="l00640" name="l00640"></a><span class="lineno">  640</span>            hit_this_bp |= bp_damage.<a class="code hl_variable" href="structdealt__damage__instance.html#a406b816a99913bd6a91b000cc7198a7c">dealt_dams</a>[i] &gt; 0;</div>
<div class="line"><a id="l00641" name="l00641"></a><span class="lineno">  641</span>        }</div>
<div class="line"><a id="l00642" name="l00642"></a><span class="lineno">  642</span> </div>
<div class="line"><a id="l00643" name="l00643"></a><span class="lineno">  643</span>        <span class="keywordflow">if</span>( !hit_multiple_bps &amp;&amp; hit_this_bp ) {</div>
<div class="line"><a id="l00644" name="l00644"></a><span class="lineno">  644</span>            <span class="keywordflow">if</span>( !bp_hit ) {</div>
<div class="line"><a id="l00645" name="l00645"></a><span class="lineno">  645</span>                bp_hit = pr.first;</div>
<div class="line"><a id="l00646" name="l00646"></a><span class="lineno">  646</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00647" name="l00647"></a><span class="lineno">  647</span>                bp_hit = <a class="code hl_function" href="classstring__id.html#ae29dd8ed38d2b5eb443a65ad46f10b2d">bodypart_str_id::NULL_ID</a>();</div>
<div class="line"><a id="l00648" name="l00648"></a><span class="lineno">  648</span>                hit_multiple_bps = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00649" name="l00649"></a><span class="lineno">  649</span>            }</div>
<div class="line"><a id="l00650" name="l00650"></a><span class="lineno">  650</span>        }</div>
<div class="line"><a id="l00651" name="l00651"></a><span class="lineno">  651</span>    }</div>
<div class="line"><a id="l00652" name="l00652"></a><span class="lineno">  652</span> </div>
<div class="line"><a id="l00653" name="l00653"></a><span class="lineno">  653</span>    dealt_damage.<a class="code hl_variable" href="structdealt__damage__instance.html#ad39dc827923ad7b203f2061134ed1db1">bp_hit</a> = bp_hit-&gt;<a class="code hl_variable" href="structbody__part__type.html#a90beb41f3dca18cdbe06f8483336c899">token</a>;</div>
<div class="line"><a id="l00654" name="l00654"></a><span class="lineno">  654</span>    <span class="keywordflow">if</span>( <a class="code hl_function" href="character_8cpp.html#a2fcb25d686f4a35fca374c6f71280311">get_player_character</a>().sees( target ) ) {</div>
<div class="line"><a id="l00655" name="l00655"></a><span class="lineno">  655</span>        <a class="code hl_function" href="namespaceranged.html#af042bc3e3b1ea1c57a42ee323ad284a8">ranged::print_dmg_msg</a>( target, source, dealt_damage );</div>
<div class="line"><a id="l00656" name="l00656"></a><span class="lineno">  656</span>    }</div>
<div class="line"><a id="l00657" name="l00657"></a><span class="lineno">  657</span> </div>
<div class="line"><a id="l00658" name="l00658"></a><span class="lineno">  658</span>    <span class="keywordflow">if</span>( target.<a class="code hl_function" href="classCreature.html#a6fb79df9315dc2bed6f34d9a2e37da90">has_effect</a>( <a class="code hl_variable" href="creature_8cpp.html#a7c7651a289cc19a34456c213eeb46edc">effect_ridden</a> ) ) {</div>
<div class="line"><a id="l00659" name="l00659"></a><span class="lineno">  659</span>        <a class="code hl_class" href="classmonster.html">monster</a> *mons = <span class="keyword">dynamic_cast&lt;</span><a class="code hl_class" href="classmonster.html">monster</a> *<span class="keyword">&gt;</span>( &amp;target );</div>
<div class="line"><a id="l00660" name="l00660"></a><span class="lineno">  660</span>        <span class="keywordflow">if</span>( mons &amp;&amp; mons-&gt;<a class="code hl_variable" href="classmonster.html#aa07ebef40819868b9f7a86383d6cd8c3">mounted_player</a> &amp;&amp; !mons-&gt;<a class="code hl_function" href="classmonster.html#a0315651e596e69f0626b30e081726596">has_flag</a>( <a class="code hl_enumvalue" href="mtype_8h.html#afa4c966d04d2ddb261a7cde725eca842af91c5e1f99c06d67e9def13a16cc8b72">MF_MECH_DEFENSIVE</a> ) ) {</div>
<div class="line"><a id="l00661" name="l00661"></a><span class="lineno">  661</span>            <span class="comment">// TODO: Return value</span></div>
<div class="line"><a id="l00662" name="l00662"></a><span class="lineno">  662</span>            <a class="code hl_function" href="namespaceranged.html#a51e6279a2008714e5596da4f5fa1b00e">hit_with_aoe</a>( *mons-&gt;<a class="code hl_variable" href="classmonster.html#aa07ebef40819868b9f7a86383d6cd8c3">mounted_player</a>, source, di );</div>
<div class="line"><a id="l00663" name="l00663"></a><span class="lineno">  663</span>        }</div>
<div class="line"><a id="l00664" name="l00664"></a><span class="lineno">  664</span>    }</div>
<div class="line"><a id="l00665" name="l00665"></a><span class="lineno">  665</span> </div>
<div class="line"><a id="l00666" name="l00666"></a><span class="lineno">  666</span>    <span class="keywordflow">return</span> dealt_damage;</div>
<div class="line"><a id="l00667" name="l00667"></a><span class="lineno">  667</span>}</div>
<div class="ttc" id="abodypart_8h_html_a089a199d69623f528a3883672f0a084e"><div class="ttname"><a href="bodypart_8h.html#a089a199d69623f528a3883672f0a084e">all_body_parts</a></div><div class="ttdeci">constexpr std::array&lt; body_part, 12 &gt; all_body_parts</div><div class="ttdoc">Contains all valid body_part values in the order they are defined in.</div><div class="ttdef"><b>Definition:</b> <a href="bodypart_8h_source.html#l00083">bodypart.h:83</a></div></div>
<div class="ttc" id="aclassCreature_html_a75ad96eb6ce27d3c1df250965b4de7b5"><div class="ttname"><a href="classCreature.html#a75ad96eb6ce27d3c1df250965b4de7b5">Creature::deal_damage</a></div><div class="ttdeci">virtual dealt_damage_instance deal_damage(Creature *source, bodypart_id bp, const damage_instance &amp;dam)</div><div class="ttdoc">Deals the damage via an attack.</div><div class="ttdef"><b>Definition:</b> <a href="creature_8cpp_source.html#l00901">creature.cpp:901</a></div></div>
<div class="ttc" id="aclassCreature_html_ac4dbde454c86b3296f53681c60612974"><div class="ttname"><a href="classCreature.html#ac4dbde454c86b3296f53681c60612974">Creature::get_body</a></div><div class="ttdeci">const std::map&lt; bodypart_str_id, bodypart &gt; &amp; get_body() const</div><div class="ttdef"><b>Definition:</b> <a href="creature_8cpp_source.html#l01568">creature.cpp:1568</a></div></div>
<div class="ttc" id="aclassmonster_html_a0315651e596e69f0626b30e081726596"><div class="ttname"><a href="classmonster.html#a0315651e596e69f0626b30e081726596">monster::has_flag</a></div><div class="ttdeci">bool has_flag(m_flag f) const override</div><div class="ttdef"><b>Definition:</b> <a href="monster_8cpp_source.html#l00894">monster.cpp:894</a></div></div>
<div class="ttc" id="aclassmonster_html_aa07ebef40819868b9f7a86383d6cd8c3"><div class="ttname"><a href="classmonster.html#aa07ebef40819868b9f7a86383d6cd8c3">monster::mounted_player</a></div><div class="ttdeci">Character * mounted_player</div><div class="ttdef"><b>Definition:</b> <a href="monster_8h_source.html#l00458">monster.h:458</a></div></div>
<div class="ttc" id="aclassstring__id_html_ae29dd8ed38d2b5eb443a65ad46f10b2d"><div class="ttname"><a href="classstring__id.html#ae29dd8ed38d2b5eb443a65ad46f10b2d">string_id&lt; body_part_type &gt;::NULL_ID</a></div><div class="ttdeci">static const string_id&lt; body_part_type &gt; &amp; NULL_ID()</div><div class="ttdoc">Returns a null id whose string_id&lt;T&gt;::is_null() must always return true.</div></div>
<div class="ttc" id="acreature_8cpp_html_a7c7651a289cc19a34456c213eeb46edc"><div class="ttname"><a href="creature_8cpp.html#a7c7651a289cc19a34456c213eeb46edc">effect_ridden</a></div><div class="ttdeci">static const efftype_id effect_ridden(&quot;ridden&quot;)</div></div>
<div class="ttc" id="amtype_8h_html_afa4c966d04d2ddb261a7cde725eca842af91c5e1f99c06d67e9def13a16cc8b72"><div class="ttname"><a href="mtype_8h.html#afa4c966d04d2ddb261a7cde725eca842af91c5e1f99c06d67e9def13a16cc8b72">MF_MECH_DEFENSIVE</a></div><div class="ttdeci">@ MF_MECH_DEFENSIVE</div><div class="ttdef"><b>Definition:</b> <a href="mtype_8h_source.html#l00118">mtype.h:118</a></div></div>
<div class="ttc" id="anamespaceranged_html_af042bc3e3b1ea1c57a42ee323ad284a8"><div class="ttname"><a href="namespaceranged.html#af042bc3e3b1ea1c57a42ee323ad284a8">ranged::print_dmg_msg</a></div><div class="ttdeci">void print_dmg_msg(Creature &amp;target, Creature *source, const dealt_damage_instance &amp;dealt_dam, hit_tier ht)</div><div class="ttdef"><b>Definition:</b> <a href="creature_8cpp_source.html#l00555">creature.cpp:555</a></div></div>
<div class="ttc" id="astructbody__part__type_html_a90beb41f3dca18cdbe06f8483336c899"><div class="ttname"><a href="structbody__part__type.html#a90beb41f3dca18cdbe06f8483336c899">body_part_type::token</a></div><div class="ttdeci">body_part token</div><div class="ttdef"><b>Definition:</b> <a href="bodypart_8h_source.html#l00107">bodypart.h:107</a></div></div>
<div class="ttc" id="astructdamage__instance_html"><div class="ttname"><a href="structdamage__instance.html">damage_instance</a></div><div class="ttdef"><b>Definition:</b> <a href="damage_8h_source.html#l00051">damage.h:51</a></div></div>
<div class="ttc" id="astructdealt__damage__instance_html"><div class="ttname"><a href="structdealt__damage__instance.html">dealt_damage_instance</a></div><div class="ttdef"><b>Definition:</b> <a href="damage_8h_source.html#l00085">damage.h:85</a></div></div>
<div class="ttc" id="astructdealt__damage__instance_html_a406b816a99913bd6a91b000cc7198a7c"><div class="ttname"><a href="structdealt__damage__instance.html#a406b816a99913bd6a91b000cc7198a7c">dealt_damage_instance::dealt_dams</a></div><div class="ttdeci">std::array&lt; int, NUM_DT &gt; dealt_dams</div><div class="ttdef"><b>Definition:</b> <a href="damage_8h_source.html#l00086">damage.h:86</a></div></div>
<div class="ttc" id="astructdealt__damage__instance_html_ad39dc827923ad7b203f2061134ed1db1"><div class="ttname"><a href="structdealt__damage__instance.html#ad39dc827923ad7b203f2061134ed1db1">dealt_damage_instance::bp_hit</a></div><div class="ttdeci">body_part bp_hit</div><div class="ttdef"><b>Definition:</b> <a href="damage_8h_source.html#l00087">damage.h:87</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="bodypart_8h_source.html#l00083">all_body_parts</a>, <a class="el" href="creature_8cpp_source.html#l00901">Creature::deal_damage()</a>, <a class="el" href="damage_8h_source.html#l00086">dealt_damage_instance::dealt_dams</a>, <a class="el" href="creature_8cpp_source.html#l01568">Creature::get_body()</a>, <a class="el" href="damage_8cpp_source.html#l00048">damage_instance::mult_damage()</a>, and <a class="el" href="classstring__id.html#ae29dd8ed38d2b5eb443a65ad46f10b2d">string_id&lt; body_part_type &gt;::NULL_ID()</a>.</p>

<p class="reference">Referenced by <a class="el" href="ranged__aoe_8cpp_source.html#l00044">execute_shaped_attack()</a>.</p>

</div>
</div>
<a id="ab65b29a98e9d9b297fe6d631afc0bf1c" name="ab65b29a98e9d9b297fe6d631afc0bf1c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab65b29a98e9d9b297fe6d631afc0bf1c">&#9670;&nbsp;</a></span>make_gun_sound_effect()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ranged::make_gun_sound_effect </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classCharacter.html">Character</a> &amp;&#160;</td>
          <td class="paramname"><em>who</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>burst</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classitem.html">item</a> &amp;&#160;</td>
          <td class="paramname"><em>gun</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="ranged_8cpp_source.html#l01802">1802</a> of file <a class="el" href="ranged_8cpp_source.html">ranged.cpp</a>.</p>
<div class="fragment"><div class="line"><a id="l01803" name="l01803"></a><span class="lineno"> 1803</span>{</div>
<div class="line"><a id="l01804" name="l01804"></a><span class="lineno"> 1804</span>    <span class="keyword">const</span> <a class="code hl_struct" href="structitem_1_1sound__data.html">item::sound_data</a> data = gun.<a class="code hl_function" href="classitem.html#a3694c5d9138956736af2444bd7b3972e">gun_noise</a>( burst );</div>
<div class="line"><a id="l01805" name="l01805"></a><span class="lineno"> 1805</span>    <span class="keywordflow">if</span>( data.<a class="code hl_variable" href="structitem_1_1sound__data.html#aa2fb844ce506ca62f0c5d1d549f54826">volume</a> &gt; 0 ) {</div>
<div class="line"><a id="l01806" name="l01806"></a><span class="lineno"> 1806</span>        <a class="code hl_function" href="namespacesounds.html#a6bb79ae1c9c3dcd8c8e0b28c66b0398d">sounds::sound</a>( who.<a class="code hl_function" href="classCharacter.html#ad24859164517ed6e392e21df69527199">pos</a>(), data.<a class="code hl_variable" href="structitem_1_1sound__data.html#aa2fb844ce506ca62f0c5d1d549f54826">volume</a>, <a class="code hl_enumvalue" href="namespacesounds.html#af6b3d144906d9ccfda6824fb87e46aa3ac222ae0d4e9c59bd254b72521b9e74ed">sounds::sound_t::combat</a>,</div>
<div class="line"><a id="l01807" name="l01807"></a><span class="lineno"> 1807</span>                       data.<a class="code hl_variable" href="structitem_1_1sound__data.html#a939db72176db475c72387bc928304f16">sound</a>.empty() ? <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Bang!&quot;</span> ) : data.<a class="code hl_variable" href="structitem_1_1sound__data.html#a939db72176db475c72387bc928304f16">sound</a> );</div>
<div class="line"><a id="l01808" name="l01808"></a><span class="lineno"> 1808</span>    }</div>
<div class="line"><a id="l01809" name="l01809"></a><span class="lineno"> 1809</span>    <a class="code hl_function" href="namespacesfx.html#a9ad72e54c1ddc8c974d7dc9b357ae41a">sfx::generate_gun_sound</a>( who.<a class="code hl_function" href="classCharacter.html#ad24859164517ed6e392e21df69527199">pos</a>(), gun );</div>
<div class="line"><a id="l01810" name="l01810"></a><span class="lineno"> 1810</span>}</div>
<div class="ttc" id="aclassitem_html_a3694c5d9138956736af2444bd7b3972e"><div class="ttname"><a href="classitem.html#a3694c5d9138956736af2444bd7b3972e">item::gun_noise</a></div><div class="ttdeci">sound_data gun_noise(bool burst=false) const</div><div class="ttdoc">Returns the sound of the gun being fired.</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01812">ranged.cpp:1812</a></div></div>
<div class="ttc" id="anamespacesfx_html_a9ad72e54c1ddc8c974d7dc9b357ae41a"><div class="ttname"><a href="namespacesfx.html#a9ad72e54c1ddc8c974d7dc9b357ae41a">sfx::generate_gun_sound</a></div><div class="ttdeci">void generate_gun_sound(const tripoint &amp;source, const item &amp;firing)</div><div class="ttdef"><b>Definition:</b> <a href="sounds_8cpp_source.html#l01604">sounds.cpp:1604</a></div></div>
<div class="ttc" id="anamespacesounds_html_a6bb79ae1c9c3dcd8c8e0b28c66b0398d"><div class="ttname"><a href="namespacesounds.html#a6bb79ae1c9c3dcd8c8e0b28c66b0398d">sounds::sound</a></div><div class="ttdeci">void sound(const tripoint &amp;p, int vol, sound_t category, const std::string &amp;description, bool ambient=false, const std::string &amp;id=&quot;&quot;, const std::string &amp;variant=&quot;default&quot;)</div><div class="ttdoc">Sound at (p) of intensity (vol)</div><div class="ttdef"><b>Definition:</b> <a href="sounds_8cpp_source.html#l00177">sounds.cpp:177</a></div></div>
<div class="ttc" id="anamespacesounds_html_af6b3d144906d9ccfda6824fb87e46aa3ac222ae0d4e9c59bd254b72521b9e74ed"><div class="ttname"><a href="namespacesounds.html#af6b3d144906d9ccfda6824fb87e46aa3ac222ae0d4e9c59bd254b72521b9e74ed">sounds::sound_t::combat</a></div><div class="ttdeci">@ combat</div></div>
<div class="ttc" id="astructitem_1_1sound__data_html"><div class="ttname"><a href="structitem_1_1sound__data.html">item::sound_data</a></div><div class="ttdef"><b>Definition:</b> <a href="item_8h_source.html#l01848">item.h:1848</a></div></div>
<div class="ttc" id="astructitem_1_1sound__data_html_a939db72176db475c72387bc928304f16"><div class="ttname"><a href="structitem_1_1sound__data.html#a939db72176db475c72387bc928304f16">item::sound_data::sound</a></div><div class="ttdeci">std::string sound</div><div class="ttdoc">Sound description, can be used with sounds::sound, it is already translated.</div><div class="ttdef"><b>Definition:</b> <a href="item_8h_source.html#l01852">item.h:1852</a></div></div>
<div class="ttc" id="astructitem_1_1sound__data_html_aa2fb844ce506ca62f0c5d1d549f54826"><div class="ttname"><a href="structitem_1_1sound__data.html#aa2fb844ce506ca62f0c5d1d549f54826">item::sound_data::volume</a></div><div class="ttdeci">int volume</div><div class="ttdoc">Volume of the sound.</div><div class="ttdef"><b>Definition:</b> <a href="item_8h_source.html#l01850">item.h:1850</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="translations_8h_source.html#l00116">_</a>, <a class="el" href="namespacesounds.html#af6b3d144906d9ccfda6824fb87e46aa3ac222ae0d4e9c59bd254b72521b9e74ed">sounds::combat</a>, <a class="el" href="sounds_8cpp_source.html#l01604">sfx::generate_gun_sound()</a>, <a class="el" href="ranged_8cpp_source.html#l01812">item::gun_noise()</a>, <a class="el" href="character_8cpp_source.html#l00601">Character::pos()</a>, <a class="el" href="item_8h_source.html#l01852">item::sound_data::sound</a>, <a class="el" href="sounds_8cpp_source.html#l00177">sounds::sound()</a>, and <a class="el" href="item_8h_source.html#l01850">item::sound_data::volume</a>.</p>

<p class="reference">Referenced by <a class="el" href="ranged_8cpp_source.html#l00822">fire_gun()</a>.</p>

</div>
</div>
<a id="af042bc3e3b1ea1c57a42ee323ad284a8" name="af042bc3e3b1ea1c57a42ee323ad284a8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af042bc3e3b1ea1c57a42ee323ad284a8">&#9670;&nbsp;</a></span>print_dmg_msg()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ranged::print_dmg_msg </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classCreature.html">Creature</a> &amp;&#160;</td>
          <td class="paramname"><em>target</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classCreature.html">Creature</a> *&#160;</td>
          <td class="paramname"><em>source</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structdealt__damage__instance.html">dealt_damage_instance</a> &amp;&#160;</td>
          <td class="paramname"><em>dealt_dam</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespaceranged.html#a5d9da06327706ab87ae19ee9dc08de53">hit_tier</a>&#160;</td>
          <td class="paramname"><em>ht</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="creature_8cpp_source.html#l00555">555</a> of file <a class="el" href="creature_8cpp_source.html">creature.cpp</a>.</p>
<div class="fragment"><div class="line"><a id="l00557" name="l00557"></a><span class="lineno">  557</span>{</div>
<div class="line"><a id="l00558" name="l00558"></a><span class="lineno">  558</span>    std::string <a class="code hl_variable" href="namespacemapgen__defer.html#a616ad2c7ee2eb002b683b41b04a888c1">message</a>;</div>
<div class="line"><a id="l00559" name="l00559"></a><span class="lineno">  559</span>    <a class="code hl_enumeration" href="enums_8h.html#a3baf36d700701401b6baf94db93d096e">game_message_type</a> sct_color = <a class="code hl_enumvalue" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea3ab788e6c7dfa584be4ca2e90c49ec8c">m_neutral</a>;</div>
<div class="line"><a id="l00560" name="l00560"></a><span class="lineno">  560</span>    <span class="keywordflow">switch</span>( ht ) {</div>
<div class="line"><a id="l00561" name="l00561"></a><span class="lineno">  561</span>        <span class="keywordflow">case</span> hit_tier::grazing:</div>
<div class="line"><a id="l00562" name="l00562"></a><span class="lineno">  562</span>            <a class="code hl_variable" href="namespacemapgen__defer.html#a616ad2c7ee2eb002b683b41b04a888c1">message</a> = <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Grazing hit.&quot;</span> );</div>
<div class="line"><a id="l00563" name="l00563"></a><span class="lineno">  563</span>            sct_color = <a class="code hl_enumvalue" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea379f06a1968886ca7a96b103d5a628fc">m_grazing</a>;</div>
<div class="line"><a id="l00564" name="l00564"></a><span class="lineno">  564</span>        <span class="keywordflow">case</span> hit_tier::normal:</div>
<div class="line"><a id="l00565" name="l00565"></a><span class="lineno">  565</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00566" name="l00566"></a><span class="lineno">  566</span>        <span class="keywordflow">case</span> hit_tier::critical:</div>
<div class="line"><a id="l00567" name="l00567"></a><span class="lineno">  567</span>            <a class="code hl_variable" href="namespacemapgen__defer.html#a616ad2c7ee2eb002b683b41b04a888c1">message</a> = <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Critical!&quot;</span> );</div>
<div class="line"><a id="l00568" name="l00568"></a><span class="lineno">  568</span>            sct_color = <a class="code hl_enumvalue" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea8663170a60ff438f4ba2ab98a1e6d6b5">m_critical</a>;</div>
<div class="line"><a id="l00569" name="l00569"></a><span class="lineno">  569</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00570" name="l00570"></a><span class="lineno">  570</span>    }</div>
<div class="line"><a id="l00571" name="l00571"></a><span class="lineno">  571</span> </div>
<div class="line"><a id="l00572" name="l00572"></a><span class="lineno">  572</span>    <span class="keywordflow">if</span>( source != <span class="keyword">nullptr</span> &amp;&amp; !<a class="code hl_variable" href="namespacemapgen__defer.html#a616ad2c7ee2eb002b683b41b04a888c1">message</a>.empty() ) {</div>
<div class="line"><a id="l00573" name="l00573"></a><span class="lineno">  573</span>        source-&gt;<a class="code hl_function" href="classCreature.html#a91dc4715c36eef7d116f944be9a4d435">add_msg_if_player</a>( <a class="code hl_enumvalue" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea2f644bab8f796b847285eab073040f10">m_good</a>, <a class="code hl_variable" href="namespacemapgen__defer.html#a616ad2c7ee2eb002b683b41b04a888c1">message</a> );</div>
<div class="line"><a id="l00574" name="l00574"></a><span class="lineno">  574</span>    }</div>
<div class="line"><a id="l00575" name="l00575"></a><span class="lineno">  575</span> </div>
<div class="line"><a id="l00576" name="l00576"></a><span class="lineno">  576</span>    <span class="keywordflow">if</span>( dealt_dam.<a class="code hl_function" href="structdealt__damage__instance.html#a86b702070a1c313624abc78ff34eff48">total_damage</a>() == 0 ) {</div>
<div class="line"><a id="l00577" name="l00577"></a><span class="lineno">  577</span>        <span class="comment">//~ 1$ - monster name, 2$ - character&#39;s bodypart or monster&#39;s skin/armor</span></div>
<div class="line"><a id="l00578" name="l00578"></a><span class="lineno">  578</span>        <a class="code hl_function" href="messages_8cpp.html#a54489326fc37823819c5105addfa27f2">add_msg</a>( <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;The shot reflects off %1$s %2$s!&quot;</span> ), target.<a class="code hl_function" href="classCreature.html#a26b7c431f85f0b99b888db69318ebdc5">disp_name</a>( <span class="keyword">true</span> ),</div>
<div class="line"><a id="l00579" name="l00579"></a><span class="lineno">  579</span>                 ( target.<a class="code hl_function" href="classCreature.html#a07012d6d1998068bef112510c7424374">is_monster</a>() || dealt_dam.<a class="code hl_variable" href="structdealt__damage__instance.html#ad39dc827923ad7b203f2061134ed1db1">bp_hit</a> == <a class="code hl_enumvalue" href="bodypart_8h.html#af618290c4c2de42aab87977ac7311980ac09d37dac773806a42c13041ba254700">num_bp</a> ) ?</div>
<div class="line"><a id="l00580" name="l00580"></a><span class="lineno">  580</span>                 target.<a class="code hl_function" href="classCreature.html#a490503cd007e206dcd23fd8457017793">skin_name</a>() :</div>
<div class="line"><a id="l00581" name="l00581"></a><span class="lineno">  581</span>                 <a class="code hl_function" href="bodypart_8cpp.html#ab29c0bad9828b787ace4d04a5e951c6b">body_part_name_accusative</a>( dealt_dam.<a class="code hl_variable" href="structdealt__damage__instance.html#ad39dc827923ad7b203f2061134ed1db1">bp_hit</a> ) );</div>
<div class="line"><a id="l00582" name="l00582"></a><span class="lineno">  582</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( target.<a class="code hl_function" href="classCreature.html#a1217a190a2e561227e831a72d4a6d390">is_player</a>() ) {</div>
<div class="line"><a id="l00583" name="l00583"></a><span class="lineno">  583</span>        <span class="keywordflow">if</span>( dealt_dam.<a class="code hl_variable" href="structdealt__damage__instance.html#ad39dc827923ad7b203f2061134ed1db1">bp_hit</a> != <a class="code hl_function" href="classstring__id.html#ae29dd8ed38d2b5eb443a65ad46f10b2d">bodypart_str_id::NULL_ID</a>()-&gt;<a class="code hl_variable" href="structbody__part__type.html#a90beb41f3dca18cdbe06f8483336c899">token</a> ) {</div>
<div class="line"><a id="l00584" name="l00584"></a><span class="lineno">  584</span>            <span class="comment">//monster hits player ranged</span></div>
<div class="line"><a id="l00585" name="l00585"></a><span class="lineno">  585</span>            <span class="comment">//~ Hit message. 1$s is bodypart name in accusative. 2$d is damage value.</span></div>
<div class="line"><a id="l00586" name="l00586"></a><span class="lineno">  586</span>            target.<a class="code hl_function" href="classCreature.html#a91dc4715c36eef7d116f944be9a4d435">add_msg_if_player</a>( <a class="code hl_enumvalue" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea72e7b82d57a6df0d4263c2043139b1b1">m_bad</a>, <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;You were hit in the %1$s for %2$d damage.&quot;</span> ),</div>
<div class="line"><a id="l00587" name="l00587"></a><span class="lineno">  587</span>                                      <a class="code hl_function" href="bodypart_8cpp.html#ab29c0bad9828b787ace4d04a5e951c6b">body_part_name_accusative</a>( dealt_dam.<a class="code hl_variable" href="structdealt__damage__instance.html#ad39dc827923ad7b203f2061134ed1db1">bp_hit</a> ),</div>
<div class="line"><a id="l00588" name="l00588"></a><span class="lineno">  588</span>                                      dealt_dam.<a class="code hl_function" href="structdealt__damage__instance.html#a86b702070a1c313624abc78ff34eff48">total_damage</a>() );</div>
<div class="line"><a id="l00589" name="l00589"></a><span class="lineno">  589</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00590" name="l00590"></a><span class="lineno">  590</span>            target.<a class="code hl_function" href="classCreature.html#a91dc4715c36eef7d116f944be9a4d435">add_msg_if_player</a>( <a class="code hl_enumvalue" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea72e7b82d57a6df0d4263c2043139b1b1">m_bad</a>, <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;You were hit for a total of %d damage.&quot;</span> ),</div>
<div class="line"><a id="l00591" name="l00591"></a><span class="lineno">  591</span>                                      dealt_dam.<a class="code hl_function" href="structdealt__damage__instance.html#a86b702070a1c313624abc78ff34eff48">total_damage</a>() );</div>
<div class="line"><a id="l00592" name="l00592"></a><span class="lineno">  592</span>        }</div>
<div class="line"><a id="l00593" name="l00593"></a><span class="lineno">  593</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( source != <span class="keyword">nullptr</span> ) {</div>
<div class="line"><a id="l00594" name="l00594"></a><span class="lineno">  594</span>        <span class="keywordflow">if</span>( source-&gt;<a class="code hl_function" href="classCreature.html#a1217a190a2e561227e831a72d4a6d390">is_player</a>() ) {</div>
<div class="line"><a id="l00595" name="l00595"></a><span class="lineno">  595</span>            <span class="comment">//player hits monster ranged</span></div>
<div class="line"><a id="l00596" name="l00596"></a><span class="lineno">  596</span>            <a class="code hl_variable" href="output_8cpp.html#ac8f1d6275ee49732d8988e5e671b1776">SCT</a>.<a class="code hl_function" href="classscrollingcombattext.html#a47effb4da95a0979a8275240a6ac8b8a">add</a>( target.<a class="code hl_function" href="classCreature.html#a45926a7ba63ccc9be744f87a4d540b7d">pos</a>().<a class="code hl_function" href="structtripoint.html#accc0725c936dbebb2486f969f39e2e5f">xy</a>(),</div>
<div class="line"><a id="l00597" name="l00597"></a><span class="lineno">  597</span>                     <a class="code hl_function" href="coordinates_8h.html#a00be0762df7b46da965e55caffac53db">direction_from</a>( <a class="code hl_variable" href="point_8h.html#a0ee2195dcb488ae55fbf4316f5011172">point_zero</a>, target.<a class="code hl_function" href="classCreature.html#a45926a7ba63ccc9be744f87a4d540b7d">pos</a>().<a class="code hl_function" href="structtripoint.html#accc0725c936dbebb2486f969f39e2e5f">xy</a>() - source-&gt;<a class="code hl_function" href="classCreature.html#a45926a7ba63ccc9be744f87a4d540b7d">pos</a>().<a class="code hl_function" href="structtripoint.html#accc0725c936dbebb2486f969f39e2e5f">xy</a>() ),</div>
<div class="line"><a id="l00598" name="l00598"></a><span class="lineno">  598</span>                     <a class="code hl_function" href="output_8cpp.html#a4fce254b5cc5c01524772be29ea40980">get_hp_bar</a>( dealt_dam.<a class="code hl_function" href="structdealt__damage__instance.html#a86b702070a1c313624abc78ff34eff48">total_damage</a>(), target.<a class="code hl_function" href="classCreature.html#a6e1819fd37a50af66566c6d1b896572a">get_hp_max</a>(), <span class="keyword">true</span> ).first,</div>
<div class="line"><a id="l00599" name="l00599"></a><span class="lineno">  599</span>                     <a class="code hl_enumvalue" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea2f644bab8f796b847285eab073040f10">m_good</a>, <a class="code hl_variable" href="namespacemapgen__defer.html#a616ad2c7ee2eb002b683b41b04a888c1">message</a>, sct_color );</div>
<div class="line"><a id="l00600" name="l00600"></a><span class="lineno">  600</span> </div>
<div class="line"><a id="l00601" name="l00601"></a><span class="lineno">  601</span>            <span class="keywordflow">if</span>( target.<a class="code hl_function" href="classCreature.html#a94737d93f30cee269b2df71478ee29fd">get_hp</a>() &gt; 0 ) {</div>
<div class="line"><a id="l00602" name="l00602"></a><span class="lineno">  602</span>                <a class="code hl_variable" href="output_8cpp.html#ac8f1d6275ee49732d8988e5e671b1776">SCT</a>.<a class="code hl_function" href="classscrollingcombattext.html#a47effb4da95a0979a8275240a6ac8b8a">add</a>( target.<a class="code hl_function" href="classCreature.html#a45926a7ba63ccc9be744f87a4d540b7d">pos</a>().<a class="code hl_function" href="structtripoint.html#accc0725c936dbebb2486f969f39e2e5f">xy</a>(),</div>
<div class="line"><a id="l00603" name="l00603"></a><span class="lineno">  603</span>                         <a class="code hl_function" href="coordinates_8h.html#a00be0762df7b46da965e55caffac53db">direction_from</a>( <a class="code hl_variable" href="point_8h.html#a0ee2195dcb488ae55fbf4316f5011172">point_zero</a>, target.<a class="code hl_function" href="classCreature.html#a45926a7ba63ccc9be744f87a4d540b7d">pos</a>().<a class="code hl_function" href="structtripoint.html#accc0725c936dbebb2486f969f39e2e5f">xy</a>() - source-&gt;<a class="code hl_function" href="classCreature.html#a45926a7ba63ccc9be744f87a4d540b7d">pos</a>().<a class="code hl_function" href="structtripoint.html#accc0725c936dbebb2486f969f39e2e5f">xy</a>() ),</div>
<div class="line"><a id="l00604" name="l00604"></a><span class="lineno">  604</span>                         <a class="code hl_function" href="output_8cpp.html#a4fce254b5cc5c01524772be29ea40980">get_hp_bar</a>( target.<a class="code hl_function" href="classCreature.html#a94737d93f30cee269b2df71478ee29fd">get_hp</a>(), target.<a class="code hl_function" href="classCreature.html#a6e1819fd37a50af66566c6d1b896572a">get_hp_max</a>(), <span class="keyword">true</span> ).first, <a class="code hl_enumvalue" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea2f644bab8f796b847285eab073040f10">m_good</a>,</div>
<div class="line"><a id="l00605" name="l00605"></a><span class="lineno">  605</span>                         <span class="comment">//~ &quot;hit points&quot;, used in scrolling combat text</span></div>
<div class="line"><a id="l00606" name="l00606"></a><span class="lineno">  606</span>                         <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;hp&quot;</span> ), <a class="code hl_enumvalue" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea3ab788e6c7dfa584be4ca2e90c49ec8c">m_neutral</a>, <span class="stringliteral">&quot;hp&quot;</span> );</div>
<div class="line"><a id="l00607" name="l00607"></a><span class="lineno">  607</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00608" name="l00608"></a><span class="lineno">  608</span>                <a class="code hl_variable" href="output_8cpp.html#ac8f1d6275ee49732d8988e5e671b1776">SCT</a>.<a class="code hl_function" href="classscrollingcombattext.html#a94b652fa370f1b1a946c726c93abb9bd">removeCreatureHP</a>();</div>
<div class="line"><a id="l00609" name="l00609"></a><span class="lineno">  609</span>            }</div>
<div class="line"><a id="l00610" name="l00610"></a><span class="lineno">  610</span> </div>
<div class="line"><a id="l00611" name="l00611"></a><span class="lineno">  611</span>            <span class="comment">//~ %1$s: creature name, %2$d: damage value</span></div>
<div class="line"><a id="l00612" name="l00612"></a><span class="lineno">  612</span>            <a class="code hl_function" href="messages_8cpp.html#a54489326fc37823819c5105addfa27f2">add_msg</a>( <a class="code hl_enumvalue" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea2f644bab8f796b847285eab073040f10">m_good</a>, <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;You hit %1$s for %2$d damage.&quot;</span> ),</div>
<div class="line"><a id="l00613" name="l00613"></a><span class="lineno">  613</span>                     target.<a class="code hl_function" href="classCreature.html#a26b7c431f85f0b99b888db69318ebdc5">disp_name</a>(), dealt_dam.<a class="code hl_function" href="structdealt__damage__instance.html#a86b702070a1c313624abc78ff34eff48">total_damage</a>() );</div>
<div class="line"><a id="l00614" name="l00614"></a><span class="lineno">  614</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00615" name="l00615"></a><span class="lineno">  615</span>            <span class="comment">//~ 1$ - shooter, 2$ - target</span></div>
<div class="line"><a id="l00616" name="l00616"></a><span class="lineno">  616</span>            <a class="code hl_function" href="messages_8cpp.html#a54489326fc37823819c5105addfa27f2">add_msg</a>( <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;%1$s shoots %2$s.&quot;</span> ),</div>
<div class="line"><a id="l00617" name="l00617"></a><span class="lineno">  617</span>                     source-&gt;<a class="code hl_function" href="classCreature.html#a26b7c431f85f0b99b888db69318ebdc5">disp_name</a>(), target.<a class="code hl_function" href="classCreature.html#a26b7c431f85f0b99b888db69318ebdc5">disp_name</a>() );</div>
<div class="line"><a id="l00618" name="l00618"></a><span class="lineno">  618</span>        }</div>
<div class="line"><a id="l00619" name="l00619"></a><span class="lineno">  619</span>    }</div>
<div class="line"><a id="l00620" name="l00620"></a><span class="lineno">  620</span>}</div>
<div class="ttc" id="abodypart_8cpp_html_ab29c0bad9828b787ace4d04a5e951c6b"><div class="ttname"><a href="bodypart_8cpp.html#ab29c0bad9828b787ace4d04a5e951c6b">body_part_name_accusative</a></div><div class="ttdeci">std::string body_part_name_accusative(body_part bp, int number)</div><div class="ttdoc">Returns the matching accusative name of the body_part token, i.e.</div><div class="ttdef"><b>Definition:</b> <a href="bodypart_8cpp_source.html#l00331">bodypart.cpp:331</a></div></div>
<div class="ttc" id="abodypart_8h_html_af618290c4c2de42aab87977ac7311980ac09d37dac773806a42c13041ba254700"><div class="ttname"><a href="bodypart_8h.html#af618290c4c2de42aab87977ac7311980ac09d37dac773806a42c13041ba254700">num_bp</a></div><div class="ttdeci">@ num_bp</div><div class="ttdef"><b>Definition:</b> <a href="bodypart_8h_source.html#l00054">bodypart.h:53</a></div></div>
<div class="ttc" id="aclassCreature_html_a07012d6d1998068bef112510c7424374"><div class="ttname"><a href="classCreature.html#a07012d6d1998068bef112510c7424374">Creature::is_monster</a></div><div class="ttdeci">virtual bool is_monster() const</div><div class="ttdef"><b>Definition:</b> <a href="creature_8h_source.html#l00101">creature.h:101</a></div></div>
<div class="ttc" id="aclassCreature_html_a1217a190a2e561227e831a72d4a6d390"><div class="ttname"><a href="classCreature.html#a1217a190a2e561227e831a72d4a6d390">Creature::is_player</a></div><div class="ttdeci">virtual bool is_player() const</div><div class="ttdef"><b>Definition:</b> <a href="creature_8h_source.html#l00092">creature.h:92</a></div></div>
<div class="ttc" id="aclassCreature_html_a26b7c431f85f0b99b888db69318ebdc5"><div class="ttname"><a href="classCreature.html#a26b7c431f85f0b99b888db69318ebdc5">Creature::disp_name</a></div><div class="ttdeci">virtual std::string disp_name(bool possessive=false, bool capitalize_first=false) const =0</div></div>
<div class="ttc" id="aclassCreature_html_a45926a7ba63ccc9be744f87a4d540b7d"><div class="ttname"><a href="classCreature.html#a45926a7ba63ccc9be744f87a4d540b7d">Creature::pos</a></div><div class="ttdeci">virtual const tripoint &amp; pos() const =0</div></div>
<div class="ttc" id="aclassCreature_html_a490503cd007e206dcd23fd8457017793"><div class="ttname"><a href="classCreature.html#a490503cd007e206dcd23fd8457017793">Creature::skin_name</a></div><div class="ttdeci">virtual std::string skin_name() const =0</div></div>
<div class="ttc" id="aclassCreature_html_a6e1819fd37a50af66566c6d1b896572a"><div class="ttname"><a href="classCreature.html#a6e1819fd37a50af66566c6d1b896572a">Creature::get_hp_max</a></div><div class="ttdeci">virtual int get_hp_max(const bodypart_id &amp;bp) const</div><div class="ttdef"><b>Definition:</b> <a href="creature_8cpp_source.html#l01703">creature.cpp:1703</a></div></div>
<div class="ttc" id="aclassCreature_html_a94737d93f30cee269b2df71478ee29fd"><div class="ttname"><a href="classCreature.html#a94737d93f30cee269b2df71478ee29fd">Creature::get_hp</a></div><div class="ttdeci">virtual int get_hp(const bodypart_id &amp;bp) const</div><div class="ttdef"><b>Definition:</b> <a href="creature_8cpp_source.html#l01686">creature.cpp:1686</a></div></div>
<div class="ttc" id="aclassscrollingcombattext_html_a47effb4da95a0979a8275240a6ac8b8a"><div class="ttname"><a href="classscrollingcombattext.html#a47effb4da95a0979a8275240a6ac8b8a">scrollingcombattext::add</a></div><div class="ttdeci">void add(point pos, direction p_oDir, const std::string &amp;p_sText, game_message_type p_gmt, const std::string &amp;p_sText2=&quot;&quot;, game_message_type p_gmt2=m_neutral, const std::string &amp;p_sType=&quot;&quot;)</div><div class="ttdef"><b>Definition:</b> <a href="output_8cpp_source.html#l01757">output.cpp:1757</a></div></div>
<div class="ttc" id="aclassscrollingcombattext_html_a94b652fa370f1b1a946c726c93abb9bd"><div class="ttname"><a href="classscrollingcombattext.html#a94b652fa370f1b1a946c726c93abb9bd">scrollingcombattext::removeCreatureHP</a></div><div class="ttdeci">void removeCreatureHP()</div><div class="ttdef"><b>Definition:</b> <a href="output_8cpp_source.html#l01937">output.cpp:1937</a></div></div>
<div class="ttc" id="acoordinates_8h_html_a00be0762df7b46da965e55caffac53db"><div class="ttname"><a href="coordinates_8h.html#a00be0762df7b46da965e55caffac53db">direction_from</a></div><div class="ttdeci">direction direction_from(const coords::coord_point&lt; Point, Origin, Scale &gt; &amp;loc1, const coords::coord_point&lt; Point, Origin, Scale &gt; &amp;loc2)</div><div class="ttdef"><b>Definition:</b> <a href="coordinates_8h_source.html#l00540">coordinates.h:540</a></div></div>
<div class="ttc" id="aenums_8h_html_a3baf36d700701401b6baf94db93d096e"><div class="ttname"><a href="enums_8h.html#a3baf36d700701401b6baf94db93d096e">game_message_type</a></div><div class="ttdeci">game_message_type</div><div class="ttdef"><b>Definition:</b> <a href="enums_8h_source.html#l00259">enums.h:259</a></div></div>
<div class="ttc" id="aenums_8h_html_a3baf36d700701401b6baf94db93d096ea379f06a1968886ca7a96b103d5a628fc"><div class="ttname"><a href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea379f06a1968886ca7a96b103d5a628fc">m_grazing</a></div><div class="ttdeci">@ m_grazing</div><div class="ttdef"><b>Definition:</b> <a href="enums_8h_source.html#l00275">enums.h:275</a></div></div>
<div class="ttc" id="aenums_8h_html_a3baf36d700701401b6baf94db93d096ea3ab788e6c7dfa584be4ca2e90c49ec8c"><div class="ttname"><a href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea3ab788e6c7dfa584be4ca2e90c49ec8c">m_neutral</a></div><div class="ttdeci">@ m_neutral</div><div class="ttdef"><b>Definition:</b> <a href="enums_8h_source.html#l00267">enums.h:267</a></div></div>
<div class="ttc" id="aenums_8h_html_a3baf36d700701401b6baf94db93d096ea8663170a60ff438f4ba2ab98a1e6d6b5"><div class="ttname"><a href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea8663170a60ff438f4ba2ab98a1e6d6b5">m_critical</a></div><div class="ttdeci">@ m_critical</div><div class="ttdef"><b>Definition:</b> <a href="enums_8h_source.html#l00274">enums.h:274</a></div></div>
<div class="ttc" id="amessages_8cpp_html_a54489326fc37823819c5105addfa27f2"><div class="ttname"><a href="messages_8cpp.html#a54489326fc37823819c5105addfa27f2">add_msg</a></div><div class="ttdeci">void add_msg(std::string msg)</div><div class="ttdef"><b>Definition:</b> <a href="messages_8cpp_source.html#l00910">messages.cpp:910</a></div></div>
<div class="ttc" id="anamespacemapgen__defer_html_a616ad2c7ee2eb002b683b41b04a888c1"><div class="ttname"><a href="namespacemapgen__defer.html#a616ad2c7ee2eb002b683b41b04a888c1">mapgen_defer::message</a></div><div class="ttdeci">std::string message</div><div class="ttdef"><b>Definition:</b> <a href="mapgen_8cpp_source.html#l00411">mapgen.cpp:411</a></div></div>
<div class="ttc" id="aoutput_8cpp_html_a4fce254b5cc5c01524772be29ea40980"><div class="ttname"><a href="output_8cpp.html#a4fce254b5cc5c01524772be29ea40980">get_hp_bar</a></div><div class="ttdeci">std::pair&lt; std::string, nc_color &gt; get_hp_bar(const int cur_hp, const int max_hp, const bool is_mon)</div><div class="ttdef"><b>Definition:</b> <a href="output_8cpp_source.html#l01604">output.cpp:1604</a></div></div>
<div class="ttc" id="aoutput_8cpp_html_ac8f1d6275ee49732d8988e5e671b1776"><div class="ttname"><a href="output_8cpp.html#ac8f1d6275ee49732d8988e5e671b1776">SCT</a></div><div class="ttdeci">scrollingcombattext SCT</div><div class="ttdef"><b>Definition:</b> <a href="output_8cpp_source.html#l00065">output.cpp:65</a></div></div>
<div class="ttc" id="apoint_8h_html_a0ee2195dcb488ae55fbf4316f5011172"><div class="ttname"><a href="point_8h.html#a0ee2195dcb488ae55fbf4316f5011172">point_zero</a></div><div class="ttdeci">static constexpr point point_zero</div><div class="ttdef"><b>Definition:</b> <a href="point_8h_source.html#l00260">point.h:260</a></div></div>
<div class="ttc" id="astructdealt__damage__instance_html_a86b702070a1c313624abc78ff34eff48"><div class="ttname"><a href="structdealt__damage__instance.html#a86b702070a1c313624abc78ff34eff48">dealt_damage_instance::total_damage</a></div><div class="ttdeci">int total_damage() const</div><div class="ttdef"><b>Definition:</b> <a href="damage_8cpp_source.html#l00180">damage.cpp:180</a></div></div>
<div class="ttc" id="astructtripoint_html_accc0725c936dbebb2486f969f39e2e5f"><div class="ttname"><a href="structtripoint.html#accc0725c936dbebb2486f969f39e2e5f">tripoint::xy</a></div><div class="ttdeci">constexpr point xy() const</div><div class="ttdef"><b>Definition:</b> <a href="point_8h_source.html#l00206">point.h:206</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="translations_8h_source.html#l00116">_</a>, <a class="el" href="output_8cpp_source.html#l01757">scrollingcombattext::add()</a>, <a class="el" href="messages_8cpp_source.html#l00910">add_msg()</a>, <a class="el" href="creature_8h_source.html#l00605">Creature::add_msg_if_player()</a>, <a class="el" href="bodypart_8cpp_source.html#l00331">body_part_name_accusative()</a>, <a class="el" href="damage_8h_source.html#l00087">dealt_damage_instance::bp_hit</a>, <a class="el" href="namespaceranged.html#a5d9da06327706ab87ae19ee9dc08de53a7e85bcb66fb9a809d5ab4f62a8b8bea8">critical</a>, <a class="el" href="coordinates_8h_source.html#l00540">direction_from()</a>, <a class="el" href="classCreature.html#a26b7c431f85f0b99b888db69318ebdc5">Creature::disp_name()</a>, <a class="el" href="creature_8cpp_source.html#l01686">Creature::get_hp()</a>, <a class="el" href="output_8cpp_source.html#l01604">get_hp_bar()</a>, <a class="el" href="creature_8cpp_source.html#l01703">Creature::get_hp_max()</a>, <a class="el" href="namespaceranged.html#a5d9da06327706ab87ae19ee9dc08de53a52b0f37c2ac81918f900f3d3e6c98597">grazing</a>, <a class="el" href="creature_8h_source.html#l00101">Creature::is_monster()</a>, <a class="el" href="creature_8h_source.html#l00092">Creature::is_player()</a>, <a class="el" href="enums_8h_source.html#l00261">m_bad</a>, <a class="el" href="enums_8h_source.html#l00274">m_critical</a>, <a class="el" href="enums_8h_source.html#l00260">m_good</a>, <a class="el" href="enums_8h_source.html#l00275">m_grazing</a>, <a class="el" href="enums_8h_source.html#l00267">m_neutral</a>, <a class="el" href="mapgen_8cpp_source.html#l00411">mapgen_defer::message</a>, <a class="el" href="namespaceranged.html#a5d9da06327706ab87ae19ee9dc08de53afea087517c26fadd409bd4b9dc642555">normal</a>, <a class="el" href="classstring__id.html#ae29dd8ed38d2b5eb443a65ad46f10b2d">string_id&lt; body_part_type &gt;::NULL_ID()</a>, <a class="el" href="bodypart_8h_source.html#l00053">num_bp</a>, <a class="el" href="point_8h_source.html#l00260">point_zero</a>, <a class="el" href="classCreature.html#a45926a7ba63ccc9be744f87a4d540b7d">Creature::pos()</a>, <a class="el" href="output_8cpp_source.html#l01937">scrollingcombattext::removeCreatureHP()</a>, <a class="el" href="output_8cpp_source.html#l00065">SCT</a>, <a class="el" href="classCreature.html#a490503cd007e206dcd23fd8457017793">Creature::skin_name()</a>, <a class="el" href="bodypart_8h_source.html#l00107">body_part_type::token</a>, <a class="el" href="damage_8cpp_source.html#l00180">dealt_damage_instance::total_damage()</a>, and <a class="el" href="point_8h_source.html#l00206">tripoint::xy()</a>.</p>

</div>
</div>
<a id="ae7778ea8feb8352ac65fe74e81164ebc" name="ae7778ea8feb8352ac65fe74e81164ebc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae7778ea8feb8352ac65fe74e81164ebc">&#9670;&nbsp;</a></span>prompt_select_default_ammo_for()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ranged::prompt_select_default_ammo_for </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classavatar.html">avatar</a> &amp;&#160;</td>
          <td class="paramname"><em>u</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classitem.html">item</a> &amp;&#160;</td>
          <td class="paramname"><em>w</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Prompts to select default ammo compatible with provided gun. </p>

<p class="definition">Definition at line <a class="el" href="ranged_8cpp_source.html#l03804">3804</a> of file <a class="el" href="ranged_8cpp_source.html">ranged.cpp</a>.</p>
<div class="fragment"><div class="line"><a id="l03805" name="l03805"></a><span class="lineno"> 3805</span>{</div>
<div class="line"><a id="l03806" name="l03806"></a><span class="lineno"> 3806</span>    <a class="code hl_class" href="classitem__reload__option.html">item_reload_option</a> opt = <a class="code hl_function" href="namespacecharacter__funcs.html#a4c310418ea1c2bab8b4b03d7e0981df9">character_funcs::select_ammo</a>( u, w, <span class="keyword">false</span>, <span class="keyword">true</span>, <span class="keyword">true</span> );</div>
<div class="line"><a id="l03807" name="l03807"></a><span class="lineno"> 3807</span>    <span class="keywordflow">if</span>( opt ) {</div>
<div class="line"><a id="l03808" name="l03808"></a><span class="lineno"> 3808</span>        <span class="keywordflow">if</span>( u.<a class="code hl_variable" href="classplayer.html#a5f1ee4ce958fda62c4766dd8762529c2">ammo_location</a> &amp;&amp; opt.<a class="code hl_variable" href="classitem__reload__option.html#aaa2e80736bd76e83cd1fa4c871211bbd">ammo</a> == u.<a class="code hl_variable" href="classplayer.html#a5f1ee4ce958fda62c4766dd8762529c2">ammo_location</a> ) {</div>
<div class="line"><a id="l03809" name="l03809"></a><span class="lineno"> 3809</span>            u.<a class="code hl_function" href="classplayer.html#ae7009d849f19a4f5ebe877cbe463c459">add_msg_if_player</a>( <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Cleared ammo preferences for %s.&quot;</span> ), w.<a class="code hl_function" href="classitem.html#a7e78e26dcf9b357cda769c3ca2938eda">tname</a>() );</div>
<div class="line"><a id="l03810" name="l03810"></a><span class="lineno"> 3810</span>            u.<a class="code hl_variable" href="classplayer.html#a5f1ee4ce958fda62c4766dd8762529c2">ammo_location</a> = <a class="code hl_class" href="classitem__location.html">item_location</a>();</div>
<div class="line"><a id="l03811" name="l03811"></a><span class="lineno"> 3811</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( u.<a class="code hl_function" href="classvisitable.html#af49d5ef7b3f2f0a8664c23097a56373f">has_item</a>( *opt.<a class="code hl_variable" href="classitem__reload__option.html#aaa2e80736bd76e83cd1fa4c871211bbd">ammo</a> ) ) {</div>
<div class="line"><a id="l03812" name="l03812"></a><span class="lineno"> 3812</span>            u.<a class="code hl_function" href="classplayer.html#ae7009d849f19a4f5ebe877cbe463c459">add_msg_if_player</a>( <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Selected %s as default ammo for %s.&quot;</span> ), opt.<a class="code hl_variable" href="classitem__reload__option.html#aaa2e80736bd76e83cd1fa4c871211bbd">ammo</a>-&gt;<a class="code hl_function" href="classitem.html#a7e78e26dcf9b357cda769c3ca2938eda">tname</a>(), w.<a class="code hl_function" href="classitem.html#a7e78e26dcf9b357cda769c3ca2938eda">tname</a>() );</div>
<div class="line"><a id="l03813" name="l03813"></a><span class="lineno"> 3813</span>            u.<a class="code hl_variable" href="classplayer.html#a5f1ee4ce958fda62c4766dd8762529c2">ammo_location</a> = opt.<a class="code hl_variable" href="classitem__reload__option.html#aaa2e80736bd76e83cd1fa4c871211bbd">ammo</a>;</div>
<div class="line"><a id="l03814" name="l03814"></a><span class="lineno"> 3814</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l03815" name="l03815"></a><span class="lineno"> 3815</span>            u.<a class="code hl_function" href="classplayer.html#ae7009d849f19a4f5ebe877cbe463c459">add_msg_if_player</a>( <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;You don&#39;t have that ammo on you.&quot;</span> ) );</div>
<div class="line"><a id="l03816" name="l03816"></a><span class="lineno"> 3816</span>        }</div>
<div class="line"><a id="l03817" name="l03817"></a><span class="lineno"> 3817</span>    }</div>
<div class="line"><a id="l03818" name="l03818"></a><span class="lineno"> 3818</span>}</div>
<div class="ttc" id="aclassitem__reload__option_html"><div class="ttname"><a href="classitem__reload__option.html">item_reload_option</a></div><div class="ttdef"><b>Definition:</b> <a href="item_8h_source.html#l00175">item.h:176</a></div></div>
<div class="ttc" id="aclassitem__reload__option_html_aaa2e80736bd76e83cd1fa4c871211bbd"><div class="ttname"><a href="classitem__reload__option.html#aaa2e80736bd76e83cd1fa4c871211bbd">item_reload_option::ammo</a></div><div class="ttdeci">item_location ammo</div><div class="ttdef"><b>Definition:</b> <a href="item_8h_source.html#l00188">item.h:188</a></div></div>
<div class="ttc" id="aclassplayer_html_a5f1ee4ce958fda62c4766dd8762529c2"><div class="ttname"><a href="classplayer.html#a5f1ee4ce958fda62c4766dd8762529c2">player::ammo_location</a></div><div class="ttdeci">item_location ammo_location</div><div class="ttdef"><b>Definition:</b> <a href="player_8h_source.html#l00244">player.h:244</a></div></div>
<div class="ttc" id="aclassplayer_html_ae7009d849f19a4f5ebe877cbe463c459"><div class="ttname"><a href="classplayer.html#ae7009d849f19a4f5ebe877cbe463c459">player::add_msg_if_player</a></div><div class="ttdeci">void add_msg_if_player(const std::string &amp;msg) const override</div><div class="ttdef"><b>Definition:</b> <a href="player_8cpp_source.html#l00366">player.cpp:366</a></div></div>
<div class="ttc" id="anamespacecharacter__funcs_html_a4c310418ea1c2bab8b4b03d7e0981df9"><div class="ttname"><a href="namespacecharacter__funcs.html#a4c310418ea1c2bab8b4b03d7e0981df9">character_funcs::select_ammo</a></div><div class="ttdeci">item_reload_option select_ammo(const Character &amp;who, const item &amp;base, std::vector&lt; item_reload_option &gt; opts)</div><div class="ttdoc">Select ammo from the provided options.</div><div class="ttdef"><b>Definition:</b> <a href="character__functions_8cpp_source.html#l00750">character_functions.cpp:750</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="translations_8h_source.html#l00116">_</a>, <a class="el" href="player_8cpp_source.html#l00366">player::add_msg_if_player()</a>, <a class="el" href="item_8h_source.html#l00188">item_reload_option::ammo</a>, <a class="el" href="player_8h_source.html#l00244">player::ammo_location</a>, <a class="el" href="visitable_8cpp_source.html#l00095">visitable&lt; T &gt;::has_item()</a>, <a class="el" href="character__functions_8cpp_source.html#l00750">character_funcs::select_ammo()</a>, and <a class="el" href="item_8cpp_source.html#l04574">item::tname()</a>.</p>

<p class="reference">Referenced by <a class="el" href="handle__action_8cpp_source.html#l01527">game::handle_action()</a>, and <a class="el" href="avatar__action_8cpp_source.html#l01159">avatar_action::reload()</a>.</p>

</div>
</div>
<a id="a9fab96fd0829b448bad76e542e320156" name="a9fab96fd0829b448bad76e542e320156"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9fab96fd0829b448bad76e542e320156">&#9670;&nbsp;</a></span>recoil_total()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double ranged::recoil_total </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classCharacter.html">Character</a> &amp;&#160;</td>
          <td class="paramname"><em>who</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Current total maximum recoil penalty from all sources. </p>

<p class="definition">Definition at line <a class="el" href="ranged_8cpp_source.html#l02085">2085</a> of file <a class="el" href="ranged_8cpp_source.html">ranged.cpp</a>.</p>
<div class="fragment"><div class="line"><a id="l02086" name="l02086"></a><span class="lineno"> 2086</span>{</div>
<div class="line"><a id="l02087" name="l02087"></a><span class="lineno"> 2087</span>    <span class="keywordflow">return</span> who.<a class="code hl_variable" href="classCharacter.html#a057d68671b298012a18f4e289b39935d">recoil</a> + <a class="code hl_function" href="namespaceranged.html#a6c1943d0fc446952875c5a5cb88cf3fc">recoil_vehicle</a>( who );</div>
<div class="line"><a id="l02088" name="l02088"></a><span class="lineno"> 2088</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="character_8h_source.html#l00571">Character::recoil</a>, and <a class="el" href="ranged_8cpp_source.html#l02073">recoil_vehicle()</a>.</p>

<p class="reference">Referenced by <a class="el" href="ranged_8cpp_source.html#l00822">fire_gun()</a>, <a class="el" href="npcmove_8cpp_source.html#l01339">npc::method_of_attack()</a>, <a class="el" href="npcmove_8cpp_source.html#l00703">npc::move()</a>, <a class="el" href="ranged_8cpp_source.html#l03531">target_ui::panel_recoil()</a>, and <a class="el" href="npcmove_8cpp_source.html#l02120">npc::wont_hit_friend()</a>.</p>

</div>
</div>
<a id="a6c1943d0fc446952875c5a5cb88cf3fc" name="a6c1943d0fc446952875c5a5cb88cf3fc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6c1943d0fc446952875c5a5cb88cf3fc">&#9670;&nbsp;</a></span>recoil_vehicle()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double ranged::recoil_vehicle </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classCharacter.html">Character</a> &amp;&#160;</td>
          <td class="paramname"><em>who</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get maximum recoil penalty due to vehicle motion. </p>

<p class="definition">Definition at line <a class="el" href="ranged_8cpp_source.html#l02073">2073</a> of file <a class="el" href="ranged_8cpp_source.html">ranged.cpp</a>.</p>
<div class="fragment"><div class="line"><a id="l02074" name="l02074"></a><span class="lineno"> 2074</span>{</div>
<div class="line"><a id="l02075" name="l02075"></a><span class="lineno"> 2075</span>    <span class="comment">// TODO: vary penalty dependent upon vehicle part on which player is boarded</span></div>
<div class="line"><a id="l02076" name="l02076"></a><span class="lineno"> 2076</span> </div>
<div class="line"><a id="l02077" name="l02077"></a><span class="lineno"> 2077</span>    <span class="keywordflow">if</span>( who.<a class="code hl_variable" href="classCharacter.html#a61bc9422c35b63128532af268e52cb71">in_vehicle</a> ) {</div>
<div class="line"><a id="l02078" name="l02078"></a><span class="lineno"> 2078</span>        <span class="keywordflow">if</span>( <span class="keyword">const</span> <a class="code hl_class" href="classoptional__vpart__position.html">optional_vpart_position</a> vp = <a class="code hl_function" href="map_8cpp.html#acb0b34be6e497bdd2f9f40ae6929d562">get_map</a>().veh_at( who.<a class="code hl_function" href="classCharacter.html#ad24859164517ed6e392e21df69527199">pos</a>() ) ) {</div>
<div class="line"><a id="l02079" name="l02079"></a><span class="lineno"> 2079</span>            <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>( std::abs( vp-&gt;vehicle().velocity ) ) * 3 / 100;</div>
<div class="line"><a id="l02080" name="l02080"></a><span class="lineno"> 2080</span>        }</div>
<div class="line"><a id="l02081" name="l02081"></a><span class="lineno"> 2081</span>    }</div>
<div class="line"><a id="l02082" name="l02082"></a><span class="lineno"> 2082</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a id="l02083" name="l02083"></a><span class="lineno"> 2083</span>}</div>
<div class="ttc" id="aclassCharacter_html_a61bc9422c35b63128532af268e52cb71"><div class="ttname"><a href="classCharacter.html#a61bc9422c35b63128532af268e52cb71">Character::in_vehicle</a></div><div class="ttdeci">bool in_vehicle</div><div class="ttdef"><b>Definition:</b> <a href="character_8h_source.html#l01573">character.h:1573</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="map_8cpp_source.html#l00147">get_map()</a>, <a class="el" href="character_8h_source.html#l01573">Character::in_vehicle</a>, and <a class="el" href="character_8cpp_source.html#l00601">Character::pos()</a>.</p>

<p class="reference">Referenced by <a class="el" href="ranged_8cpp_source.html#l00822">fire_gun()</a>, <a class="el" href="ranged_8cpp_source.html#l01564">print_aim()</a>, and <a class="el" href="ranged_8cpp_source.html#l02085">recoil_total()</a>.</p>

</div>
</div>
<a id="a32d7ead84f4eb01b4050fdbbca0767ea" name="a32d7ead84f4eb01b4050fdbbca0767ea"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a32d7ead84f4eb01b4050fdbbca0767ea">&#9670;&nbsp;</a></span>str_draw_damage_modifier()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float ranged::str_draw_damage_modifier </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classitem.html">item</a> &amp;&#160;</td>
          <td class="paramname"><em>it</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classCharacter.html">Character</a> &amp;&#160;</td>
          <td class="paramname"><em>p</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="ranged_8cpp_source.html#l01031">1031</a> of file <a class="el" href="ranged_8cpp_source.html">ranged.cpp</a>.</p>
<div class="fragment"><div class="line"><a id="l01032" name="l01032"></a><span class="lineno"> 1032</span>{</div>
<div class="line"><a id="l01033" name="l01033"></a><span class="lineno"> 1033</span>    <span class="keywordflow">if</span>( !it.<a class="code hl_function" href="classitem.html#aaa5aeb6f838927babb10ede535cf2a73">has_flag</a>( <a class="code hl_function" href="ranged_8cpp.html#a3756f1dde5d862fe1b0f0240dfc13e6a">flag_STR_DRAW</a> ) || p.<a class="code hl_function" href="classCharacter.html#a5aba683ccf77cb560a0a932308289bd9">get_str</a>() &gt;= it.<a class="code hl_function" href="classitem.html#a2899a37f781e1efea9465a98277141c7">get_min_str</a>() || it.<a class="code hl_function" href="classitem.html#a2899a37f781e1efea9465a98277141c7">get_min_str</a>() &lt;= 1 ) {</div>
<div class="line"><a id="l01034" name="l01034"></a><span class="lineno"> 1034</span>        <span class="keywordflow">return</span> 1.0f;</div>
<div class="line"><a id="l01035" name="l01035"></a><span class="lineno"> 1035</span>    }</div>
<div class="line"><a id="l01036" name="l01036"></a><span class="lineno"> 1036</span>    <span class="keywordflow">if</span>( <a class="code hl_function" href="namespaceranged.html#a4c8c85e0249f67213d9994612315aa3e">ranged::get_str_draw_penalty</a>( it, p ) &lt; 0.75f ) {</div>
<div class="line"><a id="l01037" name="l01037"></a><span class="lineno"> 1037</span>        <span class="keywordflow">return</span> 0.5f;</div>
<div class="line"><a id="l01038" name="l01038"></a><span class="lineno"> 1038</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code hl_function" href="namespaceranged.html#a4c8c85e0249f67213d9994612315aa3e">ranged::get_str_draw_penalty</a>( it, p ) &lt; 1.0f ) {</div>
<div class="line"><a id="l01039" name="l01039"></a><span class="lineno"> 1039</span>        <span class="keywordflow">return</span> 0.75f;</div>
<div class="line"><a id="l01040" name="l01040"></a><span class="lineno"> 1040</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01041" name="l01041"></a><span class="lineno"> 1041</span>        <span class="keywordflow">return</span> 1.0f;</div>
<div class="line"><a id="l01042" name="l01042"></a><span class="lineno"> 1042</span>    }</div>
<div class="line"><a id="l01043" name="l01043"></a><span class="lineno"> 1043</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="ranged_8cpp.html#a3756f1dde5d862fe1b0f0240dfc13e6a">flag_STR_DRAW()</a>, <a class="el" href="item_8cpp_source.html#l10073">item::get_min_str()</a>, <a class="el" href="character_8cpp_source.html#l04090">Character::get_str()</a>, <a class="el" href="ranged_8cpp_source.html#l01019">get_str_draw_penalty()</a>, and <a class="el" href="item_8cpp_source.html#l05328">item::has_flag()</a>.</p>

<p class="reference">Referenced by <a class="el" href="ranged_8cpp_source.html#l00822">fire_gun()</a>, and <a class="el" href="item_8cpp_source.html#l02020">item::gun_info()</a>.</p>

</div>
</div>
<a id="a613a2847b3c06998d6117f2630fc9ed5" name="a613a2847b3c06998d6117f2630fc9ed5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a613a2847b3c06998d6117f2630fc9ed5">&#9670;&nbsp;</a></span>str_draw_dispersion_modifier()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float ranged::str_draw_dispersion_modifier </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classitem.html">item</a> &amp;&#160;</td>
          <td class="paramname"><em>it</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classCharacter.html">Character</a> &amp;&#160;</td>
          <td class="paramname"><em>p</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="ranged_8cpp_source.html#l01045">1045</a> of file <a class="el" href="ranged_8cpp_source.html">ranged.cpp</a>.</p>
<div class="fragment"><div class="line"><a id="l01046" name="l01046"></a><span class="lineno"> 1046</span>{</div>
<div class="line"><a id="l01047" name="l01047"></a><span class="lineno"> 1047</span>    <span class="keywordflow">if</span>( !it.<a class="code hl_function" href="classitem.html#aaa5aeb6f838927babb10ede535cf2a73">has_flag</a>( <a class="code hl_function" href="ranged_8cpp.html#a3756f1dde5d862fe1b0f0240dfc13e6a">flag_STR_DRAW</a> ) || p.<a class="code hl_function" href="classCharacter.html#a5aba683ccf77cb560a0a932308289bd9">get_str</a>() &gt;= it.<a class="code hl_function" href="classitem.html#a2899a37f781e1efea9465a98277141c7">get_min_str</a>() || it.<a class="code hl_function" href="classitem.html#a2899a37f781e1efea9465a98277141c7">get_min_str</a>() &lt;= 1 ) {</div>
<div class="line"><a id="l01048" name="l01048"></a><span class="lineno"> 1048</span>        <span class="keywordflow">return</span> 1.0f;</div>
<div class="line"><a id="l01049" name="l01049"></a><span class="lineno"> 1049</span>    }</div>
<div class="line"><a id="l01050" name="l01050"></a><span class="lineno"> 1050</span>    <span class="keywordflow">if</span>( <a class="code hl_function" href="namespaceranged.html#a4c8c85e0249f67213d9994612315aa3e">ranged::get_str_draw_penalty</a>( it, p ) &lt; 0.75f ) {</div>
<div class="line"><a id="l01051" name="l01051"></a><span class="lineno"> 1051</span>        <span class="keywordflow">return</span> 0.5f;</div>
<div class="line"><a id="l01052" name="l01052"></a><span class="lineno"> 1052</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01053" name="l01053"></a><span class="lineno"> 1053</span>        <span class="keywordflow">return</span> 1.0f;</div>
<div class="line"><a id="l01054" name="l01054"></a><span class="lineno"> 1054</span>    }</div>
<div class="line"><a id="l01055" name="l01055"></a><span class="lineno"> 1055</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="ranged_8cpp.html#a3756f1dde5d862fe1b0f0240dfc13e6a">flag_STR_DRAW()</a>, <a class="el" href="item_8cpp_source.html#l10073">item::get_min_str()</a>, <a class="el" href="character_8cpp_source.html#l04090">Character::get_str()</a>, <a class="el" href="ranged_8cpp_source.html#l01019">get_str_draw_penalty()</a>, and <a class="el" href="item_8cpp_source.html#l05328">item::has_flag()</a>.</p>

<p class="reference">Referenced by <a class="el" href="ranged_8cpp_source.html#l01917">get_weapon_dispersion()</a>.</p>

</div>
</div>
<a id="aa7a46e309ff8892e692a92511635a4eb" name="aa7a46e309ff8892e692a92511635a4eb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa7a46e309ff8892e692a92511635a4eb">&#9670;&nbsp;</a></span>str_draw_range_modifier()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float ranged::str_draw_range_modifier </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classitem.html">item</a> &amp;&#160;</td>
          <td class="paramname"><em>it</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classCharacter.html">Character</a> &amp;&#160;</td>
          <td class="paramname"><em>p</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="ranged_8cpp_source.html#l01057">1057</a> of file <a class="el" href="ranged_8cpp_source.html">ranged.cpp</a>.</p>
<div class="fragment"><div class="line"><a id="l01058" name="l01058"></a><span class="lineno"> 1058</span>{</div>
<div class="line"><a id="l01059" name="l01059"></a><span class="lineno"> 1059</span>    <span class="keywordflow">if</span>( !it.<a class="code hl_function" href="classitem.html#aaa5aeb6f838927babb10ede535cf2a73">has_flag</a>( <a class="code hl_function" href="ranged_8cpp.html#a3756f1dde5d862fe1b0f0240dfc13e6a">flag_STR_DRAW</a> ) || p.<a class="code hl_function" href="classCharacter.html#a5aba683ccf77cb560a0a932308289bd9">get_str</a>() &gt;= it.<a class="code hl_function" href="classitem.html#a2899a37f781e1efea9465a98277141c7">get_min_str</a>() || it.<a class="code hl_function" href="classitem.html#a2899a37f781e1efea9465a98277141c7">get_min_str</a>() &lt;= 1 ) {</div>
<div class="line"><a id="l01060" name="l01060"></a><span class="lineno"> 1060</span>        <span class="keywordflow">return</span> 1.0f;</div>
<div class="line"><a id="l01061" name="l01061"></a><span class="lineno"> 1061</span>    }</div>
<div class="line"><a id="l01062" name="l01062"></a><span class="lineno"> 1062</span>    <span class="keywordflow">if</span>( <a class="code hl_function" href="namespaceranged.html#a4c8c85e0249f67213d9994612315aa3e">ranged::get_str_draw_penalty</a>( it, p ) &lt; 0.75f ) {</div>
<div class="line"><a id="l01063" name="l01063"></a><span class="lineno"> 1063</span>        <span class="keywordflow">return</span> 0.5f;</div>
<div class="line"><a id="l01064" name="l01064"></a><span class="lineno"> 1064</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code hl_function" href="namespaceranged.html#a4c8c85e0249f67213d9994612315aa3e">ranged::get_str_draw_penalty</a>( it, p ) &lt; 1.0f ) {</div>
<div class="line"><a id="l01065" name="l01065"></a><span class="lineno"> 1065</span>        <span class="keywordflow">return</span> 0.75f;</div>
<div class="line"><a id="l01066" name="l01066"></a><span class="lineno"> 1066</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01067" name="l01067"></a><span class="lineno"> 1067</span>        <span class="keywordflow">return</span> 1.0f;</div>
<div class="line"><a id="l01068" name="l01068"></a><span class="lineno"> 1068</span>    }</div>
<div class="line"><a id="l01069" name="l01069"></a><span class="lineno"> 1069</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="ranged_8cpp.html#a3756f1dde5d862fe1b0f0240dfc13e6a">flag_STR_DRAW()</a>, <a class="el" href="item_8cpp_source.html#l10073">item::get_min_str()</a>, <a class="el" href="character_8cpp_source.html#l04090">Character::get_str()</a>, <a class="el" href="ranged_8cpp_source.html#l01019">get_str_draw_penalty()</a>, and <a class="el" href="item_8cpp_source.html#l05328">item::has_flag()</a>.</p>

<p class="reference">Referenced by <a class="el" href="item_8cpp_source.html#l07374">item::gun_range()</a>.</p>

</div>
</div>
<a id="a3fc846128cfc30100d71fbb6e2d482c5" name="a3fc846128cfc30100d71fbb6e2d482c5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3fc846128cfc30100d71fbb6e2d482c5">&#9670;&nbsp;</a></span>targetable_creatures() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt; <a class="el" href="classCreature.html">Creature</a> * &gt; ranged::targetable_creatures </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classCharacter.html">Character</a> &amp;&#160;</td>
          <td class="paramname"><em>c</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>range</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="ranged_8cpp_source.html#l02093">2093</a> of file <a class="el" href="ranged_8cpp_source.html">ranged.cpp</a>.</p>
<div class="fragment"><div class="line"><a id="l02094" name="l02094"></a><span class="lineno"> 2094</span>{</div>
<div class="line"><a id="l02095" name="l02095"></a><span class="lineno"> 2095</span>    <span class="keywordflow">return</span> <a class="code hl_function" href="namespaceranged.html#a41e7f0a8b2c552d2f8ec4c8a4930c7af">targetable_creatures</a>( <a class="code hl_variable" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>, <a class="code hl_enumvalue" href="character_8h.html#addab86bfe6fd0bf8c22ec43df3ec051da1c21724609ac70f1573fd4b755c64ddb">range</a>, <a class="code hl_class" href="classturret__data.html">turret_data</a>() );</div>
<div class="line"><a id="l02096" name="l02096"></a><span class="lineno"> 2096</span>}</div>
<div class="ttc" id="aclassturret__data_html"><div class="ttname"><a href="classturret__data.html">turret_data</a></div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8h_source.html#l00474">vehicle.h:475</a></div></div>
<div class="ttc" id="amagic_8cpp_html_a6753ecfe87da659675b18c2f81d6ec12"><div class="ttname"><a href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a></div><div class="ttdeci">constexpr double c</div><div class="ttdef"><b>Definition:</b> <a href="magic_8cpp_source.html#l01032">magic.cpp:1032</a></div></div>
<div class="ttc" id="anamespaceranged_html_a41e7f0a8b2c552d2f8ec4c8a4930c7af"><div class="ttname"><a href="namespaceranged.html#a41e7f0a8b2c552d2f8ec4c8a4930c7af">ranged::targetable_creatures</a></div><div class="ttdeci">std::vector&lt; Creature * &gt; targetable_creatures(const Character &amp;c, const int range, const turret_data &amp;turret)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l02098">ranged.cpp:2098</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="magic_8cpp_source.html#l01032">c</a>, <a class="el" href="character_8h_source.html#l00104">range</a>, and <a class="el" href="ranged_8cpp_source.html#l02093">targetable_creatures()</a>.</p>

<p class="reference">Referenced by <a class="el" href="avatar__action_8cpp_source.html#l00599">avatar_action::autoattack()</a>, <a class="el" href="ranged_8cpp_source.html#l02093">targetable_creatures()</a>, and <a class="el" href="ranged_8cpp_source.html#l02708">target_ui::update_target_list()</a>.</p>

</div>
</div>
<a id="a41e7f0a8b2c552d2f8ec4c8a4930c7af" name="a41e7f0a8b2c552d2f8ec4c8a4930c7af"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a41e7f0a8b2c552d2f8ec4c8a4930c7af">&#9670;&nbsp;</a></span>targetable_creatures() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt; <a class="el" href="classCreature.html">Creature</a> * &gt; ranged::targetable_creatures </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classCharacter.html">Character</a> &amp;&#160;</td>
          <td class="paramname"><em>c</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>range</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classturret__data.html">turret_data</a> &amp;&#160;</td>
          <td class="paramname"><em>turret</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="ranged_8cpp_source.html#l02098">2098</a> of file <a class="el" href="ranged_8cpp_source.html">ranged.cpp</a>.</p>
<div class="fragment"><div class="line"><a id="l02100" name="l02100"></a><span class="lineno"> 2100</span>{</div>
<div class="line"><a id="l02101" name="l02101"></a><span class="lineno"> 2101</span>    <span class="keyword">const</span> <a class="code hl_class" href="classvehicle.html">vehicle</a> *veh_from_turret = turret ? turret.<a class="code hl_function" href="classturret__data.html#aca7944937ce0285293b927c0c893d65a">get_veh</a>() : <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l02102" name="l02102"></a><span class="lineno"> 2102</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;get_creatures_if( [&amp;<a class="code hl_variable" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>, <a class="code hl_enumvalue" href="character_8h.html#addab86bfe6fd0bf8c22ec43df3ec051da1c21724609ac70f1573fd4b755c64ddb">range</a>, veh_from_turret]( <span class="keyword">const</span> <a class="code hl_class" href="classCreature.html">Creature</a> &amp; critter ) -&gt; <span class="keywordtype">bool</span> {</div>
<div class="line"><a id="l02103" name="l02103"></a><span class="lineno"> 2103</span>        <span class="keywordflow">if</span>( std::round( <a class="code hl_function" href="line_8cpp.html#a2d906c9af0b0586f48bc34cff0838817">rl_dist_exact</a>( <a class="code hl_variable" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>.pos(), critter.<a class="code hl_function" href="classCreature.html#a45926a7ba63ccc9be744f87a4d540b7d">pos</a>() ) ) &gt; <a class="code hl_enumvalue" href="character_8h.html#addab86bfe6fd0bf8c22ec43df3ec051da1c21724609ac70f1573fd4b755c64ddb">range</a> )</div>
<div class="line"><a id="l02104" name="l02104"></a><span class="lineno"> 2104</span>        {</div>
<div class="line"><a id="l02105" name="l02105"></a><span class="lineno"> 2105</span>            return false;</div>
<div class="line"><a id="l02106" name="l02106"></a><span class="lineno"> 2106</span>        }</div>
<div class="line"><a id="l02107" name="l02107"></a><span class="lineno"> 2107</span> </div>
<div class="line"><a id="l02108" name="l02108"></a><span class="lineno"> 2108</span>        <span class="comment">// Special case: if range is 1, it&#39;s a melee attack.</span></div>
<div class="line"><a id="l02109" name="l02109"></a><span class="lineno"> 2109</span>        <span class="comment">// Melee attacks can only target on same z-level or directly up/down, not &quot;z-diagonally&quot;.</span></div>
<div class="line"><a id="l02110" name="l02110"></a><span class="lineno"> 2110</span>        <span class="keywordflow">if</span>( <a class="code hl_enumvalue" href="character_8h.html#addab86bfe6fd0bf8c22ec43df3ec051da1c21724609ac70f1573fd4b755c64ddb">range</a> &lt;= 1 &amp;&amp; <a class="code hl_variable" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>.posz() != critter.<a class="code hl_function" href="classCreature.html#a3a3ada596854cf8084b3a728b633a9db">posz</a>() &amp;&amp; <a class="code hl_variable" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>.pos().xy() != critter.<a class="code hl_function" href="classCreature.html#a45926a7ba63ccc9be744f87a4d540b7d">pos</a>().<a class="code hl_function" href="structtripoint.html#accc0725c936dbebb2486f969f39e2e5f">xy</a>() )</div>
<div class="line"><a id="l02111" name="l02111"></a><span class="lineno"> 2111</span>        {</div>
<div class="line"><a id="l02112" name="l02112"></a><span class="lineno"> 2112</span>            return false;</div>
<div class="line"><a id="l02113" name="l02113"></a><span class="lineno"> 2113</span>        }</div>
<div class="line"><a id="l02114" name="l02114"></a><span class="lineno"> 2114</span> </div>
<div class="line"><a id="l02115" name="l02115"></a><span class="lineno"> 2115</span>        <span class="keywordflow">if</span>( !<a class="code hl_variable" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>.sees( critter ) &amp;&amp; !<a class="code hl_variable" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>.sees_with_infrared( critter ) )</div>
<div class="line"><a id="l02116" name="l02116"></a><span class="lineno"> 2116</span>        {</div>
<div class="line"><a id="l02117" name="l02117"></a><span class="lineno"> 2117</span>            return false;</div>
<div class="line"><a id="l02118" name="l02118"></a><span class="lineno"> 2118</span>        }</div>
<div class="line"><a id="l02119" name="l02119"></a><span class="lineno"> 2119</span> </div>
<div class="line"><a id="l02120" name="l02120"></a><span class="lineno"> 2120</span>        <span class="comment">// TODO: get rid of fake npcs (pos() check)</span></div>
<div class="line"><a id="l02121" name="l02121"></a><span class="lineno"> 2121</span>        <span class="keywordflow">if</span>( &amp;<a class="code hl_variable" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a> == &amp;critter || <a class="code hl_variable" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>.pos() == critter.<a class="code hl_function" href="classCreature.html#a45926a7ba63ccc9be744f87a4d540b7d">pos</a>() || <a class="code hl_variable" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>.attitude_to( critter ) == Creature::Attitude::A_FRIENDLY )</div>
<div class="line"><a id="l02122" name="l02122"></a><span class="lineno"> 2122</span>        {</div>
<div class="line"><a id="l02123" name="l02123"></a><span class="lineno"> 2123</span>            return false;</div>
<div class="line"><a id="l02124" name="l02124"></a><span class="lineno"> 2124</span>        }</div>
<div class="line"><a id="l02125" name="l02125"></a><span class="lineno"> 2125</span> </div>
<div class="line"><a id="l02126" name="l02126"></a><span class="lineno"> 2126</span>        <a class="code hl_class" href="classmap.html">map</a> &amp;here = <a class="code hl_function" href="map_8cpp.html#acb0b34be6e497bdd2f9f40ae6929d562">get_map</a>();</div>
<div class="line"><a id="l02127" name="l02127"></a><span class="lineno"> 2127</span> </div>
<div class="line"><a id="l02128" name="l02128"></a><span class="lineno"> 2128</span>        <span class="comment">// TODO: It should use projectile passability checks when finding path, not vision checks.</span></div>
<div class="line"><a id="l02129" name="l02129"></a><span class="lineno"> 2129</span>        std::vector&lt;tripoint&gt; path = here.<a class="code hl_function" href="classmap.html#a0f73359be972a030063b4e84f770275e">find_clear_path</a>( <a class="code hl_variable" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>.pos(), critter.<a class="code hl_function" href="classCreature.html#a45926a7ba63ccc9be744f87a4d540b7d">pos</a>() );</div>
<div class="line"><a id="l02130" name="l02130"></a><span class="lineno"> 2130</span>        <a class="code hl_struct" href="structtripoint.html">tripoint</a> prev_point = <a class="code hl_variable" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>.pos();</div>
<div class="line"><a id="l02131" name="l02131"></a><span class="lineno"> 2131</span>        <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code hl_struct" href="structtripoint.html">tripoint</a> &amp;<a class="code hl_struct" href="structpoint.html">point</a> : path )</div>
<div class="line"><a id="l02132" name="l02132"></a><span class="lineno"> 2132</span>        {</div>
<div class="line"><a id="l02133" name="l02133"></a><span class="lineno"> 2133</span>            if( here.obstructed_by_vehicle_rotation( prev_point, point ) ) {</div>
<div class="line"><a id="l02134" name="l02134"></a><span class="lineno"> 2134</span>                <span class="comment">//Blocked by a rotated vehicle&#39;s walls</span></div>
<div class="line"><a id="l02135" name="l02135"></a><span class="lineno"> 2135</span>                return false;</div>
<div class="line"><a id="l02136" name="l02136"></a><span class="lineno"> 2136</span>            }</div>
<div class="line"><a id="l02137" name="l02137"></a><span class="lineno"> 2137</span> </div>
<div class="line"><a id="l02138" name="l02138"></a><span class="lineno"> 2138</span>            prev_point = <a class="code hl_struct" href="structpoint.html">point</a>;</div>
<div class="line"><a id="l02139" name="l02139"></a><span class="lineno"> 2139</span> </div>
<div class="line"><a id="l02140" name="l02140"></a><span class="lineno"> 2140</span>            <span class="keywordflow">if</span>( here.passable( <a class="code hl_struct" href="structpoint.html">point</a> ) ) {</div>
<div class="line"><a id="l02141" name="l02141"></a><span class="lineno"> 2141</span>                <span class="comment">// If it&#39;s passable, it doesn&#39;t block bullets</span></div>
<div class="line"><a id="l02142" name="l02142"></a><span class="lineno"> 2142</span>                continue;</div>
<div class="line"><a id="l02143" name="l02143"></a><span class="lineno"> 2143</span>            }</div>
<div class="line"><a id="l02144" name="l02144"></a><span class="lineno"> 2144</span> </div>
<div class="line"><a id="l02145" name="l02145"></a><span class="lineno"> 2145</span>            <span class="keyword">const</span> <a class="code hl_class" href="classvehicle.html">vehicle</a> *veh_at_point = <a class="code hl_function" href="vpart__position_8h.html#a67bd76da258293f1443f1356308381dc">veh_pointer_or_null</a>( here.veh_at( <a class="code hl_struct" href="structpoint.html">point</a> ) );</div>
<div class="line"><a id="l02146" name="l02146"></a><span class="lineno"> 2146</span>            <span class="keywordflow">if</span>( veh_at_point &amp;&amp; veh_at_point != veh_from_turret ) {</div>
<div class="line"><a id="l02147" name="l02147"></a><span class="lineno"> 2147</span>                <span class="comment">// Vehicles don&#39;t have impassable-but-shootable-through parts</span></div>
<div class="line"><a id="l02148" name="l02148"></a><span class="lineno"> 2148</span>                return false;</div>
<div class="line"><a id="l02149" name="l02149"></a><span class="lineno"> 2149</span>            }</div>
<div class="line"><a id="l02150" name="l02150"></a><span class="lineno"> 2150</span>            <span class="keywordflow">if</span>( !here.has_flag_ter( <a class="code hl_enumvalue" href="mapdata_8h.html#aa04d037303ea30193f7cf0cd82304258ac945c31a7a3d56b4f17384b30f73133f">TFLAG_TRANSPARENT</a>, <a class="code hl_struct" href="structpoint.html">point</a> ) ) {</div>
<div class="line"><a id="l02151" name="l02151"></a><span class="lineno"> 2151</span>                <span class="comment">// If it&#39;s transparent, it&#39;s either glass (fine) or reinforced glass (not fine)</span></div>
<div class="line"><a id="l02152" name="l02152"></a><span class="lineno"> 2152</span>                <span class="comment">// Hack it with the more common case for now</span></div>
<div class="line"><a id="l02153" name="l02153"></a><span class="lineno"> 2153</span>                <span class="comment">// TODO: Handle armored glass</span></div>
<div class="line"><a id="l02154" name="l02154"></a><span class="lineno"> 2154</span>                return false;</div>
<div class="line"><a id="l02155" name="l02155"></a><span class="lineno"> 2155</span>            }</div>
<div class="line"><a id="l02156" name="l02156"></a><span class="lineno"> 2156</span>        }</div>
<div class="line"><a id="l02157" name="l02157"></a><span class="lineno"> 2157</span> </div>
<div class="line"><a id="l02158" name="l02158"></a><span class="lineno"> 2158</span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l02159" name="l02159"></a><span class="lineno"> 2159</span>    } );</div>
<div class="line"><a id="l02160" name="l02160"></a><span class="lineno"> 2160</span>}</div>
<div class="ttc" id="aclassCreature_html_a3a3ada596854cf8084b3a728b633a9db"><div class="ttname"><a href="classCreature.html#a3a3ada596854cf8084b3a728b633a9db">Creature::posz</a></div><div class="ttdeci">virtual int posz() const =0</div></div>
<div class="ttc" id="aclassmap_html_a0f73359be972a030063b4e84f770275e"><div class="ttname"><a href="classmap.html#a0f73359be972a030063b4e84f770275e">map::find_clear_path</a></div><div class="ttdeci">std::vector&lt; tripoint &gt; find_clear_path(const tripoint &amp;source, const tripoint &amp;destination) const</div><div class="ttdoc">Iteratively tries Bresenham lines with different biases until it finds a clear line or decides there ...</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l06394">map.cpp:6394</a></div></div>
<div class="ttc" id="aclassturret__data_html_aca7944937ce0285293b927c0c893d65a"><div class="ttname"><a href="classturret__data.html#aca7944937ce0285293b927c0c893d65a">turret_data::get_veh</a></div><div class="ttdeci">const vehicle * get_veh() const</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8h_source.html#l00496">vehicle.h:496</a></div></div>
<div class="ttc" id="aline_8cpp_html_a2d906c9af0b0586f48bc34cff0838817"><div class="ttname"><a href="line_8cpp.html#a2d906c9af0b0586f48bc34cff0838817">rl_dist_exact</a></div><div class="ttdeci">float rl_dist_exact(const tripoint &amp;loc1, const tripoint &amp;loc2)</div><div class="ttdef"><b>Definition:</b> <a href="line_8cpp_source.html#l00292">line.cpp:292</a></div></div>
<div class="ttc" id="amapdata_8h_html_aa04d037303ea30193f7cf0cd82304258ac945c31a7a3d56b4f17384b30f73133f"><div class="ttname"><a href="mapdata_8h.html#aa04d037303ea30193f7cf0cd82304258ac945c31a7a3d56b4f17384b30f73133f">TFLAG_TRANSPARENT</a></div><div class="ttdeci">@ TFLAG_TRANSPARENT</div><div class="ttdef"><b>Definition:</b> <a href="mapdata_8h_source.html#l00276">mapdata.h:276</a></div></div>
<div class="ttc" id="astructpoint_html"><div class="ttname"><a href="structpoint.html">point</a></div><div class="ttdef"><b>Definition:</b> <a href="point_8h_source.html#l00035">point.h:35</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="magic_8cpp_source.html#l01032">c</a>, <a class="el" href="map_8cpp_source.html#l06394">map::find_clear_path()</a>, <a class="el" href="game_8cpp_source.html#l00283">g</a>, <a class="el" href="map_8cpp_source.html#l00147">get_map()</a>, <a class="el" href="vehicle_8h_source.html#l00496">turret_data::get_veh()</a>, <a class="el" href="classCreature.html#a45926a7ba63ccc9be744f87a4d540b7d">Creature::pos()</a>, <a class="el" href="classCreature.html#a3a3ada596854cf8084b3a728b633a9db">Creature::posz()</a>, <a class="el" href="character_8h_source.html#l00104">range</a>, <a class="el" href="line_8cpp_source.html#l00292">rl_dist_exact()</a>, <a class="el" href="mapdata_8h_source.html#l00276">TFLAG_TRANSPARENT</a>, <a class="el" href="vpart__position_8h_source.html#l00156">veh_pointer_or_null()</a>, and <a class="el" href="point_8h_source.html#l00206">tripoint::xy()</a>.</p>

</div>
</div>
<a id="aeadf3905fda7ac9f7e6e13d78d6beadb" name="aeadf3905fda7ac9f7e6e13d78d6beadb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aeadf3905fda7ac9f7e6e13d78d6beadb">&#9670;&nbsp;</a></span>throw_cost()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ranged::throw_cost </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classCharacter.html">Character</a> &amp;&#160;</td>
          <td class="paramname"><em>c</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classitem.html">item</a> &amp;&#160;</td>
          <td class="paramname"><em>to_throw</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
Throw increases throwing speed Dexterity increases throwing speed 
<p class="definition">Definition at line <a class="el" href="ranged_8cpp_source.html#l00990">990</a> of file <a class="el" href="ranged_8cpp_source.html">ranged.cpp</a>.</p>
<div class="fragment"><div class="line"><a id="l00991" name="l00991"></a><span class="lineno">  991</span>{</div>
<div class="line"><a id="l00992" name="l00992"></a><span class="lineno">  992</span>    <span class="comment">// Very similar to player::attack_cost</span></div>
<div class="line"><a id="l00993" name="l00993"></a><span class="lineno">  993</span>    <span class="comment">// TODO: Extract into a function?</span></div>
<div class="line"><a id="l00994" name="l00994"></a><span class="lineno">  994</span>    <span class="comment">// Differences:</span></div>
<div class="line"><a id="l00995" name="l00995"></a><span class="lineno">  995</span>    <span class="comment">// Dex is more (2x) important for throwing speed</span></div>
<div class="line"><a id="l00996" name="l00996"></a><span class="lineno">  996</span>    <span class="comment">// At 10 skill, the cost is down to 0.75%, not 0.66%</span></div>
<div class="line"><a id="l00997" name="l00997"></a><span class="lineno">  997</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> base_move_cost = to_throw.<a class="code hl_function" href="classitem.html#ae75cd02ac10dda906018f27096a6efa9">attack_cost</a>() / 2;</div>
<div class="line"><a id="l00998" name="l00998"></a><span class="lineno">  998</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> throw_skill = std::min( <a class="code hl_variable" href="game__constants_8h.html#ae9c0ec5b4724c15132efddb8862ca652">MAX_SKILL</a>, <a class="code hl_variable" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>.get_skill_level( <a class="code hl_variable" href="ranged_8cpp.html#aca8ae2b9cbc86602a56a3885b72a4ed1">skill_throw</a> ) );<span class="comment"></span></div>
<div class="line"><a id="l00999" name="l00999"></a><span class="lineno">  999</span><span class="comment">    ///\EFFECT_THROW increases throwing speed</span></div>
<div class="line"><a id="l01000" name="l01000"></a><span class="lineno"> 1000</span><span class="comment"></span>    <span class="keyword">const</span> <span class="keywordtype">int</span> skill_cost = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>( ( base_move_cost * ( 20 - throw_skill ) / 20 ) );<span class="comment"></span></div>
<div class="line"><a id="l01001" name="l01001"></a><span class="lineno"> 1001</span><span class="comment">    ///\EFFECT_DEX increases throwing speed</span></div>
<div class="line"><a id="l01002" name="l01002"></a><span class="lineno"> 1002</span><span class="comment"></span>    <span class="keyword">const</span> <span class="keywordtype">int</span> dexbonus = <a class="code hl_variable" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>.get_dex();</div>
<div class="line"><a id="l01003" name="l01003"></a><span class="lineno"> 1003</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> encumbrance_penalty = <a class="code hl_variable" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>.encumb( <a class="code hl_enumvalue" href="bodypart_8h.html#af618290c4c2de42aab87977ac7311980ab4b216482dcc0e468819f023c3aeddd1">bp_torso</a> ) +</div>
<div class="line"><a id="l01004" name="l01004"></a><span class="lineno"> 1004</span>                                    ( <a class="code hl_variable" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>.encumb( <a class="code hl_enumvalue" href="bodypart_8h.html#af618290c4c2de42aab87977ac7311980a2806629e65a2c2eb5d8049e29e77910e">bp_hand_l</a> ) + <a class="code hl_variable" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>.encumb( <a class="code hl_enumvalue" href="bodypart_8h.html#af618290c4c2de42aab87977ac7311980a54721306a0e05318b6d0440349c1a0fb">bp_hand_r</a> ) ) / 2;</div>
<div class="line"><a id="l01005" name="l01005"></a><span class="lineno"> 1005</span>    <span class="keyword">const</span> <span class="keywordtype">float</span> stamina_ratio = <span class="keyword">static_cast&lt;</span><span class="keywordtype">float</span><span class="keyword">&gt;</span>( <a class="code hl_variable" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>.get_stamina() ) / <a class="code hl_variable" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>.get_stamina_max();</div>
<div class="line"><a id="l01006" name="l01006"></a><span class="lineno"> 1006</span>    <span class="keyword">const</span> <span class="keywordtype">float</span> stamina_penalty = 1.0 + std::max( ( 0.25f - stamina_ratio ) * 4.0f, 0.0f );</div>
<div class="line"><a id="l01007" name="l01007"></a><span class="lineno"> 1007</span> </div>
<div class="line"><a id="l01008" name="l01008"></a><span class="lineno"> 1008</span>    <span class="keywordtype">int</span> <a class="code hl_function" href="activity__item__handling_8cpp.html#a0572000ec0976f2d095ae0cd9d20e78b">move_cost</a> = base_move_cost;</div>
<div class="line"><a id="l01009" name="l01009"></a><span class="lineno"> 1009</span>    <span class="comment">// Stamina penalty only affects base/2 and encumbrance parts of the cost</span></div>
<div class="line"><a id="l01010" name="l01010"></a><span class="lineno"> 1010</span>    <a class="code hl_function" href="activity__item__handling_8cpp.html#a0572000ec0976f2d095ae0cd9d20e78b">move_cost</a> += encumbrance_penalty;</div>
<div class="line"><a id="l01011" name="l01011"></a><span class="lineno"> 1011</span>    <a class="code hl_function" href="activity__item__handling_8cpp.html#a0572000ec0976f2d095ae0cd9d20e78b">move_cost</a> *= stamina_penalty;</div>
<div class="line"><a id="l01012" name="l01012"></a><span class="lineno"> 1012</span>    <a class="code hl_function" href="activity__item__handling_8cpp.html#a0572000ec0976f2d095ae0cd9d20e78b">move_cost</a> += skill_cost;</div>
<div class="line"><a id="l01013" name="l01013"></a><span class="lineno"> 1013</span>    <a class="code hl_function" href="activity__item__handling_8cpp.html#a0572000ec0976f2d095ae0cd9d20e78b">move_cost</a> -= dexbonus;</div>
<div class="line"><a id="l01014" name="l01014"></a><span class="lineno"> 1014</span>    <a class="code hl_function" href="activity__item__handling_8cpp.html#a0572000ec0976f2d095ae0cd9d20e78b">move_cost</a> *= <a class="code hl_variable" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>.mutation_value( <span class="stringliteral">&quot;attackcost_modifier&quot;</span> );</div>
<div class="line"><a id="l01015" name="l01015"></a><span class="lineno"> 1015</span> </div>
<div class="line"><a id="l01016" name="l01016"></a><span class="lineno"> 1016</span>    <span class="keywordflow">return</span> std::max( 25, <a class="code hl_function" href="activity__item__handling_8cpp.html#a0572000ec0976f2d095ae0cd9d20e78b">move_cost</a> );</div>
<div class="line"><a id="l01017" name="l01017"></a><span class="lineno"> 1017</span>}</div>
<div class="ttc" id="aactivity__item__handling_8cpp_html_a0572000ec0976f2d095ae0cd9d20e78b"><div class="ttname"><a href="activity__item__handling_8cpp.html#a0572000ec0976f2d095ae0cd9d20e78b">move_cost</a></div><div class="ttdeci">static int move_cost(const item &amp;it, const tripoint &amp;src, const tripoint &amp;dest)</div><div class="ttdef"><b>Definition:</b> <a href="activity__item__handling_8cpp_source.html#l00899">activity_item_handling.cpp:899</a></div></div>
<div class="ttc" id="abodypart_8h_html_af618290c4c2de42aab87977ac7311980ab4b216482dcc0e468819f023c3aeddd1"><div class="ttname"><a href="bodypart_8h.html#af618290c4c2de42aab87977ac7311980ab4b216482dcc0e468819f023c3aeddd1">bp_torso</a></div><div class="ttdeci">@ bp_torso</div><div class="ttdef"><b>Definition:</b> <a href="bodypart_8h_source.html#l00041">bodypart.h:41</a></div></div>
<div class="ttc" id="aclassitem_html_ae75cd02ac10dda906018f27096a6efa9"><div class="ttname"><a href="classitem.html#ae75cd02ac10dda906018f27096a6efa9">item::attack_cost</a></div><div class="ttdeci">int attack_cost() const</div><div class="ttdoc">Base number of moves (Creature::moves) that a single melee attack with this items takes.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l05206">item.cpp:5206</a></div></div>
<div class="ttc" id="aranged_8cpp_html_aca8ae2b9cbc86602a56a3885b72a4ed1"><div class="ttname"><a href="ranged_8cpp.html#aca8ae2b9cbc86602a56a3885b72a4ed1">skill_throw</a></div><div class="ttdeci">static const skill_id skill_throw(&quot;throw&quot;)</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="item_8cpp_source.html#l05206">item::attack_cost()</a>, <a class="el" href="bodypart_8h_source.html#l00047">bp_hand_l</a>, <a class="el" href="bodypart_8h_source.html#l00048">bp_hand_r</a>, <a class="el" href="bodypart_8h_source.html#l00041">bp_torso</a>, <a class="el" href="magic_8cpp_source.html#l01032">c</a>, <a class="el" href="game__constants_8h_source.html#l00114">MAX_SKILL</a>, <a class="el" href="activity__item__handling_8cpp_source.html#l00899">move_cost()</a>, and <a class="el" href="ranged_8cpp.html#aca8ae2b9cbc86602a56a3885b72a4ed1">skill_throw</a>.</p>

<p class="reference">Referenced by <a class="el" href="ranged_8cpp_source.html#l01612">draw_throw_aim()</a>, and <a class="el" href="ranged_8cpp_source.html#l01130">throw_item()</a>.</p>

</div>
</div>
<a id="afd6b1338d47e5ecd34de75b921c11113" name="afd6b1338d47e5ecd34de75b921c11113"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afd6b1338d47e5ecd34de75b921c11113">&#9670;&nbsp;</a></span>throw_dispersion_per_dodge()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ranged::throw_dispersion_per_dodge </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classCharacter.html">Character</a> &amp;&#160;</td>
          <td class="paramname"><em>c</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>add_encumbrance</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>How much dispersion does one point of target's dodge add when throwing at said target? </p>
Dexterity increases throwing accuracy against targets with good dodge stat 
<p class="definition">Definition at line <a class="el" href="ranged_8cpp_source.html#l01071">1071</a> of file <a class="el" href="ranged_8cpp_source.html">ranged.cpp</a>.</p>
<div class="fragment"><div class="line"><a id="l01072" name="l01072"></a><span class="lineno"> 1072</span>{</div>
<div class="line"><a id="l01073" name="l01073"></a><span class="lineno"> 1073</span>    <span class="comment">// +200 per dodge point at 0 dexterity</span></div>
<div class="line"><a id="l01074" name="l01074"></a><span class="lineno"> 1074</span>    <span class="comment">// +100 at 8, +80 at 12, +66.6 at 16, +57 at 20, +50 at 24</span></div>
<div class="line"><a id="l01075" name="l01075"></a><span class="lineno"> 1075</span>    <span class="comment">// Each 10 encumbrance on either hand is like -1 dex (can bring penalty to +400 per dodge)</span></div>
<div class="line"><a id="l01076" name="l01076"></a><span class="lineno"> 1076</span>    <span class="comment">// Maybe TODO: Only use one hand</span></div>
<div class="line"><a id="l01077" name="l01077"></a><span class="lineno"> 1077</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> encumbrance = add_encumbrance ? <a class="code hl_variable" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>.encumb( <a class="code hl_enumvalue" href="bodypart_8h.html#af618290c4c2de42aab87977ac7311980a2806629e65a2c2eb5d8049e29e77910e">bp_hand_l</a> ) + <a class="code hl_variable" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>.encumb( <a class="code hl_enumvalue" href="bodypart_8h.html#af618290c4c2de42aab87977ac7311980a54721306a0e05318b6d0440349c1a0fb">bp_hand_r</a> ) : 0;<span class="comment"></span></div>
<div class="line"><a id="l01078" name="l01078"></a><span class="lineno"> 1078</span><span class="comment">    ///\EFFECT_DEX increases throwing accuracy against targets with good dodge stat</span></div>
<div class="line"><a id="l01079" name="l01079"></a><span class="lineno"> 1079</span><span class="comment"></span>    <span class="keywordtype">float</span> effective_dex = 2 + <a class="code hl_variable" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>.get_dex() / 4.0f - ( encumbrance ) / 40.0f;</div>
<div class="line"><a id="l01080" name="l01080"></a><span class="lineno"> 1080</span>    <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>( 100.0f / std::max( 1.0f, effective_dex ) );</div>
<div class="line"><a id="l01081" name="l01081"></a><span class="lineno"> 1081</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="bodypart_8h_source.html#l00047">bp_hand_l</a>, <a class="el" href="bodypart_8h_source.html#l00048">bp_hand_r</a>, and <a class="el" href="magic_8cpp_source.html#l01032">c</a>.</p>

<p class="reference">Referenced by <a class="el" href="character__display_8cpp_source.html#l00370">draw_stats_info()</a>, <a class="el" href="newcharacter_8cpp_source.html#l00794">set_stats()</a>, and <a class="el" href="ranged_8cpp_source.html#l01085">throwing_dispersion()</a>.</p>

</div>
</div>
<a id="aaaa4e309fe9b7ad615954c9f7524ddce" name="aaaa4e309fe9b7ad615954c9f7524ddce"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aaaa4e309fe9b7ad615954c9f7524ddce">&#9670;&nbsp;</a></span>throw_item()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structdealt__projectile__attack.html">dealt_projectile_attack</a> ranged::throw_item </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classCharacter.html">Character</a> &amp;&#160;</td>
          <td class="paramname"><em>who</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structtripoint.html">tripoint</a> &amp;&#160;</td>
          <td class="paramname"><em>target</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classitem.html">item</a> &amp;&#160;</td>
          <td class="paramname"><em>to_throw</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="generic__factory_8h.html#a1159dbaba81931271dbfe5b9c7f041b3">std::optional</a>&lt; <a class="el" href="structtripoint.html">tripoint</a> &gt;&#160;</td>
          <td class="paramname"><em>blind_throw_from_pos</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Execute a throw. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">who</td><td><a class="el" href="classCharacter.html">Character</a> whose stats to use </td></tr>
    <tr><td class="paramname">to_throw</td><td>Item being thrown </td></tr>
    <tr><td class="paramname">blind_throw_from_pos</td><td>Position of blind throw (if blind throwing) </td></tr>
  </table>
  </dd>
</dl>
Strength increases throwing damage Strength increases chance of shattering thrown glass items (NEGATIVE) 
<p class="definition">Definition at line <a class="el" href="ranged_8cpp_source.html#l01130">1130</a> of file <a class="el" href="ranged_8cpp_source.html">ranged.cpp</a>.</p>
<div class="fragment"><div class="line"><a id="l01132" name="l01132"></a><span class="lineno"> 1132</span>{</div>
<div class="line"><a id="l01133" name="l01133"></a><span class="lineno"> 1133</span>    <span class="comment">// Copy the item, we may alter it before throwing</span></div>
<div class="line"><a id="l01134" name="l01134"></a><span class="lineno"> 1134</span>    <a class="code hl_class" href="classitem.html">item</a> thrown = to_throw;</div>
<div class="line"><a id="l01135" name="l01135"></a><span class="lineno"> 1135</span> </div>
<div class="line"><a id="l01136" name="l01136"></a><span class="lineno"> 1136</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code hl_function" href="activity__item__handling_8cpp.html#a0572000ec0976f2d095ae0cd9d20e78b">move_cost</a> = <a class="code hl_function" href="namespaceranged.html#aeadf3905fda7ac9f7e6e13d78d6beadb">ranged::throw_cost</a>( who, to_throw );</div>
<div class="line"><a id="l01137" name="l01137"></a><span class="lineno"> 1137</span>    who.<a class="code hl_function" href="classCreature.html#a891bc2d0c564449cb462178317819254">mod_moves</a>( -<a class="code hl_function" href="activity__item__handling_8cpp.html#a0572000ec0976f2d095ae0cd9d20e78b">move_cost</a> );</div>
<div class="line"><a id="l01138" name="l01138"></a><span class="lineno"> 1138</span> </div>
<div class="line"><a id="l01139" name="l01139"></a><span class="lineno"> 1139</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> throwing_skill = who.<a class="code hl_function" href="classCharacter.html#afa95fe499ca6b55ab97f1b442a4c95c5">get_skill_level</a>( <a class="code hl_variable" href="ranged_8cpp.html#aca8ae2b9cbc86602a56a3885b72a4ed1">skill_throw</a> );</div>
<div class="line"><a id="l01140" name="l01140"></a><span class="lineno"> 1140</span>    <a class="code hl_class" href="classunits_1_1quantity.html">units::volume</a> <a class="code hl_typedef" href="namespaceunits.html#a5d16607c866588620acb381e7dbbf0a6">volume</a> = to_throw.<a class="code hl_function" href="classitem.html#a51eafbdf8b331d88b741c0c527f98eb9">volume</a>();</div>
<div class="line"><a id="l01141" name="l01141"></a><span class="lineno"> 1141</span>    <a class="code hl_class" href="classunits_1_1quantity.html">units::mass</a> weight = to_throw.<a class="code hl_function" href="classitem.html#a3157f01f1da6fe89bdbc87db2605afb9">weight</a>();</div>
<div class="line"><a id="l01142" name="l01142"></a><span class="lineno"> 1142</span> </div>
<div class="line"><a id="l01143" name="l01143"></a><span class="lineno"> 1143</span>    <span class="comment">// Previously calculated as 2_gram * std::max( 1, str_cur )</span></div>
<div class="line"><a id="l01144" name="l01144"></a><span class="lineno"> 1144</span>    <span class="comment">// using 16_gram normalizes it to 8 str. Same effort expenditure</span></div>
<div class="line"><a id="l01145" name="l01145"></a><span class="lineno"> 1145</span>    <span class="comment">// for being able to throw farther.</span></div>
<div class="line"><a id="l01146" name="l01146"></a><span class="lineno"> 1146</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> weight_cost = weight / ( 16_gram );</div>
<div class="line"><a id="l01147" name="l01147"></a><span class="lineno"> 1147</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> encumbrance_cost = <a class="code hl_function" href="rng_8cpp.html#acd19ae79e3590a99c9eaf0389318b686">roll_remainder</a>( ( who.<a class="code hl_function" href="classCharacter.html#adc1fd84a88722a905e57fea8bfd5b6b0">encumb</a>( <a class="code hl_enumvalue" href="bodypart_8h.html#af618290c4c2de42aab87977ac7311980a441080ba1d3930d38f635658d9b28e01">bp_arm_l</a> ) + who.<a class="code hl_function" href="classCharacter.html#adc1fd84a88722a905e57fea8bfd5b6b0">encumb</a>(</div>
<div class="line"><a id="l01148" name="l01148"></a><span class="lineno"> 1148</span>                                     <a class="code hl_enumvalue" href="bodypart_8h.html#af618290c4c2de42aab87977ac7311980ae5f21c7494ad730a0c6abf6957976cb3">bp_arm_r</a> ) ) * 2.0f );</div>
<div class="line"><a id="l01149" name="l01149"></a><span class="lineno"> 1149</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> stamina_cost = ( weight_cost + encumbrance_cost - throwing_skill + 50 ) * -1;</div>
<div class="line"><a id="l01150" name="l01150"></a><span class="lineno"> 1150</span> </div>
<div class="line"><a id="l01151" name="l01151"></a><span class="lineno"> 1151</span>    <span class="keywordtype">bool</span> throw_assist = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01152" name="l01152"></a><span class="lineno"> 1152</span>    <span class="keywordtype">int</span> throw_assist_str = 0;</div>
<div class="line"><a id="l01153" name="l01153"></a><span class="lineno"> 1153</span>    <span class="keywordflow">if</span>( who.<a class="code hl_function" href="classCharacter.html#a67b51491c2529df09755e07bc633cc55">is_mounted</a>() ) {</div>
<div class="line"><a id="l01154" name="l01154"></a><span class="lineno"> 1154</span>        <a class="code hl_class" href="classmonster.html">monster</a> *mons = who.<a class="code hl_variable" href="classCharacter.html#ac3d46549b7cdaac1f98991167ad5f1b3">mounted_creature</a>.get();</div>
<div class="line"><a id="l01155" name="l01155"></a><span class="lineno"> 1155</span>        <span class="keywordflow">if</span>( mons-&gt;<a class="code hl_function" href="classmonster.html#ad104be109ff1d39a6e96cfb133e08ef0">mech_str_addition</a>() != 0 ) {</div>
<div class="line"><a id="l01156" name="l01156"></a><span class="lineno"> 1156</span>            throw_assist = <span class="keyword">true</span>;</div>
<div class="line"><a id="l01157" name="l01157"></a><span class="lineno"> 1157</span>            throw_assist_str = mons-&gt;<a class="code hl_function" href="classmonster.html#ad104be109ff1d39a6e96cfb133e08ef0">mech_str_addition</a>();</div>
<div class="line"><a id="l01158" name="l01158"></a><span class="lineno"> 1158</span>            mons-&gt;<a class="code hl_function" href="classmonster.html#a8ea6e76214228bc20ec1d69daebe5d72">use_mech_power</a>( -3 );</div>
<div class="line"><a id="l01159" name="l01159"></a><span class="lineno"> 1159</span>        }</div>
<div class="line"><a id="l01160" name="l01160"></a><span class="lineno"> 1160</span>    }</div>
<div class="line"><a id="l01161" name="l01161"></a><span class="lineno"> 1161</span>    <span class="keywordflow">if</span>( !throw_assist ) {</div>
<div class="line"><a id="l01162" name="l01162"></a><span class="lineno"> 1162</span>        who.<a class="code hl_function" href="classCharacter.html#ac29de3d2bc90dd1c8d921b539fb05cfb">mod_stamina</a>( stamina_cost );</div>
<div class="line"><a id="l01163" name="l01163"></a><span class="lineno"> 1163</span>    }</div>
<div class="line"><a id="l01164" name="l01164"></a><span class="lineno"> 1164</span> </div>
<div class="line"><a id="l01165" name="l01165"></a><span class="lineno"> 1165</span>    <span class="keyword">const</span> <a class="code hl_class" href="classstring__id.html">skill_id</a> &amp;skill_used = <a class="code hl_variable" href="ranged_8cpp.html#aca8ae2b9cbc86602a56a3885b72a4ed1">skill_throw</a>;</div>
<div class="line"><a id="l01166" name="l01166"></a><span class="lineno"> 1166</span>    <span class="keywordtype">int</span> skill_level = std::min( <a class="code hl_variable" href="game__constants_8h.html#ae9c0ec5b4724c15132efddb8862ca652">MAX_SKILL</a>, who.<a class="code hl_function" href="classCharacter.html#afa95fe499ca6b55ab97f1b442a4c95c5">get_skill_level</a>( <a class="code hl_variable" href="ranged_8cpp.html#aca8ae2b9cbc86602a56a3885b72a4ed1">skill_throw</a> ) );</div>
<div class="line"><a id="l01167" name="l01167"></a><span class="lineno"> 1167</span>    <span class="comment">// if you are lying on the floor, you can&#39;t really throw that well</span></div>
<div class="line"><a id="l01168" name="l01168"></a><span class="lineno"> 1168</span>    <span class="keywordflow">if</span>( who.<a class="code hl_function" href="classCreature.html#a6fb79df9315dc2bed6f34d9a2e37da90">has_effect</a>( <a class="code hl_variable" href="ranged_8cpp.html#a08481f62adb6937636ea44b855311037">effect_downed</a> ) ) {</div>
<div class="line"><a id="l01169" name="l01169"></a><span class="lineno"> 1169</span>        skill_level = std::max( 0, skill_level - 5 );</div>
<div class="line"><a id="l01170" name="l01170"></a><span class="lineno"> 1170</span>    }</div>
<div class="line"><a id="l01171" name="l01171"></a><span class="lineno"> 1171</span>    <span class="comment">// We&#39;ll be constructing a projectile</span></div>
<div class="line"><a id="l01172" name="l01172"></a><span class="lineno"> 1172</span>    <a class="code hl_struct" href="structprojectile.html">projectile</a> proj;</div>
<div class="line"><a id="l01173" name="l01173"></a><span class="lineno"> 1173</span>    proj.<a class="code hl_variable" href="structprojectile.html#a82d8f657f8cfc4e180c15bfab8ca8a6e">impact</a> = thrown.<a class="code hl_function" href="classitem.html#a13b2b008995a2f2f2daa63be578b27c8">base_damage_thrown</a>();</div>
<div class="line"><a id="l01174" name="l01174"></a><span class="lineno"> 1174</span>    proj.<a class="code hl_variable" href="structprojectile.html#aa2af53bce63feecb719ef1edba54689e">speed</a> = 10 + skill_level;</div>
<div class="line"><a id="l01175" name="l01175"></a><span class="lineno"> 1175</span>    <span class="keyword">auto</span> &amp;impact = proj.<a class="code hl_variable" href="structprojectile.html#a82d8f657f8cfc4e180c15bfab8ca8a6e">impact</a>;</div>
<div class="line"><a id="l01176" name="l01176"></a><span class="lineno"> 1176</span> </div>
<div class="line"><a id="l01177" name="l01177"></a><span class="lineno"> 1177</span>    <span class="keyword">static</span> <span class="keyword">const</span> std::set&lt;material_id&gt; ferric = { <a class="code hl_typedef" href="type__id_8h.html#a569ce0271cf4ab170e63bb05658be142">material_id</a>( <span class="stringliteral">&quot;iron&quot;</span> ), <a class="code hl_typedef" href="type__id_8h.html#a569ce0271cf4ab170e63bb05658be142">material_id</a>( <span class="stringliteral">&quot;steel&quot;</span> ) };</div>
<div class="line"><a id="l01178" name="l01178"></a><span class="lineno"> 1178</span> </div>
<div class="line"><a id="l01179" name="l01179"></a><span class="lineno"> 1179</span>    <span class="keywordtype">bool</span> do_railgun = who.<a class="code hl_function" href="classCharacter.html#af9c7419575e23d52745c94009929fafb">has_active_bionic</a>( <a class="code hl_variable" href="ranged_8cpp.html#a738f726f320c7f5b5edca445777a14fa">bio_railgun</a> ) &amp;&amp; thrown.<a class="code hl_function" href="classitem.html#a9e2c24734b538e61e186fb6777b62c25">made_of_any</a>( ferric ) &amp;&amp;</div>
<div class="line"><a id="l01180" name="l01180"></a><span class="lineno"> 1180</span>                      !throw_assist;</div>
<div class="line"><a id="l01181" name="l01181"></a><span class="lineno"> 1181</span> </div>
<div class="line"><a id="l01182" name="l01182"></a><span class="lineno"> 1182</span>    <span class="comment">// The damage dealt due to item&#39;s weight, player&#39;s strength, and skill level</span></div>
<div class="line"><a id="l01183" name="l01183"></a><span class="lineno"> 1183</span>    <span class="comment">// Up to str/2 or weight/100g (lower), so 10 str is 5 damage before multipliers</span></div>
<div class="line"><a id="l01184" name="l01184"></a><span class="lineno"> 1184</span>    <span class="comment">// Railgun doubles the effective strength</span><span class="comment"></span></div>
<div class="line"><a id="l01185" name="l01185"></a><span class="lineno"> 1185</span><span class="comment">    ///\EFFECT_STR increases throwing damage</span></div>
<div class="line"><a id="l01186" name="l01186"></a><span class="lineno"> 1186</span><span class="comment"></span>    <span class="keywordtype">double</span> stats_mod = do_railgun ? who.<a class="code hl_function" href="classCharacter.html#a5aba683ccf77cb560a0a932308289bd9">get_str</a>() : ( who.<a class="code hl_function" href="classCharacter.html#a5aba683ccf77cb560a0a932308289bd9">get_str</a>() / 2.0 );</div>
<div class="line"><a id="l01187" name="l01187"></a><span class="lineno"> 1187</span>    stats_mod = throw_assist ? throw_assist_str / 2.0 : stats_mod;</div>
<div class="line"><a id="l01188" name="l01188"></a><span class="lineno"> 1188</span>    <span class="comment">// modify strength impact based on skill level, clamped to [0.15 - 1]</span></div>
<div class="line"><a id="l01189" name="l01189"></a><span class="lineno"> 1189</span>    <span class="comment">// mod = mod * [ ( ( skill / max_skill ) * 0.85 ) + 0.15 ]</span></div>
<div class="line"><a id="l01190" name="l01190"></a><span class="lineno"> 1190</span>    stats_mod *= ( std::min( <a class="code hl_variable" href="game__constants_8h.html#ae9c0ec5b4724c15132efddb8862ca652">MAX_SKILL</a>,</div>
<div class="line"><a id="l01191" name="l01191"></a><span class="lineno"> 1191</span>                             who.<a class="code hl_function" href="classCharacter.html#afa95fe499ca6b55ab97f1b442a4c95c5">get_skill_level</a>( <a class="code hl_variable" href="ranged_8cpp.html#aca8ae2b9cbc86602a56a3885b72a4ed1">skill_throw</a> ) ) /</div>
<div class="line"><a id="l01192" name="l01192"></a><span class="lineno"> 1192</span>                   <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>( <a class="code hl_variable" href="game__constants_8h.html#ae9c0ec5b4724c15132efddb8862ca652">MAX_SKILL</a> ) ) * 0.85 + 0.15;</div>
<div class="line"><a id="l01193" name="l01193"></a><span class="lineno"> 1193</span>    impact.add_damage( <a class="code hl_enumvalue" href="damage_8h.html#ae63a2cf8429f9edf77b547d34ffe4e7aa5f8b46c6c239266403858fa2ae90ef23">DT_BASH</a>, std::min( weight / 100.0_gram, stats_mod ) );</div>
<div class="line"><a id="l01194" name="l01194"></a><span class="lineno"> 1194</span> </div>
<div class="line"><a id="l01195" name="l01195"></a><span class="lineno"> 1195</span>    <span class="keywordflow">if</span>( thrown.<a class="code hl_function" href="classitem.html#aaa5aeb6f838927babb10ede535cf2a73">has_flag</a>( <span class="stringliteral">&quot;ACT_ON_RANGED_HIT&quot;</span> ) ) {</div>
<div class="line"><a id="l01196" name="l01196"></a><span class="lineno"> 1196</span>        proj.<a class="code hl_function" href="structprojectile.html#a05d90cbb1c83669dd7c23477c8f35963">add_effect</a>( <a class="code hl_variable" href="ranged_8cpp.html#a4832c47fe321946202cd17b211b27862">ammo_effect_ACT_ON_RANGED_HIT</a> );</div>
<div class="line"><a id="l01197" name="l01197"></a><span class="lineno"> 1197</span>        thrown.<a class="code hl_variable" href="classitem.html#a2993eb10a5ae589e6bb1be0a74cb65c1">active</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l01198" name="l01198"></a><span class="lineno"> 1198</span>    }</div>
<div class="line"><a id="l01199" name="l01199"></a><span class="lineno"> 1199</span> </div>
<div class="line"><a id="l01200" name="l01200"></a><span class="lineno"> 1200</span>    <span class="comment">// Item will shatter upon landing, destroying the item, dealing damage, and making noise</span><span class="comment"></span></div>
<div class="line"><a id="l01201" name="l01201"></a><span class="lineno"> 1201</span><span class="comment">    /** @EFFECT_STR increases chance of shattering thrown glass items (NEGATIVE) */</span></div>
<div class="line"><a id="l01202" name="l01202"></a><span class="lineno"> 1202</span>    <span class="keyword">const</span> <span class="keywordtype">bool</span> shatter = !thrown.<a class="code hl_variable" href="classitem.html#a2993eb10a5ae589e6bb1be0a74cb65c1">active</a> &amp;&amp; thrown.<a class="code hl_function" href="classitem.html#a4326944ae95f4d265c8ca1c76ed89a03">made_of</a>( <a class="code hl_typedef" href="type__id_8h.html#a569ce0271cf4ab170e63bb05658be142">material_id</a>( <span class="stringliteral">&quot;glass&quot;</span> ) ) &amp;&amp;</div>
<div class="line"><a id="l01203" name="l01203"></a><span class="lineno"> 1203</span>                         <a class="code hl_function" href="artifact_8cpp.html#a70800e95389f34dd34186fafaea2a840">rng</a>( 0, <a class="code hl_function" href="namespaceunits.html#a144476d36f26d6e1916493c3636d54dc">units::to_milliliter</a>( 2_liter - <a class="code hl_typedef" href="namespaceunits.html#a5d16607c866588620acb381e7dbbf0a6">volume</a> ) ) &lt; who.<a class="code hl_function" href="classCharacter.html#a5aba683ccf77cb560a0a932308289bd9">get_str</a>() * 100;</div>
<div class="line"><a id="l01204" name="l01204"></a><span class="lineno"> 1204</span> </div>
<div class="line"><a id="l01205" name="l01205"></a><span class="lineno"> 1205</span>    <span class="comment">// Item will burst upon landing, destroying the item, and spilling its contents</span></div>
<div class="line"><a id="l01206" name="l01206"></a><span class="lineno"> 1206</span>    <span class="keyword">const</span> <span class="keywordtype">bool</span> burst = thrown.<a class="code hl_function" href="classitem.html#aeb49bb1b64eba3731e606ffe83e95b4f">has_property</a>( <span class="stringliteral">&quot;burst_when_filled&quot;</span> ) &amp;&amp; thrown.<a class="code hl_function" href="classitem.html#a723753bab4cc789e3ec186846c9916a3">is_container</a>() &amp;&amp;</div>
<div class="line"><a id="l01207" name="l01207"></a><span class="lineno"> 1207</span>                       thrown.<a class="code hl_function" href="classitem.html#a19e6dd5afd4bada41c8d97792fd0815d">get_property_int64_t</a>( <span class="stringliteral">&quot;burst_when_filled&quot;</span> ) &lt;= <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span></div>
<div class="line"><a id="l01208" name="l01208"></a><span class="lineno"> 1208</span>                       ( thrown.<a class="code hl_function" href="classitem.html#aeb62f6d93e37bf01af71f795cc39f4f1">get_contained</a>().<a class="code hl_function" href="classitem.html#a51eafbdf8b331d88b741c0c527f98eb9">volume</a>().<a class="code hl_function" href="classunits_1_1quantity.html#a239e9b238064a23fab11ff2094537958">value</a>() ) / thrown.<a class="code hl_function" href="classitem.html#acbc651b09ebafad57974d0cfa04b8e5d">get_container_capacity</a>().<a class="code hl_function" href="classunits_1_1quantity.html#a239e9b238064a23fab11ff2094537958">value</a>() * 100;</div>
<div class="line"><a id="l01209" name="l01209"></a><span class="lineno"> 1209</span> </div>
<div class="line"><a id="l01210" name="l01210"></a><span class="lineno"> 1210</span>    <span class="comment">// Add some flags to the projectile</span></div>
<div class="line"><a id="l01211" name="l01211"></a><span class="lineno"> 1211</span>    <span class="keywordflow">if</span>( weight &gt; 500_gram ) {</div>
<div class="line"><a id="l01212" name="l01212"></a><span class="lineno"> 1212</span>        proj.<a class="code hl_function" href="structprojectile.html#a05d90cbb1c83669dd7c23477c8f35963">add_effect</a>( <a class="code hl_variable" href="ranged_8cpp.html#a56ca2e5cfeec3ed46b11661ab0d4a51d">ammo_effect_HEAVY_HIT</a> );</div>
<div class="line"><a id="l01213" name="l01213"></a><span class="lineno"> 1213</span>    }</div>
<div class="line"><a id="l01214" name="l01214"></a><span class="lineno"> 1214</span> </div>
<div class="line"><a id="l01215" name="l01215"></a><span class="lineno"> 1215</span>    proj.<a class="code hl_function" href="structprojectile.html#a05d90cbb1c83669dd7c23477c8f35963">add_effect</a>( <a class="code hl_variable" href="ranged_8cpp.html#aa3f58e0db88c98c686cbce467d25fd94">ammo_effect_NO_ITEM_DAMAGE</a> );</div>
<div class="line"><a id="l01216" name="l01216"></a><span class="lineno"> 1216</span> </div>
<div class="line"><a id="l01217" name="l01217"></a><span class="lineno"> 1217</span>    <span class="keywordflow">if</span>( thrown.<a class="code hl_variable" href="classitem.html#a2993eb10a5ae589e6bb1be0a74cb65c1">active</a> ) {</div>
<div class="line"><a id="l01218" name="l01218"></a><span class="lineno"> 1218</span>        <span class="comment">// Can&#39;t have Molotovs embed into monsters</span></div>
<div class="line"><a id="l01219" name="l01219"></a><span class="lineno"> 1219</span>        <span class="comment">// Monsters don&#39;t have inventory processing</span></div>
<div class="line"><a id="l01220" name="l01220"></a><span class="lineno"> 1220</span>        proj.<a class="code hl_function" href="structprojectile.html#a05d90cbb1c83669dd7c23477c8f35963">add_effect</a>( <a class="code hl_variable" href="ranged_8cpp.html#a8f6e1a41d7fec5aac1acdc98363c8cc4">ammo_effect_NO_EMBED</a> );</div>
<div class="line"><a id="l01221" name="l01221"></a><span class="lineno"> 1221</span>    }</div>
<div class="line"><a id="l01222" name="l01222"></a><span class="lineno"> 1222</span> </div>
<div class="line"><a id="l01223" name="l01223"></a><span class="lineno"> 1223</span>    <span class="keywordflow">if</span>( do_railgun ) {</div>
<div class="line"><a id="l01224" name="l01224"></a><span class="lineno"> 1224</span>        proj.<a class="code hl_function" href="structprojectile.html#a05d90cbb1c83669dd7c23477c8f35963">add_effect</a>( <a class="code hl_variable" href="ranged_8cpp.html#a17d7acb18d1ef9119106898d678fac76">ammo_effect_LIGHTNING</a> );</div>
<div class="line"><a id="l01225" name="l01225"></a><span class="lineno"> 1225</span>    }</div>
<div class="line"><a id="l01226" name="l01226"></a><span class="lineno"> 1226</span> </div>
<div class="line"><a id="l01227" name="l01227"></a><span class="lineno"> 1227</span>    <span class="keywordflow">if</span>( <a class="code hl_typedef" href="namespaceunits.html#a5d16607c866588620acb381e7dbbf0a6">volume</a> &gt; 500_ml ) {</div>
<div class="line"><a id="l01228" name="l01228"></a><span class="lineno"> 1228</span>        proj.<a class="code hl_function" href="structprojectile.html#a05d90cbb1c83669dd7c23477c8f35963">add_effect</a>( <a class="code hl_variable" href="ranged_8cpp.html#ad2f60bde7290b0993994d14fad34a3e9">ammo_effect_WIDE</a> );</div>
<div class="line"><a id="l01229" name="l01229"></a><span class="lineno"> 1229</span>    }</div>
<div class="line"><a id="l01230" name="l01230"></a><span class="lineno"> 1230</span> </div>
<div class="line"><a id="l01231" name="l01231"></a><span class="lineno"> 1231</span>    <span class="comment">// Deal extra cut damage if the item breaks</span></div>
<div class="line"><a id="l01232" name="l01232"></a><span class="lineno"> 1232</span>    <span class="keywordflow">if</span>( shatter ) {</div>
<div class="line"><a id="l01233" name="l01233"></a><span class="lineno"> 1233</span>        impact.add_damage( <a class="code hl_enumvalue" href="damage_8h.html#ae63a2cf8429f9edf77b547d34ffe4e7aa8ff698c0509e78ff65c7c7ec899b4f51">DT_CUT</a>, <a class="code hl_function" href="namespaceunits.html#a144476d36f26d6e1916493c3636d54dc">units::to_milliliter</a>( <a class="code hl_typedef" href="namespaceunits.html#a5d16607c866588620acb381e7dbbf0a6">volume</a> ) / 500.0f );</div>
<div class="line"><a id="l01234" name="l01234"></a><span class="lineno"> 1234</span>        proj.<a class="code hl_function" href="structprojectile.html#a05d90cbb1c83669dd7c23477c8f35963">add_effect</a>( <a class="code hl_variable" href="ranged_8cpp.html#a7037269f2b6a941bc0e3f2e659450f32">ammo_effect_SHATTER_SELF</a> );</div>
<div class="line"><a id="l01235" name="l01235"></a><span class="lineno"> 1235</span>    }</div>
<div class="line"><a id="l01236" name="l01236"></a><span class="lineno"> 1236</span> </div>
<div class="line"><a id="l01237" name="l01237"></a><span class="lineno"> 1237</span>    <span class="comment">// TODO: Add wet effect if other things care about that</span></div>
<div class="line"><a id="l01238" name="l01238"></a><span class="lineno"> 1238</span>    <span class="keywordflow">if</span>( burst ) {</div>
<div class="line"><a id="l01239" name="l01239"></a><span class="lineno"> 1239</span>        proj.<a class="code hl_function" href="structprojectile.html#a05d90cbb1c83669dd7c23477c8f35963">add_effect</a>( <a class="code hl_variable" href="ranged_8cpp.html#a336ae362f6bd28ffde9cd73ccf9be4ae">ammo_effect_BURST</a> );</div>
<div class="line"><a id="l01240" name="l01240"></a><span class="lineno"> 1240</span>    }</div>
<div class="line"><a id="l01241" name="l01241"></a><span class="lineno"> 1241</span> </div>
<div class="line"><a id="l01242" name="l01242"></a><span class="lineno"> 1242</span>    <span class="comment">// Some minor (skill/2) armor piercing for skillful throws</span></div>
<div class="line"><a id="l01243" name="l01243"></a><span class="lineno"> 1243</span>    <span class="comment">// Not as much as in melee, though</span></div>
<div class="line"><a id="l01244" name="l01244"></a><span class="lineno"> 1244</span>    <span class="keywordflow">for</span>( <a class="code hl_struct" href="structdamage__unit.html">damage_unit</a> &amp;du : impact.damage_units ) {</div>
<div class="line"><a id="l01245" name="l01245"></a><span class="lineno"> 1245</span>        du.<a class="code hl_variable" href="structdamage__unit.html#ab4d1b13f7ebe2f16a43038e1441ec2b5">res_pen</a> += skill_level / 2.0f;</div>
<div class="line"><a id="l01246" name="l01246"></a><span class="lineno"> 1246</span>    }</div>
<div class="line"><a id="l01247" name="l01247"></a><span class="lineno"> 1247</span>    <span class="comment">// handling for tangling thrown items</span></div>
<div class="line"><a id="l01248" name="l01248"></a><span class="lineno"> 1248</span>    <span class="keywordflow">if</span>( thrown.<a class="code hl_function" href="classitem.html#aaa5aeb6f838927babb10ede535cf2a73">has_flag</a>( <span class="stringliteral">&quot;TANGLE&quot;</span> ) ) {</div>
<div class="line"><a id="l01249" name="l01249"></a><span class="lineno"> 1249</span>        proj.<a class="code hl_function" href="structprojectile.html#a05d90cbb1c83669dd7c23477c8f35963">add_effect</a>( <a class="code hl_variable" href="ranged_8cpp.html#aa629b07204a26cf4e57eabe425b3d5c4">ammo_effect_TANGLE</a> );</div>
<div class="line"><a id="l01250" name="l01250"></a><span class="lineno"> 1250</span>    }</div>
<div class="line"><a id="l01251" name="l01251"></a><span class="lineno"> 1251</span> </div>
<div class="line"><a id="l01252" name="l01252"></a><span class="lineno"> 1252</span>    <a class="code hl_class" href="classCreature.html">Creature</a> *critter = <a class="code hl_variable" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;critter_at( target, <span class="keyword">true</span> );</div>
<div class="line"><a id="l01253" name="l01253"></a><span class="lineno"> 1253</span>    <span class="keyword">const</span> <a class="code hl_class" href="classdispersion__sources.html">dispersion_sources</a> dispersion( <a class="code hl_function" href="namespaceranged.html#a54895869f69a00b4a74df15057a9a780">ranged::throwing_dispersion</a>( who, thrown, critter,</div>
<div class="line"><a id="l01254" name="l01254"></a><span class="lineno"> 1254</span>                                         blind_throw_from_pos.has_value() ) );</div>
<div class="line"><a id="l01255" name="l01255"></a><span class="lineno"> 1255</span>    <span class="keyword">const</span> <a class="code hl_struct" href="structitype.html">itype</a> *thrown_type = thrown.<a class="code hl_variable" href="classitem.html#ac1d2c4c33b8a499812f3437cb2fad742">type</a>;</div>
<div class="line"><a id="l01256" name="l01256"></a><span class="lineno"> 1256</span> </div>
<div class="line"><a id="l01257" name="l01257"></a><span class="lineno"> 1257</span>    <span class="comment">// Put the item into the projectile</span></div>
<div class="line"><a id="l01258" name="l01258"></a><span class="lineno"> 1258</span>    proj.<a class="code hl_function" href="structprojectile.html#a2bbf20562006058aa939aa5339860ba7">set_drop</a>( <a class="code hl_function" href="namespaceavatar__action.html#a76ba74774376a08222b8cdcce08f7304">std::move</a>( thrown ) );</div>
<div class="line"><a id="l01259" name="l01259"></a><span class="lineno"> 1259</span>    <span class="keywordflow">if</span>( thrown_type-&gt;<a class="code hl_function" href="structitype.html#ab8196084d50fd9a33d6d93c290501b4f">has_flag</a>( <span class="stringliteral">&quot;CUSTOM_EXPLOSION&quot;</span> ) ) {</div>
<div class="line"><a id="l01260" name="l01260"></a><span class="lineno"> 1260</span>        proj.<a class="code hl_function" href="structprojectile.html#a3eb9cbe946d6bf2131eeae97d2d1230d">set_custom_explosion</a>( thrown_type-&gt;<a class="code hl_variable" href="structitype.html#a15ce9f3914d2afb7992e4683a0996791">explosion</a> );</div>
<div class="line"><a id="l01261" name="l01261"></a><span class="lineno"> 1261</span>    }</div>
<div class="line"><a id="l01262" name="l01262"></a><span class="lineno"> 1262</span> </div>
<div class="line"><a id="l01263" name="l01263"></a><span class="lineno"> 1263</span>    <span class="comment">// Throw from the player&#39;s position, unless we&#39;re blind throwing, in which case</span></div>
<div class="line"><a id="l01264" name="l01264"></a><span class="lineno"> 1264</span>    <span class="comment">// throw from the the blind throw position instead.</span></div>
<div class="line"><a id="l01265" name="l01265"></a><span class="lineno"> 1265</span>    <span class="keyword">const</span> <a class="code hl_struct" href="structtripoint.html">tripoint</a> throw_from = blind_throw_from_pos ? *blind_throw_from_pos : who.<a class="code hl_function" href="classCharacter.html#ad24859164517ed6e392e21df69527199">pos</a>();</div>
<div class="line"><a id="l01266" name="l01266"></a><span class="lineno"> 1266</span> </div>
<div class="line"><a id="l01267" name="l01267"></a><span class="lineno"> 1267</span>    <span class="keywordtype">float</span> <a class="code hl_enumvalue" href="character_8h.html#addab86bfe6fd0bf8c22ec43df3ec051da1c21724609ac70f1573fd4b755c64ddb">range</a> = <a class="code hl_function" href="coordinates_8h.html#a47953b33a873caa0861b12222842a5ec">rl_dist</a>( throw_from, target );</div>
<div class="line"><a id="l01268" name="l01268"></a><span class="lineno"> 1268</span>    proj.<a class="code hl_variable" href="structprojectile.html#a312bc9a78fe7a5fdefb44e3755154db3">range</a> = <a class="code hl_enumvalue" href="character_8h.html#addab86bfe6fd0bf8c22ec43df3ec051da1c21724609ac70f1573fd4b755c64ddb">range</a>;</div>
<div class="line"><a id="l01269" name="l01269"></a><span class="lineno"> 1269</span>    <span class="keywordtype">int</span> skill_lvl = who.<a class="code hl_function" href="classCharacter.html#afa95fe499ca6b55ab97f1b442a4c95c5">get_skill_level</a>( skill_used );</div>
<div class="line"><a id="l01270" name="l01270"></a><span class="lineno"> 1270</span>    <span class="comment">// Avoid awarding tons of xp for lucky throws against hard to hit targets</span></div>
<div class="line"><a id="l01271" name="l01271"></a><span class="lineno"> 1271</span>    <span class="keyword">const</span> <span class="keywordtype">float</span> range_factor = std::min&lt;float&gt;( <a class="code hl_enumvalue" href="character_8h.html#addab86bfe6fd0bf8c22ec43df3ec051da1c21724609ac70f1573fd4b755c64ddb">range</a>, skill_lvl + 3 );</div>
<div class="line"><a id="l01272" name="l01272"></a><span class="lineno"> 1272</span>    <span class="comment">// We&#39;re aiming to get a damaging hit, not just an accurate one - reward proper weapons</span></div>
<div class="line"><a id="l01273" name="l01273"></a><span class="lineno"> 1273</span>    <span class="keyword">const</span> <span class="keywordtype">float</span> damage_factor = 5.0f * std::sqrt( proj.<a class="code hl_variable" href="structprojectile.html#a82d8f657f8cfc4e180c15bfab8ca8a6e">impact</a>.<a class="code hl_function" href="structdamage__instance.html#a96f6f6d008ed8744ce549cefcfec3951">total_damage</a>() / 5.0f );</div>
<div class="line"><a id="l01274" name="l01274"></a><span class="lineno"> 1274</span>    <span class="comment">// This should generally have values below ~20*sqrt(skill_lvl)</span></div>
<div class="line"><a id="l01275" name="l01275"></a><span class="lineno"> 1275</span>    <span class="keyword">const</span> <span class="keywordtype">float</span> final_xp_mult = range_factor * damage_factor;</div>
<div class="line"><a id="l01276" name="l01276"></a><span class="lineno"> 1276</span> </div>
<div class="line"><a id="l01277" name="l01277"></a><span class="lineno"> 1277</span>    <span class="keyword">auto</span> dealt_attack = <a class="code hl_function" href="ballistics_8cpp.html#aeded5f16540ef8f873a7d9eb5edca240">projectile_attack</a>( proj, throw_from, target, dispersion, &amp;who );</div>
<div class="line"><a id="l01278" name="l01278"></a><span class="lineno"> 1278</span> </div>
<div class="line"><a id="l01279" name="l01279"></a><span class="lineno"> 1279</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> missed_by = dealt_attack.missed_by;</div>
<div class="line"><a id="l01280" name="l01280"></a><span class="lineno"> 1280</span>    <span class="keywordflow">if</span>( missed_by &lt;= 0.1 &amp;&amp; dealt_attack.hit_critter != <span class="keyword">nullptr</span> ) {</div>
<div class="line"><a id="l01281" name="l01281"></a><span class="lineno"> 1281</span>        who.<a class="code hl_function" href="classCreature.html#acb1d0a1210d3dd4c86350f3ad4c58649">as_player</a>()-&gt;<a class="code hl_function" href="classCharacter.html#a3d70ebd707bada8879208e98f07f7223">practice</a>( skill_used, final_xp_mult, <a class="code hl_variable" href="game__constants_8h.html#ae9c0ec5b4724c15132efddb8862ca652">MAX_SKILL</a> );</div>
<div class="line"><a id="l01282" name="l01282"></a><span class="lineno"> 1282</span>        <span class="comment">// TODO: Check target for existence of head</span></div>
<div class="line"><a id="l01283" name="l01283"></a><span class="lineno"> 1283</span>        <a class="code hl_variable" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;events().send&lt;<a class="code hl_enumvalue" href="event_8h.html#a430b444c74dd3fd1472a31714ec5f1cea365dbc32084e314b4788756b6fa66ecb">event_type::character_gets_headshot</a>&gt;( who.<a class="code hl_function" href="classCharacter.html#adb54bdcb284abb66b6be99c8ae225065">getID</a>() );</div>
<div class="line"><a id="l01284" name="l01284"></a><span class="lineno"> 1284</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( dealt_attack.hit_critter != <span class="keyword">nullptr</span> &amp;&amp; missed_by &gt; 0.0f ) {</div>
<div class="line"><a id="l01285" name="l01285"></a><span class="lineno"> 1285</span>        who.<a class="code hl_function" href="classCreature.html#acb1d0a1210d3dd4c86350f3ad4c58649">as_player</a>()-&gt;<a class="code hl_function" href="classCharacter.html#a3d70ebd707bada8879208e98f07f7223">practice</a>( skill_used, final_xp_mult / ( 1.0f + missed_by ), <a class="code hl_variable" href="game__constants_8h.html#ae9c0ec5b4724c15132efddb8862ca652">MAX_SKILL</a> );</div>
<div class="line"><a id="l01286" name="l01286"></a><span class="lineno"> 1286</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01287" name="l01287"></a><span class="lineno"> 1287</span>        <span class="comment">// Pure grindy practice - cap gain at lvl 2</span></div>
<div class="line"><a id="l01288" name="l01288"></a><span class="lineno"> 1288</span>        who.<a class="code hl_function" href="classCreature.html#acb1d0a1210d3dd4c86350f3ad4c58649">as_player</a>()-&gt;<a class="code hl_function" href="classCharacter.html#a3d70ebd707bada8879208e98f07f7223">practice</a>( skill_used, 5, 2 );</div>
<div class="line"><a id="l01289" name="l01289"></a><span class="lineno"> 1289</span>    }</div>
<div class="line"><a id="l01290" name="l01290"></a><span class="lineno"> 1290</span>    <span class="comment">// Reset last target pos</span></div>
<div class="line"><a id="l01291" name="l01291"></a><span class="lineno"> 1291</span>    who.<a class="code hl_function" href="classCreature.html#acb1d0a1210d3dd4c86350f3ad4c58649">as_player</a>()-&gt;<a class="code hl_variable" href="classplayer.html#ad8110d027c3f75af41656a8caf171b9f">last_target_pos</a> = std::nullopt;</div>
<div class="line"><a id="l01292" name="l01292"></a><span class="lineno"> 1292</span>    who.<a class="code hl_variable" href="classCharacter.html#a057d68671b298012a18f4e289b39935d">recoil</a> = <a class="code hl_variable" href="game__constants_8h.html#a8226e8a134603e5bc06df05efd13d8d1">MAX_RECOIL</a>;</div>
<div class="line"><a id="l01293" name="l01293"></a><span class="lineno"> 1293</span> </div>
<div class="line"><a id="l01294" name="l01294"></a><span class="lineno"> 1294</span>    <span class="keywordflow">return</span> dealt_attack;</div>
<div class="line"><a id="l01295" name="l01295"></a><span class="lineno"> 1295</span>}</div>
<div class="ttc" id="aclassCharacter_html_ac29de3d2bc90dd1c8d921b539fb05cfb"><div class="ttname"><a href="classCharacter.html#ac29de3d2bc90dd1c8d921b539fb05cfb">Character::mod_stamina</a></div><div class="ttdeci">void mod_stamina(int mod)</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l07109">character.cpp:7109</a></div></div>
<div class="ttc" id="aclassCreature_html_a891bc2d0c564449cb462178317819254"><div class="ttname"><a href="classCreature.html#a891bc2d0c564449cb462178317819254">Creature::mod_moves</a></div><div class="ttdeci">void mod_moves(int nmoves)</div><div class="ttdef"><b>Definition:</b> <a href="creature_8cpp_source.html#l01448">creature.cpp:1448</a></div></div>
<div class="ttc" id="aclassitem_html_a13b2b008995a2f2f2daa63be578b27c8"><div class="ttname"><a href="classitem.html#a13b2b008995a2f2f2daa63be578b27c8">item::base_damage_thrown</a></div><div class="ttdeci">damage_instance base_damage_thrown() const</div><div class="ttdoc">All damage types this item deals when thrown (no skill modifiers etc.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l05284">item.cpp:5284</a></div></div>
<div class="ttc" id="aclassitem_html_a19e6dd5afd4bada41c8d97792fd0815d"><div class="ttname"><a href="classitem.html#a19e6dd5afd4bada41c8d97792fd0815d">item::get_property_int64_t</a></div><div class="ttdeci">int64_t get_property_int64_t(const std::string &amp;prop, int64_t def=0) const</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l05394">item.cpp:5394</a></div></div>
<div class="ttc" id="aclassitem_html_a2993eb10a5ae589e6bb1be0a74cb65c1"><div class="ttname"><a href="classitem.html#a2993eb10a5ae589e6bb1be0a74cb65c1">item::active</a></div><div class="ttdeci">bool active</div><div class="ttdef"><b>Definition:</b> <a href="item_8h_source.html#l02237">item.h:2237</a></div></div>
<div class="ttc" id="aclassitem_html_a3157f01f1da6fe89bdbc87db2605afb9"><div class="ttname"><a href="classitem.html#a3157f01f1da6fe89bdbc87db2605afb9">item::weight</a></div><div class="ttdeci">units::mass weight(bool include_contents=true, bool integral=false) const</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l04983">item.cpp:4983</a></div></div>
<div class="ttc" id="aclassitem_html_a4326944ae95f4d265c8ca1c76ed89a03"><div class="ttname"><a href="classitem.html#a4326944ae95f4d265c8ca1c76ed89a03">item::made_of</a></div><div class="ttdeci">const std::vector&lt; material_id &gt; &amp; made_of() const</div><div class="ttdoc">The ids of all the materials this is made of.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l06438">item.cpp:6438</a></div></div>
<div class="ttc" id="aclassitem_html_a723753bab4cc789e3ec186846c9916a3"><div class="ttname"><a href="classitem.html#a723753bab4cc789e3ec186846c9916a3">item::is_container</a></div><div class="ttdeci">bool is_container() const</div><div class="ttdoc">Whether this is container.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l06744">item.cpp:6744</a></div></div>
<div class="ttc" id="aclassitem_html_a9e2c24734b538e61e186fb6777b62c25"><div class="ttname"><a href="classitem.html#a9e2c24734b538e61e186fb6777b62c25">item::made_of_any</a></div><div class="ttdeci">bool made_of_any(const std::set&lt; material_id &gt; &amp;mat_idents) const</div><div class="ttdoc">Check we are made of at least one of a set (e.g.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l06460">item.cpp:6460</a></div></div>
<div class="ttc" id="aclassitem_html_acbc651b09ebafad57974d0cfa04b8e5d"><div class="ttname"><a href="classitem.html#acbc651b09ebafad57974d0cfa04b8e5d">item::get_container_capacity</a></div><div class="ttdeci">units::volume get_container_capacity() const</div><div class="ttdoc">It returns the total capacity (volume) of the container for liquids.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l08417">item.cpp:8417</a></div></div>
<div class="ttc" id="aclassitem_html_aeb49bb1b64eba3731e606ffe83e95b4f"><div class="ttname"><a href="classitem.html#aeb49bb1b64eba3731e606ffe83e95b4f">item::has_property</a></div><div class="ttdeci">bool has_property(const std::string &amp;prop) const</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l05383">item.cpp:5383</a></div></div>
<div class="ttc" id="aclassitem_html_aeb62f6d93e37bf01af71f795cc39f4f1"><div class="ttname"><a href="classitem.html#aeb62f6d93e37bf01af71f795cc39f4f1">item::get_contained</a></div><div class="ttdeci">const item &amp; get_contained() const</div><div class="ttdoc">Return a contained item (if any and only one).</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l07076">item.cpp:7076</a></div></div>
<div class="ttc" id="aclassmonster_html_a8ea6e76214228bc20ec1d69daebe5d72"><div class="ttname"><a href="classmonster.html#a8ea6e76214228bc20ec1d69daebe5d72">monster::use_mech_power</a></div><div class="ttdeci">bool use_mech_power(int amt)</div><div class="ttdef"><b>Definition:</b> <a href="monster_8cpp_source.html#l02435">monster.cpp:2435</a></div></div>
<div class="ttc" id="aclassmonster_html_ad104be109ff1d39a6e96cfb133e08ef0"><div class="ttname"><a href="classmonster.html#ad104be109ff1d39a6e96cfb133e08ef0">monster::mech_str_addition</a></div><div class="ttdeci">int mech_str_addition() const</div><div class="ttdef"><b>Definition:</b> <a href="monster_8cpp_source.html#l02445">monster.cpp:2445</a></div></div>
<div class="ttc" id="aclassplayer_html_ad8110d027c3f75af41656a8caf171b9f"><div class="ttname"><a href="classplayer.html#ad8110d027c3f75af41656a8caf171b9f">player::last_target_pos</a></div><div class="ttdeci">std::optional&lt; tripoint &gt; last_target_pos</div><div class="ttdef"><b>Definition:</b> <a href="player_8h_source.html#l00242">player.h:242</a></div></div>
<div class="ttc" id="aclassunits_1_1quantity_html"><div class="ttname"><a href="classunits_1_1quantity.html">units::quantity</a></div><div class="ttdef"><b>Definition:</b> <a href="units__def_8h_source.html#l00014">units_def.h:15</a></div></div>
<div class="ttc" id="aclassunits_1_1quantity_html_a239e9b238064a23fab11ff2094537958"><div class="ttname"><a href="classunits_1_1quantity.html#a239e9b238064a23fab11ff2094537958">units::quantity::value</a></div><div class="ttdeci">constexpr const value_type &amp; value() const</div><div class="ttdoc">Access the raw dimensionless value.</div><div class="ttdef"><b>Definition:</b> <a href="units__def_8h_source.html#l00044">units_def.h:44</a></div></div>
<div class="ttc" id="acoordinates_8h_html_a47953b33a873caa0861b12222842a5ec"><div class="ttname"><a href="coordinates_8h.html#a47953b33a873caa0861b12222842a5ec">rl_dist</a></div><div class="ttdeci">int rl_dist(const coords::coord_point&lt; Point, Origin, Scale &gt; &amp;loc1, const coords::coord_point&lt; Point, Origin, Scale &gt; &amp;loc2)</div><div class="ttdef"><b>Definition:</b> <a href="coordinates_8h_source.html#l00519">coordinates.h:519</a></div></div>
<div class="ttc" id="adamage_8h_html_ae63a2cf8429f9edf77b547d34ffe4e7aa5f8b46c6c239266403858fa2ae90ef23"><div class="ttname"><a href="damage_8h.html#ae63a2cf8429f9edf77b547d34ffe4e7aa5f8b46c6c239266403858fa2ae90ef23">DT_BASH</a></div><div class="ttdeci">@ DT_BASH</div><div class="ttdef"><b>Definition:</b> <a href="damage_8h_source.html#l00024">damage.h:24</a></div></div>
<div class="ttc" id="adamage_8h_html_ae63a2cf8429f9edf77b547d34ffe4e7aa8ff698c0509e78ff65c7c7ec899b4f51"><div class="ttname"><a href="damage_8h.html#ae63a2cf8429f9edf77b547d34ffe4e7aa8ff698c0509e78ff65c7c7ec899b4f51">DT_CUT</a></div><div class="ttdeci">@ DT_CUT</div><div class="ttdef"><b>Definition:</b> <a href="damage_8h_source.html#l00025">damage.h:25</a></div></div>
<div class="ttc" id="anamespaceranged_html_a54895869f69a00b4a74df15057a9a780"><div class="ttname"><a href="namespaceranged.html#a54895869f69a00b4a74df15057a9a780">ranged::throwing_dispersion</a></div><div class="ttdeci">int throwing_dispersion(const Character &amp;c, const item &amp;to_throw, Creature *critter, bool is_blind_throw)</div><div class="ttdoc">Dispersion of a thrown item, against a given target, taking into account whether or not the throw was...</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01085">ranged.cpp:1085</a></div></div>
<div class="ttc" id="anamespaceranged_html_aeadf3905fda7ac9f7e6e13d78d6beadb"><div class="ttname"><a href="namespaceranged.html#aeadf3905fda7ac9f7e6e13d78d6beadb">ranged::throw_cost</a></div><div class="ttdeci">int throw_cost(const Character &amp;c, const item &amp;to_throw)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00990">ranged.cpp:990</a></div></div>
<div class="ttc" id="anamespaceunits_html_a144476d36f26d6e1916493c3636d54dc"><div class="ttname"><a href="namespaceunits.html#a144476d36f26d6e1916493c3636d54dc">units::to_milliliter</a></div><div class="ttdeci">constexpr value_type to_milliliter(const quantity&lt; value_type, volume_in_milliliter_tag &gt; &amp;v)</div><div class="ttdef"><b>Definition:</b> <a href="units__volume_8h_source.html#l00038">units_volume.h:38</a></div></div>
<div class="ttc" id="anamespaceunits_html_a5d16607c866588620acb381e7dbbf0a6"><div class="ttname"><a href="namespaceunits.html#a5d16607c866588620acb381e7dbbf0a6">units::volume</a></div><div class="ttdeci">quantity&lt; int, volume_in_milliliter_tag &gt; volume</div><div class="ttdef"><b>Definition:</b> <a href="units__volume_8h_source.html#l00016">units_volume.h:16</a></div></div>
<div class="ttc" id="aranged_8cpp_html_a08481f62adb6937636ea44b855311037"><div class="ttname"><a href="ranged_8cpp.html#a08481f62adb6937636ea44b855311037">effect_downed</a></div><div class="ttdeci">static const efftype_id effect_downed(&quot;downed&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a17d7acb18d1ef9119106898d678fac76"><div class="ttname"><a href="ranged_8cpp.html#a17d7acb18d1ef9119106898d678fac76">ammo_effect_LIGHTNING</a></div><div class="ttdeci">static const ammo_effect_str_id ammo_effect_LIGHTNING(&quot;LIGHTNING&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a336ae362f6bd28ffde9cd73ccf9be4ae"><div class="ttname"><a href="ranged_8cpp.html#a336ae362f6bd28ffde9cd73ccf9be4ae">ammo_effect_BURST</a></div><div class="ttdeci">static const ammo_effect_str_id ammo_effect_BURST(&quot;BURST&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a4832c47fe321946202cd17b211b27862"><div class="ttname"><a href="ranged_8cpp.html#a4832c47fe321946202cd17b211b27862">ammo_effect_ACT_ON_RANGED_HIT</a></div><div class="ttdeci">static const ammo_effect_str_id ammo_effect_ACT_ON_RANGED_HIT(&quot;ACT_ON_RANGED_HIT&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a56ca2e5cfeec3ed46b11661ab0d4a51d"><div class="ttname"><a href="ranged_8cpp.html#a56ca2e5cfeec3ed46b11661ab0d4a51d">ammo_effect_HEAVY_HIT</a></div><div class="ttdeci">static const ammo_effect_str_id ammo_effect_HEAVY_HIT(&quot;HEAVY_HIT&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a7037269f2b6a941bc0e3f2e659450f32"><div class="ttname"><a href="ranged_8cpp.html#a7037269f2b6a941bc0e3f2e659450f32">ammo_effect_SHATTER_SELF</a></div><div class="ttdeci">static const ammo_effect_str_id ammo_effect_SHATTER_SELF(&quot;SHATTER_SELF&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a738f726f320c7f5b5edca445777a14fa"><div class="ttname"><a href="ranged_8cpp.html#a738f726f320c7f5b5edca445777a14fa">bio_railgun</a></div><div class="ttdeci">static const bionic_id bio_railgun(&quot;bio_railgun&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a8f6e1a41d7fec5aac1acdc98363c8cc4"><div class="ttname"><a href="ranged_8cpp.html#a8f6e1a41d7fec5aac1acdc98363c8cc4">ammo_effect_NO_EMBED</a></div><div class="ttdeci">static const ammo_effect_str_id ammo_effect_NO_EMBED(&quot;NO_EMBED&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_aa3f58e0db88c98c686cbce467d25fd94"><div class="ttname"><a href="ranged_8cpp.html#aa3f58e0db88c98c686cbce467d25fd94">ammo_effect_NO_ITEM_DAMAGE</a></div><div class="ttdeci">static const ammo_effect_str_id ammo_effect_NO_ITEM_DAMAGE(&quot;NO_ITEM_DAMAGE&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_aa629b07204a26cf4e57eabe425b3d5c4"><div class="ttname"><a href="ranged_8cpp.html#aa629b07204a26cf4e57eabe425b3d5c4">ammo_effect_TANGLE</a></div><div class="ttdeci">static const ammo_effect_str_id ammo_effect_TANGLE(&quot;TANGLE&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_ad2f60bde7290b0993994d14fad34a3e9"><div class="ttname"><a href="ranged_8cpp.html#ad2f60bde7290b0993994d14fad34a3e9">ammo_effect_WIDE</a></div><div class="ttdeci">static const ammo_effect_str_id ammo_effect_WIDE(&quot;WIDE&quot;)</div></div>
<div class="ttc" id="arng_8cpp_html_acd19ae79e3590a99c9eaf0389318b686"><div class="ttname"><a href="rng_8cpp.html#acd19ae79e3590a99c9eaf0389318b686">roll_remainder</a></div><div class="ttdeci">int roll_remainder(double value)</div><div class="ttdef"><b>Definition:</b> <a href="rng_8cpp_source.html#l00096">rng.cpp:96</a></div></div>
<div class="ttc" id="astructdamage__unit_html"><div class="ttname"><a href="structdamage__unit.html">damage_unit</a></div><div class="ttdef"><b>Definition:</b> <a href="damage_8h_source.html#l00035">damage.h:35</a></div></div>
<div class="ttc" id="astructdamage__unit_html_ab4d1b13f7ebe2f16a43038e1441ec2b5"><div class="ttname"><a href="structdamage__unit.html#ab4d1b13f7ebe2f16a43038e1441ec2b5">damage_unit::res_pen</a></div><div class="ttdeci">float res_pen</div><div class="ttdef"><b>Definition:</b> <a href="damage_8h_source.html#l00038">damage.h:38</a></div></div>
<div class="ttc" id="astructitype_html"><div class="ttname"><a href="structitype.html">itype</a></div><div class="ttdef"><b>Definition:</b> <a href="itype_8h_source.html#l00804">itype.h:804</a></div></div>
<div class="ttc" id="astructitype_html_a15ce9f3914d2afb7992e4683a0996791"><div class="ttname"><a href="structitype.html#a15ce9f3914d2afb7992e4683a0996791">itype::explosion</a></div><div class="ttdeci">explosion_data explosion</div><div class="ttdef"><b>Definition:</b> <a href="itype_8h_source.html#l00913">itype.h:913</a></div></div>
<div class="ttc" id="astructitype_html_ab8196084d50fd9a33d6d93c290501b4f"><div class="ttname"><a href="structitype.html#ab8196084d50fd9a33d6d93c290501b4f">itype::has_flag</a></div><div class="ttdeci">bool has_flag(const std::string &amp;flag) const</div><div class="ttdef"><b>Definition:</b> <a href="itype_8cpp_source.html#l00146">itype.cpp:146</a></div></div>
<div class="ttc" id="astructprojectile_html_a2bbf20562006058aa939aa5339860ba7"><div class="ttname"><a href="structprojectile.html#a2bbf20562006058aa939aa5339860ba7">projectile::set_drop</a></div><div class="ttdeci">void set_drop(const item &amp;it)</div><div class="ttdoc">Copies item it as a drop for this projectile.</div><div class="ttdef"><b>Definition:</b> <a href="projectile_8cpp_source.html#l00053">projectile.cpp:53</a></div></div>
<div class="ttc" id="astructprojectile_html_a312bc9a78fe7a5fdefb44e3755154db3"><div class="ttname"><a href="structprojectile.html#a312bc9a78fe7a5fdefb44e3755154db3">projectile::range</a></div><div class="ttdeci">int range</div><div class="ttdef"><b>Definition:</b> <a href="projectile_8h_source.html#l00026">projectile.h:26</a></div></div>
<div class="ttc" id="astructprojectile_html_a3eb9cbe946d6bf2131eeae97d2d1230d"><div class="ttname"><a href="structprojectile.html#a3eb9cbe946d6bf2131eeae97d2d1230d">projectile::set_custom_explosion</a></div><div class="ttdeci">void set_custom_explosion(const explosion_data &amp;ex)</div><div class="ttdef"><b>Definition:</b> <a href="projectile_8cpp_source.html#l00086">projectile.cpp:86</a></div></div>
<div class="ttc" id="astructprojectile_html_aa2af53bce63feecb719ef1edba54689e"><div class="ttname"><a href="structprojectile.html#aa2af53bce63feecb719ef1edba54689e">projectile::speed</a></div><div class="ttdeci">int speed</div><div class="ttdef"><b>Definition:</b> <a href="projectile_8h_source.html#l00025">projectile.h:25</a></div></div>
<div class="ttc" id="atype__id_8h_html_a569ce0271cf4ab170e63bb05658be142"><div class="ttname"><a href="type__id_8h.html#a569ce0271cf4ab170e63bb05658be142">material_id</a></div><div class="ttdeci">string_id&lt; material_type &gt; material_id</div><div class="ttdef"><b>Definition:</b> <a href="type__id_8h_source.html#l00095">type_id.h:95</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="item_8h_source.html#l02237">item::active</a>, <a class="el" href="projectile_8h_source.html#l00058">projectile::add_effect()</a>, <a class="el" href="ranged_8cpp.html#a4832c47fe321946202cd17b211b27862">ammo_effect_ACT_ON_RANGED_HIT</a>, <a class="el" href="ranged_8cpp.html#a336ae362f6bd28ffde9cd73ccf9be4ae">ammo_effect_BURST</a>, <a class="el" href="ranged_8cpp.html#a56ca2e5cfeec3ed46b11661ab0d4a51d">ammo_effect_HEAVY_HIT</a>, <a class="el" href="ranged_8cpp.html#a17d7acb18d1ef9119106898d678fac76">ammo_effect_LIGHTNING</a>, <a class="el" href="ranged_8cpp.html#a8f6e1a41d7fec5aac1acdc98363c8cc4">ammo_effect_NO_EMBED</a>, <a class="el" href="ranged_8cpp.html#aa3f58e0db88c98c686cbce467d25fd94">ammo_effect_NO_ITEM_DAMAGE</a>, <a class="el" href="ranged_8cpp.html#a7037269f2b6a941bc0e3f2e659450f32">ammo_effect_SHATTER_SELF</a>, <a class="el" href="ranged_8cpp.html#aa629b07204a26cf4e57eabe425b3d5c4">ammo_effect_TANGLE</a>, <a class="el" href="ranged_8cpp.html#ad2f60bde7290b0993994d14fad34a3e9">ammo_effect_WIDE</a>, <a class="el" href="creature_8h_source.html#l00122">Creature::as_player()</a>, <a class="el" href="item_8cpp_source.html#l05284">item::base_damage_thrown()</a>, <a class="el" href="ranged_8cpp.html#a738f726f320c7f5b5edca445777a14fa">bio_railgun</a>, <a class="el" href="bodypart_8h_source.html#l00045">bp_arm_l</a>, <a class="el" href="bodypart_8h_source.html#l00046">bp_arm_r</a>, <a class="el" href="event_8h.html#a430b444c74dd3fd1472a31714ec5f1cea365dbc32084e314b4788756b6fa66ecb">character_gets_headshot</a>, <a class="el" href="damage_8h_source.html#l00024">DT_BASH</a>, <a class="el" href="damage_8h_source.html#l00025">DT_CUT</a>, <a class="el" href="ranged_8cpp.html#a08481f62adb6937636ea44b855311037">effect_downed</a>, <a class="el" href="character_8cpp_source.html#l04027">Character::encumb()</a>, <a class="el" href="itype_8h_source.html#l00913">itype::explosion</a>, <a class="el" href="game_8cpp_source.html#l00283">g</a>, <a class="el" href="item_8cpp_source.html#l07076">item::get_contained()</a>, <a class="el" href="item_8cpp_source.html#l08417">item::get_container_capacity()</a>, <a class="el" href="item_8cpp_source.html#l05394">item::get_property_int64_t()</a>, <a class="el" href="character_8cpp_source.html#l03351">Character::get_skill_level()</a>, <a class="el" href="character_8cpp_source.html#l04090">Character::get_str()</a>, <a class="el" href="character_8cpp_source.html#l00494">Character::getID()</a>, <a class="el" href="character_8cpp_source.html#l01824">Character::has_active_bionic()</a>, <a class="el" href="creature_8cpp_source.html#l01206">Creature::has_effect()</a>, <a class="el" href="item_8cpp_source.html#l05328">item::has_flag()</a>, <a class="el" href="itype_8cpp_source.html#l00146">itype::has_flag()</a>, <a class="el" href="item_8cpp_source.html#l05383">item::has_property()</a>, <a class="el" href="projectile_8h_source.html#l00021">projectile::impact</a>, <a class="el" href="item_8cpp_source.html#l06744">item::is_container()</a>, <a class="el" href="character_8cpp_source.html#l01082">Character::is_mounted()</a>, <a class="el" href="player_8h_source.html#l00242">player::last_target_pos</a>, <a class="el" href="item_8cpp_source.html#l06438">item::made_of()</a>, <a class="el" href="item_8cpp_source.html#l06460">item::made_of_any()</a>, <a class="el" href="game__constants_8h_source.html#l00131">MAX_RECOIL</a>, <a class="el" href="game__constants_8h_source.html#l00114">MAX_SKILL</a>, <a class="el" href="monster_8cpp_source.html#l02445">monster::mech_str_addition()</a>, <a class="el" href="creature_8cpp_source.html#l01448">Creature::mod_moves()</a>, <a class="el" href="character_8cpp_source.html#l07109">Character::mod_stamina()</a>, <a class="el" href="character_8h_source.html#l01617">Character::mounted_creature</a>, <a class="el" href="avatar__action_8cpp_source.html#l00096">avatar_action::move()</a>, <a class="el" href="activity__item__handling_8cpp_source.html#l00899">move_cost()</a>, <a class="el" href="character_8cpp_source.html#l00601">Character::pos()</a>, <a class="el" href="character_8cpp_source.html#l03417">Character::practice()</a>, <a class="el" href="ballistics_8cpp_source.html#l00201">projectile_attack()</a>, <a class="el" href="character_8h_source.html#l00104">range</a>, <a class="el" href="projectile_8h_source.html#l00026">projectile::range</a>, <a class="el" href="character_8h_source.html#l00571">Character::recoil</a>, <a class="el" href="damage_8h_source.html#l00038">damage_unit::res_pen</a>, <a class="el" href="coordinates_8h_source.html#l00519">rl_dist()</a>, <a class="el" href="artifact_8cpp_source.html#l00032">rng()</a>, <a class="el" href="rng_8cpp_source.html#l00096">roll_remainder()</a>, <a class="el" href="projectile_8cpp_source.html#l00086">projectile::set_custom_explosion()</a>, <a class="el" href="projectile_8cpp_source.html#l00053">projectile::set_drop()</a>, <a class="el" href="ranged_8cpp.html#aca8ae2b9cbc86602a56a3885b72a4ed1">skill_throw</a>, <a class="el" href="projectile_8h_source.html#l00025">projectile::speed</a>, <a class="el" href="ranged_8cpp_source.html#l00990">throw_cost()</a>, <a class="el" href="ranged_8cpp_source.html#l01085">throwing_dispersion()</a>, <a class="el" href="units__volume_8h_source.html#l00038">units::to_milliliter()</a>, <a class="el" href="damage_8cpp_source.html#l00075">damage_instance::total_damage()</a>, <a class="el" href="item_8h_source.html#l02160">item::type</a>, <a class="el" href="monster_8cpp_source.html#l02435">monster::use_mech_power()</a>, <a class="el" href="units__def_8h_source.html#l00044">units::quantity&lt; V, U &gt;::value()</a>, <a class="el" href="item_8cpp_source.html#l05129">item::volume()</a>, and <a class="el" href="item_8cpp_source.html#l04983">item::weight()</a>.</p>

<p class="reference">Referenced by <a class="el" href="activity__actor_8cpp_source.html#l01158">throw_activity_actor::do_turn()</a>, and <a class="el" href="npcmove_8cpp_source.html#l03594">npc_throw()</a>.</p>

</div>
</div>
<a id="a54895869f69a00b4a74df15057a9a780" name="a54895869f69a00b4a74df15057a9a780"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a54895869f69a00b4a74df15057a9a780">&#9670;&nbsp;</a></span>throwing_dispersion()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ranged::throwing_dispersion </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classCharacter.html">Character</a> &amp;&#160;</td>
          <td class="paramname"><em>c</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classitem.html">item</a> &amp;&#160;</td>
          <td class="paramname"><em>to_throw</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classCreature.html">Creature</a> *&#160;</td>
          <td class="paramname"><em>critter</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>is_blind_throw</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Dispersion of a thrown item, against a given target, taking into account whether or not the throw was blind. </p>
Strength decreases throwing dispersion when throwing heavy objects Throw increases throwing accuracy Perception decreases throwing accuracy penalty from eye encumbrance 
<p class="definition">Definition at line <a class="el" href="ranged_8cpp_source.html#l01085">1085</a> of file <a class="el" href="ranged_8cpp_source.html">ranged.cpp</a>.</p>
<div class="fragment"><div class="line"><a id="l01087" name="l01087"></a><span class="lineno"> 1087</span>{</div>
<div class="line"><a id="l01088" name="l01088"></a><span class="lineno"> 1088</span>    <a class="code hl_class" href="classunits_1_1quantity.html">units::mass</a> weight = to_throw.<a class="code hl_function" href="classitem.html#a3157f01f1da6fe89bdbc87db2605afb9">weight</a>();</div>
<div class="line"><a id="l01089" name="l01089"></a><span class="lineno"> 1089</span>    <a class="code hl_class" href="classunits_1_1quantity.html">units::volume</a> <a class="code hl_typedef" href="namespaceunits.html#a5d16607c866588620acb381e7dbbf0a6">volume</a> = to_throw.<a class="code hl_function" href="classitem.html#a51eafbdf8b331d88b741c0c527f98eb9">volume</a>();</div>
<div class="line"><a id="l01090" name="l01090"></a><span class="lineno"> 1090</span>    <span class="keywordflow">if</span>( to_throw.<a class="code hl_function" href="classitem.html#a40963a016376016eb408bdb9dbb94388">count_by_charges</a>() &amp;&amp; to_throw.<a class="code hl_variable" href="classitem.html#a6bfb92ab5d41e0eb3a1da160fac71b0e">charges</a> &gt; 1 ) {</div>
<div class="line"><a id="l01091" name="l01091"></a><span class="lineno"> 1091</span>        weight /= to_throw.<a class="code hl_variable" href="classitem.html#a6bfb92ab5d41e0eb3a1da160fac71b0e">charges</a>;</div>
<div class="line"><a id="l01092" name="l01092"></a><span class="lineno"> 1092</span>        <a class="code hl_typedef" href="namespaceunits.html#a5d16607c866588620acb381e7dbbf0a6">volume</a> /= to_throw.<a class="code hl_variable" href="classitem.html#a6bfb92ab5d41e0eb3a1da160fac71b0e">charges</a>;</div>
<div class="line"><a id="l01093" name="l01093"></a><span class="lineno"> 1093</span>    }</div>
<div class="line"><a id="l01094" name="l01094"></a><span class="lineno"> 1094</span> </div>
<div class="line"><a id="l01095" name="l01095"></a><span class="lineno"> 1095</span>    <span class="keywordtype">int</span> throw_difficulty = 1000;</div>
<div class="line"><a id="l01096" name="l01096"></a><span class="lineno"> 1096</span>    <span class="comment">// 1000 penalty for every liter after the first</span></div>
<div class="line"><a id="l01097" name="l01097"></a><span class="lineno"> 1097</span>    <span class="comment">// TODO: Except javelin type items</span></div>
<div class="line"><a id="l01098" name="l01098"></a><span class="lineno"> 1098</span>    throw_difficulty += std::max&lt;int&gt;( 0, <a class="code hl_function" href="namespaceunits.html#a144476d36f26d6e1916493c3636d54dc">units::to_milliliter</a>( <a class="code hl_typedef" href="namespaceunits.html#a5d16607c866588620acb381e7dbbf0a6">volume</a> - 1_liter ) );</div>
<div class="line"><a id="l01099" name="l01099"></a><span class="lineno"> 1099</span>    <span class="comment">// 1 penalty for gram above str*100 grams (at 0 skill)</span><span class="comment"></span></div>
<div class="line"><a id="l01100" name="l01100"></a><span class="lineno"> 1100</span><span class="comment">    ///\EFFECT_STR decreases throwing dispersion when throwing heavy objects</span></div>
<div class="line"><a id="l01101" name="l01101"></a><span class="lineno"> 1101</span><span class="comment"></span>    <span class="keyword">const</span> <span class="keywordtype">int</span> weight_in_gram = <a class="code hl_function" href="namespaceunits.html#a8306911daadc1a4d7a7b46e9786f4a4c">units::to_gram</a>( weight );</div>
<div class="line"><a id="l01102" name="l01102"></a><span class="lineno"> 1102</span>    throw_difficulty += std::max( 0, weight_in_gram - <a class="code hl_variable" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>.get_str() * 100 );</div>
<div class="line"><a id="l01103" name="l01103"></a><span class="lineno"> 1103</span> </div>
<div class="line"><a id="l01104" name="l01104"></a><span class="lineno"> 1104</span>    <span class="comment">// Dispersion from difficult throws goes from 100% at lvl 0 to 20% at lvl 10</span><span class="comment"></span></div>
<div class="line"><a id="l01105" name="l01105"></a><span class="lineno"> 1105</span><span class="comment">    ///\EFFECT_THROW increases throwing accuracy</span></div>
<div class="line"><a id="l01106" name="l01106"></a><span class="lineno"> 1106</span><span class="comment"></span>    <span class="keyword">const</span> <span class="keywordtype">int</span> throw_skill = std::min( <a class="code hl_variable" href="game__constants_8h.html#ae9c0ec5b4724c15132efddb8862ca652">MAX_SKILL</a>, <a class="code hl_variable" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>.get_skill_level( <a class="code hl_variable" href="ranged_8cpp.html#aca8ae2b9cbc86602a56a3885b72a4ed1">skill_throw</a> ) );</div>
<div class="line"><a id="l01107" name="l01107"></a><span class="lineno"> 1107</span>    <span class="keywordtype">int</span> dispersion = 10 * throw_difficulty / ( 6 * throw_skill + 20 );</div>
<div class="line"><a id="l01108" name="l01108"></a><span class="lineno"> 1108</span>    <span class="comment">// If the target is a creature, it moves around and ruins aim</span></div>
<div class="line"><a id="l01109" name="l01109"></a><span class="lineno"> 1109</span>    <span class="comment">// TODO: Inform projectile functions if the attacker actually aims for the critter or just the tile</span></div>
<div class="line"><a id="l01110" name="l01110"></a><span class="lineno"> 1110</span>    <span class="keywordflow">if</span>( critter != <span class="keyword">nullptr</span> ) {</div>
<div class="line"><a id="l01111" name="l01111"></a><span class="lineno"> 1111</span>        <span class="comment">// It&#39;s easier to dodge at close range (thrower needs to adjust more)</span></div>
<div class="line"><a id="l01112" name="l01112"></a><span class="lineno"> 1112</span>        <span class="comment">// Dodge x10 at point blank, x5 at 1 dist, then flat</span></div>
<div class="line"><a id="l01113" name="l01113"></a><span class="lineno"> 1113</span>        <span class="keywordtype">float</span> effective_dodge = critter-&gt;<a class="code hl_function" href="classCreature.html#aaa501dbe3d1e90d47da43fb9ea57b3be">get_dodge</a>() * std::max( 1, 10 - 5 * <a class="code hl_function" href="coordinates_8h.html#a47953b33a873caa0861b12222842a5ec">rl_dist</a>( <a class="code hl_variable" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>.pos(),</div>
<div class="line"><a id="l01114" name="l01114"></a><span class="lineno"> 1114</span>                                critter-&gt;<a class="code hl_function" href="classCreature.html#a45926a7ba63ccc9be744f87a4d540b7d">pos</a>() ) );</div>
<div class="line"><a id="l01115" name="l01115"></a><span class="lineno"> 1115</span>        dispersion += <a class="code hl_function" href="namespaceranged.html#afd6b1338d47e5ecd34de75b921c11113">throw_dispersion_per_dodge</a>( <a class="code hl_variable" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>, <span class="keyword">true</span> ) * effective_dodge;</div>
<div class="line"><a id="l01116" name="l01116"></a><span class="lineno"> 1116</span>    }</div>
<div class="line"><a id="l01117" name="l01117"></a><span class="lineno"> 1117</span>    <span class="comment">// 1 perception per 1 eye encumbrance</span><span class="comment"></span></div>
<div class="line"><a id="l01118" name="l01118"></a><span class="lineno"> 1118</span><span class="comment">    ///\EFFECT_PER decreases throwing accuracy penalty from eye encumbrance</span></div>
<div class="line"><a id="l01119" name="l01119"></a><span class="lineno"> 1119</span><span class="comment"></span>    dispersion += std::max( 0, ( <a class="code hl_variable" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>.encumb( <a class="code hl_enumvalue" href="bodypart_8h.html#af618290c4c2de42aab87977ac7311980a2055386ee220ee2ca3e61d13df65e868">bp_eyes</a> ) - <a class="code hl_variable" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>.get_per() ) * 10 );</div>
<div class="line"><a id="l01120" name="l01120"></a><span class="lineno"> 1120</span> </div>
<div class="line"><a id="l01121" name="l01121"></a><span class="lineno"> 1121</span>    <span class="comment">// If throwing blind, we&#39;re assuming they mechanically can&#39;t achieve the</span></div>
<div class="line"><a id="l01122" name="l01122"></a><span class="lineno"> 1122</span>    <span class="comment">// accuracy of a normal throw.</span></div>
<div class="line"><a id="l01123" name="l01123"></a><span class="lineno"> 1123</span>    <span class="keywordflow">if</span>( is_blind_throw ) {</div>
<div class="line"><a id="l01124" name="l01124"></a><span class="lineno"> 1124</span>        dispersion *= 4;</div>
<div class="line"><a id="l01125" name="l01125"></a><span class="lineno"> 1125</span>    }</div>
<div class="line"><a id="l01126" name="l01126"></a><span class="lineno"> 1126</span> </div>
<div class="line"><a id="l01127" name="l01127"></a><span class="lineno"> 1127</span>    <span class="keywordflow">return</span> std::max( 0, dispersion );</div>
<div class="line"><a id="l01128" name="l01128"></a><span class="lineno"> 1128</span>}</div>
<div class="ttc" id="aclassCreature_html_aaa501dbe3d1e90d47da43fb9ea57b3be"><div class="ttname"><a href="classCreature.html#aaa501dbe3d1e90d47da43fb9ea57b3be">Creature::get_dodge</a></div><div class="ttdeci">virtual float get_dodge() const</div><div class="ttdef"><b>Definition:</b> <a href="creature_8cpp_source.html#l01549">creature.cpp:1549</a></div></div>
<div class="ttc" id="aclassitem_html_a40963a016376016eb408bdb9dbb94388"><div class="ttname"><a href="classitem.html#a40963a016376016eb408bdb9dbb94388">item::count_by_charges</a></div><div class="ttdeci">bool count_by_charges() const</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l06030">item.cpp:6030</a></div></div>
<div class="ttc" id="aclassitem_html_a6bfb92ab5d41e0eb3a1da160fac71b0e"><div class="ttname"><a href="classitem.html#a6bfb92ab5d41e0eb3a1da160fac71b0e">item::charges</a></div><div class="ttdeci">int charges</div><div class="ttdef"><b>Definition:</b> <a href="item_8h_source.html#l02199">item.h:2199</a></div></div>
<div class="ttc" id="anamespaceranged_html_afd6b1338d47e5ecd34de75b921c11113"><div class="ttname"><a href="namespaceranged.html#afd6b1338d47e5ecd34de75b921c11113">ranged::throw_dispersion_per_dodge</a></div><div class="ttdeci">int throw_dispersion_per_dodge(const Character &amp;c, bool add_encumbrance)</div><div class="ttdoc">How much dispersion does one point of target's dodge add when throwing at said target?</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01071">ranged.cpp:1071</a></div></div>
<div class="ttc" id="anamespaceunits_html_a8306911daadc1a4d7a7b46e9786f4a4c"><div class="ttname"><a href="namespaceunits.html#a8306911daadc1a4d7a7b46e9786f4a4c">units::to_gram</a></div><div class="ttdeci">constexpr value_type to_gram(const quantity&lt; value_type, mass_in_milligram_tag &gt; &amp;v)</div><div class="ttdef"><b>Definition:</b> <a href="units__mass_8h_source.html#l00068">units_mass.h:68</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="bodypart_8h_source.html#l00043">bp_eyes</a>, <a class="el" href="magic_8cpp_source.html#l01032">c</a>, <a class="el" href="item_8h_source.html#l02199">item::charges</a>, <a class="el" href="item_8cpp_source.html#l06030">item::count_by_charges()</a>, <a class="el" href="creature_8cpp_source.html#l01549">Creature::get_dodge()</a>, <a class="el" href="game__constants_8h_source.html#l00114">MAX_SKILL</a>, <a class="el" href="classCreature.html#a45926a7ba63ccc9be744f87a4d540b7d">Creature::pos()</a>, <a class="el" href="coordinates_8h_source.html#l00519">rl_dist()</a>, <a class="el" href="ranged_8cpp.html#aca8ae2b9cbc86602a56a3885b72a4ed1">skill_throw</a>, <a class="el" href="ranged_8cpp_source.html#l01071">throw_dispersion_per_dodge()</a>, <a class="el" href="units__mass_8h_source.html#l00068">units::to_gram()</a>, <a class="el" href="units__volume_8h_source.html#l00038">units::to_milliliter()</a>, <a class="el" href="item_8cpp_source.html#l05129">item::volume()</a>, and <a class="el" href="item_8cpp_source.html#l04983">item::weight()</a>.</p>

<p class="reference">Referenced by <a class="el" href="npcmove_8cpp_source.html#l02069">npc::confident_throw_range()</a>, <a class="el" href="ranged_8cpp_source.html#l01612">draw_throw_aim()</a>, and <a class="el" href="ranged_8cpp_source.html#l01130">throw_item()</a>.</p>

</div>
</div>
<a id="ad3183129b44ab2775b50bb90da5c5333" name="ad3183129b44ab2775b50bb90da5c5333"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad3183129b44ab2775b50bb90da5c5333">&#9670;&nbsp;</a></span>time_to_attack()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ranged::time_to_attack </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classCharacter.html">Character</a> &amp;&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classitem.html">item</a> &amp;&#160;</td>
          <td class="paramname"><em>firing</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classitem__location.html">item_location</a>&#160;</td>
          <td class="paramname"><em>loc</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calculates time taken to fire gun. </p>

<p class="definition">Definition at line <a class="el" href="ranged_8cpp_source.html#l01734">1734</a> of file <a class="el" href="ranged_8cpp_source.html">ranged.cpp</a>.</p>
<div class="fragment"><div class="line"><a id="l01735" name="l01735"></a><span class="lineno"> 1735</span>{</div>
<div class="line"><a id="l01736" name="l01736"></a><span class="lineno"> 1736</span>    <span class="keyword">const</span> <a class="code hl_class" href="classstring__id.html">skill_id</a> &amp;skill_used = firing.<a class="code hl_variable" href="classitem.html#ac1d2c4c33b8a499812f3437cb2fad742">type</a>-&gt;<a class="code hl_variable" href="structitype.html#a623ec8243b1e599086fa3a23c3179370">gun</a>-&gt;skill_used;</div>
<div class="line"><a id="l01737" name="l01737"></a><span class="lineno"> 1737</span>    <span class="keyword">const</span> <a class="code hl_struct" href="structtime__info__t.html">time_info_t</a> &amp;info = skill_used-&gt;<a class="code hl_function" href="classSkill.html#a879f0e8d0da73f0cdebd825134cd32d6">time_to_attack</a>();</div>
<div class="line"><a id="l01738" name="l01738"></a><span class="lineno"> 1738</span>    <span class="keywordtype">int</span> RAS_time = 0;</div>
<div class="line"><a id="l01739" name="l01739"></a><span class="lineno"> 1739</span>    <span class="keywordflow">if</span>( !loc ) {</div>
<div class="line"><a id="l01740" name="l01740"></a><span class="lineno"> 1740</span>        RAS_time = 0;</div>
<div class="line"><a id="l01741" name="l01741"></a><span class="lineno"> 1741</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01742" name="l01742"></a><span class="lineno"> 1742</span>        <span class="comment">// RAS Weapon, calculate move cost.</span></div>
<div class="line"><a id="l01743" name="l01743"></a><span class="lineno"> 1743</span>        <span class="comment">// At low stamina levels, firing starts getting slow.</span></div>
<div class="line"><a id="l01744" name="l01744"></a><span class="lineno"> 1744</span>        <span class="keyword">const</span> <span class="keywordtype">int</span> sta_percent = ( 100 * p.<a class="code hl_function" href="classCharacter.html#a0ffe14df559cee6e9b5d02f5b214d009">get_stamina</a>() ) / p.<a class="code hl_function" href="classCharacter.html#aefe5432750eb1c2c65fea628fd9878a7">get_stamina_max</a>();</div>
<div class="line"><a id="l01745" name="l01745"></a><span class="lineno"> 1745</span>        <span class="keyword">const</span> <span class="keywordtype">int</span> reload_stamina_penalty = ( sta_percent &lt; 25 ) ? ( ( 25 - sta_percent ) * 2 ) : 0;</div>
<div class="line"><a id="l01746" name="l01746"></a><span class="lineno"> 1746</span>        <a class="code hl_class" href="classitem__reload__option.html">item_reload_option</a> opt = <a class="code hl_class" href="classitem__reload__option.html">item_reload_option</a>( p.<a class="code hl_function" href="classCreature.html#acb1d0a1210d3dd4c86350f3ad4c58649">as_player</a>(), &amp;firing, &amp;firing, loc );</div>
<div class="line"><a id="l01747" name="l01747"></a><span class="lineno"> 1747</span>        RAS_time = opt.<a class="code hl_function" href="classitem__reload__option.html#a4839e0524ad7b4230c01e55c271aef82">moves</a>() + reload_stamina_penalty;</div>
<div class="line"><a id="l01748" name="l01748"></a><span class="lineno"> 1748</span>    }</div>
<div class="line"><a id="l01749" name="l01749"></a><span class="lineno"> 1749</span>    <span class="keywordflow">return</span> std::max( info.<a class="code hl_variable" href="structtime__info__t.html#a562e779c37f25968ccd5f5298a8c308c">min_time</a>,</div>
<div class="line"><a id="l01750" name="l01750"></a><span class="lineno"> 1750</span>                     info.<a class="code hl_variable" href="structtime__info__t.html#ab3676d37128ef1625abe58686c8c2bfb">base_time</a> - info.<a class="code hl_variable" href="structtime__info__t.html#a1cb4c0bb33cbe25f4e889533d8ae1721">time_reduction_per_level</a> * p.<a class="code hl_function" href="classCharacter.html#afa95fe499ca6b55ab97f1b442a4c95c5">get_skill_level</a>( skill_used ) + RAS_time );</div>
<div class="line"><a id="l01751" name="l01751"></a><span class="lineno"> 1751</span>}</div>
<div class="ttc" id="aclassCharacter_html_a0ffe14df559cee6e9b5d02f5b214d009"><div class="ttname"><a href="classCharacter.html#a0ffe14df559cee6e9b5d02f5b214d009">Character::get_stamina</a></div><div class="ttdeci">int get_stamina() const</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l07088">character.cpp:7088</a></div></div>
<div class="ttc" id="aclassCharacter_html_aefe5432750eb1c2c65fea628fd9878a7"><div class="ttname"><a href="classCharacter.html#aefe5432750eb1c2c65fea628fd9878a7">Character::get_stamina_max</a></div><div class="ttdeci">int get_stamina_max() const</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l07093">character.cpp:7093</a></div></div>
<div class="ttc" id="aclassSkill_html_a879f0e8d0da73f0cdebd825134cd32d6"><div class="ttname"><a href="classSkill.html#a879f0e8d0da73f0cdebd825134cd32d6">Skill::time_to_attack</a></div><div class="ttdeci">time_info_t time_to_attack() const</div><div class="ttdef"><b>Definition:</b> <a href="skill_8h_source.html#l00081">skill.h:81</a></div></div>
<div class="ttc" id="aclassitem__reload__option_html_a4839e0524ad7b4230c01e55c271aef82"><div class="ttname"><a href="classitem__reload__option.html#a4839e0524ad7b4230c01e55c271aef82">item_reload_option::moves</a></div><div class="ttdeci">int moves() const</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l08054">item.cpp:8054</a></div></div>
<div class="ttc" id="astructtime__info__t_html"><div class="ttname"><a href="structtime__info__t.html">time_info_t</a></div><div class="ttdef"><b>Definition:</b> <a href="skill_8h_source.html#l00023">skill.h:23</a></div></div>
<div class="ttc" id="astructtime__info__t_html_a1cb4c0bb33cbe25f4e889533d8ae1721"><div class="ttname"><a href="structtime__info__t.html#a1cb4c0bb33cbe25f4e889533d8ae1721">time_info_t::time_reduction_per_level</a></div><div class="ttdeci">int time_reduction_per_level</div><div class="ttdef"><b>Definition:</b> <a href="skill_8h_source.html#l00029">skill.h:29</a></div></div>
<div class="ttc" id="astructtime__info__t_html_a562e779c37f25968ccd5f5298a8c308c"><div class="ttname"><a href="structtime__info__t.html#a562e779c37f25968ccd5f5298a8c308c">time_info_t::min_time</a></div><div class="ttdeci">int min_time</div><div class="ttdef"><b>Definition:</b> <a href="skill_8h_source.html#l00025">skill.h:25</a></div></div>
<div class="ttc" id="astructtime__info__t_html_ab3676d37128ef1625abe58686c8c2bfb"><div class="ttname"><a href="structtime__info__t.html#ab3676d37128ef1625abe58686c8c2bfb">time_info_t::base_time</a></div><div class="ttdeci">int base_time</div><div class="ttdef"><b>Definition:</b> <a href="skill_8h_source.html#l00027">skill.h:27</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="creature_8h_source.html#l00122">Creature::as_player()</a>, <a class="el" href="skill_8h_source.html#l00027">time_info_t::base_time</a>, <a class="el" href="character_8cpp_source.html#l03351">Character::get_skill_level()</a>, <a class="el" href="character_8cpp_source.html#l07088">Character::get_stamina()</a>, <a class="el" href="character_8cpp_source.html#l07093">Character::get_stamina_max()</a>, <a class="el" href="itype_8h_source.html#l00827">itype::gun</a>, <a class="el" href="skill_8h_source.html#l00025">time_info_t::min_time</a>, <a class="el" href="item_8cpp_source.html#l08054">item_reload_option::moves()</a>, <a class="el" href="skill_8h_source.html#l00029">time_info_t::time_reduction_per_level</a>, <a class="el" href="skill_8h_source.html#l00081">Skill::time_to_attack()</a>, and <a class="el" href="item_8h_source.html#l02160">item::type</a>.</p>

<p class="reference">Referenced by <a class="el" href="ranged_8cpp_source.html#l00822">fire_gun()</a>, <a class="el" href="npcmove_8cpp_source.html#l02079">item::ideal_ranged_dps()</a>, and <a class="el" href="ranged_8cpp_source.html#l01564">print_aim()</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespaceranged.html">ranged</a></li>
    <li class="footer">Generated on Sun Aug 20 2023 09:17:25 for Cataclysm BN by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.2 </li>
  </ul>
</div>
</body>
</html>
