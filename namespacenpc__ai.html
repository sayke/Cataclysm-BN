<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Cataclysm BN: npc_ai Namespace Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Cataclysm BN
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('namespacenpc__ai.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">npc_ai Namespace Reference</div></div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a03081587a4844207a7386844f8a31cd5"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacenpc__ai.html#a03081587a4844207a7386844f8a31cd5">wielded_value</a> (const <a class="el" href="classCharacter.html">Character</a> &amp;who)</td></tr>
<tr class="memdesc:a03081587a4844207a7386844f8a31cd5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Evaluate wielded weapon's ideal value.  <a href="namespacenpc__ai.html#a03081587a4844207a7386844f8a31cd5">More...</a><br /></td></tr>
<tr class="separator:a03081587a4844207a7386844f8a31cd5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6fa541a904a63a5b95b20ce9000254d8"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacenpc__ai.html#a6fa541a904a63a5b95b20ce9000254d8">weapon_value</a> (const <a class="el" href="classCharacter.html">Character</a> &amp;who, const <a class="el" href="classitem.html">item</a> &amp;weap, int ammo)</td></tr>
<tr class="memdesc:a6fa541a904a63a5b95b20ce9000254d8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Evaluate item as weapon (melee or gun)  <a href="namespacenpc__ai.html#a6fa541a904a63a5b95b20ce9000254d8">More...</a><br /></td></tr>
<tr class="separator:a6fa541a904a63a5b95b20ce9000254d8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a198ce7a4cff534bf1df12f584bff1197"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacenpc__ai.html#a198ce7a4cff534bf1df12f584bff1197">gun_value</a> (const <a class="el" href="classCharacter.html">Character</a> &amp;who, const <a class="el" href="classitem.html">item</a> &amp;weap, int ammo)</td></tr>
<tr class="memdesc:a198ce7a4cff534bf1df12f584bff1197"><td class="mdescLeft">&#160;</td><td class="mdescRight">Evaluates item as a gun.  <a href="namespacenpc__ai.html#a198ce7a4cff534bf1df12f584bff1197">More...</a><br /></td></tr>
<tr class="separator:a198ce7a4cff534bf1df12f584bff1197"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0e953b9c8d447ec25fc27c06a6e3d55c"><td class="memItemLeft" align="right" valign="top">std::pair&lt; <a class="el" href="type__id_8h.html#a8174d98bb32e389bd2e1ab691167f7b9">gun_mode_id</a>, <a class="el" href="classgun__mode.html">gun_mode</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacenpc__ai.html#a0e953b9c8d447ec25fc27c06a6e3d55c">best_mode_for_range</a> (const <a class="el" href="classCharacter.html">Character</a> &amp;who, const <a class="el" href="classitem.html">item</a> &amp;firing, int dist)</td></tr>
<tr class="memdesc:a0e953b9c8d447ec25fc27c06a6e3d55c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Chooses best <a class="el" href="classgun__mode.html">gun_mode</a> for range.  <a href="namespacenpc__ai.html#a0e953b9c8d447ec25fc27c06a6e3d55c">More...</a><br /></td></tr>
<tr class="separator:a0e953b9c8d447ec25fc27c06a6e3d55c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a15c5ded877137a648d04762228055b66"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacenpc__ai.html#a15c5ded877137a648d04762228055b66">melee_value</a> (const <a class="el" href="classCharacter.html">Character</a> &amp;who, const <a class="el" href="classitem.html">item</a> &amp;weap)</td></tr>
<tr class="memdesc:a15c5ded877137a648d04762228055b66"><td class="mdescLeft">&#160;</td><td class="mdescRight">Evaluate item as a melee weapon.  <a href="namespacenpc__ai.html#a15c5ded877137a648d04762228055b66">More...</a><br /></td></tr>
<tr class="separator:a15c5ded877137a648d04762228055b66"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a64daf871b45496787e445f932f4381d3"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacenpc__ai.html#a64daf871b45496787e445f932f4381d3">unarmed_value</a> (const <a class="el" href="classCharacter.html">Character</a> &amp;who)</td></tr>
<tr class="memdesc:a64daf871b45496787e445f932f4381d3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Evaluate unarmed melee value.  <a href="namespacenpc__ai.html#a64daf871b45496787e445f932f4381d3">More...</a><br /></td></tr>
<tr class="separator:a64daf871b45496787e445f932f4381d3"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="a0e953b9c8d447ec25fc27c06a6e3d55c" name="a0e953b9c8d447ec25fc27c06a6e3d55c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0e953b9c8d447ec25fc27c06a6e3d55c">&#9670;&nbsp;</a></span>best_mode_for_range()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::pair&lt; <a class="el" href="type__id_8h.html#a8174d98bb32e389bd2e1ab691167f7b9">gun_mode_id</a>, <a class="el" href="classgun__mode.html">gun_mode</a> &gt; npc_ai::best_mode_for_range </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classCharacter.html">Character</a> &amp;&#160;</td>
          <td class="paramname"><em>who</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classitem.html">item</a> &amp;&#160;</td>
          <td class="paramname"><em>firing</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>dist</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Chooses best <a class="el" href="classgun__mode.html">gun_mode</a> for range. </p>

<p class="definition">Definition at line <a class="el" href="ranged_8cpp_source.html#l01967">1967</a> of file <a class="el" href="ranged_8cpp_source.html">ranged.cpp</a>.</p>
<div class="fragment"><div class="line"><a id="l01970" name="l01970"></a><span class="lineno"> 1970</span>{</div>
<div class="line"><a id="l01971" name="l01971"></a><span class="lineno"> 1971</span>    std::pair&lt;gun_mode_id, gun_mode&gt; res = std::make_pair( <a class="code hl_typedef" href="type__id_8h.html#a8174d98bb32e389bd2e1ab691167f7b9">gun_mode_id</a>(), <a class="code hl_class" href="classgun__mode.html">gun_mode</a>() );</div>
<div class="line"><a id="l01972" name="l01972"></a><span class="lineno"> 1972</span>    <span class="keywordtype">int</span> shots = who.<a class="code hl_function" href="classCharacter.html#a81864eee5b75943bd4222b696117a52a">is_wielding</a>( firing ) ? <a class="code hl_function" href="namespacecharacter__funcs.html#a97bfa1444b6ed6f142910821e84fe313">character_funcs::ammo_count_for</a>( who,</div>
<div class="line"><a id="l01973" name="l01973"></a><span class="lineno"> 1973</span>                firing ) : <a class="code hl_namespace" href="namespaceitem__funcs.html">item_funcs</a>::<a class="code hl_function" href="namespaceitem__funcs.html#a04f6aa7c848c842a119f6e07e0dd7c6b">shots_remaining</a>( who, firing );</div>
<div class="line"><a id="l01974" name="l01974"></a><span class="lineno"> 1974</span>    <span class="keywordflow">if</span>( !firing.<a class="code hl_function" href="classitem.html#a2912b2e15a4eec07a5070fffbbd152e8">is_gun</a>() || shots == 0 ) {</div>
<div class="line"><a id="l01975" name="l01975"></a><span class="lineno"> 1975</span>        <span class="keywordflow">return</span> res;</div>
<div class="line"><a id="l01976" name="l01976"></a><span class="lineno"> 1976</span>    }</div>
<div class="line"><a id="l01977" name="l01977"></a><span class="lineno"> 1977</span>    <span class="keywordtype">int</span> min_recoil = <a class="code hl_variable" href="game__constants_8h.html#a8226e8a134603e5bc06df05efd13d8d1">MAX_RECOIL</a>;</div>
<div class="line"><a id="l01978" name="l01978"></a><span class="lineno"> 1978</span>    min_recoil = <a class="code hl_function" href="namespaceranged.html#ad70a4328dc4c6c69d45b40f23d90195d">ranged::get_most_accurate_sight</a>( who, firing );</div>
<div class="line"><a id="l01979" name="l01979"></a><span class="lineno"> 1979</span>    <span class="keywordtype">int</span> <a class="code hl_enumvalue" href="character_8h.html#addab86bfe6fd0bf8c22ec43df3ec051da1c21724609ac70f1573fd4b755c64ddb">range</a> = <span class="keyword">static_cast&lt;</span><span class="keyword">const </span><a class="code hl_class" href="classnpc.html">npc</a> *<span class="keyword">&gt;</span>( &amp;who )-&gt;confident_shoot_range( firing, min_recoil );</div>
<div class="line"><a id="l01980" name="l01980"></a><span class="lineno"> 1980</span> </div>
<div class="line"><a id="l01981" name="l01981"></a><span class="lineno"> 1981</span>    <span class="keywordflow">if</span>( dist &gt; <a class="code hl_enumvalue" href="character_8h.html#addab86bfe6fd0bf8c22ec43df3ec051da1c21724609ac70f1573fd4b755c64ddb">range</a> ) {</div>
<div class="line"><a id="l01982" name="l01982"></a><span class="lineno"> 1982</span>        <span class="keywordflow">return</span> res;</div>
<div class="line"><a id="l01983" name="l01983"></a><span class="lineno"> 1983</span>    }</div>
<div class="line"><a id="l01984" name="l01984"></a><span class="lineno"> 1984</span> </div>
<div class="line"><a id="l01985" name="l01985"></a><span class="lineno"> 1985</span>    <span class="keyword">const</span> <span class="keyword">auto</span> gun_mode_cmp = []( <span class="keyword">const</span> std::pair&lt;gun_mode_id, gun_mode&gt; lhs,</div>
<div class="line"><a id="l01986" name="l01986"></a><span class="lineno"> 1986</span>    <span class="keyword">const</span> std::pair&lt;gun_mode_id, gun_mode&gt; rhs ) {</div>
<div class="line"><a id="l01987" name="l01987"></a><span class="lineno"> 1987</span>        <span class="keywordflow">return</span> lhs.second.qty &lt; rhs.second.qty;</div>
<div class="line"><a id="l01988" name="l01988"></a><span class="lineno"> 1988</span>    };</div>
<div class="line"><a id="l01989" name="l01989"></a><span class="lineno"> 1989</span> </div>
<div class="line"><a id="l01990" name="l01990"></a><span class="lineno"> 1990</span>    <span class="keyword">const</span> std::map&lt;gun_mode_id, gun_mode&gt; &amp;to_add = firing.<a class="code hl_function" href="classitem.html#aa1a2ecb3e9ebf95dc7fedac4c1de32b4">gun_all_modes</a>();</div>
<div class="line"><a id="l01991" name="l01991"></a><span class="lineno"> 1991</span>    std::vector&lt;std::pair&lt;gun_mode_id, gun_mode&gt;&gt; modes;</div>
<div class="line"><a id="l01992" name="l01992"></a><span class="lineno"> 1992</span>    std::copy( to_add.begin(), to_add.end(), std::back_inserter( modes ) );</div>
<div class="line"><a id="l01993" name="l01993"></a><span class="lineno"> 1993</span> </div>
<div class="line"><a id="l01994" name="l01994"></a><span class="lineno"> 1994</span>    <a class="code hl_function" href="cata__utility_8h.html#ad7f4be1b8ffc52a0be18e72d041241af">erase_if</a>( modes, [&amp;]( <span class="keyword">const</span> std::pair&lt;gun_mode_id, gun_mode&gt; &amp;e ) {</div>
<div class="line"><a id="l01995" name="l01995"></a><span class="lineno"> 1995</span>        <span class="keyword">const</span> <span class="keyword">auto</span> &amp;m = e.second;</div>
<div class="line"><a id="l01996" name="l01996"></a><span class="lineno"> 1996</span>        <span class="keywordflow">return</span> m.melee() || !who.<a class="code hl_function" href="classCharacter.html#a4eddeb86babf626e7869882079b40651">can_use</a>( *m.target ) || m.flags.count( <span class="stringliteral">&quot;NPC_AVOID&quot;</span> ) || shots &lt; m.qty ||</div>
<div class="line"><a id="l01997" name="l01997"></a><span class="lineno"> 1997</span>               ( dist &gt; 0 &amp;&amp; <span class="keyword">static_cast&lt;</span><span class="keyword">const </span><a class="code hl_class" href="classnpc.html">npc</a> *<span class="keyword">&gt;</span>( &amp;who )-&gt;<a class="code hl_function" href="classnpc.html#a82c1e391aa196be38ec7ddd7d66bab8d">confident_gun_mode_range</a>( m, min_recoil ) &lt; dist );</div>
<div class="line"><a id="l01998" name="l01998"></a><span class="lineno"> 1998</span>    } );</div>
<div class="line"><a id="l01999" name="l01999"></a><span class="lineno"> 1999</span> </div>
<div class="line"><a id="l02000" name="l02000"></a><span class="lineno"> 2000</span>    <span class="keywordflow">if</span>( modes.empty() ) {</div>
<div class="line"><a id="l02001" name="l02001"></a><span class="lineno"> 2001</span>        <span class="keywordflow">return</span> res;</div>
<div class="line"><a id="l02002" name="l02002"></a><span class="lineno"> 2002</span>    }</div>
<div class="line"><a id="l02003" name="l02003"></a><span class="lineno"> 2003</span> </div>
<div class="line"><a id="l02004" name="l02004"></a><span class="lineno"> 2004</span>    <span class="keyword">const</span> <span class="keyword">auto</span> g_mode = std::max_element( modes.begin(), modes.end(), gun_mode_cmp );</div>
<div class="line"><a id="l02005" name="l02005"></a><span class="lineno"> 2005</span>    res = *g_mode;</div>
<div class="line"><a id="l02006" name="l02006"></a><span class="lineno"> 2006</span>    <span class="keywordflow">return</span> res;</div>
<div class="line"><a id="l02007" name="l02007"></a><span class="lineno"> 2007</span>}</div>
<div class="ttc" id="acata__utility_8h_html_ad7f4be1b8ffc52a0be18e72d041241af"><div class="ttname"><a href="cata__utility_8h.html#ad7f4be1b8ffc52a0be18e72d041241af">erase_if</a></div><div class="ttdeci">bool erase_if(Col &amp;set, Pred predicate)</div><div class="ttdoc">Erases elements from a set that match given predicate function.</div><div class="ttdef"><b>Definition:</b> <a href="cata__utility_8h_source.html#l00237">cata_utility.h:237</a></div></div>
<div class="ttc" id="acharacter_8h_html_addab86bfe6fd0bf8c22ec43df3ec051da1c21724609ac70f1573fd4b755c64ddb"><div class="ttname"><a href="character_8h.html#addab86bfe6fd0bf8c22ec43df3ec051da1c21724609ac70f1573fd4b755c64ddb">range</a></div><div class="ttdeci">@ range</div><div class="ttdef"><b>Definition:</b> <a href="character_8h_source.html#l00104">character.h:104</a></div></div>
<div class="ttc" id="aclassCharacter_html_a4eddeb86babf626e7869882079b40651"><div class="ttname"><a href="classCharacter.html#a4eddeb86babf626e7869882079b40651">Character::can_use</a></div><div class="ttdeci">bool can_use(const item &amp;it, const item &amp;context=item()) const</div><div class="ttdoc">Checks if character stats and skills meet minimum requirements for the item.</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l02736">character.cpp:2736</a></div></div>
<div class="ttc" id="aclassCharacter_html_a81864eee5b75943bd4222b696117a52a"><div class="ttname"><a href="classCharacter.html#a81864eee5b75943bd4222b696117a52a">Character::is_wielding</a></div><div class="ttdeci">bool is_wielding(const item &amp;target) const</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l03229">character.cpp:3229</a></div></div>
<div class="ttc" id="aclassgun__mode_html"><div class="ttname"><a href="classgun__mode.html">gun_mode</a></div><div class="ttdef"><b>Definition:</b> <a href="gun__mode_8h_source.html#l00012">gun_mode.h:13</a></div></div>
<div class="ttc" id="aclassitem_html_a2912b2e15a4eec07a5070fffbbd152e8"><div class="ttname"><a href="classitem.html#a2912b2e15a4eec07a5070fffbbd152e8">item::is_gun</a></div><div class="ttdeci">bool is_gun() const</div><div class="ttdoc">Can this item be used to perform a ranged attack?</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l06542">item.cpp:6542</a></div></div>
<div class="ttc" id="aclassitem_html_aa1a2ecb3e9ebf95dc7fedac4c1de32b4"><div class="ttname"><a href="classitem.html#aa1a2ecb3e9ebf95dc7fedac4c1de32b4">item::gun_all_modes</a></div><div class="ttdeci">std::map&lt; gun_mode_id, gun_mode &gt; gun_all_modes() const</div><div class="ttdoc">Get all possible modes for this gun inclusive of any attached gunmods.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l07855">item.cpp:7855</a></div></div>
<div class="ttc" id="aclassnpc_html"><div class="ttname"><a href="classnpc.html">npc</a></div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l00743">npc.h:744</a></div></div>
<div class="ttc" id="aclassnpc_html_a82c1e391aa196be38ec7ddd7d66bab8d"><div class="ttname"><a href="classnpc.html#a82c1e391aa196be38ec7ddd7d66bab8d">npc::confident_gun_mode_range</a></div><div class="ttdeci">int confident_gun_mode_range(const gun_mode &amp;gun, int at_recoil) const</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l02041">npcmove.cpp:2041</a></div></div>
<div class="ttc" id="agame__constants_8h_html_a8226e8a134603e5bc06df05efd13d8d1"><div class="ttname"><a href="game__constants_8h.html#a8226e8a134603e5bc06df05efd13d8d1">MAX_RECOIL</a></div><div class="ttdeci">constexpr double MAX_RECOIL</div><div class="ttdef"><b>Definition:</b> <a href="game__constants_8h_source.html#l00131">game_constants.h:131</a></div></div>
<div class="ttc" id="anamespacecharacter__funcs_html_a97bfa1444b6ed6f142910821e84fe313"><div class="ttname"><a href="namespacecharacter__funcs.html#a97bfa1444b6ed6f142910821e84fe313">character_funcs::ammo_count_for</a></div><div class="ttdeci">int ammo_count_for(const Character &amp;who, const item &amp;gun)</div><div class="ttdoc">Counts ammo and UPS charges (lower of) for a given gun on the character.</div><div class="ttdef"><b>Definition:</b> <a href="character__functions_8cpp_source.html#l01180">character_functions.cpp:1180</a></div></div>
<div class="ttc" id="anamespaceitem__funcs_html"><div class="ttname"><a href="namespaceitem__funcs.html">item_funcs</a></div><div class="ttdef"><b>Definition:</b> <a href="item__functions_8cpp_source.html#l00012">item_functions.cpp:13</a></div></div>
<div class="ttc" id="anamespaceitem__funcs_html_a04f6aa7c848c842a119f6e07e0dd7c6b"><div class="ttname"><a href="namespaceitem__funcs.html#a04f6aa7c848c842a119f6e07e0dd7c6b">item_funcs::shots_remaining</a></div><div class="ttdeci">int shots_remaining(const Character &amp;who, const item &amp;it)</div><div class="ttdoc">Number of shots left, considers if a gun uses ups, ammo, or both.</div><div class="ttdef"><b>Definition:</b> <a href="item__functions_8cpp_source.html#l00045">item_functions.cpp:45</a></div></div>
<div class="ttc" id="anamespaceranged_html_ad70a4328dc4c6c69d45b40f23d90195d"><div class="ttname"><a href="namespaceranged.html#ad70a4328dc4c6c69d45b40f23d90195d">ranged::get_most_accurate_sight</a></div><div class="ttdeci">int get_most_accurate_sight(const Character &amp;who, const item &amp;gun)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l03855">ranged.cpp:3855</a></div></div>
<div class="ttc" id="atype__id_8h_html_a8174d98bb32e389bd2e1ab691167f7b9"><div class="ttname"><a href="type__id_8h.html#a8174d98bb32e389bd2e1ab691167f7b9">gun_mode_id</a></div><div class="ttdeci">string_id&lt; gun_mode &gt; gun_mode_id</div><div class="ttdef"><b>Definition:</b> <a href="type__id_8h_source.html#l00068">type_id.h:68</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="character__functions_8cpp_source.html#l01180">character_funcs::ammo_count_for()</a>, <a class="el" href="character_8cpp_source.html#l02736">Character::can_use()</a>, <a class="el" href="npcmove_8cpp_source.html#l02041">npc::confident_gun_mode_range()</a>, <a class="el" href="cata__utility_8h_source.html#l00237">erase_if()</a>, <a class="el" href="ranged_8cpp_source.html#l03855">ranged::get_most_accurate_sight()</a>, <a class="el" href="item_8cpp_source.html#l07855">item::gun_all_modes()</a>, <a class="el" href="item_8cpp_source.html#l06542">item::is_gun()</a>, <a class="el" href="character_8cpp_source.html#l03229">Character::is_wielding()</a>, <a class="el" href="game__constants_8h_source.html#l00131">MAX_RECOIL</a>, <a class="el" href="character_8h_source.html#l00104">range</a>, and <a class="el" href="item__functions_8cpp_source.html#l00045">item_funcs::shots_remaining()</a>.</p>

<p class="reference">Referenced by <a class="el" href="bionics_8cpp_source.html#l00522">npc::check_or_use_weapon_cbm()</a>, <a class="el" href="ranged_8cpp_source.html#l02009">gun_value()</a>, and <a class="el" href="npcmove_8cpp_source.html#l03442">npc::wield_better_weapon()</a>.</p>

</div>
</div>
<a id="a198ce7a4cff534bf1df12f584bff1197" name="a198ce7a4cff534bf1df12f584bff1197"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a198ce7a4cff534bf1df12f584bff1197">&#9670;&nbsp;</a></span>gun_value()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double npc_ai::gun_value </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classCharacter.html">Character</a> &amp;&#160;</td>
          <td class="paramname"><em>who</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classitem.html">item</a> &amp;&#160;</td>
          <td class="paramname"><em>weap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ammo</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Evaluates item as a gun. </p>

<p class="definition">Definition at line <a class="el" href="ranged_8cpp_source.html#l02009">2009</a> of file <a class="el" href="ranged_8cpp_source.html">ranged.cpp</a>.</p>
<div class="fragment"><div class="line"><a id="l02010" name="l02010"></a><span class="lineno"> 2010</span>{</div>
<div class="line"><a id="l02011" name="l02011"></a><span class="lineno"> 2011</span>    <span class="comment">// TODO: Mods</span></div>
<div class="line"><a id="l02012" name="l02012"></a><span class="lineno"> 2012</span>    <span class="comment">// TODO: Allow using a specified type of ammo rather than default or current</span></div>
<div class="line"><a id="l02013" name="l02013"></a><span class="lineno"> 2013</span>    <span class="keywordflow">if</span>( !weap.<a class="code hl_variable" href="classitem.html#ac1d2c4c33b8a499812f3437cb2fad742">type</a>-&gt;<a class="code hl_variable" href="structitype.html#a623ec8243b1e599086fa3a23c3179370">gun</a> ) {</div>
<div class="line"><a id="l02014" name="l02014"></a><span class="lineno"> 2014</span>        <a class="code hl_function" href="messages_8cpp.html#a54489326fc37823819c5105addfa27f2">add_msg</a>( <a class="code hl_enumvalue" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea9855e523119c93601d8f67718994df05">m_debug</a>, <span class="stringliteral">&quot;%s is not a gun, gun_value set to 0&quot;</span>, weap.<a class="code hl_variable" href="classitem.html#ac1d2c4c33b8a499812f3437cb2fad742">type</a>-&gt;<a class="code hl_function" href="structitype.html#abc2596bacfc718fba56ab8076bab5d6b">get_id</a>().<a class="code hl_function" href="classstring__id.html#aa7dabc565f0c067e1a237ea224b18f93">str</a>() );</div>
<div class="line"><a id="l02015" name="l02015"></a><span class="lineno"> 2015</span>        <span class="keywordflow">return</span> 0.0;</div>
<div class="line"><a id="l02016" name="l02016"></a><span class="lineno"> 2016</span>    }</div>
<div class="line"><a id="l02017" name="l02017"></a><span class="lineno"> 2017</span> </div>
<div class="line"><a id="l02018" name="l02018"></a><span class="lineno"> 2018</span>    <span class="keywordflow">if</span>( ammo &lt;= 0 ) {</div>
<div class="line"><a id="l02019" name="l02019"></a><span class="lineno"> 2019</span>        <a class="code hl_function" href="messages_8cpp.html#a54489326fc37823819c5105addfa27f2">add_msg</a>( <a class="code hl_enumvalue" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea9855e523119c93601d8f67718994df05">m_debug</a>, <span class="stringliteral">&quot;%s has no ammo, gun_value set to 0&quot;</span>, weap.<a class="code hl_variable" href="classitem.html#ac1d2c4c33b8a499812f3437cb2fad742">type</a>-&gt;<a class="code hl_function" href="structitype.html#abc2596bacfc718fba56ab8076bab5d6b">get_id</a>().<a class="code hl_function" href="classstring__id.html#aa7dabc565f0c067e1a237ea224b18f93">str</a>() );</div>
<div class="line"><a id="l02020" name="l02020"></a><span class="lineno"> 2020</span>        <span class="keywordflow">return</span> 0.0;</div>
<div class="line"><a id="l02021" name="l02021"></a><span class="lineno"> 2021</span>    }</div>
<div class="line"><a id="l02022" name="l02022"></a><span class="lineno"> 2022</span> </div>
<div class="line"><a id="l02023" name="l02023"></a><span class="lineno"> 2023</span>    <a class="code hl_class" href="classitem.html">item</a> ideal_weapon = weap;</div>
<div class="line"><a id="l02024" name="l02024"></a><span class="lineno"> 2024</span>    <span class="keywordflow">if</span>( !ideal_weapon.<a class="code hl_function" href="classitem.html#ab07d96e30c441a84435972df842f4c77">ammo_default</a>().<a class="code hl_function" href="classstring__id.html#a3ca78345025397b3d3ac22729ba1684b">is_null</a>() ) {</div>
<div class="line"><a id="l02025" name="l02025"></a><span class="lineno"> 2025</span>        ideal_weapon.<a class="code hl_function" href="classitem.html#a6a3f16444c412bce4b75a7d600d6a3fe">ammo_set</a>( ideal_weapon.<a class="code hl_function" href="classitem.html#ab07d96e30c441a84435972df842f4c77">ammo_default</a>(), -1 );</div>
<div class="line"><a id="l02026" name="l02026"></a><span class="lineno"> 2026</span>    }</div>
<div class="line"><a id="l02027" name="l02027"></a><span class="lineno"> 2027</span> </div>
<div class="line"><a id="l02028" name="l02028"></a><span class="lineno"> 2028</span>    <span class="keyword">auto</span> [mode_id, mode_] = <a class="code hl_function" href="namespacenpc__ai.html#a0e953b9c8d447ec25fc27c06a6e3d55c">npc_ai::best_mode_for_range</a>( who, ideal_weapon, -1 );</div>
<div class="line"><a id="l02029" name="l02029"></a><span class="lineno"> 2029</span> </div>
<div class="line"><a id="l02030" name="l02030"></a><span class="lineno"> 2030</span>    <span class="comment">// Doesn&#39;t use calculate_dispersion because that requires a map</span></div>
<div class="line"><a id="l02031" name="l02031"></a><span class="lineno"> 2031</span>    <span class="comment">// TODO: Turn this into a common function.</span></div>
<div class="line"><a id="l02032" name="l02032"></a><span class="lineno"> 2032</span>    <a class="code hl_class" href="classdispersion__sources.html">dispersion_sources</a> mode_disp = <a class="code hl_function" href="namespaceranged.html#a8b31304e61913a0072ad6df6e16bc932">ranged::get_weapon_dispersion</a>( who, ideal_weapon );</div>
<div class="line"><a id="l02033" name="l02033"></a><span class="lineno"> 2033</span>    <span class="keywordtype">double</span> total_dispersion = mode_disp.<a class="code hl_function" href="classdispersion__sources.html#ac3dc7f13e78a217aeaba57740f3af17c">max</a>();</div>
<div class="line"><a id="l02034" name="l02034"></a><span class="lineno"> 2034</span>    <span class="keywordflow">if</span>( ideal_weapon.<a class="code hl_function" href="classitem.html#a624c3b7ec10ae766a9e75718af71e647">ammo_current</a>() ) {</div>
<div class="line"><a id="l02035" name="l02035"></a><span class="lineno"> 2035</span>        total_dispersion += ideal_weapon.<a class="code hl_function" href="classitem.html#a624c3b7ec10ae766a9e75718af71e647">ammo_current</a>()-&gt;<a class="code hl_variable" href="structitype.html#a7cb80d77696cefb42ac6e75756b47e60">ammo</a>-&gt;dispersion;</div>
<div class="line"><a id="l02036" name="l02036"></a><span class="lineno"> 2036</span>    }</div>
<div class="line"><a id="l02037" name="l02037"></a><span class="lineno"> 2037</span>    <span class="comment">// Necessary so that ideal_ranged_dps will include the reload cost in calc.</span></div>
<div class="line"><a id="l02038" name="l02038"></a><span class="lineno"> 2038</span>    ideal_weapon.<a class="code hl_function" href="classitem.html#aa31ffbae3561dd20a3a60e541f6fd02e">ammo_unset</a>();</div>
<div class="line"><a id="l02039" name="l02039"></a><span class="lineno"> 2039</span>    <span class="keywordtype">double</span> dps = ideal_weapon.<a class="code hl_function" href="classitem.html#aa91e9e381f2d96ad24f93b1344fd6276">ideal_ranged_dps</a>( who, mode_ );</div>
<div class="line"><a id="l02040" name="l02040"></a><span class="lineno"> 2040</span> </div>
<div class="line"><a id="l02041" name="l02041"></a><span class="lineno"> 2041</span>    <span class="comment">// &quot;Medium range&quot; below means 9 tiles, &quot;short range&quot; means 4</span></div>
<div class="line"><a id="l02042" name="l02042"></a><span class="lineno"> 2042</span>    <span class="comment">// Those are guarantees (assuming maximum time spent aiming)</span></div>
<div class="line"><a id="l02043" name="l02043"></a><span class="lineno"> 2043</span>    <span class="keyword">static</span> <span class="keyword">const</span> std::vector&lt;std::pair&lt;float, float&gt;&gt; dispersion_thresholds = {</div>
<div class="line"><a id="l02044" name="l02044"></a><span class="lineno"> 2044</span>        {</div>
<div class="line"><a id="l02045" name="l02045"></a><span class="lineno"> 2045</span>            <span class="comment">// Headshots all the time</span></div>
<div class="line"><a id="l02046" name="l02046"></a><span class="lineno"> 2046</span>            { 0.0f, 2.0f },</div>
<div class="line"><a id="l02047" name="l02047"></a><span class="lineno"> 2047</span>            <span class="comment">// Critical at medium range</span></div>
<div class="line"><a id="l02048" name="l02048"></a><span class="lineno"> 2048</span>            { 100.0f, 1.8f },</div>
<div class="line"><a id="l02049" name="l02049"></a><span class="lineno"> 2049</span>            <span class="comment">// Critical at short range or good hit at medium</span></div>
<div class="line"><a id="l02050" name="l02050"></a><span class="lineno"> 2050</span>            { 200.0f, 1.6f },</div>
<div class="line"><a id="l02051" name="l02051"></a><span class="lineno"> 2051</span>            <span class="comment">// OK hits at medium</span></div>
<div class="line"><a id="l02052" name="l02052"></a><span class="lineno"> 2052</span>            { 300.0f, 1.45f },</div>
<div class="line"><a id="l02053" name="l02053"></a><span class="lineno"> 2053</span>            <span class="comment">// Point blank headshots</span></div>
<div class="line"><a id="l02054" name="l02054"></a><span class="lineno"> 2054</span>            { 450.0f, 1.30f },</div>
<div class="line"><a id="l02055" name="l02055"></a><span class="lineno"> 2055</span>            <span class="comment">// OK hits at short</span></div>
<div class="line"><a id="l02056" name="l02056"></a><span class="lineno"> 2056</span>            { 700.0f, 1.15f },</div>
<div class="line"><a id="l02057" name="l02057"></a><span class="lineno"> 2057</span>            <span class="comment">// Glances at medium, criticals at point blank</span></div>
<div class="line"><a id="l02058" name="l02058"></a><span class="lineno"> 2058</span>            { 1000.0f, 1.0f },</div>
<div class="line"><a id="l02059" name="l02059"></a><span class="lineno"> 2059</span>            <span class="comment">// Nothing guaranteed, pure gamble</span></div>
<div class="line"><a id="l02060" name="l02060"></a><span class="lineno"> 2060</span>            { 2000.0f, 0.1f },</div>
<div class="line"><a id="l02061" name="l02061"></a><span class="lineno"> 2061</span>        }</div>
<div class="line"><a id="l02062" name="l02062"></a><span class="lineno"> 2062</span>    };</div>
<div class="line"><a id="l02063" name="l02063"></a><span class="lineno"> 2063</span> </div>
<div class="line"><a id="l02064" name="l02064"></a><span class="lineno"> 2064</span>    <span class="keywordtype">float</span> dispersion_factor = <a class="code hl_function" href="cata__utility_8cpp.html#ac49c7bae3c3ac926a5501ffb127c1e97">multi_lerp</a>( dispersion_thresholds, total_dispersion );</div>
<div class="line"><a id="l02065" name="l02065"></a><span class="lineno"> 2065</span> </div>
<div class="line"><a id="l02066" name="l02066"></a><span class="lineno"> 2066</span>    <span class="keywordtype">double</span> <a class="code hl_function" href="namespacenpc__ai.html#a198ce7a4cff534bf1df12f584bff1197">gun_value</a> = dps * dispersion_factor;</div>
<div class="line"><a id="l02067" name="l02067"></a><span class="lineno"> 2067</span> </div>
<div class="line"><a id="l02068" name="l02068"></a><span class="lineno"> 2068</span>    <a class="code hl_function" href="messages_8cpp.html#a54489326fc37823819c5105addfa27f2">add_msg</a>( <a class="code hl_enumvalue" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea9855e523119c93601d8f67718994df05">m_debug</a>, <span class="stringliteral">&quot;%s as gun: %.1f total, %.1f dispersion, %.1f dps&quot;</span>,</div>
<div class="line"><a id="l02069" name="l02069"></a><span class="lineno"> 2069</span>             weap.<a class="code hl_variable" href="classitem.html#ac1d2c4c33b8a499812f3437cb2fad742">type</a>-&gt;<a class="code hl_function" href="structitype.html#abc2596bacfc718fba56ab8076bab5d6b">get_id</a>().<a class="code hl_function" href="classstring__id.html#aa7dabc565f0c067e1a237ea224b18f93">str</a>(), <a class="code hl_function" href="namespacenpc__ai.html#a198ce7a4cff534bf1df12f584bff1197">gun_value</a>, dispersion_factor, dps );</div>
<div class="line"><a id="l02070" name="l02070"></a><span class="lineno"> 2070</span>    <span class="keywordflow">return</span> std::max( 0.0, <a class="code hl_function" href="namespacenpc__ai.html#a198ce7a4cff534bf1df12f584bff1197">gun_value</a> );</div>
<div class="line"><a id="l02071" name="l02071"></a><span class="lineno"> 2071</span>}</div>
<div class="ttc" id="acata__utility_8cpp_html_ac49c7bae3c3ac926a5501ffb127c1e97"><div class="ttname"><a href="cata__utility_8cpp.html#ac49c7bae3c3ac926a5501ffb127c1e97">multi_lerp</a></div><div class="ttdeci">float multi_lerp(const std::vector&lt; std::pair&lt; float, float &gt; &gt; &amp;points, float x)</div><div class="ttdoc">From points, finds p1 and p2 such that p1.first &lt; x &lt; p2.first Then linearly interpolates between p1....</div><div class="ttdef"><b>Definition:</b> <a href="cata__utility_8cpp_source.html#l00157">cata_utility.cpp:157</a></div></div>
<div class="ttc" id="aclassdispersion__sources_html"><div class="ttname"><a href="classdispersion__sources.html">dispersion_sources</a></div><div class="ttdef"><b>Definition:</b> <a href="dispersion_8h_source.html#l00008">dispersion.h:9</a></div></div>
<div class="ttc" id="aclassdispersion__sources_html_ac3dc7f13e78a217aeaba57740f3af17c"><div class="ttname"><a href="classdispersion__sources.html#ac3dc7f13e78a217aeaba57740f3af17c">dispersion_sources::max</a></div><div class="ttdeci">double max() const</div><div class="ttdef"><b>Definition:</b> <a href="dispersion_8cpp_source.html#l00020">dispersion.cpp:20</a></div></div>
<div class="ttc" id="aclassitem_html"><div class="ttname"><a href="classitem.html">item</a></div><div class="ttdef"><b>Definition:</b> <a href="item_8h_source.html#l00209">item.h:210</a></div></div>
<div class="ttc" id="aclassitem_html_a624c3b7ec10ae766a9e75718af71e647"><div class="ttname"><a href="classitem.html#a624c3b7ec10ae766a9e75718af71e647">item::ammo_current</a></div><div class="ttdeci">itype_id ammo_current() const</div><div class="ttdoc">Specific ammo type, returns &quot;null&quot; if item is neither ammo nor loaded with any.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l07576">item.cpp:7576</a></div></div>
<div class="ttc" id="aclassitem_html_a6a3f16444c412bce4b75a7d600d6a3fe"><div class="ttname"><a href="classitem.html#a6a3f16444c412bce4b75a7d600d6a3fe">item::ammo_set</a></div><div class="ttdeci">item &amp; ammo_set(const itype_id &amp;ammo, int qty=-1)</div><div class="ttdoc">Filter setting the ammo for this instance Any existing ammo is removed.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l00593">item.cpp:593</a></div></div>
<div class="ttc" id="aclassitem_html_aa31ffbae3561dd20a3a60e541f6fd02e"><div class="ttname"><a href="classitem.html#aa31ffbae3561dd20a3a60e541f6fd02e">item::ammo_unset</a></div><div class="ttdeci">item &amp; ammo_unset()</div><div class="ttdoc">Filter removing all ammo from this instance If the item is neither a tool, gun nor magazine is a no-o...</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l00683">item.cpp:683</a></div></div>
<div class="ttc" id="aclassitem_html_aa91e9e381f2d96ad24f93b1344fd6276"><div class="ttname"><a href="classitem.html#aa91e9e381f2d96ad24f93b1344fd6276">item::ideal_ranged_dps</a></div><div class="ttdeci">double ideal_ranged_dps(const Character &amp;who, gun_mode &amp;mode) const</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l02079">npcmove.cpp:2079</a></div></div>
<div class="ttc" id="aclassitem_html_ab07d96e30c441a84435972df842f4c77"><div class="ttname"><a href="classitem.html#ab07d96e30c441a84435972df842f4c77">item::ammo_default</a></div><div class="ttdeci">itype_id ammo_default(bool conversion=true) const</div><div class="ttdoc">Get default ammo used by item or a null id if item does not have a default ammo type.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l07613">item.cpp:7613</a></div></div>
<div class="ttc" id="aclassitem_html_ac1d2c4c33b8a499812f3437cb2fad742"><div class="ttname"><a href="classitem.html#ac1d2c4c33b8a499812f3437cb2fad742">item::type</a></div><div class="ttdeci">const itype * type</div><div class="ttdef"><b>Definition:</b> <a href="item_8h_source.html#l02160">item.h:2160</a></div></div>
<div class="ttc" id="aclassstring__id_html_a3ca78345025397b3d3ac22729ba1684b"><div class="ttname"><a href="classstring__id.html#a3ca78345025397b3d3ac22729ba1684b">string_id::is_null</a></div><div class="ttdeci">bool is_null() const</div><div class="ttdoc">Returns whether this represents the id of the null-object (in which case it's the null-id).</div><div class="ttdef"><b>Definition:</b> <a href="string__id_8h_source.html#l00317">string_id.h:317</a></div></div>
<div class="ttc" id="aclassstring__id_html_aa7dabc565f0c067e1a237ea224b18f93"><div class="ttname"><a href="classstring__id.html#aa7dabc565f0c067e1a237ea224b18f93">string_id::str</a></div><div class="ttdeci">const std::string &amp; str() const</div><div class="ttdoc">Returns the identifier as plain std::string.</div><div class="ttdef"><b>Definition:</b> <a href="string__id_8h_source.html#l00255">string_id.h:255</a></div></div>
<div class="ttc" id="aenums_8h_html_a3baf36d700701401b6baf94db93d096ea9855e523119c93601d8f67718994df05"><div class="ttname"><a href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea9855e523119c93601d8f67718994df05">m_debug</a></div><div class="ttdeci">@ m_debug</div><div class="ttdef"><b>Definition:</b> <a href="enums_8h_source.html#l00271">enums.h:271</a></div></div>
<div class="ttc" id="amessages_8cpp_html_a54489326fc37823819c5105addfa27f2"><div class="ttname"><a href="messages_8cpp.html#a54489326fc37823819c5105addfa27f2">add_msg</a></div><div class="ttdeci">void add_msg(std::string msg)</div><div class="ttdef"><b>Definition:</b> <a href="messages_8cpp_source.html#l00910">messages.cpp:910</a></div></div>
<div class="ttc" id="anamespacenpc__ai_html_a0e953b9c8d447ec25fc27c06a6e3d55c"><div class="ttname"><a href="namespacenpc__ai.html#a0e953b9c8d447ec25fc27c06a6e3d55c">npc_ai::best_mode_for_range</a></div><div class="ttdeci">std::pair&lt; gun_mode_id, gun_mode &gt; best_mode_for_range(const Character &amp;who, const item &amp;firing, int dist)</div><div class="ttdoc">Chooses best gun_mode for range.</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01967">ranged.cpp:1967</a></div></div>
<div class="ttc" id="anamespacenpc__ai_html_a198ce7a4cff534bf1df12f584bff1197"><div class="ttname"><a href="namespacenpc__ai.html#a198ce7a4cff534bf1df12f584bff1197">npc_ai::gun_value</a></div><div class="ttdeci">double gun_value(const Character &amp;who, const item &amp;weap, int ammo)</div><div class="ttdoc">Evaluates item as a gun.</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l02009">ranged.cpp:2009</a></div></div>
<div class="ttc" id="anamespaceranged_html_a8b31304e61913a0072ad6df6e16bc932"><div class="ttname"><a href="namespaceranged.html#a8b31304e61913a0072ad6df6e16bc932">ranged::get_weapon_dispersion</a></div><div class="ttdeci">dispersion_sources get_weapon_dispersion(const Character &amp;who, const item &amp;obj)</div><div class="ttdoc">Get weapon's dispersion value modified accoring to character stats.</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01917">ranged.cpp:1917</a></div></div>
<div class="ttc" id="astructitype_html_a623ec8243b1e599086fa3a23c3179370"><div class="ttname"><a href="structitype.html#a623ec8243b1e599086fa3a23c3179370">itype::gun</a></div><div class="ttdeci">cata::value_ptr&lt; islot_gun &gt; gun</div><div class="ttdef"><b>Definition:</b> <a href="itype_8h_source.html#l00827">itype.h:827</a></div></div>
<div class="ttc" id="astructitype_html_a7cb80d77696cefb42ac6e75756b47e60"><div class="ttname"><a href="structitype.html#a7cb80d77696cefb42ac6e75756b47e60">itype::ammo</a></div><div class="ttdeci">cata::value_ptr&lt; islot_ammo &gt; ammo</div><div class="ttdef"><b>Definition:</b> <a href="itype_8h_source.html#l00832">itype.h:832</a></div></div>
<div class="ttc" id="astructitype_html_abc2596bacfc718fba56ab8076bab5d6b"><div class="ttname"><a href="structitype.html#abc2596bacfc718fba56ab8076bab5d6b">itype::get_id</a></div><div class="ttdeci">const itype_id &amp; get_id() const</div><div class="ttdef"><b>Definition:</b> <a href="itype_8cpp_source.html#l00088">itype.cpp:88</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="messages_8cpp_source.html#l00910">add_msg()</a>, <a class="el" href="itype_8h_source.html#l00832">itype::ammo</a>, <a class="el" href="item_8cpp_source.html#l07576">item::ammo_current()</a>, <a class="el" href="item_8cpp_source.html#l07613">item::ammo_default()</a>, <a class="el" href="item_8cpp_source.html#l00593">item::ammo_set()</a>, <a class="el" href="item_8cpp_source.html#l00683">item::ammo_unset()</a>, <a class="el" href="ranged_8cpp_source.html#l01967">best_mode_for_range()</a>, <a class="el" href="itype_8cpp_source.html#l00088">itype::get_id()</a>, <a class="el" href="ranged_8cpp_source.html#l01917">ranged::get_weapon_dispersion()</a>, <a class="el" href="itype_8h_source.html#l00827">itype::gun</a>, <a class="el" href="ranged_8cpp_source.html#l02009">gun_value()</a>, <a class="el" href="npcmove_8cpp_source.html#l02079">item::ideal_ranged_dps()</a>, <a class="el" href="string__id_8h_source.html#l00317">string_id&lt; T &gt;::is_null()</a>, <a class="el" href="enums_8h_source.html#l00271">m_debug</a>, <a class="el" href="dispersion_8cpp_source.html#l00020">dispersion_sources::max()</a>, <a class="el" href="cata__utility_8cpp_source.html#l00157">multi_lerp()</a>, <a class="el" href="string__id_8h_source.html#l00255">string_id&lt; T &gt;::str()</a>, and <a class="el" href="item_8h_source.html#l02160">item::type</a>.</p>

<p class="reference">Referenced by <a class="el" href="ranged_8cpp_source.html#l02009">gun_value()</a>, and <a class="el" href="melee_8cpp_source.html#l02335">weapon_value()</a>.</p>

</div>
</div>
<a id="a15c5ded877137a648d04762228055b66" name="a15c5ded877137a648d04762228055b66"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a15c5ded877137a648d04762228055b66">&#9670;&nbsp;</a></span>melee_value()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double npc_ai::melee_value </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classCharacter.html">Character</a> &amp;&#160;</td>
          <td class="paramname"><em>who</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classitem.html">item</a> &amp;&#160;</td>
          <td class="paramname"><em>weap</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Evaluate item as a melee weapon. </p>

<p class="definition">Definition at line <a class="el" href="melee_8cpp_source.html#l02348">2348</a> of file <a class="el" href="melee_8cpp_source.html">melee.cpp</a>.</p>
<div class="fragment"><div class="line"><a id="l02349" name="l02349"></a><span class="lineno"> 2349</span>{</div>
<div class="line"><a id="l02350" name="l02350"></a><span class="lineno"> 2350</span>    <span class="comment">// start with average effective dps against a range of enemies</span></div>
<div class="line"><a id="l02351" name="l02351"></a><span class="lineno"> 2351</span>    <span class="keywordtype">double</span> my_value = weap.<a class="code hl_function" href="classitem.html#a96c8a18aef6da2f8d876178a3d21dfb0">average_dps</a>( *who.<a class="code hl_function" href="classCreature.html#acb1d0a1210d3dd4c86350f3ad4c58649">as_player</a>() );</div>
<div class="line"><a id="l02352" name="l02352"></a><span class="lineno"> 2352</span> </div>
<div class="line"><a id="l02353" name="l02353"></a><span class="lineno"> 2353</span>    <span class="keywordtype">float</span> reach = weap.<a class="code hl_function" href="classitem.html#a04985a2b99688b687432463fb2f0a853">reach_range</a>( who );</div>
<div class="line"><a id="l02354" name="l02354"></a><span class="lineno"> 2354</span>    <span class="comment">// value reach weapons more</span></div>
<div class="line"><a id="l02355" name="l02355"></a><span class="lineno"> 2355</span>    <span class="keywordflow">if</span>( reach &gt; 1.0f ) {</div>
<div class="line"><a id="l02356" name="l02356"></a><span class="lineno"> 2356</span>        my_value *= 1.0f + 0.5f * ( std::sqrt( reach ) - 1.0f );</div>
<div class="line"><a id="l02357" name="l02357"></a><span class="lineno"> 2357</span>    }</div>
<div class="line"><a id="l02358" name="l02358"></a><span class="lineno"> 2358</span>    <span class="comment">// value polearms less to account for the trickiness of keeping the right range</span></div>
<div class="line"><a id="l02359" name="l02359"></a><span class="lineno"> 2359</span>    <span class="keywordflow">if</span>( weap.<a class="code hl_function" href="classitem.html#aaa5aeb6f838927babb10ede535cf2a73">has_flag</a>( <span class="stringliteral">&quot;POLEARM&quot;</span> ) ) {</div>
<div class="line"><a id="l02360" name="l02360"></a><span class="lineno"> 2360</span>        my_value *= 0.8;</div>
<div class="line"><a id="l02361" name="l02361"></a><span class="lineno"> 2361</span>    }</div>
<div class="line"><a id="l02362" name="l02362"></a><span class="lineno"> 2362</span> </div>
<div class="line"><a id="l02363" name="l02363"></a><span class="lineno"> 2363</span>    <span class="comment">// value style weapons more</span></div>
<div class="line"><a id="l02364" name="l02364"></a><span class="lineno"> 2364</span>    <span class="keywordflow">if</span>( !who.<a class="code hl_variable" href="classCharacter.html#a313797e99525bfd2a5ead68b7672f168">martial_arts_data</a>-&gt;enumerate_known_styles( weap.<a class="code hl_variable" href="classitem.html#ac1d2c4c33b8a499812f3437cb2fad742">type</a>-&gt;<a class="code hl_function" href="structitype.html#abc2596bacfc718fba56ab8076bab5d6b">get_id</a>() ).empty() ) {</div>
<div class="line"><a id="l02365" name="l02365"></a><span class="lineno"> 2365</span>        my_value *= 1.5;</div>
<div class="line"><a id="l02366" name="l02366"></a><span class="lineno"> 2366</span>    }</div>
<div class="line"><a id="l02367" name="l02367"></a><span class="lineno"> 2367</span> </div>
<div class="line"><a id="l02368" name="l02368"></a><span class="lineno"> 2368</span>    <a class="code hl_function" href="messages_8cpp.html#a54489326fc37823819c5105addfa27f2">add_msg</a>( <a class="code hl_enumvalue" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea9855e523119c93601d8f67718994df05">m_debug</a>, <span class="stringliteral">&quot;%s as melee: %.1f&quot;</span>, weap.<a class="code hl_variable" href="classitem.html#ac1d2c4c33b8a499812f3437cb2fad742">type</a>-&gt;<a class="code hl_function" href="structitype.html#abc2596bacfc718fba56ab8076bab5d6b">get_id</a>().<a class="code hl_function" href="classstring__id.html#aa7dabc565f0c067e1a237ea224b18f93">str</a>(), my_value );</div>
<div class="line"><a id="l02369" name="l02369"></a><span class="lineno"> 2369</span> </div>
<div class="line"><a id="l02370" name="l02370"></a><span class="lineno"> 2370</span>    <span class="keywordflow">return</span> std::max( 0.0, my_value );</div>
<div class="line"><a id="l02371" name="l02371"></a><span class="lineno"> 2371</span>}</div>
<div class="ttc" id="aclassCharacter_html_a313797e99525bfd2a5ead68b7672f168"><div class="ttname"><a href="classCharacter.html#a313797e99525bfd2a5ead68b7672f168">Character::martial_arts_data</a></div><div class="ttdeci">pimpl&lt; character_martial_arts &gt; martial_arts_data</div><div class="ttdef"><b>Definition:</b> <a href="character_8h_source.html#l01588">character.h:1588</a></div></div>
<div class="ttc" id="aclassCreature_html_acb1d0a1210d3dd4c86350f3ad4c58649"><div class="ttname"><a href="classCreature.html#acb1d0a1210d3dd4c86350f3ad4c58649">Creature::as_player</a></div><div class="ttdeci">virtual player * as_player()</div><div class="ttdef"><b>Definition:</b> <a href="creature_8h_source.html#l00122">creature.h:122</a></div></div>
<div class="ttc" id="aclassitem_html_a04985a2b99688b687432463fb2f0a853"><div class="ttname"><a href="classitem.html#a04985a2b99688b687432463fb2f0a853">item::reach_range</a></div><div class="ttdeci">int reach_range(const Character &amp;guy) const</div><div class="ttdoc">Max range of melee attack this weapon can be used for.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l05290">item.cpp:5290</a></div></div>
<div class="ttc" id="aclassitem_html_a96c8a18aef6da2f8d876178a3d21dfb0"><div class="ttname"><a href="classitem.html#a96c8a18aef6da2f8d876178a3d21dfb0">item::average_dps</a></div><div class="ttdeci">double average_dps(const player &amp;guy) const</div><div class="ttdoc">return the average dps of the weapon against evaluation monsters</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l01451">item.cpp:1451</a></div></div>
<div class="ttc" id="aclassitem_html_aaa5aeb6f838927babb10ede535cf2a73"><div class="ttname"><a href="classitem.html#aaa5aeb6f838927babb10ede535cf2a73">item::has_flag</a></div><div class="ttdeci">bool has_flag(const std::string &amp;flag) const</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l05328">item.cpp:5328</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="messages_8cpp_source.html#l00910">add_msg()</a>, <a class="el" href="creature_8h_source.html#l00122">Creature::as_player()</a>, <a class="el" href="item_8cpp_source.html#l01451">item::average_dps()</a>, <a class="el" href="itype_8cpp_source.html#l00088">itype::get_id()</a>, <a class="el" href="item_8cpp_source.html#l05328">item::has_flag()</a>, <a class="el" href="enums_8h_source.html#l00271">m_debug</a>, <a class="el" href="character_8h_source.html#l01588">Character::martial_arts_data</a>, <a class="el" href="item_8cpp_source.html#l05290">item::reach_range()</a>, <a class="el" href="string__id_8h_source.html#l00255">string_id&lt; T &gt;::str()</a>, and <a class="el" href="item_8h_source.html#l02160">item::type</a>.</p>

<p class="reference">Referenced by <a class="el" href="npc_8cpp_source.html#l02177">npc::average_damage_dealt()</a>, <a class="el" href="melee_8cpp_source.html#l02373">unarmed_value()</a>, <a class="el" href="melee_8cpp_source.html#l02335">weapon_value()</a>, and <a class="el" href="npcmove_8cpp_source.html#l03442">npc::wield_better_weapon()</a>.</p>

</div>
</div>
<a id="a64daf871b45496787e445f932f4381d3" name="a64daf871b45496787e445f932f4381d3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a64daf871b45496787e445f932f4381d3">&#9670;&nbsp;</a></span>unarmed_value()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double npc_ai::unarmed_value </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classCharacter.html">Character</a> &amp;&#160;</td>
          <td class="paramname"><em>who</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Evaluate unarmed melee value. </p>

<p class="definition">Definition at line <a class="el" href="melee_8cpp_source.html#l02373">2373</a> of file <a class="el" href="melee_8cpp_source.html">melee.cpp</a>.</p>
<div class="fragment"><div class="line"><a id="l02374" name="l02374"></a><span class="lineno"> 2374</span>{</div>
<div class="line"><a id="l02375" name="l02375"></a><span class="lineno"> 2375</span>    <span class="comment">// TODO: Martial arts</span></div>
<div class="line"><a id="l02376" name="l02376"></a><span class="lineno"> 2376</span>    <span class="keywordflow">return</span> <a class="code hl_function" href="namespacenpc__ai.html#a15c5ded877137a648d04762228055b66">melee_value</a>( who, <a class="code hl_class" href="classitem.html">item</a>() );</div>
<div class="line"><a id="l02377" name="l02377"></a><span class="lineno"> 2377</span>}</div>
<div class="ttc" id="anamespacenpc__ai_html_a15c5ded877137a648d04762228055b66"><div class="ttname"><a href="namespacenpc__ai.html#a15c5ded877137a648d04762228055b66">npc_ai::melee_value</a></div><div class="ttdeci">double melee_value(const Character &amp;who, const item &amp;weap)</div><div class="ttdoc">Evaluate item as a melee weapon.</div><div class="ttdef"><b>Definition:</b> <a href="melee_8cpp_source.html#l02348">melee.cpp:2348</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="melee_8cpp_source.html#l02348">melee_value()</a>.</p>

</div>
</div>
<a id="a6fa541a904a63a5b95b20ce9000254d8" name="a6fa541a904a63a5b95b20ce9000254d8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6fa541a904a63a5b95b20ce9000254d8">&#9670;&nbsp;</a></span>weapon_value()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double npc_ai::weapon_value </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classCharacter.html">Character</a> &amp;&#160;</td>
          <td class="paramname"><em>who</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classitem.html">item</a> &amp;&#160;</td>
          <td class="paramname"><em>weap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ammo</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Evaluate item as weapon (melee or gun) </p>

<p class="definition">Definition at line <a class="el" href="melee_8cpp_source.html#l02335">2335</a> of file <a class="el" href="melee_8cpp_source.html">melee.cpp</a>.</p>
<div class="fragment"><div class="line"><a id="l02336" name="l02336"></a><span class="lineno"> 2336</span>{</div>
<div class="line"><a id="l02337" name="l02337"></a><span class="lineno"> 2337</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> val_gun = <a class="code hl_function" href="namespacenpc__ai.html#a198ce7a4cff534bf1df12f584bff1197">gun_value</a>( who, weap, ammo );</div>
<div class="line"><a id="l02338" name="l02338"></a><span class="lineno"> 2338</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> val_melee = <a class="code hl_function" href="namespacenpc__ai.html#a15c5ded877137a648d04762228055b66">melee_value</a>( who, weap );</div>
<div class="line"><a id="l02339" name="l02339"></a><span class="lineno"> 2339</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code hl_enumvalue" href="namespacedetail_1_1digits.html#aad69d2373aa047bdd9e81494bf3da5aea74589f67c5fc9945d7dde9d16aecda3a">more</a> = std::max( val_gun, val_melee );</div>
<div class="line"><a id="l02340" name="l02340"></a><span class="lineno"> 2340</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> less = std::min( val_gun, val_melee );</div>
<div class="line"><a id="l02341" name="l02341"></a><span class="lineno"> 2341</span> </div>
<div class="line"><a id="l02342" name="l02342"></a><span class="lineno"> 2342</span>    <span class="comment">// A small bonus for guns you can also use to hit stuff with (bayonets etc.)</span></div>
<div class="line"><a id="l02343" name="l02343"></a><span class="lineno"> 2343</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> my_val = ( <a class="code hl_enumvalue" href="namespacedetail_1_1digits.html#aad69d2373aa047bdd9e81494bf3da5aea74589f67c5fc9945d7dde9d16aecda3a">more</a> + ( less / 2.0 ) );</div>
<div class="line"><a id="l02344" name="l02344"></a><span class="lineno"> 2344</span>    <a class="code hl_function" href="messages_8cpp.html#a54489326fc37823819c5105addfa27f2">add_msg</a>( <a class="code hl_enumvalue" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea9855e523119c93601d8f67718994df05">m_debug</a>, <span class="stringliteral">&quot;%s (%ld ammo) sum value: %.1f&quot;</span>, weap.<a class="code hl_variable" href="classitem.html#ac1d2c4c33b8a499812f3437cb2fad742">type</a>-&gt;<a class="code hl_function" href="structitype.html#abc2596bacfc718fba56ab8076bab5d6b">get_id</a>().<a class="code hl_function" href="classstring__id.html#aa7dabc565f0c067e1a237ea224b18f93">str</a>(), ammo, my_val );</div>
<div class="line"><a id="l02345" name="l02345"></a><span class="lineno"> 2345</span>    <span class="keywordflow">return</span> my_val;</div>
<div class="line"><a id="l02346" name="l02346"></a><span class="lineno"> 2346</span>}</div>
<div class="ttc" id="anamespacedetail_1_1digits_html_aad69d2373aa047bdd9e81494bf3da5aea74589f67c5fc9945d7dde9d16aecda3a"><div class="ttname"><a href="namespacedetail_1_1digits.html#aad69d2373aa047bdd9e81494bf3da5aea74589f67c5fc9945d7dde9d16aecda3a">detail::digits::more</a></div><div class="ttdeci">@ more</div><div class="ttdef"><b>Definition:</b> <a href="fmtlib__format-inl_8h_source.html#l01627">fmtlib_format-inl.h:1627</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="messages_8cpp_source.html#l00910">add_msg()</a>, <a class="el" href="itype_8cpp_source.html#l00088">itype::get_id()</a>, <a class="el" href="ranged_8cpp_source.html#l02009">gun_value()</a>, <a class="el" href="enums_8h_source.html#l00271">m_debug</a>, <a class="el" href="melee_8cpp_source.html#l02348">melee_value()</a>, <a class="el" href="fmtlib__format-inl_8h_source.html#l01627">detail::digits::more</a>, <a class="el" href="string__id_8h_source.html#l00255">string_id&lt; T &gt;::str()</a>, and <a class="el" href="item_8h_source.html#l02160">item::type</a>.</p>

<p class="reference">Referenced by <a class="el" href="npctalk_8cpp_source.html#l03374">give_item_to()</a>, <a class="el" href="npc_8cpp_source.html#l01742">npc::value()</a>, and <a class="el" href="melee_8cpp_source.html#l02319">wielded_value()</a>.</p>

</div>
</div>
<a id="a03081587a4844207a7386844f8a31cd5" name="a03081587a4844207a7386844f8a31cd5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a03081587a4844207a7386844f8a31cd5">&#9670;&nbsp;</a></span>wielded_value()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double npc_ai::wielded_value </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classCharacter.html">Character</a> &amp;&#160;</td>
          <td class="paramname"><em>who</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Evaluate wielded weapon's ideal value. </p>

<p class="definition">Definition at line <a class="el" href="melee_8cpp_source.html#l02319">2319</a> of file <a class="el" href="melee_8cpp_source.html">melee.cpp</a>.</p>
<div class="fragment"><div class="line"><a id="l02320" name="l02320"></a><span class="lineno"> 2320</span>{</div>
<div class="line"><a id="l02321" name="l02321"></a><span class="lineno"> 2321</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> cached = *who.<a class="code hl_function" href="classCharacter.html#af27efb6a73d59f0fb275a23a44afb46b">get_npc_ai_info_cache</a>( <a class="code hl_enumvalue" href="character_8h.html#addab86bfe6fd0bf8c22ec43df3ec051da6c1d5de20741d1572a1638942c179e99">npc_ai_info::ideal_weapon_value</a> );</div>
<div class="line"><a id="l02322" name="l02322"></a><span class="lineno"> 2322</span>    <span class="keywordflow">if</span>( cached &gt;= 0.0 ) {</div>
<div class="line"><a id="l02323" name="l02323"></a><span class="lineno"> 2323</span>        <a class="code hl_function" href="messages_8cpp.html#a54489326fc37823819c5105addfa27f2">add_msg</a>( <a class="code hl_enumvalue" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea9855e523119c93601d8f67718994df05">m_debug</a>, <span class="stringliteral">&quot;%s ideal sum value: %.1f&quot;</span>, who.<a class="code hl_function" href="classCharacter.html#a9cec37becf60e594b4978cb8f8c5278b">primary_weapon</a>().<a class="code hl_variable" href="classitem.html#ac1d2c4c33b8a499812f3437cb2fad742">type</a>-&gt;<a class="code hl_function" href="structitype.html#abc2596bacfc718fba56ab8076bab5d6b">get_id</a>().<a class="code hl_function" href="classstring__id.html#aa7dabc565f0c067e1a237ea224b18f93">str</a>(), cached );</div>
<div class="line"><a id="l02324" name="l02324"></a><span class="lineno"> 2324</span>        <span class="keywordflow">return</span> cached;</div>
<div class="line"><a id="l02325" name="l02325"></a><span class="lineno"> 2325</span>    }</div>
<div class="line"><a id="l02326" name="l02326"></a><span class="lineno"> 2326</span>    <a class="code hl_class" href="classitem.html">item</a> ideal_weapon = who.<a class="code hl_function" href="classCharacter.html#a9cec37becf60e594b4978cb8f8c5278b">primary_weapon</a>();</div>
<div class="line"><a id="l02327" name="l02327"></a><span class="lineno"> 2327</span>    <span class="keywordflow">if</span>( !ideal_weapon.<a class="code hl_function" href="classitem.html#ab07d96e30c441a84435972df842f4c77">ammo_default</a>().<a class="code hl_function" href="classstring__id.html#a3ca78345025397b3d3ac22729ba1684b">is_null</a>() ) {</div>
<div class="line"><a id="l02328" name="l02328"></a><span class="lineno"> 2328</span>        ideal_weapon.<a class="code hl_function" href="classitem.html#a6a3f16444c412bce4b75a7d600d6a3fe">ammo_set</a>( ideal_weapon.<a class="code hl_function" href="classitem.html#ab07d96e30c441a84435972df842f4c77">ammo_default</a>(), -1 );</div>
<div class="line"><a id="l02329" name="l02329"></a><span class="lineno"> 2329</span>    }</div>
<div class="line"><a id="l02330" name="l02330"></a><span class="lineno"> 2330</span>    <span class="keywordtype">double</span> weap_val = <a class="code hl_function" href="namespacenpc__ai.html#a6fa541a904a63a5b95b20ce9000254d8">weapon_value</a>( who, ideal_weapon, ideal_weapon.<a class="code hl_function" href="classitem.html#a5d89f04a2a08245ec865db0865e8a6c1">ammo_capacity</a>() );</div>
<div class="line"><a id="l02331" name="l02331"></a><span class="lineno"> 2331</span>    who.<a class="code hl_function" href="classCharacter.html#afcedb6ffb07cd9b269a7bbd63dc0f418">set_npc_ai_info_cache</a>( <a class="code hl_enumvalue" href="character_8h.html#addab86bfe6fd0bf8c22ec43df3ec051da6c1d5de20741d1572a1638942c179e99">npc_ai_info::ideal_weapon_value</a>, weap_val );</div>
<div class="line"><a id="l02332" name="l02332"></a><span class="lineno"> 2332</span>    <span class="keywordflow">return</span> weap_val;</div>
<div class="line"><a id="l02333" name="l02333"></a><span class="lineno"> 2333</span>}</div>
<div class="ttc" id="acharacter_8h_html_addab86bfe6fd0bf8c22ec43df3ec051da6c1d5de20741d1572a1638942c179e99"><div class="ttname"><a href="character_8h.html#addab86bfe6fd0bf8c22ec43df3ec051da6c1d5de20741d1572a1638942c179e99">ideal_weapon_value</a></div><div class="ttdeci">@ ideal_weapon_value</div><div class="ttdef"><b>Definition:</b> <a href="character_8h_source.html#l00101">character.h:101</a></div></div>
<div class="ttc" id="aclassCharacter_html_a9cec37becf60e594b4978cb8f8c5278b"><div class="ttname"><a href="classCharacter.html#a9cec37becf60e594b4978cb8f8c5278b">Character::primary_weapon</a></div><div class="ttdeci">item &amp; primary_weapon()</div><div class="ttdoc">Legacy code hack, don't use.</div><div class="ttdef"><b>Definition:</b> <a href="melee_8cpp_source.html#l00166">melee.cpp:166</a></div></div>
<div class="ttc" id="aclassCharacter_html_af27efb6a73d59f0fb275a23a44afb46b"><div class="ttname"><a href="classCharacter.html#af27efb6a73d59f0fb275a23a44afb46b">Character::get_npc_ai_info_cache</a></div><div class="ttdeci">std::optional&lt; double &gt; get_npc_ai_info_cache(npc_ai_info key) const</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l10641">character.cpp:10641</a></div></div>
<div class="ttc" id="aclassCharacter_html_afcedb6ffb07cd9b269a7bbd63dc0f418"><div class="ttname"><a href="classCharacter.html#afcedb6ffb07cd9b269a7bbd63dc0f418">Character::set_npc_ai_info_cache</a></div><div class="ttdeci">void set_npc_ai_info_cache(npc_ai_info key, double val) const</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l10636">character.cpp:10636</a></div></div>
<div class="ttc" id="aclassitem_html_a5d89f04a2a08245ec865db0865e8a6c1"><div class="ttname"><a href="classitem.html#a5d89f04a2a08245ec865db0865e8a6c1">item::ammo_capacity</a></div><div class="ttdeci">int ammo_capacity() const</div><div class="ttdoc">Maximum quantity of ammunition loadable for tool, gun or auxiliary gunmod.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l07426">item.cpp:7426</a></div></div>
<div class="ttc" id="anamespacenpc__ai_html_a6fa541a904a63a5b95b20ce9000254d8"><div class="ttname"><a href="namespacenpc__ai.html#a6fa541a904a63a5b95b20ce9000254d8">npc_ai::weapon_value</a></div><div class="ttdeci">double weapon_value(const Character &amp;who, const item &amp;weap, int ammo)</div><div class="ttdoc">Evaluate item as weapon (melee or gun)</div><div class="ttdef"><b>Definition:</b> <a href="melee_8cpp_source.html#l02335">melee.cpp:2335</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="messages_8cpp_source.html#l00910">add_msg()</a>, <a class="el" href="item_8cpp_source.html#l07426">item::ammo_capacity()</a>, <a class="el" href="item_8cpp_source.html#l07613">item::ammo_default()</a>, <a class="el" href="item_8cpp_source.html#l00593">item::ammo_set()</a>, <a class="el" href="itype_8cpp_source.html#l00088">itype::get_id()</a>, <a class="el" href="character_8cpp_source.html#l10641">Character::get_npc_ai_info_cache()</a>, <a class="el" href="character_8h_source.html#l00101">ideal_weapon_value</a>, <a class="el" href="string__id_8h_source.html#l00317">string_id&lt; T &gt;::is_null()</a>, <a class="el" href="enums_8h_source.html#l00271">m_debug</a>, <a class="el" href="melee_8cpp_source.html#l00166">Character::primary_weapon()</a>, <a class="el" href="character_8cpp_source.html#l10636">Character::set_npc_ai_info_cache()</a>, <a class="el" href="string__id_8h_source.html#l00255">string_id&lt; T &gt;::str()</a>, <a class="el" href="item_8h_source.html#l02160">item::type</a>, and <a class="el" href="melee_8cpp_source.html#l02335">weapon_value()</a>.</p>

<p class="reference">Referenced by <a class="el" href="npcmove_8cpp_source.html#l00629">npc::character_danger()</a>, <a class="el" href="npc_8cpp_source.html#l01482">npc::decide_needs()</a>, <a class="el" href="npc_8cpp_source.html#l01209">npc::form_opinion()</a>, <a class="el" href="avatar__action_8cpp_source.html#l00588">rate_critter()</a>, <a class="el" href="npcmove_8cpp_source.html#l00651">npc::regen_ai_cache()</a>, and <a class="el" href="npc_8cpp_source.html#l01742">npc::value()</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacenpc__ai.html">npc_ai</a></li>
    <li class="footer">Generated on Sat Aug 26 2023 10:03:02 for Cataclysm BN by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.2 </li>
  </ul>
</div>
</body>
</html>
